{
  "version": 3,
  "sources": ["../../lambda/admin/shoutouts.ts"],
  "sourcesContent": ["// lambda/admin/shoutouts.ts\r\n//\r\n// Admin-only shoutouts & targeted invites.\r\n// This is a minimal stub so AdminStack can deploy cleanly.\r\n// You can later wire this into SNS/SES/EventBridge, etc.\r\n\r\ntype AppSyncIdentity = {\r\n  sub?: string;\r\n  username?: string;\r\n  claims?: { [key: string]: any };\r\n  groups?: string[] | null;\r\n};\r\n\r\ntype AppSyncEvent = {\r\n  identity?: AppSyncIdentity;\r\n  info: { fieldName: string };\r\n  arguments: any;\r\n};\r\n\r\nfunction isAdmin(identity?: AppSyncIdentity): boolean {\r\n  if (!identity) return false;\r\n\r\n  const claimsGroups =\r\n    identity.claims?.[\"cognito:groups\"] ??\r\n    identity.claims?.[\"custom:groups\"] ??\r\n    identity.groups;\r\n\r\n  const groups = Array.isArray(claimsGroups)\r\n    ? claimsGroups\r\n    : typeof claimsGroups === \"string\"\r\n    ? claimsGroups.split(\",\")\r\n    : [];\r\n\r\n  // IdentityStack created \"admin\" and \"creator\" groups\r\n  return groups.includes(\"admin\") || groups.includes(\"ADMIN\");\r\n}\r\n\r\nexport const handler = async (event: AppSyncEvent) => {\r\n  const identity = event.identity;\r\n  const field = event.info.fieldName;\r\n\r\n  if (!identity?.sub) {\r\n    throw new Error(\"Unauthorized\");\r\n  }\r\n\r\n  if (!isAdmin(identity)) {\r\n    throw new Error(\"Forbidden\");\r\n  }\r\n\r\n  switch (field) {\r\n    // Admin \u2192 send a broadcast shoutout (e.g. SNS / push in future)\r\n    case \"adminSendShoutout\": {\r\n      const { message, audience } = event.arguments || {};\r\n      return {\r\n        ok: true,\r\n        delivered: false, // will flip to true once SNS/SES is wired\r\n        message: message ?? \"\",\r\n        audience: audience ?? \"ALL\",\r\n        sentAt: new Date().toISOString(),\r\n      };\r\n    }\r\n\r\n    // Admin \u2192 send a targeted invite (email or userId list)\r\n    case \"adminSendTargetedInvite\": {\r\n      const { email, userId, templateId } = event.arguments || {};\r\n      return {\r\n        ok: true,\r\n        delivered: false,\r\n        email: email ?? null,\r\n        userId: userId ?? null,\r\n        templateId: templateId ?? null,\r\n        sentAt: new Date().toISOString(),\r\n      };\r\n    }\r\n\r\n    // Fallback for any future admin shoutout fields\r\n    default:\r\n      return {\r\n        ok: true,\r\n        handled: false,\r\n        field,\r\n      };\r\n  }\r\n};\r\n"],
  "mappings": "yaAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,aAAAE,IAAA,eAAAC,EAAAH,GAmBA,SAASI,EAAQC,EAAqC,CAnBtD,IAAAC,EAAAC,EAoBE,GAAI,CAACF,EAAU,MAAO,GAEtB,IAAMG,IACJF,EAAAD,EAAS,SAAT,YAAAC,EAAkB,sBAClBC,EAAAF,EAAS,SAAT,YAAAE,EAAkB,mBAClBF,EAAS,OAELI,EAAS,MAAM,QAAQD,CAAY,EACrCA,EACA,OAAOA,GAAiB,SACxBA,EAAa,MAAM,GAAG,EACtB,CAAC,EAGL,OAAOC,EAAO,SAAS,OAAO,GAAKA,EAAO,SAAS,OAAO,CAC5D,CAEO,IAAMP,EAAU,MAAOQ,GAAwB,CACpD,IAAML,EAAWK,EAAM,SACjBC,EAAQD,EAAM,KAAK,UAEzB,GAAI,EAACL,GAAA,MAAAA,EAAU,KACb,MAAM,IAAI,MAAM,cAAc,EAGhC,GAAI,CAACD,EAAQC,CAAQ,EACnB,MAAM,IAAI,MAAM,WAAW,EAG7B,OAAQM,EAAO,CAEb,IAAK,oBAAqB,CACxB,GAAM,CAAE,QAAAC,EAAS,SAAAC,CAAS,EAAIH,EAAM,WAAa,CAAC,EAClD,MAAO,CACL,GAAI,GACJ,UAAW,GACX,QAASE,GAAW,GACpB,SAAUC,GAAY,MACtB,OAAQ,IAAI,KAAK,EAAE,YAAY,CACjC,CACF,CAGA,IAAK,0BAA2B,CAC9B,GAAM,CAAE,MAAAC,EAAO,OAAAC,EAAQ,WAAAC,CAAW,EAAIN,EAAM,WAAa,CAAC,EAC1D,MAAO,CACL,GAAI,GACJ,UAAW,GACX,MAAOI,GAAS,KAChB,OAAQC,GAAU,KAClB,WAAYC,GAAc,KAC1B,OAAQ,IAAI,KAAK,EAAE,YAAY,CACjC,CACF,CAGA,QACE,MAAO,CACL,GAAI,GACJ,QAAS,GACT,MAAAL,CACF,CACJ,CACF",
  "names": ["shoutouts_exports", "__export", "handler", "__toCommonJS", "isAdmin", "identity", "_a", "_b", "claimsGroups", "groups", "event", "field", "message", "audience", "email", "userId", "templateId"]
}
