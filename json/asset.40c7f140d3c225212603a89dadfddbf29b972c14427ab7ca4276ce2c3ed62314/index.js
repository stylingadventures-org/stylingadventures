"use strict";var m=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames;var S=Object.prototype.hasOwnProperty;var T=(e,t)=>{for(var r in t)m(e,r,{get:t[r],enumerable:!0})},b=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of C(t))!S.call(e,i)&&i!==r&&m(e,i,{get:()=>t[i],enumerable:!(n=E(t,i))||n.enumerable});return e};var P=e=>b(m({},"__esModule",{value:!0}),e);var D={};T(D,{handler:()=>x});module.exports=P(D);var a=require("@aws-sdk/client-dynamodb"),s=require("@aws-sdk/util-dynamodb"),o=require("crypto"),u=new a.DynamoDBClient({}),l=process.env.TABLE_NAME;function c(e){if(!e?.sub)throw new Error("Not authenticated")}function d(e){let r=(e?.claims||{})["cognito:groups"],n=Array.isArray(r)?r:String(r||"").split(",").map(i=>i.trim()).filter(Boolean);return n.includes("CREATOR")||n.includes("COLLAB")||n.includes("ADMIN")||n.includes("PRIME")}function g(e){let r=(e?.claims||{})["cognito:groups"],n=Array.isArray(r)?r:String(r||"").split(",").map(i=>i.trim()).filter(Boolean);return n.includes("ADMIN")||n.includes("PRIME")}function I(){return new Date().toISOString()}function p(e){return`CREATOR#${e}#FORECAST`}function R(e){return`FORECAST#${e}`}var f=e=>(0,s.marshall)(e,{removeUndefinedValues:!0});async function w(e,t){if(c(t),!d(t))throw new Error("Creator tier required");let n=((await u.send(new a.QueryCommand({TableName:l,KeyConditionExpression:"pk = :pk",ScanIndexForward:!1,Limit:1,ExpressionAttributeValues:f({":pk":p(e.creatorId)})}))).Items??[])[0];return n?(0,s.unmarshall)(n):null}async function F(e,t){if(c(t),!d(t))throw new Error("Creator tier required");let r=Math.min(e.limit??10,50),n=await u.send(new a.QueryCommand({TableName:l,KeyConditionExpression:"pk = :pk",ScanIndexForward:!1,Limit:r,ExpressionAttributeValues:f({":pk":p(e.creatorId)}),ExclusiveStartKey:e.nextToken?JSON.parse(Buffer.from(e.nextToken,"base64").toString()):void 0})),i=(n.Items??[]).map(h=>(0,s.unmarshall)(h)),y=null;return n.LastEvaluatedKey&&(y=Buffer.from(JSON.stringify(n.LastEvaluatedKey)).toString("base64")),{items:i,nextToken:y}}async function k(e,t){if(c(t),!d(t))throw new Error("Creator tier required");let r=await w(e,t);return{id:(0,o.randomUUID)(),creatorId:e.creatorId,reportDate:I(),analyticsSnapshot:{followers:1e4,followersThisWeek:150,engagement:.045,engagementThisWeek:.048,contentPosted:5,avgLikes:234,avgComments:12,avgShares:8,topContentType:"REEL",peakEngagementTime:"19:00 EST"},forecasts:r?[r]:[],recommendations:[]}}async function A(e){if(c(e),!d(e))throw new Error("Creator tier required");return[{id:(0,o.randomUUID)(),forecastId:"PLATFORM",trendName:"Micro-Episode Format Growth",category:"CONTENT_FORMAT",probability:.82,relevance:"HIGH",actionItems:["Create 5-10 min episodes","Focus on serialization"]},{id:(0,o.randomUUID)(),forecastId:"PLATFORM",trendName:"Creator Collabs on Music",category:"MUSIC",probability:.76,relevance:"HIGH",actionItems:["Partner with producers","Release duets/remixes"]}]}async function M(e,t){if(c(t),!d(t))throw new Error("Creator tier required");return[{id:(0,o.randomUUID)(),forecastId:(0,o.randomUUID)(),priority:1,title:"Increase posting frequency",description:"Post 3-4x per week for optimal engagement",expectedOutcome:"15-20% follower growth",timeframe:"30 days",resourcesNeeded:["Content planning","Scheduling tool"],successMetrics:["Engagement rate > 5%","Follower growth > 10%"]}]}async function N(e,t){if(!g(t))throw new Error("ADMIN required");let r=(0,o.randomUUID)(),n=I(),i={id:r,creatorId:e.creatorId,forecastId:r,generatedAt:n,forecastPeriod:e.forecastPeriod,growthPrediction:{currentFollowers:1e4,projectedFollowers:11500,growthRate:.15,engagementRate:.045,projectedEngagementRate:.052,estRevenueImpact:1200},audienceSentiment:{overallSentiment:"POSITIVE",positivePercent:72,neutralPercent:20,negativePercent:8,sentimentTrend:"IMPROVING",keyTopics:["Fashion","Music","Behind-the-scenes"],communityHealth:8},trendPredictions:[],riskFactors:[{id:(0,o.randomUUID)(),forecastId:r,riskName:"Content saturation",severity:"MEDIUM",probability:.35,potentialImpact:"5-10% engagement drop",mitigationStrategy:"Diversify content types"}],opportunities:[{id:(0,o.randomUUID)(),forecastId:r,opportunityName:"Sponsor partnership",category:"SPONSORSHIP",estimatedValue:5e3,timeWindow:"60 days",actionItems:["Pitch deck","Media kit"],difficulty:"MEDIUM"}],recommendations:[],confidence:.82,lastUpdated:n};return await u.send(new a.PutItemCommand({TableName:l,Item:f({pk:p(e.creatorId),sk:R(r),entityType:"CREATOR_FORECAST",gsi1pk:`FORECAST#PERIOD#${e.forecastPeriod}`,gsi1sk:n,...i})})),i}async function O(e,t){if(!g(t))throw new Error("ADMIN required");return e.metrics}async function L(e){if(!g(e))throw new Error("ADMIN required");return await A(e)}var x=async e=>{console.log("CreatorForecastResolverFn event",JSON.stringify(e));let t=e.info?.fieldName;try{switch(t){case"creatorLatestForecast":return await w(e.arguments,e.identity);case"creatorForecastHistory":return await F(e.arguments,e.identity);case"creatorReport":return await k(e.arguments,e.identity);case"platformTrendPredictions":return await A(e.identity);case"creatorGrowthRecommendations":return await M(e.arguments,e.identity);case"adminGenerateCreatorForecast":return await N(e.arguments,e.identity);case"adminUpdateAnalyticsSnapshot":return await O(e.arguments,e.identity);case"adminGeneratePlatformTrends":return await L(e.identity);default:throw new Error(`Unknown field: ${t}`)}}catch(r){throw console.error("CreatorForecastResolverFn error",r),r}};0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
