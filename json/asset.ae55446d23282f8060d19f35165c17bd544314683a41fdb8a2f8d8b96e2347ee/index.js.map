{
  "version": 3,
  "sources": ["../../lambda/admin/community-tools.ts"],
  "sourcesContent": ["// lambda/admin/community-tools.ts\r\n//\r\n// Admin-only community & event management:\r\n// - challenges\r\n// - polls/games hooks\r\n// - shoutouts / targeted invites\r\n//\r\n// This is a stub implementation so CDK can deploy cleanly.\r\n// You can flesh out the real logic later (Dynamo, EventBridge, SNS/SES, etc).\r\n\r\ntype AppSyncIdentity = {\r\n  sub?: string;\r\n  username?: string;\r\n  claims?: { [key: string]: any };\r\n  groups?: string[] | null;\r\n};\r\n\r\ntype AppSyncEvent = {\r\n  identity?: AppSyncIdentity;\r\n  info: { fieldName: string };\r\n  arguments: any;\r\n};\r\n\r\nfunction isAdmin(identity?: AppSyncIdentity): boolean {\r\n  if (!identity) return false;\r\n\r\n  const claimsGroups =\r\n    identity.claims?.[\"cognito:groups\"] ??\r\n    identity.claims?.[\"custom:groups\"] ??\r\n    identity.groups;\r\n\r\n  const groups = Array.isArray(claimsGroups)\r\n    ? claimsGroups\r\n    : typeof claimsGroups === \"string\"\r\n    ? claimsGroups.split(\",\")\r\n    : [];\r\n\r\n  // IdentityStack created \"admin\" and \"creator\" groups\r\n  return groups.includes(\"admin\") || groups.includes(\"ADMIN\");\r\n}\r\n\r\nexport const handler = async (event: AppSyncEvent) => {\r\n  const identity = event.identity;\r\n  const field = event.info.fieldName;\r\n\r\n  if (!identity?.sub) {\r\n    throw new Error(\"Unauthorized\");\r\n  }\r\n\r\n  if (!isAdmin(identity)) {\r\n    throw new Error(\"Forbidden\");\r\n  }\r\n\r\n  // From here on, caller is an ADMIN.\r\n\r\n  switch (field) {\r\n    // Launch a challenge (placeholder)\r\n    case \"adminLaunchChallenge\":\r\n      return {\r\n        ok: true,\r\n        challengeId: \"placeholder-challenge-id\",\r\n        createdAt: new Date().toISOString(),\r\n      };\r\n\r\n    // List challenges (placeholder)\r\n    case \"adminListChallenges\":\r\n      return {\r\n        items: [],\r\n        nextToken: null,\r\n      };\r\n\r\n    // Trigger a game / event (placeholder)\r\n    case \"adminTriggerCommunityEvent\":\r\n      return {\r\n        ok: true,\r\n        triggeredAt: new Date().toISOString(),\r\n      };\r\n\r\n    // Send shoutout (placeholder)\r\n    case \"adminSendShoutout\":\r\n      return {\r\n        ok: true,\r\n        sentAt: new Date().toISOString(),\r\n      };\r\n\r\n    // Targeted invite (placeholder)\r\n    case \"adminSendTargetedInvite\":\r\n      return {\r\n        ok: true,\r\n        sentAt: new Date().toISOString(),\r\n      };\r\n\r\n    default:\r\n      // Safe default so adding new fields later won't break deploys\r\n      return {\r\n        ok: true,\r\n        handled: false,\r\n        field,\r\n      };\r\n  }\r\n};\r\n"],
  "mappings": "yaAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,aAAAE,IAAA,eAAAC,EAAAH,GAuBA,SAASI,EAAQC,EAAqC,CAvBtD,IAAAC,EAAAC,EAwBE,GAAI,CAACF,EAAU,MAAO,GAEtB,IAAMG,IACJF,EAAAD,EAAS,SAAT,YAAAC,EAAkB,sBAClBC,EAAAF,EAAS,SAAT,YAAAE,EAAkB,mBAClBF,EAAS,OAELI,EAAS,MAAM,QAAQD,CAAY,EACrCA,EACA,OAAOA,GAAiB,SACxBA,EAAa,MAAM,GAAG,EACtB,CAAC,EAGL,OAAOC,EAAO,SAAS,OAAO,GAAKA,EAAO,SAAS,OAAO,CAC5D,CAEO,IAAMP,EAAU,MAAOQ,GAAwB,CACpD,IAAML,EAAWK,EAAM,SACjBC,EAAQD,EAAM,KAAK,UAEzB,GAAI,EAACL,GAAA,MAAAA,EAAU,KACb,MAAM,IAAI,MAAM,cAAc,EAGhC,GAAI,CAACD,EAAQC,CAAQ,EACnB,MAAM,IAAI,MAAM,WAAW,EAK7B,OAAQM,EAAO,CAEb,IAAK,uBACH,MAAO,CACL,GAAI,GACJ,YAAa,2BACb,UAAW,IAAI,KAAK,EAAE,YAAY,CACpC,EAGF,IAAK,sBACH,MAAO,CACL,MAAO,CAAC,EACR,UAAW,IACb,EAGF,IAAK,6BACH,MAAO,CACL,GAAI,GACJ,YAAa,IAAI,KAAK,EAAE,YAAY,CACtC,EAGF,IAAK,oBACH,MAAO,CACL,GAAI,GACJ,OAAQ,IAAI,KAAK,EAAE,YAAY,CACjC,EAGF,IAAK,0BACH,MAAO,CACL,GAAI,GACJ,OAAQ,IAAI,KAAK,EAAE,YAAY,CACjC,EAEF,QAEE,MAAO,CACL,GAAI,GACJ,QAAS,GACT,MAAAA,CACF,CACJ,CACF",
  "names": ["community_tools_exports", "__export", "handler", "__toCommonJS", "isAdmin", "identity", "_a", "_b", "claimsGroups", "groups", "event", "field"]
}
