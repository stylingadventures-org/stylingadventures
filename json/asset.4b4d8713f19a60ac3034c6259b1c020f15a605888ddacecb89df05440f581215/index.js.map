{
  "version": 3,
  "sources": ["../../lambda/prime/magazine-resolver.ts"],
  "sourcesContent": ["/**\r\n * lambda/prime/magazine-resolver.ts\r\n * \r\n * Handles Prime Magazine queries and mutations:\r\n * - Get current/latest issue\r\n * - Browse magazine archive\r\n * - Retrieve articles and editorials\r\n * - Admin: Create issues, add articles, publish\r\n */\r\n\r\nimport {\r\n  DynamoDBClient,\r\n  PutItemCommand,\r\n  QueryCommand,\r\n  UpdateItemCommand,\r\n  GetItemCommand,\r\n} from \"@aws-sdk/client-dynamodb\";\r\nimport { marshall, unmarshall } from \"@aws-sdk/util-dynamodb\";\r\nimport { randomUUID } from \"crypto\";\r\nimport { AppSyncIdentityCognito } from \"aws-lambda\";\r\n\r\nconst ddb = new DynamoDBClient({});\r\nconst TABLE_NAME = process.env.TABLE_NAME!;\r\n\r\ntype SAIdentity = (AppSyncIdentityCognito & { groups?: string[] | null }) | null | undefined;\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// Auth helpers\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nfunction assertAuth(identity: SAIdentity): asserts identity {\r\n  if (!identity?.sub) throw new Error(\"Not authenticated\");\r\n}\r\n\r\nfunction assertPrime(identity: SAIdentity): void {\r\n  assertAuth(identity);\r\n  const claims = (identity as any)?.claims || {};\r\n  const raw = claims[\"cognito:groups\"];\r\n  const groups = Array.isArray(raw)\r\n    ? raw\r\n    : String(raw || \"\").split(\",\").map((g) => g.trim()).filter(Boolean);\r\n\r\n  if (!groups.includes(\"PRIME\") && !groups.includes(\"ADMIN\")) {\r\n    throw new Error(\"PRIME or ADMIN tier required\");\r\n  }\r\n}\r\n\r\nfunction isAdmin(identity: SAIdentity): boolean {\r\n  const claims = (identity as any)?.claims || {};\r\n  const raw = claims[\"cognito:groups\"];\r\n  const groups = Array.isArray(raw)\r\n    ? raw\r\n    : String(raw || \"\").split(\",\").map((g) => g.trim()).filter(Boolean);\r\n  return groups.includes(\"ADMIN\") || groups.includes(\"PRIME\");\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// Types\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\ninterface PrimeMagazine {\r\n  id: string;\r\n  issueNumber: number;\r\n  title: string;\r\n  theme: string;\r\n  coverImageKey: string;\r\n  coverStory: string;\r\n  publishedAt: string;\r\n  articles: Article[];\r\n  exclusiveContent: ExclusiveFeature[];\r\n  fashionEditorial?: FashionEditorial;\r\n  musicFeature?: MusicFeature;\r\n  viewCount: number;\r\n  likeCount: number;\r\n  status: \"DRAFT\" | \"SCHEDULED\" | \"PUBLISHED\" | \"ARCHIVED\";\r\n}\r\n\r\ninterface Article {\r\n  id: string;\r\n  magazineId: string;\r\n  title: string;\r\n  author: string;\r\n  category: string;\r\n  content: string;\r\n  featuredImages: string[];\r\n  wordCount: number;\r\n  readTime: number;\r\n  createdAt: string;\r\n}\r\n\r\ninterface ExclusiveFeature {\r\n  id: string;\r\n  magazineId: string;\r\n  title: string;\r\n  description: string;\r\n  exclusivityLevel: string;\r\n  viewsCount: number;\r\n}\r\n\r\ninterface FashionEditorial {\r\n  id: string;\r\n  magazineId: string;\r\n  title: string;\r\n  photographyCredit: string;\r\n  stylist: string;\r\n}\r\n\r\ninterface MusicFeature {\r\n  id: string;\r\n  magazineId: string;\r\n  title: string;\r\n  featuredArtist: string;\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// Helpers\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nfunction nowIso() {\r\n  return new Date().toISOString();\r\n}\r\n\r\nfunction pkForMagazine() {\r\n  return \"MAGAZINE#ISSUE\";\r\n}\r\n\r\nfunction skForMagazine(issueNumber: number) {\r\n  return `ISSUE#${issueNumber}`;\r\n}\r\n\r\nconst ddbMarshal = (value: any) =>\r\n  marshall(value, { removeUndefinedValues: true });\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// Queries\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function handleCurrentPrimeMagazine(identity: SAIdentity): Promise<PrimeMagazine | null> {\r\n  assertPrime(identity);\r\n\r\n  const res = await ddb.send(\r\n    new QueryCommand({\r\n      TableName: TABLE_NAME,\r\n      KeyConditionExpression: \"pk = :pk\",\r\n      FilterExpression: \"#status = :published\",\r\n      ExpressionAttributeNames: { \"#status\": \"status\" },\r\n      ExpressionAttributeValues: ddbMarshal({\r\n        \":pk\": pkForMagazine(),\r\n        \":published\": \"PUBLISHED\",\r\n      }),\r\n      ScanIndexForward: false,\r\n      Limit: 1,\r\n    }),\r\n  );\r\n\r\n  const raw = (res.Items ?? [])[0];\r\n  if (!raw) return null;\r\n\r\n  return unmarshall(raw) as PrimeMagazine;\r\n}\r\n\r\nasync function handlePrimeMagazineArchive(\r\n  args: { limit?: number; nextToken?: string },\r\n  identity: SAIdentity,\r\n): Promise<{ items: PrimeMagazine[]; nextToken: string | null }> {\r\n  assertPrime(identity);\r\n\r\n  const limit = Math.min(args.limit ?? 12, 50);\r\n\r\n  const res = await ddb.send(\r\n    new QueryCommand({\r\n      TableName: TABLE_NAME,\r\n      KeyConditionExpression: \"pk = :pk\",\r\n      FilterExpression: \"#status = :published\",\r\n      ExpressionAttributeNames: { \"#status\": \"status\" },\r\n      ExpressionAttributeValues: ddbMarshal({\r\n        \":pk\": pkForMagazine(),\r\n        \":published\": \"PUBLISHED\",\r\n      }),\r\n      ScanIndexForward: false,\r\n      Limit: limit,\r\n      ExclusiveStartKey: args.nextToken\r\n        ? JSON.parse(Buffer.from(args.nextToken, \"base64\").toString())\r\n        : undefined,\r\n    }),\r\n  );\r\n\r\n  const items = (res.Items ?? []).map((raw) => unmarshall(raw) as PrimeMagazine);\r\n\r\n  let nextToken = null;\r\n  if (res.LastEvaluatedKey) {\r\n    nextToken = Buffer.from(JSON.stringify(res.LastEvaluatedKey)).toString(\"base64\");\r\n  }\r\n\r\n  return { items, nextToken };\r\n}\r\n\r\nasync function handlePrimeMagazine(\r\n  args: { issueNumber: number },\r\n  identity: SAIdentity,\r\n): Promise<PrimeMagazine | null> {\r\n  assertPrime(identity);\r\n\r\n  const res = await ddb.send(\r\n    new GetItemCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: ddbMarshal({\r\n        pk: pkForMagazine(),\r\n        sk: skForMagazine(args.issueNumber),\r\n      }),\r\n    }),\r\n  );\r\n\r\n  if (!res.Item) return null;\r\n  return unmarshall(res.Item) as PrimeMagazine;\r\n}\r\n\r\nasync function handleMagazineArticles(\r\n  args: { magazineId: string; category?: string },\r\n  identity: SAIdentity,\r\n): Promise<Article[]> {\r\n  assertPrime(identity);\r\n\r\n  // In production, would query articles by magazineId\r\n  // For now returning empty array as placeholder\r\n  return [];\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// Mutations (Admin only)\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function handleAdminCreateMagazineIssue(\r\n  args: {\r\n    issueNumber: number;\r\n    title: string;\r\n    theme: string;\r\n    coverImageKey: string;\r\n  },\r\n  identity: SAIdentity,\r\n): Promise<PrimeMagazine> {\r\n  assertPrime(identity);\r\n  if (!isAdmin(identity)) throw new Error(\"ADMIN required\");\r\n\r\n  const magazineId = randomUUID();\r\n  const now = nowIso();\r\n\r\n  const magazine: PrimeMagazine = {\r\n    id: magazineId,\r\n    issueNumber: args.issueNumber,\r\n    title: args.title,\r\n    theme: args.theme,\r\n    coverImageKey: args.coverImageKey,\r\n    coverStory: \"\",\r\n    publishedAt: now,\r\n    articles: [],\r\n    exclusiveContent: [],\r\n    viewCount: 0,\r\n    likeCount: 0,\r\n    status: \"DRAFT\",\r\n  };\r\n\r\n  await ddb.send(\r\n    new PutItemCommand({\r\n      TableName: TABLE_NAME,\r\n      Item: ddbMarshal({\r\n        pk: pkForMagazine(),\r\n        sk: skForMagazine(args.issueNumber),\r\n        entityType: \"MAGAZINE\",\r\n        gsi1pk: \"MAGAZINE#STATUS#DRAFT\",\r\n        gsi1sk: now,\r\n        ...magazine,\r\n      }),\r\n    }),\r\n  );\r\n\r\n  return magazine;\r\n}\r\n\r\nasync function handleAdminAddArticle(\r\n  args: {\r\n    magazineId: string;\r\n    title: string;\r\n    author: string;\r\n    category: string;\r\n    content: string;\r\n  },\r\n  identity: SAIdentity,\r\n): Promise<Article> {\r\n  assertPrime(identity);\r\n  if (!isAdmin(identity)) throw new Error(\"ADMIN required\");\r\n\r\n  const article: Article = {\r\n    id: randomUUID(),\r\n    magazineId: args.magazineId,\r\n    title: args.title,\r\n    author: args.author,\r\n    category: args.category,\r\n    content: args.content,\r\n    featuredImages: [],\r\n    wordCount: args.content.split(\" \").length,\r\n    readTime: Math.ceil(args.content.split(\" \").length / 200),\r\n    createdAt: nowIso(),\r\n  };\r\n\r\n  return article;\r\n}\r\n\r\nasync function handleAdminCreateFashionEditorial(\r\n  args: {\r\n    magazineId: string;\r\n    title: string;\r\n    photographyCredit: string;\r\n    stylist: string;\r\n  },\r\n  identity: SAIdentity,\r\n): Promise<FashionEditorial> {\r\n  assertPrime(identity);\r\n  if (!isAdmin(identity)) throw new Error(\"ADMIN required\");\r\n\r\n  const editorial: FashionEditorial = {\r\n    id: randomUUID(),\r\n    magazineId: args.magazineId,\r\n    title: args.title,\r\n    photographyCredit: args.photographyCredit,\r\n    stylist: args.stylist,\r\n  };\r\n\r\n  return editorial;\r\n}\r\n\r\nasync function handleAdminPublishMagazine(\r\n  args: { magazineId: string },\r\n  identity: SAIdentity,\r\n): Promise<PrimeMagazine> {\r\n  assertPrime(identity);\r\n  if (!isAdmin(identity)) throw new Error(\"ADMIN required\");\r\n\r\n  // In production, would find by magazineId and update status\r\n  // For now returning placeholder\r\n  return {\r\n    id: args.magazineId,\r\n    issueNumber: 1,\r\n    title: \"Issue\",\r\n    theme: \"Theme\",\r\n    coverImageKey: \"\",\r\n    coverStory: \"\",\r\n    publishedAt: nowIso(),\r\n    articles: [],\r\n    exclusiveContent: [],\r\n    viewCount: 0,\r\n    likeCount: 0,\r\n    status: \"PUBLISHED\",\r\n  };\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// AppSync Lambda resolver entrypoint\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nexport const handler = async (event: any) => {\r\n  console.log(\"MagazineResolverFn event\", JSON.stringify(event));\r\n\r\n  const fieldName = event.info?.fieldName as string | undefined;\r\n\r\n  try {\r\n    switch (fieldName) {\r\n      case \"currentPrimeMagazine\":\r\n        return await handleCurrentPrimeMagazine(event.identity);\r\n\r\n      case \"primeMagazineArchive\":\r\n        return await handlePrimeMagazineArchive(event.arguments || {}, event.identity);\r\n\r\n      case \"primeMagazine\":\r\n        return await handlePrimeMagazine(event.arguments, event.identity);\r\n\r\n      case \"magazineArticles\":\r\n        return await handleMagazineArticles(event.arguments, event.identity);\r\n\r\n      case \"adminCreateMagazineIssue\":\r\n        return await handleAdminCreateMagazineIssue(event.arguments, event.identity);\r\n\r\n      case \"adminAddArticle\":\r\n        return await handleAdminAddArticle(event.arguments, event.identity);\r\n\r\n      case \"adminCreateFashionEditorial\":\r\n        return await handleAdminCreateFashionEditorial(event.arguments, event.identity);\r\n\r\n      case \"adminPublishMagazine\":\r\n        return await handleAdminPublishMagazine(event.arguments, event.identity);\r\n\r\n      default:\r\n        throw new Error(`Unknown field: ${fieldName}`);\r\n    }\r\n  } catch (err: any) {\r\n    console.error(\"MagazineResolverFn error\", err);\r\n    throw err;\r\n  }\r\n};\r\n"],
  "mappings": "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",
  "names": ["magazine_resolver_exports", "__export", "handler", "__toCommonJS", "import_client_dynamodb", "import_util_dynamodb", "import_crypto", "ddb", "TABLE_NAME", "assertAuth", "identity", "assertPrime", "raw", "groups", "g", "isAdmin", "nowIso", "pkForMagazine", "skForMagazine", "issueNumber", "ddbMarshal", "value", "handleCurrentPrimeMagazine", "handlePrimeMagazineArchive", "args", "limit", "res", "items", "nextToken", "handlePrimeMagazine", "handleMagazineArticles", "handleAdminCreateMagazineIssue", "magazineId", "now", "magazine", "handleAdminAddArticle", "handleAdminCreateFashionEditorial", "handleAdminPublishMagazine", "event", "fieldName", "err"]
}
