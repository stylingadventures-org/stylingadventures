"use strict";var a=Object.defineProperty;var c=Object.getOwnPropertyDescriptor;var A=Object.getOwnPropertyNames;var l=Object.prototype.hasOwnProperty;var L=(e,r)=>{for(var n in r)a(e,n,{get:r[n],enumerable:!0})},d=(e,r,n,i)=>{if(r&&typeof r=="object"||typeof r=="function")for(let t of A(r))!l.call(e,t)&&t!==n&&a(e,t,{get:()=>r[t],enumerable:!(i=c(r,t))||i.enumerable});return e};var I=e=>d(a({},"__esModule",{value:!0}),e);var h={};L(h,{handler:()=>N});module.exports=I(h);var s=require("@aws-sdk/client-dynamodb"),u=require("@aws-sdk/util-dynamodb"),R=new s.DynamoDBClient({}),m=process.env.TABLE_NAME,f=process.env.LIVESTREAM_CHANNEL_ARN,T=process.env.LIVESTREAM_PLAYBACK_URL;function C(e){let r=e?.claims||{},n=r["custom:tier"]||r.tier,i=r["cognito:groups"],t=Array.isArray(i)?i:String(i||"").split(",").map(o=>o.trim()).filter(Boolean);return t.includes("ADMIN")?"ADMIN":t.includes("COLLAB")?"COLLAB":t.includes("PRIME")?"PRIME":t.includes("CREATOR")?"CREATOR":t.includes("BESTIE")?"BESTIE":n&&["FREE","BESTIE","CREATOR","COLLAB","ADMIN","PRIME"].includes(n)?n:"FREE"}function g(e){let r=C(e);if(!["CREATOR","COLLAB","ADMIN","PRIME"].includes(r))throw new Error("Creator tier required");return r}function p(e){if(!e?.sub)throw new Error("Not authenticated");return String(e.sub)}var N=async e=>{console.log("CreatorLivestreamFn event",JSON.stringify(e));let r=e.info?.fieldName,n=e.identity;g(n);let i=p(n);switch(r){case"getCreatorLivestreamInfo":return{channelArn:f,playbackUrl:T};case"pinLivestreamHighlight":{let{highlightId:t,title:o}=e.arguments||{},E=new Date().toISOString();return await R.send(new s.PutItemCommand({TableName:m,Item:(0,u.marshall)({pk:`USER#${i}`,sk:`LIVE_HIGHLIGHT#${t||E}`,type:"LIVE_HIGHLIGHT",title:o||"Livestream highlight",createdAt:E},{removeUndefinedValues:!0})})),{ok:!0}}default:throw new Error(`Unsupported field in CreatorLivestreamFn: ${r}`)}};0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
