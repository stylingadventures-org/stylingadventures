{
  "version": 3,
  "sources": ["../../lambda/prime/script-review.ts"],
  "sourcesContent": ["// lambda/prime/script-review.ts\r\n\r\n/**\r\n * Script Review Lambda (Prime Studios)\r\n *\r\n * This is a minimal stub that can be called from:\r\n * - API Gateway / AppSync resolvers\r\n * - Step Functions (script review step in the episode pipeline)\r\n *\r\n * It:\r\n *  - Accepts a script payload + review action\r\n *  - Returns a \"review record\" with status + timestamps\r\n *  - Does NOT persist anything yet (purely in-memory stub)\r\n *\r\n * You can later:\r\n *  - Write records into DynamoDB (TABLE_NAME env var)\r\n *  - Attach to S3 for versioned script storage\r\n *  - Enforce admin/studio-only access via caller identity\r\n */\r\n\r\nexport type ReviewAction = \"REQUEST_REVIEW\" | \"APPROVE\" | \"REVISE\" | \"REJECT\";\r\n\r\nexport interface ScriptReviewInput {\r\n  episodeId: string;\r\n  versionId?: string; // optional, auto-generated if missing\r\n\r\n  // Raw script text, or a JSON representation of episode flow\r\n  scriptText?: string;\r\n  scriptJson?: unknown;\r\n\r\n  // Who is performing the action\r\n  reviewer?: {\r\n    userId?: string;\r\n    displayName?: string;\r\n    role?: string; // e.g. \"ADMIN\", \"STUDIO\", \"WRITER\"\r\n  };\r\n\r\n  action: ReviewAction;\r\n\r\n  // Optional note / reason (e.g. \"tighten pacing in scene 3\")\r\n  note?: string;\r\n}\r\n\r\nexport interface ScriptReviewRecord {\r\n  episodeId: string;\r\n  versionId: string;\r\n\r\n  status: \"PENDING_REVIEW\" | \"APPROVED\" | \"REVISION_REQUESTED\" | \"REJECTED\";\r\n\r\n  scriptText?: string;\r\n  scriptJson?: unknown;\r\n\r\n  reviewer?: ScriptReviewInput[\"reviewer\"];\r\n\r\n  note?: string;\r\n\r\n  createdAt: string;\r\n  updatedAt: string;\r\n\r\n  // For later evolution \u2013 attach to storage keys, etc.\r\n  archiveKey?: string;\r\n}\r\n\r\nfunction mapActionToStatus(action: ReviewAction): ScriptReviewRecord[\"status\"] {\r\n  switch (action) {\r\n    case \"REQUEST_REVIEW\":\r\n      return \"PENDING_REVIEW\";\r\n    case \"APPROVE\":\r\n      return \"APPROVED\";\r\n    case \"REVISE\":\r\n      return \"REVISION_REQUESTED\";\r\n    case \"REJECT\":\r\n      return \"REJECTED\";\r\n    default:\r\n      return \"PENDING_REVIEW\";\r\n  }\r\n}\r\n\r\nexport const handler = async (\r\n  event: ScriptReviewInput,\r\n): Promise<ScriptReviewRecord> => {\r\n  const now = new Date().toISOString();\r\n\r\n  if (!event.episodeId) {\r\n    throw new Error(\"Missing required field: episodeId\");\r\n  }\r\n\r\n  const versionId =\r\n    event.versionId ?? `v-${Math.random().toString(36).slice(2, 10)}`;\r\n\r\n  const status = mapActionToStatus(event.action);\r\n\r\n  const record: ScriptReviewRecord = {\r\n    episodeId: event.episodeId,\r\n    versionId,\r\n    status,\r\n    scriptText: event.scriptText,\r\n    scriptJson: event.scriptJson,\r\n    reviewer: event.reviewer,\r\n    note: event.note,\r\n    createdAt: now,\r\n    updatedAt: now,\r\n    // archiveKey: you can later set this when you push scripts to S3\r\n  };\r\n\r\n  console.log(\"ScriptReview event:\", JSON.stringify(event, null, 2));\r\n  console.log(\"ScriptReview record:\", JSON.stringify(record, null, 2));\r\n\r\n  // \uD83D\uDD1C Future enhancement:\r\n  // If you want to persist reviews, you can:\r\n  //  - read process.env.TABLE_NAME\r\n  //  - use DynamoDB client to putItem\r\n  //  - or write scriptText/scriptJson to S3 and set archiveKey\r\n\r\n  return record;\r\n};\r\n"],
  "mappings": "yaAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,aAAAE,IAAA,eAAAC,EAAAH,GA+DA,SAASI,EAAkBC,EAAoD,CAC7E,OAAQA,EAAQ,CACd,IAAK,iBACH,MAAO,iBACT,IAAK,UACH,MAAO,WACT,IAAK,SACH,MAAO,qBACT,IAAK,SACH,MAAO,WACT,QACE,MAAO,gBACX,CACF,CAEO,IAAMH,EAAU,MACrBI,GACgC,CAChC,IAAMC,EAAM,IAAI,KAAK,EAAE,YAAY,EAEnC,GAAI,CAACD,EAAM,UACT,MAAM,IAAI,MAAM,mCAAmC,EAGrD,IAAME,EACJF,EAAM,WAAa,KAAK,KAAK,OAAO,EAAE,SAAS,EAAE,EAAE,MAAM,EAAG,EAAE,CAAC,GAE3DG,EAASL,EAAkBE,EAAM,MAAM,EAEvCI,EAA6B,CACjC,UAAWJ,EAAM,UACjB,UAAAE,EACA,OAAAC,EACA,WAAYH,EAAM,WAClB,WAAYA,EAAM,WAClB,SAAUA,EAAM,SAChB,KAAMA,EAAM,KACZ,UAAWC,EACX,UAAWA,CAEb,EAEA,eAAQ,IAAI,sBAAuB,KAAK,UAAUD,EAAO,KAAM,CAAC,CAAC,EACjE,QAAQ,IAAI,uBAAwB,KAAK,UAAUI,EAAQ,KAAM,CAAC,CAAC,EAQ5DA,CACT",
  "names": ["script_review_exports", "__export", "handler", "__toCommonJS", "mapActionToStatus", "action", "event", "now", "versionId", "status", "record"]
}
