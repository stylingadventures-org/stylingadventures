{
  "version": 3,
  "sources": ["../../lambda/prime-bank/award-prime-coins.ts"],
  "sourcesContent": ["// lambda/prime-bank/award-prime-coins.ts\r\nimport {\r\n  DynamoDBClient,\r\n  UpdateItemCommand,\r\n  PutItemCommand,\r\n} from \"@aws-sdk/client-dynamodb\";\r\nimport { Handler } from \"aws-lambda\";\r\n\r\nconst ACCOUNT_TABLE_NAME = process.env.PRIME_BANK_ACCOUNT_TABLE_NAME!;\r\nconst TRANSACTION_TABLE_NAME = process.env.PRIME_BANK_TRANSACTION_TABLE_NAME!;\r\n\r\nconst ddb = new DynamoDBClient({});\r\n\r\n// Simple shape for now \u2013 you can expand later\r\ninterface AwardPrimeCoinsEvent {\r\n  userId: string;\r\n  amount: number;\r\n  source: string; // e.g. \"dailyLogin\"\r\n  notes?: string;\r\n}\r\n\r\nexport const handler: Handler<AwardPrimeCoinsEvent, any> = async (event) => {\r\n  console.log(\"AwardPrimeCoins event:\", JSON.stringify(event));\r\n\r\n  const { userId, amount, source, notes } = event;\r\n\r\n  // TODO: add validation, caps, etc.\r\n\r\n  // 1) Update PrimeBankAccount.balance\r\n  await ddb.send(\r\n    new UpdateItemCommand({\r\n      TableName: ACCOUNT_TABLE_NAME,\r\n      Key: { userId: { S: userId } },\r\n      UpdateExpression: \"ADD primeCoins :delta\",\r\n      ExpressionAttributeValues: {\r\n        \":delta\": { N: String(amount) },\r\n      },\r\n    })\r\n  );\r\n\r\n  // 2) Insert a transaction record\r\n  const timestamp = new Date().toISOString();\r\n  const transactionId = `txn_${Date.now()}`;\r\n\r\n  await ddb.send(\r\n    new PutItemCommand({\r\n      TableName: TRANSACTION_TABLE_NAME,\r\n      Item: {\r\n        userId: { S: userId },\r\n        timestamp: { S: timestamp },\r\n        transactionId: { S: transactionId },\r\n        type: { S: \"earn\" },\r\n        currency: { S: \"primeCoins\" },\r\n        amount: { N: String(amount) },\r\n        source: { S: source },\r\n        ...(notes ? { notes: { S: notes } } : {}),\r\n      },\r\n    })\r\n  );\r\n\r\n  return {\r\n    ok: true,\r\n    userId,\r\n    amount,\r\n    transactionId,\r\n  };\r\n};\r\n"],
  "mappings": "yaAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,aAAAE,IAAA,eAAAC,EAAAH,GACA,IAAAI,EAIO,oCAGDC,EAAqB,QAAQ,IAAI,8BACjCC,EAAyB,QAAQ,IAAI,kCAErCC,EAAM,IAAI,iBAAe,CAAC,CAAC,EAUpBL,EAA8C,MAAOM,GAAU,CAC1E,QAAQ,IAAI,yBAA0B,KAAK,UAAUA,CAAK,CAAC,EAE3D,GAAM,CAAE,OAAAC,EAAQ,OAAAC,EAAQ,OAAAC,EAAQ,MAAAC,CAAM,EAAIJ,EAK1C,MAAMD,EAAI,KACR,IAAI,oBAAkB,CACpB,UAAWF,EACX,IAAK,CAAE,OAAQ,CAAE,EAAGI,CAAO,CAAE,EAC7B,iBAAkB,wBAClB,0BAA2B,CACzB,SAAU,CAAE,EAAG,OAAOC,CAAM,CAAE,CAChC,CACF,CAAC,CACH,EAGA,IAAMG,EAAY,IAAI,KAAK,EAAE,YAAY,EACnCC,EAAgB,OAAO,KAAK,IAAI,CAAC,GAEvC,aAAMP,EAAI,KACR,IAAI,iBAAe,CACjB,UAAWD,EACX,KAAM,CACJ,OAAQ,CAAE,EAAGG,CAAO,EACpB,UAAW,CAAE,EAAGI,CAAU,EAC1B,cAAe,CAAE,EAAGC,CAAc,EAClC,KAAM,CAAE,EAAG,MAAO,EAClB,SAAU,CAAE,EAAG,YAAa,EAC5B,OAAQ,CAAE,EAAG,OAAOJ,CAAM,CAAE,EAC5B,OAAQ,CAAE,EAAGC,CAAO,EACpB,GAAIC,EAAQ,CAAE,MAAO,CAAE,EAAGA,CAAM,CAAE,EAAI,CAAC,CACzC,CACF,CAAC,CACH,EAEO,CACL,GAAI,GACJ,OAAAH,EACA,OAAAC,EACA,cAAAI,CACF,CACF",
  "names": ["award_prime_coins_exports", "__export", "handler", "__toCommonJS", "import_client_dynamodb", "ACCOUNT_TABLE_NAME", "TRANSACTION_TABLE_NAME", "ddb", "event", "userId", "amount", "source", "notes", "timestamp", "transactionId"]
}
