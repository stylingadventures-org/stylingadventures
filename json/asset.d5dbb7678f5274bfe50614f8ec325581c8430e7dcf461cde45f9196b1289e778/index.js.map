{
  "version": 3,
  "sources": ["../../lambda/layout/validate-layout.ts"],
  "sourcesContent": ["// lambda/layout/validate-layout.ts\r\nimport { S3Client, GetObjectCommand } from \"@aws-sdk/client-s3\";\r\nimport { Readable } from \"stream\";\r\n\r\nconst s3 = new S3Client({});\r\nconst BUCKET = process.env.LAYOUT_TEMPLATES_BUCKET!;\r\n\r\n// tiny helper to read body\r\nasync function streamToString(stream: any): Promise<string> {\r\n  const chunks: Buffer[] = [];\r\n  for await (const chunk of stream as Readable) {\r\n    chunks.push(Buffer.from(chunk));\r\n  }\r\n  return Buffer.concat(chunks).toString(\"utf8\");\r\n}\r\n\r\nexport const handler = async (event: any) => {\r\n  const { layoutKey, schemaKey } = event;\r\n\r\n  if (!layoutKey || !schemaKey) {\r\n    throw new Error(\"layoutKey and schemaKey are required\");\r\n  }\r\n\r\n  const [layoutObj, schemaObj] = await Promise.all(\r\n    [layoutKey, schemaKey].map(async (Key) => {\r\n      const res = await s3.send(\r\n        new GetObjectCommand({ Bucket: BUCKET, Key }),\r\n      );\r\n      const body = await streamToString(res.Body as any);\r\n      return JSON.parse(body);\r\n    }),\r\n  );\r\n\r\n  // TODO: apply real JSON Schema validation + accessibility rules\r\n  // For now, just return \"valid: true\" when it parses.\r\n  return {\r\n    layoutValid: true,\r\n    issues: [],\r\n    layoutSummary: {\r\n      anchors: layoutObj.anchors ?? [],\r\n      bounds: layoutObj.bounds ?? null,\r\n    },\r\n  };\r\n};\r\n"],
  "mappings": "yaAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,aAAAE,IAAA,eAAAC,EAAAH,GACA,IAAAI,EAA2C,8BAGrCC,EAAK,IAAI,WAAS,CAAC,CAAC,EACpBC,EAAS,QAAQ,IAAI,wBAG3B,eAAeC,EAAeC,EAA8B,CAC1D,IAAMC,EAAmB,CAAC,EAC1B,cAAiBC,KAASF,EACxBC,EAAO,KAAK,OAAO,KAAKC,CAAK,CAAC,EAEhC,OAAO,OAAO,OAAOD,CAAM,EAAE,SAAS,MAAM,CAC9C,CAEO,IAAMP,EAAU,MAAOS,GAAe,CAC3C,GAAM,CAAE,UAAAC,EAAW,UAAAC,CAAU,EAAIF,EAEjC,GAAI,CAACC,GAAa,CAACC,EACjB,MAAM,IAAI,MAAM,sCAAsC,EAGxD,GAAM,CAACC,EAAWC,CAAS,EAAI,MAAM,QAAQ,IAC3C,CAACH,EAAWC,CAAS,EAAE,IAAI,MAAOG,GAAQ,CACxC,IAAMC,EAAM,MAAMZ,EAAG,KACnB,IAAI,mBAAiB,CAAE,OAAQC,EAAQ,IAAAU,CAAI,CAAC,CAC9C,EACME,EAAO,MAAMX,EAAeU,EAAI,IAAW,EACjD,OAAO,KAAK,MAAMC,CAAI,CACxB,CAAC,CACH,EAIA,MAAO,CACL,YAAa,GACb,OAAQ,CAAC,EACT,cAAe,CACb,QAASJ,EAAU,SAAW,CAAC,EAC/B,OAAQA,EAAU,QAAU,IAC9B,CACF,CACF",
  "names": ["validate_layout_exports", "__export", "handler", "__toCommonJS", "import_client_s3", "s3", "BUCKET", "streamToString", "stream", "chunks", "chunk", "event", "layoutKey", "schemaKey", "layoutObj", "schemaObj", "Key", "res", "body"]
}
