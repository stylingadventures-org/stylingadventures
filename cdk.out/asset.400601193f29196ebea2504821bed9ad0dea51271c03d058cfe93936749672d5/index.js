"use strict";var qi=Object.create;var we=Object.defineProperty;var Mi=Object.getOwnPropertyDescriptor;var Fi=Object.getOwnPropertyNames;var Di=Object.getPrototypeOf,Oi=Object.prototype.hasOwnProperty;var w=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports),zi=(e,r)=>{for(var t in r)we(e,t,{get:r[t],enumerable:!0})},dr=(e,r,t,i)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of Fi(r))!Oi.call(e,n)&&n!==t&&we(e,n,{get:()=>r[n],enumerable:!(i=Mi(r,n))||i.enumerable});return e};var Ui=(e,r,t)=>(t=e!=null?qi(Di(e)):{},dr(r||!e||!e.__esModule?we(t,"default",{value:e,enumerable:!0}):t,e)),Gi=e=>dr(we({},"__esModule",{value:!0}),e);var T=w((vl,gr)=>{"use strict";var mr=function(e){return typeof e<"u"&&e!==null},Hi=function(e){return typeof e=="object"},Wi=function(e){return Object.prototype.toString.call(e)==="[object Object]"},Xi=function(e){return typeof e=="function"},Vi=function(e){return typeof e=="boolean"},Ki=function(e){return e instanceof Buffer},Qi=function(e){if(mr(e))switch(e.constructor){case Uint8Array:case Uint8ClampedArray:case Int8Array:case Uint16Array:case Int16Array:case Uint32Array:case Int32Array:case Float32Array:case Float64Array:return!0}return!1},Ji=function(e){return e instanceof ArrayBuffer},Yi=function(e){return typeof e=="string"&&e.length>0},Zi=function(e){return typeof e=="number"&&!Number.isNaN(e)},en=function(e){return Number.isInteger(e)},rn=function(e,r,t){return e>=r&&e<=t},tn=function(e,r){return r.includes(e)},nn=function(e,r,t){return new Error(`Expected ${r} for ${e} but received ${t} of type ${typeof t}`)},an=function(e,r){return r.message=e.message,r};gr.exports={defined:mr,object:Hi,plainObject:Wi,fn:Xi,bool:Vi,buffer:Ki,typedArray:Qi,arrayBuffer:Ji,string:Yi,number:Zi,integer:en,inRange:rn,inArray:tn,invalidParameterError:nn,nativeError:an}});var wr=w((yl,pr)=>{"use strict";var br=()=>process.platform==="linux",Ee=null,sn=()=>{if(!Ee)if(br()&&process.report){let e=process.report.excludeNetwork;process.report.excludeNetwork=!0,Ee=process.report.getReport(),process.report.excludeNetwork=e}else Ee={};return Ee};pr.exports={isLinux:br,getReport:sn}});var vr=w((Pl,Er)=>{"use strict";var te=require("fs"),on="/usr/bin/ldd",ln="/proc/self/exe",ve=2048,cn=e=>{let r=te.openSync(e,"r"),t=Buffer.alloc(ve),i=te.readSync(r,t,0,ve,0);return te.close(r,()=>{}),t.subarray(0,i)},hn=e=>new Promise((r,t)=>{te.open(e,"r",(i,n)=>{if(i)t(i);else{let s=Buffer.alloc(ve);te.read(n,s,0,ve,0,(o,h)=>{r(s.subarray(0,h)),te.close(n,()=>{})})}})});Er.exports={LDD_PATH:on,SELF_PATH:ln,readFileSync:cn,readFile:hn}});var Pr=w((xl,yr)=>{"use strict";var fn=e=>{if(e.length<64||e.readUInt32BE(0)!==2135247942||e.readUInt8(4)!==2||e.readUInt8(5)!==1)return null;let r=e.readUInt32LE(32),t=e.readUInt16LE(54),i=e.readUInt16LE(56);for(let n=0;n<i;n++){let s=r+n*t;if(e.readUInt32LE(s)===3){let h=e.readUInt32LE(s+8),f=e.readUInt32LE(s+32);return e.subarray(h,h+f).toString().replace(/\0.*$/g,"")}}return null};yr.exports={interpreterPath:fn}});var Pe=w((Rl,Dr)=>{"use strict";var Rr=require("child_process"),{isLinux:ie,getReport:Ir}=wr(),{LDD_PATH:ye,SELF_PATH:jr,readFile:Be,readFileSync:qe}=vr(),{interpreterPath:Ar}=Pr(),_,C,B,kr="getconf GNU_LIBC_VERSION 2>&1 || true; ldd --version 2>&1 || true",G="",$r=()=>G||new Promise(e=>{Rr.exec(kr,(r,t)=>{G=r?" ":t,e(G)})}),Sr=()=>{if(!G)try{G=Rr.execSync(kr,{encoding:"utf8"})}catch{G=" "}return G},D="glibc",Lr=/LIBC[a-z0-9 \-).]*?(\d+\.\d+)/i,Q="musl",un=e=>e.includes("libc.musl-")||e.includes("ld-musl-"),Nr=()=>{let e=Ir();return e.header&&e.header.glibcVersionRuntime?D:Array.isArray(e.sharedObjects)&&e.sharedObjects.some(un)?Q:null},Tr=e=>{let[r,t]=e.split(/[\r\n]+/);return r&&r.includes(D)?D:t&&t.includes(Q)?Q:null},_r=e=>{if(e){if(e.includes("/ld-musl-"))return Q;if(e.includes("/ld-linux-"))return D}return null},Cr=e=>(e=e.toString(),e.includes("musl")?Q:e.includes("GNU C Library")?D:null),dn=async()=>{if(C!==void 0)return C;C=null;try{let e=await Be(ye);C=Cr(e)}catch{}return C},mn=()=>{if(C!==void 0)return C;C=null;try{let e=qe(ye);C=Cr(e)}catch{}return C},gn=async()=>{if(_!==void 0)return _;_=null;try{let e=await Be(jr),r=Ar(e);_=_r(r)}catch{}return _},bn=()=>{if(_!==void 0)return _;_=null;try{let e=qe(jr),r=Ar(e);_=_r(r)}catch{}return _},Br=async()=>{let e=null;if(ie()&&(e=await gn(),!e&&(e=await dn(),e||(e=Nr()),!e))){let r=await $r();e=Tr(r)}return e},qr=()=>{let e=null;if(ie()&&(e=bn(),!e&&(e=mn(),e||(e=Nr()),!e))){let r=Sr();e=Tr(r)}return e},pn=async()=>ie()&&await Br()!==D,wn=()=>ie()&&qr()!==D,En=async()=>{if(B!==void 0)return B;B=null;try{let r=(await Be(ye)).match(Lr);r&&(B=r[1])}catch{}return B},vn=()=>{if(B!==void 0)return B;B=null;try{let r=qe(ye).match(Lr);r&&(B=r[1])}catch{}return B},Mr=()=>{let e=Ir();return e.header&&e.header.glibcVersionRuntime?e.header.glibcVersionRuntime:null},xr=e=>e.trim().split(/\s+/)[1],Fr=e=>{let[r,t,i]=e.split(/[\r\n]+/);return r&&r.includes(D)?xr(r):t&&i&&t.includes(Q)?xr(i):null},yn=async()=>{let e=null;if(ie()&&(e=await En(),e||(e=Mr()),!e)){let r=await $r();e=Fr(r)}return e},Pn=()=>{let e=null;if(ie()&&(e=vn(),e||(e=Mr()),!e)){let r=Sr();e=Fr(r)}return e};Dr.exports={GLIBC:D,MUSL:Q,family:Br,familySync:qr,isNonGlibcLinux:pn,isNonGlibcLinuxSync:wn,version:yn,versionSync:Pn}});var de=w((Il,Or)=>{"use strict";var xn=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};Or.exports=xn});var xe=w((jl,zr)=>{"use strict";var Rn="2.0.0",In=Number.MAX_SAFE_INTEGER||9007199254740991,jn=16,An=250,kn=["major","premajor","minor","preminor","patch","prepatch","prerelease"];zr.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:jn,MAX_SAFE_BUILD_LENGTH:An,MAX_SAFE_INTEGER:In,RELEASE_TYPES:kn,SEMVER_SPEC_VERSION:Rn,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var me=w((q,Ur)=>{"use strict";var{MAX_SAFE_COMPONENT_LENGTH:Me,MAX_SAFE_BUILD_LENGTH:$n,MAX_LENGTH:Sn}=xe(),Ln=de();q=Ur.exports={};var Nn=q.re=[],Tn=q.safeRe=[],m=q.src=[],_n=q.safeSrc=[],g=q.t={},Cn=0,Fe="[a-zA-Z0-9-]",Bn=[["\\s",1],["\\d",Sn],[Fe,$n]],qn=e=>{for(let[r,t]of Bn)e=e.split(`${r}*`).join(`${r}{0,${t}}`).split(`${r}+`).join(`${r}{1,${t}}`);return e},p=(e,r,t)=>{let i=qn(r),n=Cn++;Ln(e,n,r),g[e]=n,m[n]=r,_n[n]=i,Nn[n]=new RegExp(r,t?"g":void 0),Tn[n]=new RegExp(i,t?"g":void 0)};p("NUMERICIDENTIFIER","0|[1-9]\\d*");p("NUMERICIDENTIFIERLOOSE","\\d+");p("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${Fe}*`);p("MAINVERSION",`(${m[g.NUMERICIDENTIFIER]})\\.(${m[g.NUMERICIDENTIFIER]})\\.(${m[g.NUMERICIDENTIFIER]})`);p("MAINVERSIONLOOSE",`(${m[g.NUMERICIDENTIFIERLOOSE]})\\.(${m[g.NUMERICIDENTIFIERLOOSE]})\\.(${m[g.NUMERICIDENTIFIERLOOSE]})`);p("PRERELEASEIDENTIFIER",`(?:${m[g.NONNUMERICIDENTIFIER]}|${m[g.NUMERICIDENTIFIER]})`);p("PRERELEASEIDENTIFIERLOOSE",`(?:${m[g.NONNUMERICIDENTIFIER]}|${m[g.NUMERICIDENTIFIERLOOSE]})`);p("PRERELEASE",`(?:-(${m[g.PRERELEASEIDENTIFIER]}(?:\\.${m[g.PRERELEASEIDENTIFIER]})*))`);p("PRERELEASELOOSE",`(?:-?(${m[g.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${m[g.PRERELEASEIDENTIFIERLOOSE]})*))`);p("BUILDIDENTIFIER",`${Fe}+`);p("BUILD",`(?:\\+(${m[g.BUILDIDENTIFIER]}(?:\\.${m[g.BUILDIDENTIFIER]})*))`);p("FULLPLAIN",`v?${m[g.MAINVERSION]}${m[g.PRERELEASE]}?${m[g.BUILD]}?`);p("FULL",`^${m[g.FULLPLAIN]}$`);p("LOOSEPLAIN",`[v=\\s]*${m[g.MAINVERSIONLOOSE]}${m[g.PRERELEASELOOSE]}?${m[g.BUILD]}?`);p("LOOSE",`^${m[g.LOOSEPLAIN]}$`);p("GTLT","((?:<|>)?=?)");p("XRANGEIDENTIFIERLOOSE",`${m[g.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);p("XRANGEIDENTIFIER",`${m[g.NUMERICIDENTIFIER]}|x|X|\\*`);p("XRANGEPLAIN",`[v=\\s]*(${m[g.XRANGEIDENTIFIER]})(?:\\.(${m[g.XRANGEIDENTIFIER]})(?:\\.(${m[g.XRANGEIDENTIFIER]})(?:${m[g.PRERELEASE]})?${m[g.BUILD]}?)?)?`);p("XRANGEPLAINLOOSE",`[v=\\s]*(${m[g.XRANGEIDENTIFIERLOOSE]})(?:\\.(${m[g.XRANGEIDENTIFIERLOOSE]})(?:\\.(${m[g.XRANGEIDENTIFIERLOOSE]})(?:${m[g.PRERELEASELOOSE]})?${m[g.BUILD]}?)?)?`);p("XRANGE",`^${m[g.GTLT]}\\s*${m[g.XRANGEPLAIN]}$`);p("XRANGELOOSE",`^${m[g.GTLT]}\\s*${m[g.XRANGEPLAINLOOSE]}$`);p("COERCEPLAIN",`(^|[^\\d])(\\d{1,${Me}})(?:\\.(\\d{1,${Me}}))?(?:\\.(\\d{1,${Me}}))?`);p("COERCE",`${m[g.COERCEPLAIN]}(?:$|[^\\d])`);p("COERCEFULL",m[g.COERCEPLAIN]+`(?:${m[g.PRERELEASE]})?(?:${m[g.BUILD]})?(?:$|[^\\d])`);p("COERCERTL",m[g.COERCE],!0);p("COERCERTLFULL",m[g.COERCEFULL],!0);p("LONETILDE","(?:~>?)");p("TILDETRIM",`(\\s*)${m[g.LONETILDE]}\\s+`,!0);q.tildeTrimReplace="$1~";p("TILDE",`^${m[g.LONETILDE]}${m[g.XRANGEPLAIN]}$`);p("TILDELOOSE",`^${m[g.LONETILDE]}${m[g.XRANGEPLAINLOOSE]}$`);p("LONECARET","(?:\\^)");p("CARETTRIM",`(\\s*)${m[g.LONECARET]}\\s+`,!0);q.caretTrimReplace="$1^";p("CARET",`^${m[g.LONECARET]}${m[g.XRANGEPLAIN]}$`);p("CARETLOOSE",`^${m[g.LONECARET]}${m[g.XRANGEPLAINLOOSE]}$`);p("COMPARATORLOOSE",`^${m[g.GTLT]}\\s*(${m[g.LOOSEPLAIN]})$|^$`);p("COMPARATOR",`^${m[g.GTLT]}\\s*(${m[g.FULLPLAIN]})$|^$`);p("COMPARATORTRIM",`(\\s*)${m[g.GTLT]}\\s*(${m[g.LOOSEPLAIN]}|${m[g.XRANGEPLAIN]})`,!0);q.comparatorTrimReplace="$1$2$3";p("HYPHENRANGE",`^\\s*(${m[g.XRANGEPLAIN]})\\s+-\\s+(${m[g.XRANGEPLAIN]})\\s*$`);p("HYPHENRANGELOOSE",`^\\s*(${m[g.XRANGEPLAINLOOSE]})\\s+-\\s+(${m[g.XRANGEPLAINLOOSE]})\\s*$`);p("STAR","(<|>)?=?\\s*\\*");p("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");p("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var Re=w((Al,Gr)=>{"use strict";var Mn=Object.freeze({loose:!0}),Fn=Object.freeze({}),Dn=e=>e?typeof e!="object"?Mn:e:Fn;Gr.exports=Dn});var Vr=w((kl,Xr)=>{"use strict";var Hr=/^[0-9]+$/,Wr=(e,r)=>{if(typeof e=="number"&&typeof r=="number")return e===r?0:e<r?-1:1;let t=Hr.test(e),i=Hr.test(r);return t&&i&&(e=+e,r=+r),e===r?0:t&&!i?-1:i&&!t?1:e<r?-1:1},On=(e,r)=>Wr(r,e);Xr.exports={compareIdentifiers:Wr,rcompareIdentifiers:On}});var ne=w(($l,Qr)=>{"use strict";var Ie=de(),{MAX_LENGTH:Kr,MAX_SAFE_INTEGER:je}=xe(),{safeRe:Ae,t:ke}=me(),zn=Re(),{compareIdentifiers:De}=Vr(),Oe=class e{constructor(r,t){if(t=zn(t),r instanceof e){if(r.loose===!!t.loose&&r.includePrerelease===!!t.includePrerelease)return r;r=r.version}else if(typeof r!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof r}".`);if(r.length>Kr)throw new TypeError(`version is longer than ${Kr} characters`);Ie("SemVer",r,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;let i=r.trim().match(t.loose?Ae[ke.LOOSE]:Ae[ke.FULL]);if(!i)throw new TypeError(`Invalid Version: ${r}`);if(this.raw=r,this.major=+i[1],this.minor=+i[2],this.patch=+i[3],this.major>je||this.major<0)throw new TypeError("Invalid major version");if(this.minor>je||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>je||this.patch<0)throw new TypeError("Invalid patch version");i[4]?this.prerelease=i[4].split(".").map(n=>{if(/^[0-9]+$/.test(n)){let s=+n;if(s>=0&&s<je)return s}return n}):this.prerelease=[],this.build=i[5]?i[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(r){if(Ie("SemVer.compare",this.version,this.options,r),!(r instanceof e)){if(typeof r=="string"&&r===this.version)return 0;r=new e(r,this.options)}return r.version===this.version?0:this.compareMain(r)||this.comparePre(r)}compareMain(r){return r instanceof e||(r=new e(r,this.options)),this.major<r.major?-1:this.major>r.major?1:this.minor<r.minor?-1:this.minor>r.minor?1:this.patch<r.patch?-1:this.patch>r.patch?1:0}comparePre(r){if(r instanceof e||(r=new e(r,this.options)),this.prerelease.length&&!r.prerelease.length)return-1;if(!this.prerelease.length&&r.prerelease.length)return 1;if(!this.prerelease.length&&!r.prerelease.length)return 0;let t=0;do{let i=this.prerelease[t],n=r.prerelease[t];if(Ie("prerelease compare",t,i,n),i===void 0&&n===void 0)return 0;if(n===void 0)return 1;if(i===void 0)return-1;if(i===n)continue;return De(i,n)}while(++t)}compareBuild(r){r instanceof e||(r=new e(r,this.options));let t=0;do{let i=this.build[t],n=r.build[t];if(Ie("build compare",t,i,n),i===void 0&&n===void 0)return 0;if(n===void 0)return 1;if(i===void 0)return-1;if(i===n)continue;return De(i,n)}while(++t)}inc(r,t,i){if(r.startsWith("pre")){if(!t&&i===!1)throw new Error("invalid increment argument: identifier is empty");if(t){let n=`-${t}`.match(this.options.loose?Ae[ke.PRERELEASELOOSE]:Ae[ke.PRERELEASE]);if(!n||n[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(r){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,i);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,i);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,i),this.inc("pre",t,i);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t,i),this.inc("pre",t,i);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let n=Number(i)?1:0;if(this.prerelease.length===0)this.prerelease=[n];else{let s=this.prerelease.length;for(;--s>=0;)typeof this.prerelease[s]=="number"&&(this.prerelease[s]++,s=-2);if(s===-1){if(t===this.prerelease.join(".")&&i===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(n)}}if(t){let s=[t,n];i===!1&&(s=[t]),De(this.prerelease[0],t)===0?isNaN(this.prerelease[1])&&(this.prerelease=s):this.prerelease=s}break}default:throw new Error(`invalid increment argument: ${r}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};Qr.exports=Oe});var Zr=w((Sl,Yr)=>{"use strict";var Jr=ne(),Un=(e,r,t=!1)=>{if(e instanceof Jr)return e;try{return new Jr(e,r)}catch(i){if(!t)return null;throw i}};Yr.exports=Un});var rt=w((Ll,et)=>{"use strict";var Gn=ne(),Hn=Zr(),{safeRe:$e,t:Se}=me(),Wn=(e,r)=>{if(e instanceof Gn)return e;if(typeof e=="number"&&(e=String(e)),typeof e!="string")return null;r=r||{};let t=null;if(!r.rtl)t=e.match(r.includePrerelease?$e[Se.COERCEFULL]:$e[Se.COERCE]);else{let f=r.includePrerelease?$e[Se.COERCERTLFULL]:$e[Se.COERCERTL],u;for(;(u=f.exec(e))&&(!t||t.index+t[0].length!==e.length);)(!t||u.index+u[0].length!==t.index+t[0].length)&&(t=u),f.lastIndex=u.index+u[1].length+u[2].length;f.lastIndex=-1}if(t===null)return null;let i=t[2],n=t[3]||"0",s=t[4]||"0",o=r.includePrerelease&&t[5]?`-${t[5]}`:"",h=r.includePrerelease&&t[6]?`+${t[6]}`:"";return Hn(`${i}.${n}.${s}${o}${h}`,r)};et.exports=Wn});var J=w((Nl,it)=>{"use strict";var tt=ne(),Xn=(e,r,t)=>new tt(e,t).compare(new tt(r,t));it.exports=Xn});var ze=w((Tl,nt)=>{"use strict";var Vn=J(),Kn=(e,r,t)=>Vn(e,r,t)>=0;nt.exports=Kn});var st=w((_l,at)=>{"use strict";var Ue=class{constructor(){this.max=1e3,this.map=new Map}get(r){let t=this.map.get(r);if(t!==void 0)return this.map.delete(r),this.map.set(r,t),t}delete(r){return this.map.delete(r)}set(r,t){if(!this.delete(r)&&t!==void 0){if(this.map.size>=this.max){let n=this.map.keys().next().value;this.delete(n)}this.map.set(r,t)}return this}};at.exports=Ue});var lt=w((Cl,ot)=>{"use strict";var Qn=J(),Jn=(e,r,t)=>Qn(e,r,t)===0;ot.exports=Jn});var ht=w((Bl,ct)=>{"use strict";var Yn=J(),Zn=(e,r,t)=>Yn(e,r,t)!==0;ct.exports=Zn});var ut=w((ql,ft)=>{"use strict";var ea=J(),ra=(e,r,t)=>ea(e,r,t)>0;ft.exports=ra});var mt=w((Ml,dt)=>{"use strict";var ta=J(),ia=(e,r,t)=>ta(e,r,t)<0;dt.exports=ia});var bt=w((Fl,gt)=>{"use strict";var na=J(),aa=(e,r,t)=>na(e,r,t)<=0;gt.exports=aa});var wt=w((Dl,pt)=>{"use strict";var sa=lt(),oa=ht(),la=ut(),ca=ze(),ha=mt(),fa=bt(),ua=(e,r,t,i)=>{switch(r){case"===":return typeof e=="object"&&(e=e.version),typeof t=="object"&&(t=t.version),e===t;case"!==":return typeof e=="object"&&(e=e.version),typeof t=="object"&&(t=t.version),e!==t;case"":case"=":case"==":return sa(e,t,i);case"!=":return oa(e,t,i);case">":return la(e,t,i);case">=":return ca(e,t,i);case"<":return ha(e,t,i);case"<=":return fa(e,t,i);default:throw new TypeError(`Invalid operator: ${r}`)}};pt.exports=ua});var It=w((Ol,Rt)=>{"use strict";var ge=Symbol("SemVer ANY"),We=class e{static get ANY(){return ge}constructor(r,t){if(t=Et(t),r instanceof e){if(r.loose===!!t.loose)return r;r=r.value}r=r.trim().split(/\s+/).join(" "),He("comparator",r,t),this.options=t,this.loose=!!t.loose,this.parse(r),this.semver===ge?this.value="":this.value=this.operator+this.semver.version,He("comp",this)}parse(r){let t=this.options.loose?vt[yt.COMPARATORLOOSE]:vt[yt.COMPARATOR],i=r.match(t);if(!i)throw new TypeError(`Invalid comparator: ${r}`);this.operator=i[1]!==void 0?i[1]:"",this.operator==="="&&(this.operator=""),i[2]?this.semver=new Pt(i[2],this.options.loose):this.semver=ge}toString(){return this.value}test(r){if(He("Comparator.test",r,this.options.loose),this.semver===ge||r===ge)return!0;if(typeof r=="string")try{r=new Pt(r,this.options)}catch{return!1}return Ge(r,this.operator,this.semver,this.options)}intersects(r,t){if(!(r instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new xt(r.value,t).test(this.value):r.operator===""?r.value===""?!0:new xt(this.value,t).test(r.semver):(t=Et(t),t.includePrerelease&&(this.value==="<0.0.0-0"||r.value==="<0.0.0-0")||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||r.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&r.operator.startsWith(">")||this.operator.startsWith("<")&&r.operator.startsWith("<")||this.semver.version===r.semver.version&&this.operator.includes("=")&&r.operator.includes("=")||Ge(this.semver,"<",r.semver,t)&&this.operator.startsWith(">")&&r.operator.startsWith("<")||Ge(this.semver,">",r.semver,t)&&this.operator.startsWith("<")&&r.operator.startsWith(">")))}};Rt.exports=We;var Et=Re(),{safeRe:vt,t:yt}=me(),Ge=wt(),He=de(),Pt=ne(),xt=Xe()});var Xe=w((zl,$t)=>{"use strict";var da=/\s+/g,Ve=class e{constructor(r,t){if(t=ga(t),r instanceof e)return r.loose===!!t.loose&&r.includePrerelease===!!t.includePrerelease?r:new e(r.raw,t);if(r instanceof Ke)return this.raw=r.value,this.set=[[r]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=r.trim().replace(da," "),this.set=this.raw.split("||").map(i=>this.parseRange(i.trim())).filter(i=>i.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let i=this.set[0];if(this.set=this.set.filter(n=>!At(n[0])),this.set.length===0)this.set=[i];else if(this.set.length>1){for(let n of this.set)if(n.length===1&&Pa(n[0])){this.set=[n];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let r=0;r<this.set.length;r++){r>0&&(this.formatted+="||");let t=this.set[r];for(let i=0;i<t.length;i++)i>0&&(this.formatted+=" "),this.formatted+=t[i].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(r){let i=((this.options.includePrerelease&&va)|(this.options.loose&&ya))+":"+r,n=jt.get(i);if(n)return n;let s=this.options.loose,o=s?A[j.HYPHENRANGELOOSE]:A[j.HYPHENRANGE];r=r.replace(o,Na(this.options.includePrerelease)),P("hyphen replace",r),r=r.replace(A[j.COMPARATORTRIM],pa),P("comparator trim",r),r=r.replace(A[j.TILDETRIM],wa),P("tilde trim",r),r=r.replace(A[j.CARETTRIM],Ea),P("caret trim",r);let h=r.split(" ").map(E=>xa(E,this.options)).join(" ").split(/\s+/).map(E=>La(E,this.options));s&&(h=h.filter(E=>(P("loose invalid filter",E,this.options),!!E.match(A[j.COMPARATORLOOSE])))),P("range list",h);let f=new Map,u=h.map(E=>new Ke(E,this.options));for(let E of u){if(At(E))return[E];f.set(E.value,E)}f.size>1&&f.has("")&&f.delete("");let v=[...f.values()];return jt.set(i,v),v}intersects(r,t){if(!(r instanceof e))throw new TypeError("a Range is required");return this.set.some(i=>kt(i,t)&&r.set.some(n=>kt(n,t)&&i.every(s=>n.every(o=>s.intersects(o,t)))))}test(r){if(!r)return!1;if(typeof r=="string")try{r=new ba(r,this.options)}catch{return!1}for(let t=0;t<this.set.length;t++)if(Ta(this.set[t],r,this.options))return!0;return!1}};$t.exports=Ve;var ma=st(),jt=new ma,ga=Re(),Ke=It(),P=de(),ba=ne(),{safeRe:A,t:j,comparatorTrimReplace:pa,tildeTrimReplace:wa,caretTrimReplace:Ea}=me(),{FLAG_INCLUDE_PRERELEASE:va,FLAG_LOOSE:ya}=xe(),At=e=>e.value==="<0.0.0-0",Pa=e=>e.value==="",kt=(e,r)=>{let t=!0,i=e.slice(),n=i.pop();for(;t&&i.length;)t=i.every(s=>n.intersects(s,r)),n=i.pop();return t},xa=(e,r)=>(e=e.replace(A[j.BUILD],""),P("comp",e,r),e=ja(e,r),P("caret",e),e=Ra(e,r),P("tildes",e),e=ka(e,r),P("xrange",e),e=Sa(e,r),P("stars",e),e),k=e=>!e||e.toLowerCase()==="x"||e==="*",Ra=(e,r)=>e.trim().split(/\s+/).map(t=>Ia(t,r)).join(" "),Ia=(e,r)=>{let t=r.loose?A[j.TILDELOOSE]:A[j.TILDE];return e.replace(t,(i,n,s,o,h)=>{P("tilde",e,i,n,s,o,h);let f;return k(n)?f="":k(s)?f=`>=${n}.0.0 <${+n+1}.0.0-0`:k(o)?f=`>=${n}.${s}.0 <${n}.${+s+1}.0-0`:h?(P("replaceTilde pr",h),f=`>=${n}.${s}.${o}-${h} <${n}.${+s+1}.0-0`):f=`>=${n}.${s}.${o} <${n}.${+s+1}.0-0`,P("tilde return",f),f})},ja=(e,r)=>e.trim().split(/\s+/).map(t=>Aa(t,r)).join(" "),Aa=(e,r)=>{P("caret",e,r);let t=r.loose?A[j.CARETLOOSE]:A[j.CARET],i=r.includePrerelease?"-0":"";return e.replace(t,(n,s,o,h,f)=>{P("caret",e,n,s,o,h,f);let u;return k(s)?u="":k(o)?u=`>=${s}.0.0${i} <${+s+1}.0.0-0`:k(h)?s==="0"?u=`>=${s}.${o}.0${i} <${s}.${+o+1}.0-0`:u=`>=${s}.${o}.0${i} <${+s+1}.0.0-0`:f?(P("replaceCaret pr",f),s==="0"?o==="0"?u=`>=${s}.${o}.${h}-${f} <${s}.${o}.${+h+1}-0`:u=`>=${s}.${o}.${h}-${f} <${s}.${+o+1}.0-0`:u=`>=${s}.${o}.${h}-${f} <${+s+1}.0.0-0`):(P("no pr"),s==="0"?o==="0"?u=`>=${s}.${o}.${h}${i} <${s}.${o}.${+h+1}-0`:u=`>=${s}.${o}.${h}${i} <${s}.${+o+1}.0-0`:u=`>=${s}.${o}.${h} <${+s+1}.0.0-0`),P("caret return",u),u})},ka=(e,r)=>(P("replaceXRanges",e,r),e.split(/\s+/).map(t=>$a(t,r)).join(" ")),$a=(e,r)=>{e=e.trim();let t=r.loose?A[j.XRANGELOOSE]:A[j.XRANGE];return e.replace(t,(i,n,s,o,h,f)=>{P("xRange",e,i,n,s,o,h,f);let u=k(s),v=u||k(o),E=v||k(h),K=E;return n==="="&&K&&(n=""),f=r.includePrerelease?"-0":"",u?n===">"||n==="<"?i="<0.0.0-0":i="*":n&&K?(v&&(o=0),h=0,n===">"?(n=">=",v?(s=+s+1,o=0,h=0):(o=+o+1,h=0)):n==="<="&&(n="<",v?s=+s+1:o=+o+1),n==="<"&&(f="-0"),i=`${n+s}.${o}.${h}${f}`):v?i=`>=${s}.0.0${f} <${+s+1}.0.0-0`:E&&(i=`>=${s}.${o}.0${f} <${s}.${+o+1}.0-0`),P("xRange return",i),i})},Sa=(e,r)=>(P("replaceStars",e,r),e.trim().replace(A[j.STAR],"")),La=(e,r)=>(P("replaceGTE0",e,r),e.trim().replace(A[r.includePrerelease?j.GTE0PRE:j.GTE0],"")),Na=e=>(r,t,i,n,s,o,h,f,u,v,E,K)=>(k(i)?t="":k(n)?t=`>=${i}.0.0${e?"-0":""}`:k(s)?t=`>=${i}.${n}.0${e?"-0":""}`:o?t=`>=${t}`:t=`>=${t}${e?"-0":""}`,k(u)?f="":k(v)?f=`<${+u+1}.0.0-0`:k(E)?f=`<${u}.${+v+1}.0-0`:K?f=`<=${u}.${v}.${E}-${K}`:e?f=`<${u}.${v}.${+E+1}-0`:f=`<=${f}`,`${t} ${f}`.trim()),Ta=(e,r,t)=>{for(let i=0;i<e.length;i++)if(!e[i].test(r))return!1;if(r.prerelease.length&&!t.includePrerelease){for(let i=0;i<e.length;i++)if(P(e[i].semver),e[i].semver!==Ke.ANY&&e[i].semver.prerelease.length>0){let n=e[i].semver;if(n.major===r.major&&n.minor===r.minor&&n.patch===r.patch)return!0}return!1}return!0}});var Lt=w((Ul,St)=>{"use strict";var _a=Xe(),Ca=(e,r,t)=>{try{r=new _a(r,t)}catch{return!1}return r.test(e)};St.exports=Ca});var Qe=w((Gl,Ba)=>{Ba.exports={name:"sharp",description:"High performance Node.js image processing, the fastest module to resize JPEG, PNG, WebP, GIF, AVIF and TIFF images",version:"0.34.4",author:"Lovell Fuller <npm@lovell.info>",homepage:"https://sharp.pixelplumbing.com",contributors:["Pierre Inglebert <pierre.inglebert@gmail.com>","Jonathan Ong <jonathanrichardong@gmail.com>","Chanon Sajjamanochai <chanon.s@gmail.com>","Juliano Julio <julianojulio@gmail.com>","Daniel Gasienica <daniel@gasienica.ch>","Julian Walker <julian@fiftythree.com>","Amit Pitaru <pitaru.amit@gmail.com>","Brandon Aaron <hello.brandon@aaron.sh>","Andreas Lind <andreas@one.com>","Maurus Cuelenaere <mcuelenaere@gmail.com>","Linus Unneb\xE4ck <linus@folkdatorn.se>","Victor Mateevitsi <mvictoras@gmail.com>","Alaric Holloway <alaric.holloway@gmail.com>","Bernhard K. Weisshuhn <bkw@codingforce.com>","Chris Riley <criley@primedia.com>","David Carley <dacarley@gmail.com>","John Tobin <john@limelightmobileinc.com>","Kenton Gray <kentongray@gmail.com>","Felix B\xFCnemann <Felix.Buenemann@gmail.com>","Samy Al Zahrani <samyalzahrany@gmail.com>","Chintan Thakkar <lemnisk8@gmail.com>","F. Orlando Galashan <frulo@gmx.de>","Kleis Auke Wolthuizen <info@kleisauke.nl>","Matt Hirsch <mhirsch@media.mit.edu>","Matthias Thoemmes <thoemmes@gmail.com>","Patrick Paskaris <patrick@paskaris.gr>","J\xE9r\xE9my Lal <kapouer@melix.org>","Rahul Nanwani <r.nanwani@gmail.com>","Alice Monday <alice0meta@gmail.com>","Kristo Jorgenson <kristo.jorgenson@gmail.com>","YvesBos <yves_bos@outlook.com>","Guy Maliar <guy@tailorbrands.com>","Nicolas Coden <nicolas@ncoden.fr>","Matt Parrish <matt.r.parrish@gmail.com>","Marcel Bretschneider <marcel.bretschneider@gmail.com>","Matthew McEachen <matthew+github@mceachen.org>","Jarda Kot\u011B\u0161ovec <jarda.kotesovec@gmail.com>","Kenric D'Souza <kenric.dsouza@gmail.com>","Oleh Aleinyk <oleg.aleynik@gmail.com>","Marcel Bretschneider <marcel.bretschneider@gmail.com>","Andrea Bianco <andrea.bianco@unibas.ch>","Rik Heywood <rik@rik.org>","Thomas Parisot <hi@oncletom.io>","Nathan Graves <nathanrgraves+github@gmail.com>","Tom Lokhorst <tom@lokhorst.eu>","Espen Hovlandsdal <espen@hovlandsdal.com>","Sylvain Dumont <sylvain.dumont35@gmail.com>","Alun Davies <alun.owain.davies@googlemail.com>","Aidan Hoolachan <ajhoolachan21@gmail.com>","Axel Eirola <axel.eirola@iki.fi>","Freezy <freezy@xbmc.org>","Daiz <taneli.vatanen@gmail.com>","Julian Aubourg <j@ubourg.net>","Keith Belovay <keith@picthrive.com>","Michael B. Klein <mbklein@gmail.com>","Jordan Prudhomme <jordan@raboland.fr>","Ilya Ovdin <iovdin@gmail.com>","Andargor <andargor@yahoo.com>","Paul Neave <paul.neave@gmail.com>","Brendan Kennedy <brenwken@gmail.com>","Brychan Bennett-Odlum <git@brychan.io>","Edward Silverton <e.silverton@gmail.com>","Roman Malieiev <aromaleev@gmail.com>","Tomas Szabo <tomas.szabo@deftomat.com>","Robert O'Rourke <robert@o-rourke.org>","Guillermo Alfonso Varela Chouci\xF1o <guillevch@gmail.com>","Christian Flintrup <chr@gigahost.dk>","Manan Jadhav <manan@motionden.com>","Leon Radley <leon@radley.se>","alza54 <alza54@thiocod.in>","Jacob Smith <jacob@frende.me>","Michael Nutt <michael@nutt.im>","Brad Parham <baparham@gmail.com>","Taneli Vatanen <taneli.vatanen@gmail.com>","Joris Dugu\xE9 <zaruike10@gmail.com>","Chris Banks <christopher.bradley.banks@gmail.com>","Ompal Singh <ompal.hitm09@gmail.com>","Brodan <christopher.hranj@gmail.com>","Ankur Parihar <ankur.github@gmail.com>","Brahim Ait elhaj <brahima@gmail.com>","Mart Jansink <m.jansink@gmail.com>","Lachlan Newman <lachnewman007@gmail.com>","Dennis Beatty <dennis@dcbeatty.com>","Ingvar Stepanyan <me@rreverser.com>","Don Denton <don@happycollision.com>"],scripts:{install:"node install/check.js",clean:"rm -rf src/build/ .nyc_output/ coverage/ test/fixtures/output.*",test:"npm run test-lint && npm run test-unit && npm run test-licensing && npm run test-types","test-lint":"semistandard && cpplint","test-unit":"nyc --reporter=lcov --reporter=text --check-coverage --branches=100 mocha","test-licensing":'license-checker --production --summary --onlyAllow="Apache-2.0;BSD;ISC;LGPL-3.0-or-later;MIT"',"test-leak":"./test/leak/leak.sh","test-types":"tsd","package-from-local-build":"node npm/from-local-build.js","package-release-notes":"node npm/release-notes.js","docs-build":"node docs/build.mjs","docs-serve":"cd docs && npm start","docs-publish":"cd docs && npm run build && npx firebase-tools deploy --project pixelplumbing --only hosting:pixelplumbing-sharp"},type:"commonjs",main:"lib/index.js",types:"lib/index.d.ts",files:["install","lib","src/*.{cc,h,gyp}"],repository:{type:"git",url:"git://github.com/lovell/sharp.git"},keywords:["jpeg","png","webp","avif","tiff","gif","svg","jp2","dzi","image","resize","thumbnail","crop","embed","libvips","vips"],dependencies:{"@img/colour":"^1.0.0","detect-libc":"^2.1.0",semver:"^7.7.2"},optionalDependencies:{"@img/sharp-darwin-arm64":"0.34.4","@img/sharp-darwin-x64":"0.34.4","@img/sharp-libvips-darwin-arm64":"1.2.3","@img/sharp-libvips-darwin-x64":"1.2.3","@img/sharp-libvips-linux-arm":"1.2.3","@img/sharp-libvips-linux-arm64":"1.2.3","@img/sharp-libvips-linux-ppc64":"1.2.3","@img/sharp-libvips-linux-s390x":"1.2.3","@img/sharp-libvips-linux-x64":"1.2.3","@img/sharp-libvips-linuxmusl-arm64":"1.2.3","@img/sharp-libvips-linuxmusl-x64":"1.2.3","@img/sharp-linux-arm":"0.34.4","@img/sharp-linux-arm64":"0.34.4","@img/sharp-linux-ppc64":"0.34.4","@img/sharp-linux-s390x":"0.34.4","@img/sharp-linux-x64":"0.34.4","@img/sharp-linuxmusl-arm64":"0.34.4","@img/sharp-linuxmusl-x64":"0.34.4","@img/sharp-wasm32":"0.34.4","@img/sharp-win32-arm64":"0.34.4","@img/sharp-win32-ia32":"0.34.4","@img/sharp-win32-x64":"0.34.4"},devDependencies:{"@emnapi/runtime":"^1.5.0","@img/sharp-libvips-dev":"1.2.3","@img/sharp-libvips-dev-wasm32":"1.2.3","@img/sharp-libvips-win32-arm64":"1.2.3","@img/sharp-libvips-win32-ia32":"1.2.3","@img/sharp-libvips-win32-x64":"1.2.3","@types/node":"*",cc:"^3.0.1",emnapi:"^1.5.0","exif-reader":"^2.0.2","extract-zip":"^2.0.1",icc:"^3.0.0","jsdoc-to-markdown":"^9.1.2","license-checker":"^25.0.1",mocha:"^11.7.2","node-addon-api":"^8.5.0","node-gyp":"^11.4.2",nyc:"^17.1.0",semistandard:"^17.0.0","tar-fs":"^3.1.1",tsd:"^0.33.0"},license:"Apache-2.0",engines:{node:"^18.17.0 || ^20.3.0 || >=21.0.0"},config:{libvips:">=8.17.2"},funding:{url:"https://opencollective.com/libvips"},semistandard:{env:["mocha"]},cc:{linelength:"120",filter:["build/include"]},nyc:{include:["lib"]},tsd:{directory:"test/types/"}}});var Ye=w((Hl,Ot)=>{"use strict";var{spawnSync:Le}=require("node:child_process"),{createHash:qa}=require("node:crypto"),Ct=rt(),Ma=ze(),Fa=Lt(),Nt=Pe(),{config:Da,engines:Tt,optionalDependencies:Oa}=Qe(),za=process.env.npm_package_config_libvips||Da.libvips,Bt=Ct(za).version,Ua=["darwin-arm64","darwin-x64","linux-arm","linux-arm64","linux-ppc64","linux-s390x","linux-x64","linuxmusl-arm64","linuxmusl-x64","win32-arm64","win32-ia32","win32-x64"],Ne={encoding:"utf8",shell:!0},Ga=e=>{e instanceof Error?console.error(`sharp: Installation error: ${e.message}`):console.log(`sharp: ${e}`)},qt=()=>Nt.isNonGlibcLinuxSync()?Nt.familySync():"",Ha=()=>`${process.platform}${qt()}-${process.arch}`,ae=()=>{if(Mt())return"wasm32";let{npm_config_arch:e,npm_config_platform:r,npm_config_libc:t}=process.env,i=typeof t=="string"?t:qt();return`${r||process.platform}${i}-${e||process.arch}`},Wa=()=>{try{return require(`@img/sharp-libvips-dev-${ae()}/include`)}catch{try{return require("@img/sharp-libvips-dev/include")}catch{}}return""},Xa=()=>{try{return require("@img/sharp-libvips-dev/cplusplus")}catch{}return""},Va=()=>{try{return require(`@img/sharp-libvips-dev-${ae()}/lib`)}catch{try{return require(`@img/sharp-libvips-${ae()}/lib`)}catch{}}return""},Ka=()=>{if(process.release?.name==="node"&&process.versions&&!Fa(process.versions.node,Tt.node))return{found:process.versions.node,expected:Tt.node}},Mt=()=>{let{CC:e}=process.env;return!!(e&&e.endsWith("/emcc"))},Qa=()=>process.platform==="darwin"&&process.arch==="x64"?(Le("sysctl sysctl.proc_translated",Ne).stdout||"").trim()==="sysctl.proc_translated: 1":!1,_t=e=>qa("sha512").update(e).digest("hex"),Ja=()=>{try{let e=_t(`imgsharp-libvips-${ae()}`),r=Ct(Oa[`@img/sharp-libvips-${ae()}`],{includePrerelease:!0}).version;return _t(`${e}npm:${r}`).slice(0,10)}catch{}return""},Ya=()=>Le(`node-gyp rebuild --directory=src ${Mt()?"--nodedir=emscripten":""}`,{...Ne,stdio:"inherit"}).status,Ft=()=>process.platform!=="win32"?(Le("pkg-config --modversion vips-cpp",{...Ne,env:{...process.env,PKG_CONFIG_PATH:Dt()}}).stdout||"").trim():"",Dt=()=>process.platform!=="win32"?[(Le('which brew >/dev/null 2>&1 && brew environment --plain | grep PKG_CONFIG_LIBDIR | cut -d" " -f2',Ne).stdout||"").trim(),process.env.PKG_CONFIG_PATH,"/usr/local/lib/pkgconfig","/usr/lib/pkgconfig","/usr/local/libdata/pkgconfig","/usr/libdata/pkgconfig"].filter(Boolean).join(":"):"",Je=(e,r,t)=>(t&&t(`Detected ${r}, skipping search for globally-installed libvips`),e),Za=e=>{if(process.env.SHARP_IGNORE_GLOBAL_LIBVIPS)return Je(!1,"SHARP_IGNORE_GLOBAL_LIBVIPS",e);if(process.env.SHARP_FORCE_GLOBAL_LIBVIPS)return Je(!0,"SHARP_FORCE_GLOBAL_LIBVIPS",e);if(Qa())return Je(!1,"Rosetta",e);let r=Ft();return!!r&&Ma(r,Bt)};Ot.exports={minimumLibvipsVersion:Bt,prebuiltPlatforms:Ua,buildPlatformArch:ae,buildSharpLibvipsIncludeDir:Wa,buildSharpLibvipsCPlusPlusDir:Xa,buildSharpLibvipsLibDir:Va,isUnsupportedNodeRuntime:Ka,runtimePlatformArch:Ha,log:Ga,yarnLocator:Ja,spawnRebuild:Ya,globalLibvipsVersion:Ft,pkgConfigPath:Dt,useGlobalLibvips:Za}});var pe=w((Wl,Ut)=>{"use strict";var{familySync:es,versionSync:rs}=Pe(),{runtimePlatformArch:ts,isUnsupportedNodeRuntime:zt,prebuiltPlatforms:is,minimumLibvipsVersion:ns}=Ye(),Y=ts(),as=[`../src/build/Release/sharp-${Y}.node`,"../src/build/Release/sharp-wasm32.node",`@img/sharp-${Y}/sharp.node`,"@img/sharp-wasm32/sharp.node"],Ze,se,be=[];for(Ze of as)try{se=require(Ze);break}catch(e){be.push(e)}if(se&&Ze.startsWith("@img/sharp-linux-x64")&&!se._isUsingX64V2()){let e=new Error("Prebuilt binaries for linux-x64 require v2 microarchitecture");e.code="Unsupported CPU",be.push(e),se=null}if(se)Ut.exports=se;else{let[e,r,t]=["linux","darwin","win32"].map(s=>Y.startsWith(s)),i=[`Could not load the "sharp" module using the ${Y} runtime`];be.forEach(s=>{s.code!=="MODULE_NOT_FOUND"&&i.push(`${s.code}: ${s.message}`)});let n=be.map(s=>s.message).join(" ");if(i.push("Possible solutions:"),zt()){let{found:s,expected:o}=zt();i.push("- Please upgrade Node.js:",`    Found ${s}`,`    Requires ${o}`)}else if(is.includes(Y)){let[s,o]=Y.split("-"),h=s.endsWith("musl")?" --libc=musl":"";i.push("- Ensure optional dependencies can be installed:","    npm install --include=optional sharp","- Ensure your package manager supports multi-platform installation:","    See https://sharp.pixelplumbing.com/install#cross-platform","- Add platform-specific dependencies:",`    npm install --os=${s.replace("musl","")}${h} --cpu=${o} sharp`)}else i.push(`- Manually install libvips >= ${ns}`,"- Add experimental WebAssembly-based dependencies:","    npm install --cpu=wasm32 sharp","    npm install @img/sharp-wasm32");if(e&&/(symbol not found|CXXABI_)/i.test(n))try{let{config:s}=require(`@img/sharp-libvips-${Y}/package`),o=`${es()} ${rs()}`,h=`${s.musl?"musl":"glibc"} ${s.musl||s.glibc}`;i.push("- Update your OS:",`    Found ${o}`,`    Requires ${h}`)}catch{}throw e&&/\/snap\/core[0-9]{2}/.test(n)&&i.push("- Remove the Node.js Snap, which does not support native modules","    snap remove node"),r&&/Incompatible library version/.test(n)&&i.push("- Update Homebrew:","    brew update && brew upgrade vips"),be.some(s=>s.code==="ERR_DLOPEN_DISABLED")&&i.push("- Run Node.js without using the --no-addons flag"),t&&/The specified procedure could not be found/.test(n)&&i.push("- Using the canvas package on Windows?","    See https://sharp.pixelplumbing.com/install#canvas-and-windows","- Check for outdated versions of sharp in the dependency tree:","    npm ls sharp"),i.push("- Consult the installation documentation:","    See https://sharp.pixelplumbing.com/install"),new Error(i.join(`
`))}});var Ht=w((Xl,Gt)=>{"use strict";var ss=require("node:util"),er=require("node:stream"),os=T();pe();var ls=ss.debuglog("sharp"),Z=function(e,r){if(arguments.length===1&&!os.defined(e))throw new Error("Invalid input");return this instanceof Z?(er.Duplex.call(this),this.options={topOffsetPre:-1,leftOffsetPre:-1,widthPre:-1,heightPre:-1,topOffsetPost:-1,leftOffsetPost:-1,widthPost:-1,heightPost:-1,width:-1,height:-1,canvas:"crop",position:0,resizeBackground:[0,0,0,255],angle:0,rotationAngle:0,rotationBackground:[0,0,0,255],rotateBefore:!1,orientBefore:!1,flip:!1,flop:!1,extendTop:0,extendBottom:0,extendLeft:0,extendRight:0,extendBackground:[0,0,0,255],extendWith:"background",withoutEnlargement:!1,withoutReduction:!1,affineMatrix:[],affineBackground:[0,0,0,255],affineIdx:0,affineIdy:0,affineOdx:0,affineOdy:0,affineInterpolator:this.constructor.interpolators.bilinear,kernel:"lanczos3",fastShrinkOnLoad:!0,tint:[-1,0,0,0],flatten:!1,flattenBackground:[0,0,0],unflatten:!1,negate:!1,negateAlpha:!0,medianSize:0,blurSigma:0,precision:"integer",minAmpl:.2,sharpenSigma:0,sharpenM1:1,sharpenM2:2,sharpenX1:2,sharpenY2:10,sharpenY3:20,threshold:0,thresholdGrayscale:!0,trimBackground:[],trimThreshold:-1,trimLineArt:!1,dilateWidth:0,erodeWidth:0,gamma:0,gammaOut:0,greyscale:!1,normalise:!1,normaliseLower:1,normaliseUpper:99,claheWidth:0,claheHeight:0,claheMaxSlope:3,brightness:1,saturation:1,hue:0,lightness:0,booleanBufferIn:null,booleanFileIn:"",joinChannelIn:[],extractChannel:-1,removeAlpha:!1,ensureAlpha:-1,colourspace:"srgb",colourspacePipeline:"last",composite:[],fileOut:"",formatOut:"input",streamOut:!1,keepMetadata:0,withMetadataOrientation:-1,withMetadataDensity:0,withIccProfile:"",withExif:{},withExifMerge:!0,withXmp:"",resolveWithObject:!1,loop:-1,delay:[],jpegQuality:80,jpegProgressive:!1,jpegChromaSubsampling:"4:2:0",jpegTrellisQuantisation:!1,jpegOvershootDeringing:!1,jpegOptimiseScans:!1,jpegOptimiseCoding:!0,jpegQuantisationTable:0,pngProgressive:!1,pngCompressionLevel:6,pngAdaptiveFiltering:!1,pngPalette:!1,pngQuality:100,pngEffort:7,pngBitdepth:8,pngDither:1,jp2Quality:80,jp2TileHeight:512,jp2TileWidth:512,jp2Lossless:!1,jp2ChromaSubsampling:"4:4:4",webpQuality:80,webpAlphaQuality:100,webpLossless:!1,webpNearLossless:!1,webpSmartSubsample:!1,webpSmartDeblock:!1,webpPreset:"default",webpEffort:4,webpMinSize:!1,webpMixed:!1,gifBitdepth:8,gifEffort:7,gifDither:1,gifInterFrameMaxError:0,gifInterPaletteMaxError:3,gifKeepDuplicateFrames:!1,gifReuse:!0,gifProgressive:!1,tiffQuality:80,tiffCompression:"jpeg",tiffPredictor:"horizontal",tiffPyramid:!1,tiffMiniswhite:!1,tiffBitdepth:8,tiffTile:!1,tiffTileHeight:256,tiffTileWidth:256,tiffXres:1,tiffYres:1,tiffResolutionUnit:"inch",heifQuality:50,heifLossless:!1,heifCompression:"av1",heifEffort:4,heifChromaSubsampling:"4:4:4",heifBitdepth:8,jxlDistance:1,jxlDecodingTier:0,jxlEffort:7,jxlLossless:!1,rawDepth:"uchar",tileSize:256,tileOverlap:0,tileContainer:"fs",tileLayout:"dz",tileFormat:"last",tileDepth:"last",tileAngle:0,tileSkipBlanks:-1,tileBackground:[255,255,255,255],tileCentre:!1,tileId:"https://example.com/iiif",tileBasename:"",timeoutSeconds:0,linearA:[],linearB:[],pdfBackground:[255,255,255,255],debuglog:t=>{this.emit("warning",t),ls(t)},queueListener:function(t){Z.queue.emit("change",t)}},this.options.input=this._createInputDescriptor(e,r,{allowStream:!0}),this):new Z(e,r)};Object.setPrototypeOf(Z.prototype,er.Duplex.prototype);Object.setPrototypeOf(Z,er.Duplex);function cs(){let e=this.constructor.call(),{debuglog:r,queueListener:t,...i}=this.options;return e.options=structuredClone(i),e.options.debuglog=r,e.options.queueListener=t,this._isStreamInput()&&this.on("finish",()=>{this._flattenBufferIn(),e.options.input.buffer=this.options.input.buffer,e.emit("finish")}),e}Object.assign(Z.prototype,{clone:cs});Gt.exports=Z});var Vt=w((Vl,Xt)=>{"use strict";var l=T(),H=pe(),hs={left:"low",top:"low",low:"low",center:"centre",centre:"centre",right:"high",bottom:"high",high:"high"},fs=["failOn","limitInputPixels","unlimited","animated","autoOrient","density","ignoreIcc","page","pages","sequentialRead","jp2","openSlide","pdf","raw","svg","tiff","failOnError","openSlideLevel","pdfBackground","tiffSubifd"];function Wt(e){let r=fs.filter(t=>l.defined(e[t])).map(t=>[t,e[t]]);return r.length?Object.fromEntries(r):void 0}function us(e,r,t){let i={autoOrient:!1,failOn:"warning",limitInputPixels:Math.pow(16383,2),ignoreIcc:!1,unlimited:!1,sequentialRead:!0};if(l.string(e))i.file=e;else if(l.buffer(e)){if(e.length===0)throw Error("Input Buffer is empty");i.buffer=e}else if(l.arrayBuffer(e)){if(e.byteLength===0)throw Error("Input bit Array is empty");i.buffer=Buffer.from(e,0,e.byteLength)}else if(l.typedArray(e)){if(e.length===0)throw Error("Input Bit Array is empty");i.buffer=Buffer.from(e.buffer,e.byteOffset,e.byteLength)}else if(l.plainObject(e)&&!l.defined(r))r=e,Wt(r)&&(i.buffer=[]);else if(!l.defined(e)&&!l.defined(r)&&l.object(t)&&t.allowStream)i.buffer=[];else if(Array.isArray(e))if(e.length>1)if(!this.options.joining)this.options.joining=!0,this.options.join=e.map(n=>this._createInputDescriptor(n));else throw new Error("Recursive join is unsupported");else throw new Error("Expected at least two images to join");else throw new Error(`Unsupported input '${e}' of type ${typeof e}${l.defined(r)?` when also providing options of type ${typeof r}`:""}`);if(l.object(r)){if(l.defined(r.failOnError))if(l.bool(r.failOnError))i.failOn=r.failOnError?"warning":"none";else throw l.invalidParameterError("failOnError","boolean",r.failOnError);if(l.defined(r.failOn))if(l.string(r.failOn)&&l.inArray(r.failOn,["none","truncated","error","warning"]))i.failOn=r.failOn;else throw l.invalidParameterError("failOn","one of: none, truncated, error, warning",r.failOn);if(l.defined(r.autoOrient))if(l.bool(r.autoOrient))i.autoOrient=r.autoOrient;else throw l.invalidParameterError("autoOrient","boolean",r.autoOrient);if(l.defined(r.density))if(l.inRange(r.density,1,1e5))i.density=r.density;else throw l.invalidParameterError("density","number between 1 and 100000",r.density);if(l.defined(r.ignoreIcc))if(l.bool(r.ignoreIcc))i.ignoreIcc=r.ignoreIcc;else throw l.invalidParameterError("ignoreIcc","boolean",r.ignoreIcc);if(l.defined(r.limitInputPixels))if(l.bool(r.limitInputPixels))i.limitInputPixels=r.limitInputPixels?Math.pow(16383,2):0;else if(l.integer(r.limitInputPixels)&&l.inRange(r.limitInputPixels,0,Number.MAX_SAFE_INTEGER))i.limitInputPixels=r.limitInputPixels;else throw l.invalidParameterError("limitInputPixels","positive integer",r.limitInputPixels);if(l.defined(r.unlimited))if(l.bool(r.unlimited))i.unlimited=r.unlimited;else throw l.invalidParameterError("unlimited","boolean",r.unlimited);if(l.defined(r.sequentialRead))if(l.bool(r.sequentialRead))i.sequentialRead=r.sequentialRead;else throw l.invalidParameterError("sequentialRead","boolean",r.sequentialRead);if(l.defined(r.raw)){if(l.object(r.raw)&&l.integer(r.raw.width)&&r.raw.width>0&&l.integer(r.raw.height)&&r.raw.height>0&&l.integer(r.raw.channels)&&l.inRange(r.raw.channels,1,4))switch(i.rawWidth=r.raw.width,i.rawHeight=r.raw.height,i.rawChannels=r.raw.channels,e.constructor){case Uint8Array:case Uint8ClampedArray:i.rawDepth="uchar";break;case Int8Array:i.rawDepth="char";break;case Uint16Array:i.rawDepth="ushort";break;case Int16Array:i.rawDepth="short";break;case Uint32Array:i.rawDepth="uint";break;case Int32Array:i.rawDepth="int";break;case Float32Array:i.rawDepth="float";break;case Float64Array:i.rawDepth="double";break;default:i.rawDepth="uchar";break}else throw new Error("Expected width, height and channels for raw pixel input");if(i.rawPremultiplied=!1,l.defined(r.raw.premultiplied))if(l.bool(r.raw.premultiplied))i.rawPremultiplied=r.raw.premultiplied;else throw l.invalidParameterError("raw.premultiplied","boolean",r.raw.premultiplied);if(i.rawPageHeight=0,l.defined(r.raw.pageHeight))if(l.integer(r.raw.pageHeight)&&r.raw.pageHeight>0&&r.raw.pageHeight<=r.raw.height){if(r.raw.height%r.raw.pageHeight!==0)throw new Error(`Expected raw.height ${r.raw.height} to be a multiple of raw.pageHeight ${r.raw.pageHeight}`);i.rawPageHeight=r.raw.pageHeight}else throw l.invalidParameterError("raw.pageHeight","positive integer",r.raw.pageHeight)}if(l.defined(r.animated))if(l.bool(r.animated))i.pages=r.animated?-1:1;else throw l.invalidParameterError("animated","boolean",r.animated);if(l.defined(r.pages))if(l.integer(r.pages)&&l.inRange(r.pages,-1,1e5))i.pages=r.pages;else throw l.invalidParameterError("pages","integer between -1 and 100000",r.pages);if(l.defined(r.page))if(l.integer(r.page)&&l.inRange(r.page,0,1e5))i.page=r.page;else throw l.invalidParameterError("page","integer between 0 and 100000",r.page);if(l.object(r.openSlide)&&l.defined(r.openSlide.level))if(l.integer(r.openSlide.level)&&l.inRange(r.openSlide.level,0,256))i.openSlideLevel=r.openSlide.level;else throw l.invalidParameterError("openSlide.level","integer between 0 and 256",r.openSlide.level);else if(l.defined(r.level))if(l.integer(r.level)&&l.inRange(r.level,0,256))i.openSlideLevel=r.level;else throw l.invalidParameterError("level","integer between 0 and 256",r.level);if(l.object(r.tiff)&&l.defined(r.tiff.subifd))if(l.integer(r.tiff.subifd)&&l.inRange(r.tiff.subifd,-1,1e5))i.tiffSubifd=r.tiff.subifd;else throw l.invalidParameterError("tiff.subifd","integer between -1 and 100000",r.tiff.subifd);else if(l.defined(r.subifd))if(l.integer(r.subifd)&&l.inRange(r.subifd,-1,1e5))i.tiffSubifd=r.subifd;else throw l.invalidParameterError("subifd","integer between -1 and 100000",r.subifd);if(l.object(r.svg)){if(l.defined(r.svg.stylesheet))if(l.string(r.svg.stylesheet))i.svgStylesheet=r.svg.stylesheet;else throw l.invalidParameterError("svg.stylesheet","string",r.svg.stylesheet);if(l.defined(r.svg.highBitdepth))if(l.bool(r.svg.highBitdepth))i.svgHighBitdepth=r.svg.highBitdepth;else throw l.invalidParameterError("svg.highBitdepth","boolean",r.svg.highBitdepth)}if(l.object(r.pdf)&&l.defined(r.pdf.background)?i.pdfBackground=this._getBackgroundColourOption(r.pdf.background):l.defined(r.pdfBackground)&&(i.pdfBackground=this._getBackgroundColourOption(r.pdfBackground)),l.object(r.jp2)&&l.defined(r.jp2.oneshot))if(l.bool(r.jp2.oneshot))i.jp2Oneshot=r.jp2.oneshot;else throw l.invalidParameterError("jp2.oneshot","boolean",r.jp2.oneshot);if(l.defined(r.create))if(l.object(r.create)&&l.integer(r.create.width)&&r.create.width>0&&l.integer(r.create.height)&&r.create.height>0&&l.integer(r.create.channels)){if(i.createWidth=r.create.width,i.createHeight=r.create.height,i.createChannels=r.create.channels,i.createPageHeight=0,l.defined(r.create.pageHeight))if(l.integer(r.create.pageHeight)&&r.create.pageHeight>0&&r.create.pageHeight<=r.create.height){if(r.create.height%r.create.pageHeight!==0)throw new Error(`Expected create.height ${r.create.height} to be a multiple of create.pageHeight ${r.create.pageHeight}`);i.createPageHeight=r.create.pageHeight}else throw l.invalidParameterError("create.pageHeight","positive integer",r.create.pageHeight);if(l.defined(r.create.noise)){if(!l.object(r.create.noise))throw new Error("Expected noise to be an object");if(r.create.noise.type!=="gaussian")throw new Error("Only gaussian noise is supported at the moment");if(i.createNoiseType=r.create.noise.type,!l.inRange(r.create.channels,1,4))throw l.invalidParameterError("create.channels","number between 1 and 4",r.create.channels);if(i.createNoiseMean=128,l.defined(r.create.noise.mean))if(l.number(r.create.noise.mean)&&l.inRange(r.create.noise.mean,0,1e4))i.createNoiseMean=r.create.noise.mean;else throw l.invalidParameterError("create.noise.mean","number between 0 and 10000",r.create.noise.mean);if(i.createNoiseSigma=30,l.defined(r.create.noise.sigma))if(l.number(r.create.noise.sigma)&&l.inRange(r.create.noise.sigma,0,1e4))i.createNoiseSigma=r.create.noise.sigma;else throw l.invalidParameterError("create.noise.sigma","number between 0 and 10000",r.create.noise.sigma)}else if(l.defined(r.create.background)){if(!l.inRange(r.create.channels,3,4))throw l.invalidParameterError("create.channels","number between 3 and 4",r.create.channels);i.createBackground=this._getBackgroundColourOption(r.create.background)}else throw new Error("Expected valid noise or background to create a new input image");delete i.buffer}else throw new Error("Expected valid width, height and channels to create a new input image");if(l.defined(r.text))if(l.object(r.text)&&l.string(r.text.text)){if(i.textValue=r.text.text,l.defined(r.text.height)&&l.defined(r.text.dpi))throw new Error("Expected only one of dpi or height");if(l.defined(r.text.font))if(l.string(r.text.font))i.textFont=r.text.font;else throw l.invalidParameterError("text.font","string",r.text.font);if(l.defined(r.text.fontfile))if(l.string(r.text.fontfile))i.textFontfile=r.text.fontfile;else throw l.invalidParameterError("text.fontfile","string",r.text.fontfile);if(l.defined(r.text.width))if(l.integer(r.text.width)&&r.text.width>0)i.textWidth=r.text.width;else throw l.invalidParameterError("text.width","positive integer",r.text.width);if(l.defined(r.text.height))if(l.integer(r.text.height)&&r.text.height>0)i.textHeight=r.text.height;else throw l.invalidParameterError("text.height","positive integer",r.text.height);if(l.defined(r.text.align))if(l.string(r.text.align)&&l.string(this.constructor.align[r.text.align]))i.textAlign=this.constructor.align[r.text.align];else throw l.invalidParameterError("text.align","valid alignment",r.text.align);if(l.defined(r.text.justify))if(l.bool(r.text.justify))i.textJustify=r.text.justify;else throw l.invalidParameterError("text.justify","boolean",r.text.justify);if(l.defined(r.text.dpi))if(l.integer(r.text.dpi)&&l.inRange(r.text.dpi,1,1e6))i.textDpi=r.text.dpi;else throw l.invalidParameterError("text.dpi","integer between 1 and 1000000",r.text.dpi);if(l.defined(r.text.rgba))if(l.bool(r.text.rgba))i.textRgba=r.text.rgba;else throw l.invalidParameterError("text.rgba","bool",r.text.rgba);if(l.defined(r.text.spacing))if(l.integer(r.text.spacing)&&l.inRange(r.text.spacing,-1e6,1e6))i.textSpacing=r.text.spacing;else throw l.invalidParameterError("text.spacing","integer between -1000000 and 1000000",r.text.spacing);if(l.defined(r.text.wrap))if(l.string(r.text.wrap)&&l.inArray(r.text.wrap,["word","char","word-char","none"]))i.textWrap=r.text.wrap;else throw l.invalidParameterError("text.wrap","one of: word, char, word-char, none",r.text.wrap);delete i.buffer}else throw new Error("Expected a valid string to create an image with text.");if(l.defined(r.join))if(l.defined(this.options.join)){if(l.defined(r.join.animated))if(l.bool(r.join.animated))i.joinAnimated=r.join.animated;else throw l.invalidParameterError("join.animated","boolean",r.join.animated);if(l.defined(r.join.across))if(l.integer(r.join.across)&&l.inRange(r.join.across,1,1e6))i.joinAcross=r.join.across;else throw l.invalidParameterError("join.across","integer between 1 and 100000",r.join.across);if(l.defined(r.join.shim))if(l.integer(r.join.shim)&&l.inRange(r.join.shim,0,1e6))i.joinShim=r.join.shim;else throw l.invalidParameterError("join.shim","integer between 0 and 100000",r.join.shim);if(l.defined(r.join.background)&&(i.joinBackground=this._getBackgroundColourOption(r.join.background)),l.defined(r.join.halign))if(l.string(r.join.halign)&&l.string(this.constructor.align[r.join.halign]))i.joinHalign=this.constructor.align[r.join.halign];else throw l.invalidParameterError("join.halign","valid alignment",r.join.halign);if(l.defined(r.join.valign))if(l.string(r.join.valign)&&l.string(this.constructor.align[r.join.valign]))i.joinValign=this.constructor.align[r.join.valign];else throw l.invalidParameterError("join.valign","valid alignment",r.join.valign)}else throw new Error("Expected input to be an array of images to join")}else if(l.defined(r))throw new Error("Invalid input options "+r);return i}function ds(e,r,t){Array.isArray(this.options.input.buffer)?l.buffer(e)?(this.options.input.buffer.length===0&&this.on("finish",()=>{this.streamInFinished=!0}),this.options.input.buffer.push(e),t()):t(new Error("Non-Buffer data on Writable Stream")):t(new Error("Unexpected data on Writable Stream"))}function ms(){this._isStreamInput()&&(this.options.input.buffer=Buffer.concat(this.options.input.buffer))}function gs(){return Array.isArray(this.options.input.buffer)}function bs(e){let r=Error();return l.fn(e)?(this._isStreamInput()?this.on("finish",()=>{this._flattenBufferIn(),H.metadata(this.options,(t,i)=>{t?e(l.nativeError(t,r)):e(null,i)})}):H.metadata(this.options,(t,i)=>{t?e(l.nativeError(t,r)):e(null,i)}),this):this._isStreamInput()?new Promise((t,i)=>{let n=()=>{this._flattenBufferIn(),H.metadata(this.options,(s,o)=>{s?i(l.nativeError(s,r)):t(o)})};this.writableFinished?n():this.once("finish",n)}):new Promise((t,i)=>{H.metadata(this.options,(n,s)=>{n?i(l.nativeError(n,r)):t(s)})})}function ps(e){let r=Error();return l.fn(e)?(this._isStreamInput()?this.on("finish",()=>{this._flattenBufferIn(),H.stats(this.options,(t,i)=>{t?e(l.nativeError(t,r)):e(null,i)})}):H.stats(this.options,(t,i)=>{t?e(l.nativeError(t,r)):e(null,i)}),this):this._isStreamInput()?new Promise((t,i)=>{this.on("finish",function(){this._flattenBufferIn(),H.stats(this.options,(n,s)=>{n?i(l.nativeError(n,r)):t(s)})})}):new Promise((t,i)=>{H.stats(this.options,(n,s)=>{n?i(l.nativeError(n,r)):t(s)})})}Xt.exports=function(e){Object.assign(e.prototype,{_inputOptionsFromObject:Wt,_createInputDescriptor:us,_write:ds,_flattenBufferIn:ms,_isStreamInput:gs,metadata:bs,stats:ps}),e.align=hs}});var ei=w((Kl,Zt)=>{"use strict";var b=T(),Qt={center:0,centre:0,north:1,east:2,south:3,west:4,northeast:5,southeast:6,southwest:7,northwest:8},Jt={top:1,right:2,bottom:3,left:4,"right top":5,"right bottom":6,"left bottom":7,"left top":8},Kt={background:"background",copy:"copy",repeat:"repeat",mirror:"mirror"},Yt={entropy:16,attention:17},rr={nearest:"nearest",linear:"linear",cubic:"cubic",mitchell:"mitchell",lanczos2:"lanczos2",lanczos3:"lanczos3",mks2013:"mks2013",mks2021:"mks2021"},ws={contain:"contain",cover:"cover",fill:"fill",inside:"inside",outside:"outside"},Es={contain:"embed",cover:"crop",fill:"ignore_aspect",inside:"max",outside:"min"};function tr(e){return e.angle%360!==0||e.rotationAngle!==0}function Te(e){return e.width!==-1||e.height!==-1}function vs(e,r,t){if(Te(this.options)&&this.options.debuglog("ignoring previous resize options"),this.options.widthPost!==-1&&this.options.debuglog("operation order will be: extract, resize, extract"),b.defined(e))if(b.object(e)&&!b.defined(t))t=e;else if(b.integer(e)&&e>0)this.options.width=e;else throw b.invalidParameterError("width","positive integer",e);else this.options.width=-1;if(b.defined(r))if(b.integer(r)&&r>0)this.options.height=r;else throw b.invalidParameterError("height","positive integer",r);else this.options.height=-1;if(b.object(t)){if(b.defined(t.width))if(b.integer(t.width)&&t.width>0)this.options.width=t.width;else throw b.invalidParameterError("width","positive integer",t.width);if(b.defined(t.height))if(b.integer(t.height)&&t.height>0)this.options.height=t.height;else throw b.invalidParameterError("height","positive integer",t.height);if(b.defined(t.fit)){let i=Es[t.fit];if(b.string(i))this.options.canvas=i;else throw b.invalidParameterError("fit","valid fit",t.fit)}if(b.defined(t.position)){let i=b.integer(t.position)?t.position:Yt[t.position]||Jt[t.position]||Qt[t.position];if(b.integer(i)&&(b.inRange(i,0,8)||b.inRange(i,16,17)))this.options.position=i;else throw b.invalidParameterError("position","valid position/gravity/strategy",t.position)}if(this._setBackgroundColourOption("resizeBackground",t.background),b.defined(t.kernel))if(b.string(rr[t.kernel]))this.options.kernel=rr[t.kernel];else throw b.invalidParameterError("kernel","valid kernel name",t.kernel);b.defined(t.withoutEnlargement)&&this._setBooleanOption("withoutEnlargement",t.withoutEnlargement),b.defined(t.withoutReduction)&&this._setBooleanOption("withoutReduction",t.withoutReduction),b.defined(t.fastShrinkOnLoad)&&this._setBooleanOption("fastShrinkOnLoad",t.fastShrinkOnLoad)}return tr(this.options)&&Te(this.options)&&(this.options.rotateBefore=!0),this}function ys(e){if(b.integer(e)&&e>0)this.options.extendTop=e,this.options.extendBottom=e,this.options.extendLeft=e,this.options.extendRight=e;else if(b.object(e)){if(b.defined(e.top))if(b.integer(e.top)&&e.top>=0)this.options.extendTop=e.top;else throw b.invalidParameterError("top","positive integer",e.top);if(b.defined(e.bottom))if(b.integer(e.bottom)&&e.bottom>=0)this.options.extendBottom=e.bottom;else throw b.invalidParameterError("bottom","positive integer",e.bottom);if(b.defined(e.left))if(b.integer(e.left)&&e.left>=0)this.options.extendLeft=e.left;else throw b.invalidParameterError("left","positive integer",e.left);if(b.defined(e.right))if(b.integer(e.right)&&e.right>=0)this.options.extendRight=e.right;else throw b.invalidParameterError("right","positive integer",e.right);if(this._setBackgroundColourOption("extendBackground",e.background),b.defined(e.extendWith))if(b.string(Kt[e.extendWith]))this.options.extendWith=Kt[e.extendWith];else throw b.invalidParameterError("extendWith","one of: background, copy, repeat, mirror",e.extendWith)}else throw b.invalidParameterError("extend","integer or object",e);return this}function Ps(e){let r=Te(this.options)||this.options.widthPre!==-1?"Post":"Pre";return this.options[`width${r}`]!==-1&&this.options.debuglog("ignoring previous extract options"),["left","top","width","height"].forEach(function(t){let i=e[t];if(b.integer(i)&&i>=0)this.options[t+(t==="left"||t==="top"?"Offset":"")+r]=i;else throw b.invalidParameterError(t,"integer",i)},this),tr(this.options)&&!Te(this.options)&&(this.options.widthPre===-1||this.options.widthPost===-1)&&(this.options.rotateBefore=!0),this.options.input.autoOrient&&(this.options.orientBefore=!0),this}function xs(e){if(this.options.trimThreshold=10,b.defined(e))if(b.object(e)){if(b.defined(e.background)&&this._setBackgroundColourOption("trimBackground",e.background),b.defined(e.threshold))if(b.number(e.threshold)&&e.threshold>=0)this.options.trimThreshold=e.threshold;else throw b.invalidParameterError("threshold","positive number",e.threshold);b.defined(e.lineArt)&&this._setBooleanOption("trimLineArt",e.lineArt)}else throw b.invalidParameterError("trim","object",e);return tr(this.options)&&(this.options.rotateBefore=!0),this}Zt.exports=function(e){Object.assign(e.prototype,{resize:vs,extend:ys,extract:Ps,trim:xs}),e.gravity=Qt,e.strategy=Yt,e.kernel=rr,e.fit=ws,e.position=Jt}});var ti=w((Ql,ri)=>{"use strict";var y=T(),ir={clear:"clear",source:"source",over:"over",in:"in",out:"out",atop:"atop",dest:"dest","dest-over":"dest-over","dest-in":"dest-in","dest-out":"dest-out","dest-atop":"dest-atop",xor:"xor",add:"add",saturate:"saturate",multiply:"multiply",screen:"screen",overlay:"overlay",darken:"darken",lighten:"lighten","colour-dodge":"colour-dodge","color-dodge":"colour-dodge","colour-burn":"colour-burn","color-burn":"colour-burn","hard-light":"hard-light","soft-light":"soft-light",difference:"difference",exclusion:"exclusion"};function Rs(e){if(!Array.isArray(e))throw y.invalidParameterError("images to composite","array",e);return this.options.composite=e.map(r=>{if(!y.object(r))throw y.invalidParameterError("image to composite","object",r);let t=this._inputOptionsFromObject(r),i={input:this._createInputDescriptor(r.input,t,{allowStream:!1}),blend:"over",tile:!1,left:0,top:0,hasOffset:!1,gravity:0,premultiplied:!1};if(y.defined(r.blend))if(y.string(ir[r.blend]))i.blend=ir[r.blend];else throw y.invalidParameterError("blend","valid blend name",r.blend);if(y.defined(r.tile))if(y.bool(r.tile))i.tile=r.tile;else throw y.invalidParameterError("tile","boolean",r.tile);if(y.defined(r.left))if(y.integer(r.left))i.left=r.left;else throw y.invalidParameterError("left","integer",r.left);if(y.defined(r.top))if(y.integer(r.top))i.top=r.top;else throw y.invalidParameterError("top","integer",r.top);if(y.defined(r.top)!==y.defined(r.left))throw new Error("Expected both left and top to be set");if(i.hasOffset=y.integer(r.top)&&y.integer(r.left),y.defined(r.gravity))if(y.integer(r.gravity)&&y.inRange(r.gravity,0,8))i.gravity=r.gravity;else if(y.string(r.gravity)&&y.integer(this.constructor.gravity[r.gravity]))i.gravity=this.constructor.gravity[r.gravity];else throw y.invalidParameterError("gravity","valid gravity",r.gravity);if(y.defined(r.premultiplied))if(y.bool(r.premultiplied))i.premultiplied=r.premultiplied;else throw y.invalidParameterError("premultiplied","boolean",r.premultiplied);return i}),this}ri.exports=function(e){e.prototype.composite=Rs,e.blend=ir}});var oi=w((Jl,si)=>{"use strict";var c=T(),ii={integer:"integer",float:"float",approximate:"approximate"};function Is(e,r){if(!c.defined(e))return this.autoOrient();if((this.options.angle||this.options.rotationAngle)&&(this.options.debuglog("ignoring previous rotate options"),this.options.angle=0,this.options.rotationAngle=0),c.integer(e)&&!(e%90))this.options.angle=e;else if(c.number(e))this.options.rotationAngle=e,c.object(r)&&r.background&&this._setBackgroundColourOption("rotationBackground",r.background);else throw c.invalidParameterError("angle","numeric",e);return this}function js(){return this.options.input.autoOrient=!0,this}function As(e){return this.options.flip=c.bool(e)?e:!0,this}function ks(e){return this.options.flop=c.bool(e)?e:!0,this}function $s(e,r){let t=[].concat(...e);if(t.length===4&&t.every(c.number))this.options.affineMatrix=t;else throw c.invalidParameterError("matrix","1x4 or 2x2 array",e);if(c.defined(r))if(c.object(r)){if(this._setBackgroundColourOption("affineBackground",r.background),c.defined(r.idx))if(c.number(r.idx))this.options.affineIdx=r.idx;else throw c.invalidParameterError("options.idx","number",r.idx);if(c.defined(r.idy))if(c.number(r.idy))this.options.affineIdy=r.idy;else throw c.invalidParameterError("options.idy","number",r.idy);if(c.defined(r.odx))if(c.number(r.odx))this.options.affineOdx=r.odx;else throw c.invalidParameterError("options.odx","number",r.odx);if(c.defined(r.ody))if(c.number(r.ody))this.options.affineOdy=r.ody;else throw c.invalidParameterError("options.ody","number",r.ody);if(c.defined(r.interpolator))if(c.inArray(r.interpolator,Object.values(this.constructor.interpolators)))this.options.affineInterpolator=r.interpolator;else throw c.invalidParameterError("options.interpolator","valid interpolator name",r.interpolator)}else throw c.invalidParameterError("options","object",r);return this}function Ss(e,r,t){if(!c.defined(e))this.options.sharpenSigma=-1;else if(c.bool(e))this.options.sharpenSigma=e?-1:0;else if(c.number(e)&&c.inRange(e,.01,1e4)){if(this.options.sharpenSigma=e,c.defined(r))if(c.number(r)&&c.inRange(r,0,1e4))this.options.sharpenM1=r;else throw c.invalidParameterError("flat","number between 0 and 10000",r);if(c.defined(t))if(c.number(t)&&c.inRange(t,0,1e4))this.options.sharpenM2=t;else throw c.invalidParameterError("jagged","number between 0 and 10000",t)}else if(c.plainObject(e)){if(c.number(e.sigma)&&c.inRange(e.sigma,1e-6,10))this.options.sharpenSigma=e.sigma;else throw c.invalidParameterError("options.sigma","number between 0.000001 and 10",e.sigma);if(c.defined(e.m1))if(c.number(e.m1)&&c.inRange(e.m1,0,1e6))this.options.sharpenM1=e.m1;else throw c.invalidParameterError("options.m1","number between 0 and 1000000",e.m1);if(c.defined(e.m2))if(c.number(e.m2)&&c.inRange(e.m2,0,1e6))this.options.sharpenM2=e.m2;else throw c.invalidParameterError("options.m2","number between 0 and 1000000",e.m2);if(c.defined(e.x1))if(c.number(e.x1)&&c.inRange(e.x1,0,1e6))this.options.sharpenX1=e.x1;else throw c.invalidParameterError("options.x1","number between 0 and 1000000",e.x1);if(c.defined(e.y2))if(c.number(e.y2)&&c.inRange(e.y2,0,1e6))this.options.sharpenY2=e.y2;else throw c.invalidParameterError("options.y2","number between 0 and 1000000",e.y2);if(c.defined(e.y3))if(c.number(e.y3)&&c.inRange(e.y3,0,1e6))this.options.sharpenY3=e.y3;else throw c.invalidParameterError("options.y3","number between 0 and 1000000",e.y3)}else throw c.invalidParameterError("sigma","number between 0.01 and 10000",e);return this}function Ls(e){if(!c.defined(e))this.options.medianSize=3;else if(c.integer(e)&&c.inRange(e,1,1e3))this.options.medianSize=e;else throw c.invalidParameterError("size","integer between 1 and 1000",e);return this}function Ns(e){let r;if(c.number(e))r=e;else if(c.plainObject(e)){if(!c.number(e.sigma))throw c.invalidParameterError("options.sigma","number between 0.3 and 1000",r);if(r=e.sigma,"precision"in e)if(c.string(ii[e.precision]))this.options.precision=ii[e.precision];else throw c.invalidParameterError("precision","one of: integer, float, approximate",e.precision);if("minAmplitude"in e)if(c.number(e.minAmplitude)&&c.inRange(e.minAmplitude,.001,1))this.options.minAmpl=e.minAmplitude;else throw c.invalidParameterError("minAmplitude","number between 0.001 and 1",e.minAmplitude)}if(!c.defined(e))this.options.blurSigma=-1;else if(c.bool(e))this.options.blurSigma=e?-1:0;else if(c.number(r)&&c.inRange(r,.3,1e3))this.options.blurSigma=r;else throw c.invalidParameterError("sigma","number between 0.3 and 1000",r);return this}function ni(e){if(!c.defined(e))this.options.dilateWidth=1;else if(c.integer(e)&&e>0)this.options.dilateWidth=e;else throw c.invalidParameterError("dilate","positive integer",ni);return this}function ai(e){if(!c.defined(e))this.options.erodeWidth=1;else if(c.integer(e)&&e>0)this.options.erodeWidth=e;else throw c.invalidParameterError("erode","positive integer",ai);return this}function Ts(e){return this.options.flatten=c.bool(e)?e:!0,c.object(e)&&this._setBackgroundColourOption("flattenBackground",e.background),this}function _s(){return this.options.unflatten=!0,this}function Cs(e,r){if(!c.defined(e))this.options.gamma=2.2;else if(c.number(e)&&c.inRange(e,1,3))this.options.gamma=e;else throw c.invalidParameterError("gamma","number between 1.0 and 3.0",e);if(!c.defined(r))this.options.gammaOut=this.options.gamma;else if(c.number(r)&&c.inRange(r,1,3))this.options.gammaOut=r;else throw c.invalidParameterError("gammaOut","number between 1.0 and 3.0",r);return this}function Bs(e){if(this.options.negate=c.bool(e)?e:!0,c.plainObject(e)&&"alpha"in e)if(c.bool(e.alpha))this.options.negateAlpha=e.alpha;else throw c.invalidParameterError("alpha","should be boolean value",e.alpha);return this}function qs(e){if(c.plainObject(e)){if(c.defined(e.lower))if(c.number(e.lower)&&c.inRange(e.lower,0,99))this.options.normaliseLower=e.lower;else throw c.invalidParameterError("lower","number between 0 and 99",e.lower);if(c.defined(e.upper))if(c.number(e.upper)&&c.inRange(e.upper,1,100))this.options.normaliseUpper=e.upper;else throw c.invalidParameterError("upper","number between 1 and 100",e.upper)}if(this.options.normaliseLower>=this.options.normaliseUpper)throw c.invalidParameterError("range","lower to be less than upper",`${this.options.normaliseLower} >= ${this.options.normaliseUpper}`);return this.options.normalise=!0,this}function Ms(e){return this.normalise(e)}function Fs(e){if(c.plainObject(e)){if(c.integer(e.width)&&e.width>0)this.options.claheWidth=e.width;else throw c.invalidParameterError("width","integer greater than zero",e.width);if(c.integer(e.height)&&e.height>0)this.options.claheHeight=e.height;else throw c.invalidParameterError("height","integer greater than zero",e.height);if(c.defined(e.maxSlope))if(c.integer(e.maxSlope)&&c.inRange(e.maxSlope,0,100))this.options.claheMaxSlope=e.maxSlope;else throw c.invalidParameterError("maxSlope","integer between 0 and 100",e.maxSlope)}else throw c.invalidParameterError("options","plain object",e);return this}function Ds(e){if(!c.object(e)||!Array.isArray(e.kernel)||!c.integer(e.width)||!c.integer(e.height)||!c.inRange(e.width,3,1001)||!c.inRange(e.height,3,1001)||e.height*e.width!==e.kernel.length)throw new Error("Invalid convolution kernel");return c.integer(e.scale)||(e.scale=e.kernel.reduce(function(r,t){return r+t},0)),e.scale<1&&(e.scale=1),c.integer(e.offset)||(e.offset=0),this.options.convKernel=e,this}function Os(e,r){if(!c.defined(e))this.options.threshold=128;else if(c.bool(e))this.options.threshold=e?128:0;else if(c.integer(e)&&c.inRange(e,0,255))this.options.threshold=e;else throw c.invalidParameterError("threshold","integer between 0 and 255",e);return!c.object(r)||r.greyscale===!0||r.grayscale===!0?this.options.thresholdGrayscale=!0:this.options.thresholdGrayscale=!1,this}function zs(e,r,t){if(this.options.boolean=this._createInputDescriptor(e,t),c.string(r)&&c.inArray(r,["and","or","eor"]))this.options.booleanOp=r;else throw c.invalidParameterError("operator","one of: and, or, eor",r);return this}function Us(e,r){if(!c.defined(e)&&c.number(r)?e=1:c.number(e)&&!c.defined(r)&&(r=0),!c.defined(e))this.options.linearA=[];else if(c.number(e))this.options.linearA=[e];else if(Array.isArray(e)&&e.length&&e.every(c.number))this.options.linearA=e;else throw c.invalidParameterError("a","number or array of numbers",e);if(!c.defined(r))this.options.linearB=[];else if(c.number(r))this.options.linearB=[r];else if(Array.isArray(r)&&r.length&&r.every(c.number))this.options.linearB=r;else throw c.invalidParameterError("b","number or array of numbers",r);if(this.options.linearA.length!==this.options.linearB.length)throw new Error("Expected a and b to be arrays of the same length");return this}function Gs(e){if(!Array.isArray(e))throw c.invalidParameterError("inputMatrix","array",e);if(e.length!==3&&e.length!==4)throw c.invalidParameterError("inputMatrix","3x3 or 4x4 array",e.length);let r=e.flat().map(Number);if(r.length!==9&&r.length!==16)throw c.invalidParameterError("inputMatrix","cardinality of 9 or 16",r.length);return this.options.recombMatrix=r,this}function Hs(e){if(!c.plainObject(e))throw c.invalidParameterError("options","plain object",e);if("brightness"in e)if(c.number(e.brightness)&&e.brightness>=0)this.options.brightness=e.brightness;else throw c.invalidParameterError("brightness","number above zero",e.brightness);if("saturation"in e)if(c.number(e.saturation)&&e.saturation>=0)this.options.saturation=e.saturation;else throw c.invalidParameterError("saturation","number above zero",e.saturation);if("hue"in e)if(c.integer(e.hue))this.options.hue=e.hue%360;else throw c.invalidParameterError("hue","number",e.hue);if("lightness"in e)if(c.number(e.lightness))this.options.lightness=e.lightness;else throw c.invalidParameterError("lightness","number",e.lightness);return this}si.exports=function(e){Object.assign(e.prototype,{autoOrient:js,rotate:Is,flip:As,flop:ks,affine:$s,sharpen:Ss,erode:ai,dilate:ni,median:Ls,blur:Ns,flatten:Ts,unflatten:_s,gamma:Cs,negate:Bs,normalise:qs,normalize:Ms,clahe:Fs,convolve:Ds,threshold:Os,boolean:zs,linear:Us,recomb:Gs,modulate:Hs})}});var di=w((Yl,ui)=>{var or=Object.defineProperty,Ws=Object.getOwnPropertyDescriptor,Xs=Object.getOwnPropertyNames,Vs=Object.prototype.hasOwnProperty,Ks=(e,r)=>{for(var t in r)or(e,t,{get:r[t],enumerable:!0})},Qs=(e,r,t,i)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of Xs(r))!Vs.call(e,n)&&n!==t&&or(e,n,{get:()=>r[n],enumerable:!(i=Ws(r,n))||i.enumerable});return e},Js=e=>Qs(or({},"__esModule",{value:!0}),e),li={};Ks(li,{default:()=>fo});ui.exports=Js(li);var M={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},ci=Object.create(null);for(let e in M)Object.hasOwn(M,e)&&(ci[M[e]]=e);var S={to:{},get:{}};S.get=function(e){let r=e.slice(0,3).toLowerCase(),t,i;switch(r){case"hsl":{t=S.get.hsl(e),i="hsl";break}case"hwb":{t=S.get.hwb(e),i="hwb";break}default:{t=S.get.rgb(e),i="rgb";break}}return t?{model:i,value:t}:null};S.get.rgb=function(e){if(!e)return null;let r=/^#([a-f\d]{3,4})$/i,t=/^#([a-f\d]{6})([a-f\d]{2})?$/i,i=/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[\s,|/]\s*([+-]?[\d.]+)(%?)\s*)?\)$/,n=/^rgba?\(\s*([+-]?[\d.]+)%\s*,?\s*([+-]?[\d.]+)%\s*,?\s*([+-]?[\d.]+)%\s*(?:[\s,|/]\s*([+-]?[\d.]+)(%?)\s*)?\)$/,s=/^(\w+)$/,o=[0,0,0,1],h,f,u;if(h=e.match(t)){for(u=h[2],h=h[1],f=0;f<3;f++){let v=f*2;o[f]=Number.parseInt(h.slice(v,v+2),16)}u&&(o[3]=Number.parseInt(u,16)/255)}else if(h=e.match(r)){for(h=h[1],u=h[3],f=0;f<3;f++)o[f]=Number.parseInt(h[f]+h[f],16);u&&(o[3]=Number.parseInt(u+u,16)/255)}else if(h=e.match(i)){for(f=0;f<3;f++)o[f]=Number.parseInt(h[f+1],10);h[4]&&(o[3]=h[5]?Number.parseFloat(h[4])*.01:Number.parseFloat(h[4]))}else if(h=e.match(n)){for(f=0;f<3;f++)o[f]=Math.round(Number.parseFloat(h[f+1])*2.55);h[4]&&(o[3]=h[5]?Number.parseFloat(h[4])*.01:Number.parseFloat(h[4]))}else return(h=e.match(s))?h[1]==="transparent"?[0,0,0,0]:Object.hasOwn(M,h[1])?(o=M[h[1]],o[3]=1,o):null:null;for(f=0;f<3;f++)o[f]=W(o[f],0,255);return o[3]=W(o[3],0,1),o};S.get.hsl=function(e){if(!e)return null;let r=/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d.]+)%\s*,?\s*([+-]?[\d.]+)%\s*(?:[,|/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/,t=e.match(r);if(t){let i=Number.parseFloat(t[4]),n=(Number.parseFloat(t[1])%360+360)%360,s=W(Number.parseFloat(t[2]),0,100),o=W(Number.parseFloat(t[3]),0,100),h=W(Number.isNaN(i)?1:i,0,1);return[n,s,o,h]}return null};S.get.hwb=function(e){if(!e)return null;let r=/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*[\s,]\s*([+-]?[\d.]+)%\s*[\s,]\s*([+-]?[\d.]+)%\s*(?:[\s,]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/,t=e.match(r);if(t){let i=Number.parseFloat(t[4]),n=(Number.parseFloat(t[1])%360+360)%360,s=W(Number.parseFloat(t[2]),0,100),o=W(Number.parseFloat(t[3]),0,100),h=W(Number.isNaN(i)?1:i,0,1);return[n,s,o,h]}return null};S.to.hex=function(...e){return"#"+_e(e[0])+_e(e[1])+_e(e[2])+(e[3]<1?_e(Math.round(e[3]*255)):"")};S.to.rgb=function(...e){return e.length<4||e[3]===1?"rgb("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+")":"rgba("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+", "+e[3]+")"};S.to.rgb.percent=function(...e){let r=Math.round(e[0]/255*100),t=Math.round(e[1]/255*100),i=Math.round(e[2]/255*100);return e.length<4||e[3]===1?"rgb("+r+"%, "+t+"%, "+i+"%)":"rgba("+r+"%, "+t+"%, "+i+"%, "+e[3]+")"};S.to.hsl=function(...e){return e.length<4||e[3]===1?"hsl("+e[0]+", "+e[1]+"%, "+e[2]+"%)":"hsla("+e[0]+", "+e[1]+"%, "+e[2]+"%, "+e[3]+")"};S.to.hwb=function(...e){let r="";return e.length>=4&&e[3]!==1&&(r=", "+e[3]),"hwb("+e[0]+", "+e[1]+"%, "+e[2]+"%"+r+")"};S.to.keyword=function(...e){return ci[e.slice(0,3)]};function W(e,r,t){return Math.min(Math.max(r,e),t)}function _e(e){let r=Math.round(e).toString(16).toUpperCase();return r.length<2?"0"+r:r}var oe=S,hi={};for(let e of Object.keys(M))hi[M[e]]=e;var d={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},oklab:{channels:3,labels:["okl","oka","okb"]},lch:{channels:3,labels:"lch"},oklch:{channels:3,labels:["okl","okc","okh"]},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}},ee=d,O=(6/29)**3;function ce(e){let r=e>.0031308?1.055*e**.4166666666666667-.055:e*12.92;return Math.min(Math.max(0,r),1)}function he(e){return e>.04045?((e+.055)/1.055)**2.4:e/12.92}for(let e of Object.keys(d)){if(!("channels"in d[e]))throw new Error("missing channels property: "+e);if(!("labels"in d[e]))throw new Error("missing channel labels property: "+e);if(d[e].labels.length!==d[e].channels)throw new Error("channel and label counts mismatch: "+e);let{channels:r,labels:t}=d[e];delete d[e].channels,delete d[e].labels,Object.defineProperty(d[e],"channels",{value:r}),Object.defineProperty(d[e],"labels",{value:t})}d.rgb.hsl=function(e){let r=e[0]/255,t=e[1]/255,i=e[2]/255,n=Math.min(r,t,i),s=Math.max(r,t,i),o=s-n,h,f;switch(s){case n:{h=0;break}case r:{h=(t-i)/o;break}case t:{h=2+(i-r)/o;break}case i:{h=4+(r-t)/o;break}}h=Math.min(h*60,360),h<0&&(h+=360);let u=(n+s)/2;return s===n?f=0:u<=.5?f=o/(s+n):f=o/(2-s-n),[h,f*100,u*100]};d.rgb.hsv=function(e){let r,t,i,n,s,o=e[0]/255,h=e[1]/255,f=e[2]/255,u=Math.max(o,h,f),v=u-Math.min(o,h,f),E=function(K){return(u-K)/6/v+1/2};if(v===0)n=0,s=0;else{switch(s=v/u,r=E(o),t=E(h),i=E(f),u){case o:{n=i-t;break}case h:{n=1/3+r-i;break}case f:{n=2/3+t-r;break}}n<0?n+=1:n>1&&(n-=1)}return[n*360,s*100,u*100]};d.rgb.hwb=function(e){let r=e[0],t=e[1],i=e[2],n=d.rgb.hsl(e)[0],s=1/255*Math.min(r,Math.min(t,i));return i=1-1/255*Math.max(r,Math.max(t,i)),[n,s*100,i*100]};d.rgb.oklab=function(e){let r=he(e[0]/255),t=he(e[1]/255),i=he(e[2]/255),n=Math.cbrt(.4122214708*r+.5363325363*t+.0514459929*i),s=Math.cbrt(.2119034982*r+.6806995451*t+.1073969566*i),o=Math.cbrt(.0883024619*r+.2817188376*t+.6299787005*i),h=.2104542553*n+.793617785*s-.0040720468*o,f=1.9779984951*n-2.428592205*s+.4505937099*o,u=.0259040371*n+.7827717662*s-.808675766*o;return[h*100,f*100,u*100]};d.rgb.cmyk=function(e){let r=e[0]/255,t=e[1]/255,i=e[2]/255,n=Math.min(1-r,1-t,1-i),s=(1-r-n)/(1-n)||0,o=(1-t-n)/(1-n)||0,h=(1-i-n)/(1-n)||0;return[s*100,o*100,h*100,n*100]};function Ys(e,r){return(e[0]-r[0])**2+(e[1]-r[1])**2+(e[2]-r[2])**2}d.rgb.keyword=function(e){let r=hi[e];if(r)return r;let t=Number.POSITIVE_INFINITY,i;for(let n of Object.keys(M)){let s=M[n],o=Ys(e,s);o<t&&(t=o,i=n)}return i};d.keyword.rgb=function(e){return M[e]};d.rgb.xyz=function(e){let r=he(e[0]/255),t=he(e[1]/255),i=he(e[2]/255),n=r*.4124564+t*.3575761+i*.1804375,s=r*.2126729+t*.7151522+i*.072175,o=r*.0193339+t*.119192+i*.9503041;return[n*100,s*100,o*100]};d.rgb.lab=function(e){let r=d.rgb.xyz(e),t=r[0],i=r[1],n=r[2];t/=95.047,i/=100,n/=108.883,t=t>O?t**(1/3):7.787*t+16/116,i=i>O?i**(1/3):7.787*i+16/116,n=n>O?n**(1/3):7.787*n+16/116;let s=116*i-16,o=500*(t-i),h=200*(i-n);return[s,o,h]};d.hsl.rgb=function(e){let r=e[0]/360,t=e[1]/100,i=e[2]/100,n,s;if(t===0)return s=i*255,[s,s,s];let o=i<.5?i*(1+t):i+t-i*t,h=2*i-o,f=[0,0,0];for(let u=0;u<3;u++)n=r+1/3*-(u-1),n<0&&n++,n>1&&n--,6*n<1?s=h+(o-h)*6*n:2*n<1?s=o:3*n<2?s=h+(o-h)*(2/3-n)*6:s=h,f[u]=s*255;return f};d.hsl.hsv=function(e){let r=e[0],t=e[1]/100,i=e[2]/100,n=t,s=Math.max(i,.01);i*=2,t*=i<=1?i:2-i,n*=s<=1?s:2-s;let o=(i+t)/2,h=i===0?2*n/(s+n):2*t/(i+t);return[r,h*100,o*100]};d.hsv.rgb=function(e){let r=e[0]/60,t=e[1]/100,i=e[2]/100,n=Math.floor(r)%6,s=r-Math.floor(r),o=255*i*(1-t),h=255*i*(1-t*s),f=255*i*(1-t*(1-s));switch(i*=255,n){case 0:return[i,f,o];case 1:return[h,i,o];case 2:return[o,i,f];case 3:return[o,h,i];case 4:return[f,o,i];case 5:return[i,o,h]}};d.hsv.hsl=function(e){let r=e[0],t=e[1]/100,i=e[2]/100,n=Math.max(i,.01),s,o;o=(2-t)*i;let h=(2-t)*n;return s=t*n,s/=h<=1?h:2-h,s=s||0,o/=2,[r,s*100,o*100]};d.hwb.rgb=function(e){let r=e[0]/360,t=e[1]/100,i=e[2]/100,n=t+i,s;n>1&&(t/=n,i/=n);let o=Math.floor(6*r),h=1-i;s=6*r-o,o&1&&(s=1-s);let f=t+s*(h-t),u,v,E;switch(o){default:case 6:case 0:{u=h,v=f,E=t;break}case 1:{u=f,v=h,E=t;break}case 2:{u=t,v=h,E=f;break}case 3:{u=t,v=f,E=h;break}case 4:{u=f,v=t,E=h;break}case 5:{u=h,v=t,E=f;break}}return[u*255,v*255,E*255]};d.cmyk.rgb=function(e){let r=e[0]/100,t=e[1]/100,i=e[2]/100,n=e[3]/100,s=1-Math.min(1,r*(1-n)+n),o=1-Math.min(1,t*(1-n)+n),h=1-Math.min(1,i*(1-n)+n);return[s*255,o*255,h*255]};d.xyz.rgb=function(e){let r=e[0]/100,t=e[1]/100,i=e[2]/100,n,s,o;return n=r*3.2404542+t*-1.5371385+i*-.4985314,s=r*-.969266+t*1.8760108+i*.041556,o=r*.0556434+t*-.2040259+i*1.0572252,n=ce(n),s=ce(s),o=ce(o),[n*255,s*255,o*255]};d.xyz.lab=function(e){let r=e[0],t=e[1],i=e[2];r/=95.047,t/=100,i/=108.883,r=r>O?r**(1/3):7.787*r+16/116,t=t>O?t**(1/3):7.787*t+16/116,i=i>O?i**(1/3):7.787*i+16/116;let n=116*t-16,s=500*(r-t),o=200*(t-i);return[n,s,o]};d.xyz.oklab=function(e){let r=e[0]/100,t=e[1]/100,i=e[2]/100,n=Math.cbrt(.8189330101*r+.3618667424*t-.1288597137*i),s=Math.cbrt(.0329845436*r+.9293118715*t+.0361456387*i),o=Math.cbrt(.0482003018*r+.2643662691*t+.633851707*i),h=.2104542553*n+.793617785*s-.0040720468*o,f=1.9779984951*n-2.428592205*s+.4505937099*o,u=.0259040371*n+.7827717662*s-.808675766*o;return[h*100,f*100,u*100]};d.oklab.oklch=function(e){return d.lab.lch(e)};d.oklab.xyz=function(e){let r=e[0]/100,t=e[1]/100,i=e[2]/100,n=(.999999998*r+.396337792*t+.215803758*i)**3,s=(1.000000008*r-.105561342*t-.063854175*i)**3,o=(1.000000055*r-.089484182*t-1.291485538*i)**3,h=1.227013851*n-.55779998*s+.281256149*o,f=-.040580178*n+1.11225687*s-.071676679*o,u=-.076381285*n-.421481978*s+1.58616322*o;return[h*100,f*100,u*100]};d.oklab.rgb=function(e){let r=e[0]/100,t=e[1]/100,i=e[2]/100,n=(r+.3963377774*t+.2158037573*i)**3,s=(r-.1055613458*t-.0638541728*i)**3,o=(r-.0894841775*t-1.291485548*i)**3,h=ce(4.0767416621*n-3.3077115913*s+.2309699292*o),f=ce(-1.2684380046*n+2.6097574011*s-.3413193965*o),u=ce(-.0041960863*n-.7034186147*s+1.707614701*o);return[h*255,f*255,u*255]};d.oklch.oklab=function(e){return d.lch.lab(e)};d.lab.xyz=function(e){let r=e[0],t=e[1],i=e[2],n,s,o;s=(r+16)/116,n=t/500+s,o=s-i/200;let h=s**3,f=n**3,u=o**3;return s=h>O?h:(s-16/116)/7.787,n=f>O?f:(n-16/116)/7.787,o=u>O?u:(o-16/116)/7.787,n*=95.047,s*=100,o*=108.883,[n,s,o]};d.lab.lch=function(e){let r=e[0],t=e[1],i=e[2],n;n=Math.atan2(i,t)*360/2/Math.PI,n<0&&(n+=360);let o=Math.sqrt(t*t+i*i);return[r,o,n]};d.lch.lab=function(e){let r=e[0],t=e[1],n=e[2]/360*2*Math.PI,s=t*Math.cos(n),o=t*Math.sin(n);return[r,s,o]};d.rgb.ansi16=function(e,r=null){let[t,i,n]=e,s=r===null?d.rgb.hsv(e)[2]:r;if(s=Math.round(s/50),s===0)return 30;let o=30+(Math.round(n/255)<<2|Math.round(i/255)<<1|Math.round(t/255));return s===2&&(o+=60),o};d.hsv.ansi16=function(e){return d.rgb.ansi16(d.hsv.rgb(e),e[2])};d.rgb.ansi256=function(e){let r=e[0],t=e[1],i=e[2];return r>>4===t>>4&&t>>4===i>>4?r<8?16:r>248?231:Math.round((r-8)/247*24)+232:16+36*Math.round(r/255*5)+6*Math.round(t/255*5)+Math.round(i/255*5)};d.ansi16.rgb=function(e){e=e[0];let r=e%10;if(r===0||r===7)return e>50&&(r+=3.5),r=r/10.5*255,[r,r,r];let t=(Math.trunc(e>50)+1)*.5,i=(r&1)*t*255,n=(r>>1&1)*t*255,s=(r>>2&1)*t*255;return[i,n,s]};d.ansi256.rgb=function(e){if(e=e[0],e>=232){let s=(e-232)*10+8;return[s,s,s]}e-=16;let r,t=Math.floor(e/36)/5*255,i=Math.floor((r=e%36)/6)/5*255,n=r%6/5*255;return[t,i,n]};d.rgb.hex=function(e){let t=(((Math.round(e[0])&255)<<16)+((Math.round(e[1])&255)<<8)+(Math.round(e[2])&255)).toString(16).toUpperCase();return"000000".slice(t.length)+t};d.hex.rgb=function(e){let r=e.toString(16).match(/[a-f\d]{6}|[a-f\d]{3}/i);if(!r)return[0,0,0];let t=r[0];r[0].length===3&&(t=[...t].map(h=>h+h).join(""));let i=Number.parseInt(t,16),n=i>>16&255,s=i>>8&255,o=i&255;return[n,s,o]};d.rgb.hcg=function(e){let r=e[0]/255,t=e[1]/255,i=e[2]/255,n=Math.max(Math.max(r,t),i),s=Math.min(Math.min(r,t),i),o=n-s,h,f=o<1?s/(1-o):0;return o<=0?h=0:n===r?h=(t-i)/o%6:n===t?h=2+(i-r)/o:h=4+(r-t)/o,h/=6,h%=1,[h*360,o*100,f*100]};d.hsl.hcg=function(e){let r=e[1]/100,t=e[2]/100,i=t<.5?2*r*t:2*r*(1-t),n=0;return i<1&&(n=(t-.5*i)/(1-i)),[e[0],i*100,n*100]};d.hsv.hcg=function(e){let r=e[1]/100,t=e[2]/100,i=r*t,n=0;return i<1&&(n=(t-i)/(1-i)),[e[0],i*100,n*100]};d.hcg.rgb=function(e){let r=e[0]/360,t=e[1]/100,i=e[2]/100;if(t===0)return[i*255,i*255,i*255];let n=[0,0,0],s=r%1*6,o=s%1,h=1-o,f=0;switch(Math.floor(s)){case 0:{n[0]=1,n[1]=o,n[2]=0;break}case 1:{n[0]=h,n[1]=1,n[2]=0;break}case 2:{n[0]=0,n[1]=1,n[2]=o;break}case 3:{n[0]=0,n[1]=h,n[2]=1;break}case 4:{n[0]=o,n[1]=0,n[2]=1;break}default:n[0]=1,n[1]=0,n[2]=h}return f=(1-t)*i,[(t*n[0]+f)*255,(t*n[1]+f)*255,(t*n[2]+f)*255]};d.hcg.hsv=function(e){let r=e[1]/100,t=e[2]/100,i=r+t*(1-r),n=0;return i>0&&(n=r/i),[e[0],n*100,i*100]};d.hcg.hsl=function(e){let r=e[1]/100,i=e[2]/100*(1-r)+.5*r,n=0;return i>0&&i<.5?n=r/(2*i):i>=.5&&i<1&&(n=r/(2*(1-i))),[e[0],n*100,i*100]};d.hcg.hwb=function(e){let r=e[1]/100,t=e[2]/100,i=r+t*(1-r);return[e[0],(i-r)*100,(1-i)*100]};d.hwb.hcg=function(e){let r=e[1]/100,i=1-e[2]/100,n=i-r,s=0;return n<1&&(s=(i-n)/(1-n)),[e[0],n*100,s*100]};d.apple.rgb=function(e){return[e[0]/65535*255,e[1]/65535*255,e[2]/65535*255]};d.rgb.apple=function(e){return[e[0]/255*65535,e[1]/255*65535,e[2]/255*65535]};d.gray.rgb=function(e){return[e[0]/100*255,e[0]/100*255,e[0]/100*255]};d.gray.hsl=function(e){return[0,0,e[0]]};d.gray.hsv=d.gray.hsl;d.gray.hwb=function(e){return[0,100,e[0]]};d.gray.cmyk=function(e){return[0,0,0,e[0]]};d.gray.lab=function(e){return[e[0],0,0]};d.gray.hex=function(e){let r=Math.round(e[0]/100*255)&255,i=((r<<16)+(r<<8)+r).toString(16).toUpperCase();return"000000".slice(i.length)+i};d.rgb.gray=function(e){return[(e[0]+e[1]+e[2])/3/255*100]};function Zs(){let e={},r=Object.keys(ee);for(let{length:t}=r,i=0;i<t;i++)e[r[i]]={distance:-1,parent:null};return e}function eo(e){let r=Zs(),t=[e];for(r[e].distance=0;t.length>0;){let i=t.pop(),n=Object.keys(ee[i]);for(let{length:s}=n,o=0;o<s;o++){let h=n[o],f=r[h];f.distance===-1&&(f.distance=r[i].distance+1,f.parent=i,t.unshift(h))}}return r}function ro(e,r){return function(t){return r(e(t))}}function to(e,r){let t=[r[e].parent,e],i=ee[r[e].parent][e],n=r[e].parent;for(;r[n].parent;)t.unshift(r[n].parent),i=ro(ee[r[n].parent][n],i),n=r[n].parent;return i.conversion=t,i}function io(e){let r=eo(e),t={},i=Object.keys(r);for(let{length:n}=i,s=0;s<n;s++){let o=i[s];r[o].parent!==null&&(t[o]=to(o,r))}return t}var no=io,le={},ao=Object.keys(ee);function so(e){let r=function(...t){let i=t[0];return i==null?i:(i.length>1&&(t=i),e(t))};return"conversion"in e&&(r.conversion=e.conversion),r}function oo(e){let r=function(...t){let i=t[0];if(i==null)return i;i.length>1&&(t=i);let n=e(t);if(typeof n=="object")for(let{length:s}=n,o=0;o<s;o++)n[o]=Math.round(n[o]);return n};return"conversion"in e&&(r.conversion=e.conversion),r}for(let e of ao){le[e]={},Object.defineProperty(le[e],"channels",{value:ee[e].channels}),Object.defineProperty(le[e],"labels",{value:ee[e].labels});let r=no(e),t=Object.keys(r);for(let i of t){let n=r[i];le[e][i]=oo(n),le[e][i].raw=so(n)}}var L=le,fi=["keyword","gray","hex"],nr={};for(let e of Object.keys(L))nr[[...L[e].labels].sort().join("")]=e;var ar={};function I(e,r){if(!(this instanceof I))return new I(e,r);if(r&&r in fi&&(r=null),r&&!(r in L))throw new Error("Unknown model: "+r);let t,i;if(e==null)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(e instanceof I)this.model=e.model,this.color=[...e.color],this.valpha=e.valpha;else if(typeof e=="string"){let n=oe.get(e);if(n===null)throw new Error("Unable to parse color from string: "+e);this.model=n.model,i=L[this.model].channels,this.color=n.value.slice(0,i),this.valpha=typeof n.value[i]=="number"?n.value[i]:1}else if(e.length>0){this.model=r||"rgb",i=L[this.model].channels;let n=Array.prototype.slice.call(e,0,i);this.color=sr(n,i),this.valpha=typeof e[i]=="number"?e[i]:1}else if(typeof e=="number")this.model="rgb",this.color=[e>>16&255,e>>8&255,e&255],this.valpha=1;else{this.valpha=1;let n=Object.keys(e);"alpha"in e&&(n.splice(n.indexOf("alpha"),1),this.valpha=typeof e.alpha=="number"?e.alpha:0);let s=n.sort().join("");if(!(s in nr))throw new Error("Unable to parse color from object: "+JSON.stringify(e));this.model=nr[s];let{labels:o}=L[this.model],h=[];for(t=0;t<o.length;t++)h.push(e[o[t]]);this.color=sr(h)}if(ar[this.model])for(i=L[this.model].channels,t=0;t<i;t++){let n=ar[this.model][t];n&&(this.color[t]=n(this.color[t]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}I.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(e){let r=this.model in oe.to?this:this.rgb();r=r.round(typeof e=="number"?e:1);let t=r.valpha===1?r.color:[...r.color,this.valpha];return oe.to[r.model](...t)},percentString(e){let r=this.rgb().round(typeof e=="number"?e:1),t=r.valpha===1?r.color:[...r.color,this.valpha];return oe.to.rgb.percent(...t)},array(){return this.valpha===1?[...this.color]:[...this.color,this.valpha]},object(){let e={},{channels:r}=L[this.model],{labels:t}=L[this.model];for(let i=0;i<r;i++)e[t[i]]=this.color[i];return this.valpha!==1&&(e.alpha=this.valpha),e},unitArray(){let e=this.rgb().color;return e[0]/=255,e[1]/=255,e[2]/=255,this.valpha!==1&&e.push(this.valpha),e},unitObject(){let e=this.rgb().object();return e.r/=255,e.g/=255,e.b/=255,this.valpha!==1&&(e.alpha=this.valpha),e},round(e){return e=Math.max(e||0,0),new I([...this.color.map(co(e)),this.valpha],this.model)},alpha(e){return e!==void 0?new I([...this.color,Math.max(0,Math.min(1,e))],this.model):this.valpha},red:x("rgb",0,R(255)),green:x("rgb",1,R(255)),blue:x("rgb",2,R(255)),hue:x(["hsl","hsv","hsl","hwb","hcg"],0,e=>(e%360+360)%360),saturationl:x("hsl",1,R(100)),lightness:x("hsl",2,R(100)),saturationv:x("hsv",1,R(100)),value:x("hsv",2,R(100)),chroma:x("hcg",1,R(100)),gray:x("hcg",2,R(100)),white:x("hwb",1,R(100)),wblack:x("hwb",2,R(100)),cyan:x("cmyk",0,R(100)),magenta:x("cmyk",1,R(100)),yellow:x("cmyk",2,R(100)),black:x("cmyk",3,R(100)),x:x("xyz",0,R(95.047)),y:x("xyz",1,R(100)),z:x("xyz",2,R(108.833)),l:x("lab",0,R(100)),a:x("lab",1),b:x("lab",2),keyword(e){return e!==void 0?new I(e):L[this.model].keyword(this.color)},hex(e){return e!==void 0?new I(e):oe.to.hex(...this.rgb().round().color)},hexa(e){if(e!==void 0)return new I(e);let r=this.rgb().round().color,t=Math.round(this.valpha*255).toString(16).toUpperCase();return t.length===1&&(t="0"+t),oe.to.hex(...r)+t},rgbNumber(){let e=this.rgb().color;return(e[0]&255)<<16|(e[1]&255)<<8|e[2]&255},luminosity(){let e=this.rgb().color,r=[];for(let[t,i]of e.entries()){let n=i/255;r[t]=n<=.04045?n/12.92:((n+.055)/1.055)**2.4}return .2126*r[0]+.7152*r[1]+.0722*r[2]},contrast(e){let r=this.luminosity(),t=e.luminosity();return r>t?(r+.05)/(t+.05):(t+.05)/(r+.05)},level(e){let r=this.contrast(e);return r>=7?"AAA":r>=4.5?"AA":""},isDark(){let e=this.rgb().color;return(e[0]*2126+e[1]*7152+e[2]*722)/1e4<128},isLight(){return!this.isDark()},negate(){let e=this.rgb();for(let r=0;r<3;r++)e.color[r]=255-e.color[r];return e},lighten(e){let r=this.hsl();return r.color[2]+=r.color[2]*e,r},darken(e){let r=this.hsl();return r.color[2]-=r.color[2]*e,r},saturate(e){let r=this.hsl();return r.color[1]+=r.color[1]*e,r},desaturate(e){let r=this.hsl();return r.color[1]-=r.color[1]*e,r},whiten(e){let r=this.hwb();return r.color[1]+=r.color[1]*e,r},blacken(e){let r=this.hwb();return r.color[2]+=r.color[2]*e,r},grayscale(){let e=this.rgb().color,r=e[0]*.3+e[1]*.59+e[2]*.11;return I.rgb(r,r,r)},fade(e){return this.alpha(this.valpha-this.valpha*e)},opaquer(e){return this.alpha(this.valpha+this.valpha*e)},rotate(e){let r=this.hsl(),t=r.color[0];return t=(t+e)%360,t=t<0?360+t:t,r.color[0]=t,r},mix(e,r){if(!e||!e.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof e);let t=e.rgb(),i=this.rgb(),n=r===void 0?.5:r,s=2*n-1,o=t.alpha()-i.alpha(),h=((s*o===-1?s:(s+o)/(1+s*o))+1)/2,f=1-h;return I.rgb(h*t.red()+f*i.red(),h*t.green()+f*i.green(),h*t.blue()+f*i.blue(),t.alpha()*n+i.alpha()*(1-n))}};for(let e of Object.keys(L)){if(fi.includes(e))continue;let{channels:r}=L[e];I.prototype[e]=function(...t){return this.model===e?new I(this):t.length>0?new I(t,e):new I([...ho(L[this.model][e].raw(this.color)),this.valpha],e)},I[e]=function(...t){let i=t[0];return typeof i=="number"&&(i=sr(t,r)),new I(i,e)}}function lo(e,r){return Number(e.toFixed(r))}function co(e){return function(r){return lo(r,e)}}function x(e,r,t){e=Array.isArray(e)?e:[e];for(let i of e)(ar[i]||=[])[r]=t;return e=e[0],function(i){let n;return i!==void 0?(t&&(i=t(i)),n=this[e](),n.color[r]=i,n):(n=this[e]().color[r],t&&(n=t(n)),n)}}function R(e){return function(r){return Math.max(0,Math.min(e,r))}}function ho(e){return Array.isArray(e)?e:[e]}function sr(e,r){for(let t=0;t<r;t++)typeof e[t]!="number"&&(e[t]=0);return e}var fo=I});var gi=w((Zl,mi)=>{mi.exports=di().default});var Ei=w((ec,wi)=>{"use strict";var uo=gi(),z=T(),bi={multiband:"multiband","b-w":"b-w",bw:"b-w",cmyk:"cmyk",srgb:"srgb"};function mo(e){return this._setBackgroundColourOption("tint",e),this}function go(e){return this.options.greyscale=z.bool(e)?e:!0,this}function bo(e){return this.greyscale(e)}function po(e){if(!z.string(e))throw z.invalidParameterError("colourspace","string",e);return this.options.colourspacePipeline=e,this}function wo(e){return this.pipelineColourspace(e)}function Eo(e){if(!z.string(e))throw z.invalidParameterError("colourspace","string",e);return this.options.colourspace=e,this}function vo(e){return this.toColourspace(e)}function pi(e){if(z.object(e)||z.string(e)){let r=uo(e);return[r.red(),r.green(),r.blue(),Math.round(r.alpha()*255)]}else throw z.invalidParameterError("background","object or string",e)}function yo(e,r){z.defined(r)&&(this.options[e]=pi(r))}wi.exports=function(e){Object.assign(e.prototype,{tint:mo,greyscale:go,grayscale:bo,pipelineColourspace:po,pipelineColorspace:wo,toColourspace:Eo,toColorspace:vo,_getBackgroundColourOption:pi,_setBackgroundColourOption:yo}),e.colourspace=bi,e.colorspace=bi}});var yi=w((rc,vi)=>{"use strict";var F=T(),Po={and:"and",or:"or",eor:"eor"};function xo(){return this.options.removeAlpha=!0,this}function Ro(e){if(F.defined(e))if(F.number(e)&&F.inRange(e,0,1))this.options.ensureAlpha=e;else throw F.invalidParameterError("alpha","number between 0 and 1",e);else this.options.ensureAlpha=1;return this}function Io(e){let r={red:0,green:1,blue:2,alpha:3};if(Object.keys(r).includes(e)&&(e=r[e]),F.integer(e)&&F.inRange(e,0,4))this.options.extractChannel=e;else throw F.invalidParameterError("channel","integer or one of: red, green, blue, alpha",e);return this}function jo(e,r){return Array.isArray(e)?e.forEach(function(t){this.options.joinChannelIn.push(this._createInputDescriptor(t,r))},this):this.options.joinChannelIn.push(this._createInputDescriptor(e,r)),this}function Ao(e){if(F.string(e)&&F.inArray(e,["and","or","eor"]))this.options.bandBoolOp=e;else throw F.invalidParameterError("boolOp","one of: and, or, eor",e);return this}vi.exports=function(e){Object.assign(e.prototype,{removeAlpha:xo,ensureAlpha:Ro,extractChannel:Io,joinChannel:jo,bandbool:Ao}),e.bool=Po}});var ji=w((tc,Ii)=>{"use strict";var lr=require("node:path"),a=T(),fe=pe(),Pi=new Map([["heic","heif"],["heif","heif"],["avif","avif"],["jpeg","jpeg"],["jpg","jpeg"],["jpe","jpeg"],["tile","tile"],["dz","tile"],["png","png"],["raw","raw"],["tiff","tiff"],["tif","tiff"],["webp","webp"],["gif","gif"],["jp2","jp2"],["jpx","jp2"],["j2k","jp2"],["j2c","jp2"],["jxl","jxl"]]),ko=/\.(jp[2x]|j2[kc])$/i,xi=()=>new Error("JP2 output requires libvips with support for OpenJPEG"),Ri=e=>1<<31-Math.clz32(Math.ceil(Math.log2(e)));function $o(e,r){let t;if(a.string(e)?a.string(this.options.input.file)&&lr.resolve(this.options.input.file)===lr.resolve(e)?t=new Error("Cannot use same file for input and output"):ko.test(lr.extname(e))&&!this.constructor.format.jp2k.output.file&&(t=xi()):t=new Error("Missing output file path"),t)if(a.fn(r))r(t);else return Promise.reject(t);else{this.options.fileOut=e;let i=Error();return this._pipeline(r,i)}return this}function So(e,r){a.object(e)?this._setBooleanOption("resolveWithObject",e.resolveWithObject):this.options.resolveWithObject&&(this.options.resolveWithObject=!1),this.options.fileOut="";let t=Error();return this._pipeline(a.fn(e)?e:r,t)}function Lo(){return this.options.keepMetadata|=1,this}function No(e){if(a.object(e))for(let[r,t]of Object.entries(e))if(a.object(t))for(let[i,n]of Object.entries(t))if(a.string(n))this.options.withExif[`exif-${r.toLowerCase()}-${i}`]=n;else throw a.invalidParameterError(`${r}.${i}`,"string",n);else throw a.invalidParameterError(r,"object",t);else throw a.invalidParameterError("exif","object",e);return this.options.withExifMerge=!1,this.keepExif()}function To(e){return this.withExif(e),this.options.withExifMerge=!0,this}function _o(){return this.options.keepMetadata|=8,this}function Co(e,r){if(a.string(e))this.options.withIccProfile=e;else throw a.invalidParameterError("icc","string",e);if(this.keepIccProfile(),a.object(r)&&a.defined(r.attach))if(a.bool(r.attach))r.attach||(this.options.keepMetadata&=-9);else throw a.invalidParameterError("attach","boolean",r.attach);return this}function Bo(){return this.options.keepMetadata|=2,this}function qo(e){if(a.string(e)&&e.length>0)this.options.withXmp=e,this.options.keepMetadata|=2;else throw a.invalidParameterError("xmp","non-empty string",e);return this}function Mo(){return this.options.keepMetadata=31,this}function Fo(e){if(this.keepMetadata(),this.withIccProfile("srgb"),a.object(e)){if(a.defined(e.orientation))if(a.integer(e.orientation)&&a.inRange(e.orientation,1,8))this.options.withMetadataOrientation=e.orientation;else throw a.invalidParameterError("orientation","integer between 1 and 8",e.orientation);if(a.defined(e.density))if(a.number(e.density)&&e.density>0)this.options.withMetadataDensity=e.density;else throw a.invalidParameterError("density","positive number",e.density);a.defined(e.icc)&&this.withIccProfile(e.icc),a.defined(e.exif)&&this.withExifMerge(e.exif)}return this}function Do(e,r){let t=Pi.get((a.object(e)&&a.string(e.id)?e.id:e).toLowerCase());if(!t)throw a.invalidParameterError("format",`one of: ${[...Pi.keys()].join(", ")}`,e);return this[t](r)}function Oo(e){if(a.object(e)){if(a.defined(e.quality))if(a.integer(e.quality)&&a.inRange(e.quality,1,100))this.options.jpegQuality=e.quality;else throw a.invalidParameterError("quality","integer between 1 and 100",e.quality);if(a.defined(e.progressive)&&this._setBooleanOption("jpegProgressive",e.progressive),a.defined(e.chromaSubsampling))if(a.string(e.chromaSubsampling)&&a.inArray(e.chromaSubsampling,["4:2:0","4:4:4"]))this.options.jpegChromaSubsampling=e.chromaSubsampling;else throw a.invalidParameterError("chromaSubsampling","one of: 4:2:0, 4:4:4",e.chromaSubsampling);let r=a.bool(e.optimizeCoding)?e.optimizeCoding:e.optimiseCoding;if(a.defined(r)&&this._setBooleanOption("jpegOptimiseCoding",r),a.defined(e.mozjpeg))if(a.bool(e.mozjpeg))e.mozjpeg&&(this.options.jpegTrellisQuantisation=!0,this.options.jpegOvershootDeringing=!0,this.options.jpegOptimiseScans=!0,this.options.jpegProgressive=!0,this.options.jpegQuantisationTable=3);else throw a.invalidParameterError("mozjpeg","boolean",e.mozjpeg);let t=a.bool(e.trellisQuantization)?e.trellisQuantization:e.trellisQuantisation;a.defined(t)&&this._setBooleanOption("jpegTrellisQuantisation",t),a.defined(e.overshootDeringing)&&this._setBooleanOption("jpegOvershootDeringing",e.overshootDeringing);let i=a.bool(e.optimizeScans)?e.optimizeScans:e.optimiseScans;a.defined(i)&&(this._setBooleanOption("jpegOptimiseScans",i),i&&(this.options.jpegProgressive=!0));let n=a.number(e.quantizationTable)?e.quantizationTable:e.quantisationTable;if(a.defined(n))if(a.integer(n)&&a.inRange(n,0,8))this.options.jpegQuantisationTable=n;else throw a.invalidParameterError("quantisationTable","integer between 0 and 8",n)}return this._updateFormatOut("jpeg",e)}function zo(e){if(a.object(e)){if(a.defined(e.progressive)&&this._setBooleanOption("pngProgressive",e.progressive),a.defined(e.compressionLevel))if(a.integer(e.compressionLevel)&&a.inRange(e.compressionLevel,0,9))this.options.pngCompressionLevel=e.compressionLevel;else throw a.invalidParameterError("compressionLevel","integer between 0 and 9",e.compressionLevel);a.defined(e.adaptiveFiltering)&&this._setBooleanOption("pngAdaptiveFiltering",e.adaptiveFiltering);let r=e.colours||e.colors;if(a.defined(r))if(a.integer(r)&&a.inRange(r,2,256))this.options.pngBitdepth=Ri(r);else throw a.invalidParameterError("colours","integer between 2 and 256",r);if(a.defined(e.palette)?this._setBooleanOption("pngPalette",e.palette):[e.quality,e.effort,e.colours,e.colors,e.dither].some(a.defined)&&this._setBooleanOption("pngPalette",!0),this.options.pngPalette){if(a.defined(e.quality))if(a.integer(e.quality)&&a.inRange(e.quality,0,100))this.options.pngQuality=e.quality;else throw a.invalidParameterError("quality","integer between 0 and 100",e.quality);if(a.defined(e.effort))if(a.integer(e.effort)&&a.inRange(e.effort,1,10))this.options.pngEffort=e.effort;else throw a.invalidParameterError("effort","integer between 1 and 10",e.effort);if(a.defined(e.dither))if(a.number(e.dither)&&a.inRange(e.dither,0,1))this.options.pngDither=e.dither;else throw a.invalidParameterError("dither","number between 0.0 and 1.0",e.dither)}}return this._updateFormatOut("png",e)}function Uo(e){if(a.object(e)){if(a.defined(e.quality))if(a.integer(e.quality)&&a.inRange(e.quality,1,100))this.options.webpQuality=e.quality;else throw a.invalidParameterError("quality","integer between 1 and 100",e.quality);if(a.defined(e.alphaQuality))if(a.integer(e.alphaQuality)&&a.inRange(e.alphaQuality,0,100))this.options.webpAlphaQuality=e.alphaQuality;else throw a.invalidParameterError("alphaQuality","integer between 0 and 100",e.alphaQuality);if(a.defined(e.lossless)&&this._setBooleanOption("webpLossless",e.lossless),a.defined(e.nearLossless)&&this._setBooleanOption("webpNearLossless",e.nearLossless),a.defined(e.smartSubsample)&&this._setBooleanOption("webpSmartSubsample",e.smartSubsample),a.defined(e.smartDeblock)&&this._setBooleanOption("webpSmartDeblock",e.smartDeblock),a.defined(e.preset))if(a.string(e.preset)&&a.inArray(e.preset,["default","photo","picture","drawing","icon","text"]))this.options.webpPreset=e.preset;else throw a.invalidParameterError("preset","one of: default, photo, picture, drawing, icon, text",e.preset);if(a.defined(e.effort))if(a.integer(e.effort)&&a.inRange(e.effort,0,6))this.options.webpEffort=e.effort;else throw a.invalidParameterError("effort","integer between 0 and 6",e.effort);a.defined(e.minSize)&&this._setBooleanOption("webpMinSize",e.minSize),a.defined(e.mixed)&&this._setBooleanOption("webpMixed",e.mixed)}return cr(e,this.options),this._updateFormatOut("webp",e)}function Go(e){if(a.object(e)){a.defined(e.reuse)&&this._setBooleanOption("gifReuse",e.reuse),a.defined(e.progressive)&&this._setBooleanOption("gifProgressive",e.progressive);let r=e.colours||e.colors;if(a.defined(r))if(a.integer(r)&&a.inRange(r,2,256))this.options.gifBitdepth=Ri(r);else throw a.invalidParameterError("colours","integer between 2 and 256",r);if(a.defined(e.effort))if(a.number(e.effort)&&a.inRange(e.effort,1,10))this.options.gifEffort=e.effort;else throw a.invalidParameterError("effort","integer between 1 and 10",e.effort);if(a.defined(e.dither))if(a.number(e.dither)&&a.inRange(e.dither,0,1))this.options.gifDither=e.dither;else throw a.invalidParameterError("dither","number between 0.0 and 1.0",e.dither);if(a.defined(e.interFrameMaxError))if(a.number(e.interFrameMaxError)&&a.inRange(e.interFrameMaxError,0,32))this.options.gifInterFrameMaxError=e.interFrameMaxError;else throw a.invalidParameterError("interFrameMaxError","number between 0.0 and 32.0",e.interFrameMaxError);if(a.defined(e.interPaletteMaxError))if(a.number(e.interPaletteMaxError)&&a.inRange(e.interPaletteMaxError,0,256))this.options.gifInterPaletteMaxError=e.interPaletteMaxError;else throw a.invalidParameterError("interPaletteMaxError","number between 0.0 and 256.0",e.interPaletteMaxError);if(a.defined(e.keepDuplicateFrames))if(a.bool(e.keepDuplicateFrames))this._setBooleanOption("gifKeepDuplicateFrames",e.keepDuplicateFrames);else throw a.invalidParameterError("keepDuplicateFrames","boolean",e.keepDuplicateFrames)}return cr(e,this.options),this._updateFormatOut("gif",e)}function Ho(e){if(!this.constructor.format.jp2k.output.buffer)throw xi();if(a.object(e)){if(a.defined(e.quality))if(a.integer(e.quality)&&a.inRange(e.quality,1,100))this.options.jp2Quality=e.quality;else throw a.invalidParameterError("quality","integer between 1 and 100",e.quality);if(a.defined(e.lossless))if(a.bool(e.lossless))this.options.jp2Lossless=e.lossless;else throw a.invalidParameterError("lossless","boolean",e.lossless);if(a.defined(e.tileWidth))if(a.integer(e.tileWidth)&&a.inRange(e.tileWidth,1,32768))this.options.jp2TileWidth=e.tileWidth;else throw a.invalidParameterError("tileWidth","integer between 1 and 32768",e.tileWidth);if(a.defined(e.tileHeight))if(a.integer(e.tileHeight)&&a.inRange(e.tileHeight,1,32768))this.options.jp2TileHeight=e.tileHeight;else throw a.invalidParameterError("tileHeight","integer between 1 and 32768",e.tileHeight);if(a.defined(e.chromaSubsampling))if(a.string(e.chromaSubsampling)&&a.inArray(e.chromaSubsampling,["4:2:0","4:4:4"]))this.options.jp2ChromaSubsampling=e.chromaSubsampling;else throw a.invalidParameterError("chromaSubsampling","one of: 4:2:0, 4:4:4",e.chromaSubsampling)}return this._updateFormatOut("jp2",e)}function cr(e,r){if(a.object(e)&&a.defined(e.loop))if(a.integer(e.loop)&&a.inRange(e.loop,0,65535))r.loop=e.loop;else throw a.invalidParameterError("loop","integer between 0 and 65535",e.loop);if(a.object(e)&&a.defined(e.delay))if(a.integer(e.delay)&&a.inRange(e.delay,0,65535))r.delay=[e.delay];else if(Array.isArray(e.delay)&&e.delay.every(a.integer)&&e.delay.every(t=>a.inRange(t,0,65535)))r.delay=e.delay;else throw a.invalidParameterError("delay","integer or an array of integers between 0 and 65535",e.delay)}function Wo(e){if(a.object(e)){if(a.defined(e.quality))if(a.integer(e.quality)&&a.inRange(e.quality,1,100))this.options.tiffQuality=e.quality;else throw a.invalidParameterError("quality","integer between 1 and 100",e.quality);if(a.defined(e.bitdepth))if(a.integer(e.bitdepth)&&a.inArray(e.bitdepth,[1,2,4,8]))this.options.tiffBitdepth=e.bitdepth;else throw a.invalidParameterError("bitdepth","1, 2, 4 or 8",e.bitdepth);if(a.defined(e.tile)&&this._setBooleanOption("tiffTile",e.tile),a.defined(e.tileWidth))if(a.integer(e.tileWidth)&&e.tileWidth>0)this.options.tiffTileWidth=e.tileWidth;else throw a.invalidParameterError("tileWidth","integer greater than zero",e.tileWidth);if(a.defined(e.tileHeight))if(a.integer(e.tileHeight)&&e.tileHeight>0)this.options.tiffTileHeight=e.tileHeight;else throw a.invalidParameterError("tileHeight","integer greater than zero",e.tileHeight);if(a.defined(e.miniswhite)&&this._setBooleanOption("tiffMiniswhite",e.miniswhite),a.defined(e.pyramid)&&this._setBooleanOption("tiffPyramid",e.pyramid),a.defined(e.xres))if(a.number(e.xres)&&e.xres>0)this.options.tiffXres=e.xres;else throw a.invalidParameterError("xres","number greater than zero",e.xres);if(a.defined(e.yres))if(a.number(e.yres)&&e.yres>0)this.options.tiffYres=e.yres;else throw a.invalidParameterError("yres","number greater than zero",e.yres);if(a.defined(e.compression))if(a.string(e.compression)&&a.inArray(e.compression,["none","jpeg","deflate","packbits","ccittfax4","lzw","webp","zstd","jp2k"]))this.options.tiffCompression=e.compression;else throw a.invalidParameterError("compression","one of: none, jpeg, deflate, packbits, ccittfax4, lzw, webp, zstd, jp2k",e.compression);if(a.defined(e.predictor))if(a.string(e.predictor)&&a.inArray(e.predictor,["none","horizontal","float"]))this.options.tiffPredictor=e.predictor;else throw a.invalidParameterError("predictor","one of: none, horizontal, float",e.predictor);if(a.defined(e.resolutionUnit))if(a.string(e.resolutionUnit)&&a.inArray(e.resolutionUnit,["inch","cm"]))this.options.tiffResolutionUnit=e.resolutionUnit;else throw a.invalidParameterError("resolutionUnit","one of: inch, cm",e.resolutionUnit)}return this._updateFormatOut("tiff",e)}function Xo(e){return this.heif({...e,compression:"av1"})}function Vo(e){if(a.object(e)){if(a.string(e.compression)&&a.inArray(e.compression,["av1","hevc"]))this.options.heifCompression=e.compression;else throw a.invalidParameterError("compression","one of: av1, hevc",e.compression);if(a.defined(e.quality))if(a.integer(e.quality)&&a.inRange(e.quality,1,100))this.options.heifQuality=e.quality;else throw a.invalidParameterError("quality","integer between 1 and 100",e.quality);if(a.defined(e.lossless))if(a.bool(e.lossless))this.options.heifLossless=e.lossless;else throw a.invalidParameterError("lossless","boolean",e.lossless);if(a.defined(e.effort))if(a.integer(e.effort)&&a.inRange(e.effort,0,9))this.options.heifEffort=e.effort;else throw a.invalidParameterError("effort","integer between 0 and 9",e.effort);if(a.defined(e.chromaSubsampling))if(a.string(e.chromaSubsampling)&&a.inArray(e.chromaSubsampling,["4:2:0","4:4:4"]))this.options.heifChromaSubsampling=e.chromaSubsampling;else throw a.invalidParameterError("chromaSubsampling","one of: 4:2:0, 4:4:4",e.chromaSubsampling);if(a.defined(e.bitdepth))if(a.integer(e.bitdepth)&&a.inArray(e.bitdepth,[8,10,12])){if(e.bitdepth!==8&&this.constructor.versions.heif)throw a.invalidParameterError("bitdepth when using prebuilt binaries",8,e.bitdepth);this.options.heifBitdepth=e.bitdepth}else throw a.invalidParameterError("bitdepth","8, 10 or 12",e.bitdepth)}else throw a.invalidParameterError("options","Object",e);return this._updateFormatOut("heif",e)}function Ko(e){if(a.object(e)){if(a.defined(e.quality))if(a.integer(e.quality)&&a.inRange(e.quality,1,100))this.options.jxlDistance=e.quality>=30?.1+(100-e.quality)*.09:53/3e3*e.quality*e.quality-23/20*e.quality+25;else throw a.invalidParameterError("quality","integer between 1 and 100",e.quality);else if(a.defined(e.distance))if(a.number(e.distance)&&a.inRange(e.distance,0,15))this.options.jxlDistance=e.distance;else throw a.invalidParameterError("distance","number between 0.0 and 15.0",e.distance);if(a.defined(e.decodingTier))if(a.integer(e.decodingTier)&&a.inRange(e.decodingTier,0,4))this.options.jxlDecodingTier=e.decodingTier;else throw a.invalidParameterError("decodingTier","integer between 0 and 4",e.decodingTier);if(a.defined(e.lossless))if(a.bool(e.lossless))this.options.jxlLossless=e.lossless;else throw a.invalidParameterError("lossless","boolean",e.lossless);if(a.defined(e.effort))if(a.integer(e.effort)&&a.inRange(e.effort,1,9))this.options.jxlEffort=e.effort;else throw a.invalidParameterError("effort","integer between 1 and 9",e.effort)}return cr(e,this.options),this._updateFormatOut("jxl",e)}function Qo(e){if(a.object(e)&&a.defined(e.depth))if(a.string(e.depth)&&a.inArray(e.depth,["char","uchar","short","ushort","int","uint","float","complex","double","dpcomplex"]))this.options.rawDepth=e.depth;else throw a.invalidParameterError("depth","one of: char, uchar, short, ushort, int, uint, float, complex, double, dpcomplex",e.depth);return this._updateFormatOut("raw")}function Jo(e){if(a.object(e)){if(a.defined(e.size))if(a.integer(e.size)&&a.inRange(e.size,1,8192))this.options.tileSize=e.size;else throw a.invalidParameterError("size","integer between 1 and 8192",e.size);if(a.defined(e.overlap))if(a.integer(e.overlap)&&a.inRange(e.overlap,0,8192)){if(e.overlap>this.options.tileSize)throw a.invalidParameterError("overlap",`<= size (${this.options.tileSize})`,e.overlap);this.options.tileOverlap=e.overlap}else throw a.invalidParameterError("overlap","integer between 0 and 8192",e.overlap);if(a.defined(e.container))if(a.string(e.container)&&a.inArray(e.container,["fs","zip"]))this.options.tileContainer=e.container;else throw a.invalidParameterError("container","one of: fs, zip",e.container);if(a.defined(e.layout))if(a.string(e.layout)&&a.inArray(e.layout,["dz","google","iiif","iiif3","zoomify"]))this.options.tileLayout=e.layout;else throw a.invalidParameterError("layout","one of: dz, google, iiif, iiif3, zoomify",e.layout);if(a.defined(e.angle))if(a.integer(e.angle)&&!(e.angle%90))this.options.tileAngle=e.angle;else throw a.invalidParameterError("angle","positive/negative multiple of 90",e.angle);if(this._setBackgroundColourOption("tileBackground",e.background),a.defined(e.depth))if(a.string(e.depth)&&a.inArray(e.depth,["onepixel","onetile","one"]))this.options.tileDepth=e.depth;else throw a.invalidParameterError("depth","one of: onepixel, onetile, one",e.depth);if(a.defined(e.skipBlanks))if(a.integer(e.skipBlanks)&&a.inRange(e.skipBlanks,-1,65535))this.options.tileSkipBlanks=e.skipBlanks;else throw a.invalidParameterError("skipBlanks","integer between -1 and 255/65535",e.skipBlanks);else a.defined(e.layout)&&e.layout==="google"&&(this.options.tileSkipBlanks=5);let r=a.bool(e.center)?e.center:e.centre;if(a.defined(r)&&this._setBooleanOption("tileCentre",r),a.defined(e.id))if(a.string(e.id))this.options.tileId=e.id;else throw a.invalidParameterError("id","string",e.id);if(a.defined(e.basename))if(a.string(e.basename))this.options.tileBasename=e.basename;else throw a.invalidParameterError("basename","string",e.basename)}if(a.inArray(this.options.formatOut,["jpeg","png","webp"]))this.options.tileFormat=this.options.formatOut;else if(this.options.formatOut!=="input")throw a.invalidParameterError("format","one of: jpeg, png, webp",this.options.formatOut);return this._updateFormatOut("dz")}function Yo(e){if(!a.plainObject(e))throw a.invalidParameterError("options","object",e);if(a.integer(e.seconds)&&a.inRange(e.seconds,0,3600))this.options.timeoutSeconds=e.seconds;else throw a.invalidParameterError("seconds","integer between 0 and 3600",e.seconds);return this}function Zo(e,r){return a.object(r)&&r.force===!1||(this.options.formatOut=e),this}function el(e,r){if(a.bool(r))this.options[e]=r;else throw a.invalidParameterError(e,"boolean",r)}function rl(){if(!this.options.streamOut){this.options.streamOut=!0;let e=Error();this._pipeline(void 0,e)}}function tl(e,r){return typeof e=="function"?(this._isStreamInput()?this.on("finish",()=>{this._flattenBufferIn(),fe.pipeline(this.options,(t,i,n)=>{t?e(a.nativeError(t,r)):e(null,i,n)})}):fe.pipeline(this.options,(t,i,n)=>{t?e(a.nativeError(t,r)):e(null,i,n)}),this):this.options.streamOut?(this._isStreamInput()?(this.once("finish",()=>{this._flattenBufferIn(),fe.pipeline(this.options,(t,i,n)=>{t?this.emit("error",a.nativeError(t,r)):(this.emit("info",n),this.push(i)),this.push(null),this.on("end",()=>this.emit("close"))})}),this.streamInFinished&&this.emit("finish")):fe.pipeline(this.options,(t,i,n)=>{t?this.emit("error",a.nativeError(t,r)):(this.emit("info",n),this.push(i)),this.push(null),this.on("end",()=>this.emit("close"))}),this):this._isStreamInput()?new Promise((t,i)=>{this.once("finish",()=>{this._flattenBufferIn(),fe.pipeline(this.options,(n,s,o)=>{n?i(a.nativeError(n,r)):this.options.resolveWithObject?t({data:s,info:o}):t(s)})})}):new Promise((t,i)=>{fe.pipeline(this.options,(n,s,o)=>{n?i(a.nativeError(n,r)):this.options.resolveWithObject?t({data:s,info:o}):t(s)})})}Ii.exports=function(e){Object.assign(e.prototype,{toFile:$o,toBuffer:So,keepExif:Lo,withExif:No,withExifMerge:To,keepIccProfile:_o,withIccProfile:Co,keepXmp:Bo,withXmp:qo,keepMetadata:Mo,withMetadata:Fo,toFormat:Do,jpeg:Oo,jp2:Ho,png:zo,webp:Uo,tiff:Wo,avif:Xo,heif:Vo,jxl:Ko,gif:Go,raw:Qo,tile:Jo,timeout:Yo,_updateFormatOut:Zo,_setBooleanOption:el,_read:rl,_pipeline:tl})}});var Si=w((ic,$i)=>{"use strict";var il=require("node:events"),Ce=Pe(),N=T(),{runtimePlatformArch:nl}=Ye(),$=pe(),Ai=nl(),hr=$.libvipsVersion(),X=$.format();X.heif.output.alias=["avif","heic"];X.jpeg.output.alias=["jpe","jpg"];X.tiff.output.alias=["tif"];X.jp2k.output.alias=["j2c","j2k","jp2","jpx"];var al={nearest:"nearest",bilinear:"bilinear",bicubic:"bicubic",locallyBoundedBicubic:"lbb",nohalo:"nohalo",vertexSplitQuadraticBasisSpline:"vsqbs"},ue={vips:hr.semver};if(!hr.isGlobal)if(hr.isWasm)try{ue=require("@img/sharp-wasm32/versions")}catch{}else try{ue=require(`@img/sharp-${Ai}/versions`)}catch{try{ue=require(`@img/sharp-libvips-${Ai}/versions`)}catch{}}ue.sharp=Qe().version;ue.heif&&X.heif&&(X.heif.input.fileSuffix=[".avif"],X.heif.output.alias=["avif"]);function ki(e){return N.bool(e)?e?$.cache(50,20,100):$.cache(0,0,0):N.object(e)?$.cache(e.memory,e.files,e.items):$.cache()}ki(!0);function sl(e){return $.concurrency(N.integer(e)?e:null)}Ce.familySync()===Ce.GLIBC&&!$._isUsingJemalloc()?$.concurrency(1):Ce.familySync()===Ce.MUSL&&$.concurrency()===1024&&$.concurrency(require("node:os").availableParallelism());var ol=new il.EventEmitter;function ll(){return $.counters()}function cl(e){return $.simd(N.bool(e)?e:null)}function hl(e){if(N.object(e))if(Array.isArray(e.operation)&&e.operation.every(N.string))$.block(e.operation,!0);else throw N.invalidParameterError("operation","Array<string>",e.operation);else throw N.invalidParameterError("options","object",e)}function fl(e){if(N.object(e))if(Array.isArray(e.operation)&&e.operation.every(N.string))$.block(e.operation,!1);else throw N.invalidParameterError("operation","Array<string>",e.operation);else throw N.invalidParameterError("options","object",e)}$i.exports=function(e){e.cache=ki,e.concurrency=sl,e.counters=ll,e.simd=cl,e.format=X,e.interpolators=al,e.versions=ue,e.queue=ol,e.block=hl,e.unblock=fl}});var Ni=w((nc,Li)=>{"use strict";var U=Ht();Vt()(U);ei()(U);ti()(U);oi()(U);Ei()(U);yi()(U);ji()(U);Si()(U);Li.exports=U});var wl={};zi(wl,{handler:()=>pl});module.exports=Gi(wl);var V=require("@aws-sdk/client-s3"),_i=Ui(Ni()),Ci=process.env.UPLOADS_BUCKET||process.env.BUCKET,re=process.env.DEST_BUCKET;if(!Ci)throw new Error("Missing env UPLOADS_BUCKET (or BUCKET)");if(!re)throw new Error("Missing env DEST_BUCKET");var ul=process.env.DEST_PREFIX??process.env.THUMBS_PREFIX??"thumbs/",Bi=String(ul).replace(/^\/+|\/+$/g,"")+"/",Ti=Math.max(1,parseInt(String(process.env.MAX_WIDTH??"360"),10)),dl=Math.min(100,Math.max(1,parseInt(String(process.env.JPEG_QUALITY??"80"),10))),fr=new V.S3Client({});function ml(e){return/\.(png|jpe?g|webp|gif|tiff|avif)$/i.test(e)}function ur(e){return decodeURIComponent(e.replace(/\+/g," ")).replace(/^\/*/,"")}function gl(e){let r=ur(e);return(Bi+r).replace(/\.[^.]+$/,".jpg")}function bl(e,r){let t=ur(e);if(!/^users\//i.test(t))return!1;if(r===re){let i=Bi.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&");if(new RegExp(`^${i}`,"i").test(t))return!1}return ml(t)}var pl=async e=>{for(let r of e.Records??[]){let t=r.s3?.bucket?.name,i=r.s3?.object?.key;if(!t||!i)continue;if(t!==Ci){console.log(`\u23ED\uFE0F  Ignoring event from bucket ${t}`);continue}let n=ur(i);if(!bl(n,t)){console.log(`\u23ED\uFE0F  Skipping ${n}`);continue}let s=gl(n);try{try{await fr.send(new V.HeadObjectCommand({Bucket:re,Key:s})),console.log(`\u2714\uFE0F  Thumb exists, skip: s3://${re}/${s}`);continue}catch{}let h=await(await fr.send(new V.GetObjectCommand({Bucket:t,Key:n}))).Body.transformToByteArray(),f=await(0,_i.default)(h).rotate().resize({width:Ti,height:Ti,fit:"inside",withoutEnlargement:!0}).jpeg({quality:dl,mozjpeg:!0}).toBuffer();await fr.send(new V.PutObjectCommand({Bucket:re,Key:s,Body:f,ContentType:"image/jpeg",CacheControl:"public, max-age=31536000, immutable",Metadata:{source:`${t}/${n}`}})),console.log(`\u2705 Generated: s3://${re}/${s}`)}catch(o){console.error(`\u274C Failed for ${t}/${n} -> ${re}/${s}:`,o)}}};0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
