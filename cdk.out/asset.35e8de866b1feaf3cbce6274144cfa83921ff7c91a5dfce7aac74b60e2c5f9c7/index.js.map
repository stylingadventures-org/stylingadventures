{
  "version": 3,
  "sources": ["../../lambda/graphql/index.ts"],
  "sourcesContent": ["// lambda/graphql/index.ts\r\n//\r\n// General closet GraphQL resolver:\r\n//   - Query.myCloset\r\n//   - Query.closetFeed\r\n//   - Mutation.createClosetItem\r\n//   - Mutation.requestClosetApproval\r\n//   - Mutation.updateClosetMediaKey\r\n//   - Mutation.updateClosetItemStory\r\n\r\nimport {\r\n  DynamoDBClient,\r\n  PutItemCommand,\r\n  UpdateItemCommand,\r\n  ScanCommand,\r\n} from \"@aws-sdk/client-dynamodb\";\r\nimport { unmarshall } from \"@aws-sdk/util-dynamodb\";\r\nimport { SFNClient, StartExecutionCommand } from \"@aws-sdk/client-sfn\";\r\nimport { randomUUID } from \"crypto\";\r\n\r\nconst ddb = new DynamoDBClient({});\r\nconst sfn = new SFNClient({});\r\n\r\nconst TABLE_NAME =\r\n  process.env.TABLE_NAME || process.env.APP_TABLE || undefined;\r\nconst APPROVAL_SM_ARN = process.env.APPROVAL_SM_ARN;\r\n\r\nif (!TABLE_NAME) {\r\n  throw new Error(\r\n    \"ClosetResolverFn: TABLE_NAME (or APP_TABLE) environment variable is required\",\r\n  );\r\n}\r\n\r\ntype ClosetStatus =\r\n  | \"DRAFT\"\r\n  | \"PENDING\"\r\n  | \"APPROVED\"\r\n  | \"REJECTED\"\r\n  | \"PUBLISHED\";\r\ntype ClosetAudience = \"PUBLIC\" | \"BESTIE\" | \"EXCLUSIVE\";\r\n\r\ntype ClosetItem = {\r\n  id: string;\r\n  userId: string;\r\n  ownerSub: string;\r\n  title?: string | null;\r\n  mediaKey?: string | null;\r\n  status: ClosetStatus;\r\n  audience: ClosetAudience;\r\n  reason?: string | null;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n  storyTitle?: string | null;\r\n  storySeason?: string | null;\r\n  storyVibes?: string[] | null;\r\n};\r\n\r\ntype ClosetFeedPage = {\r\n  items: ClosetItem[];\r\n  nextToken: string | null;\r\n};\r\n\r\ntype AppSyncIdentity = {\r\n  sub?: string;\r\n  claims?: Record<string, any>;\r\n};\r\n\r\ntype AppSyncEvent = {\r\n  info: { fieldName: string; parentTypeName: string };\r\n  arguments: any;\r\n  identity?: AppSyncIdentity;\r\n};\r\n\r\n// ---------- helpers ----------\r\n\r\nfunction getUserSub(event: AppSyncEvent): string {\r\n  const sub =\r\n    event.identity?.sub ||\r\n    (event.identity?.claims && event.identity.claims[\"sub\"]);\r\n  if (!sub) {\r\n    throw new Error(\"ClosetResolverFn: missing identity.sub\");\r\n  }\r\n  return String(sub);\r\n}\r\n\r\nfunction mapClosetItem(raw: any): ClosetItem {\r\n  const it = unmarshall(raw) as any;\r\n  const userId = it.userId ?? it.ownerSub;\r\n\r\n  return {\r\n    id: String(it.id),\r\n    userId: String(userId),\r\n    ownerSub: String(it.ownerSub),\r\n    title: it.title ?? null,\r\n    mediaKey: it.mediaKey ?? null,\r\n    status: (it.status ?? \"PENDING\") as ClosetStatus,\r\n    audience: (it.audience ?? \"PUBLIC\") as ClosetAudience,\r\n    reason: it.reason ?? null,\r\n    createdAt: String(it.createdAt),\r\n    updatedAt: String(it.updatedAt ?? it.createdAt),\r\n    storyTitle: it.storyTitle ?? null,\r\n    storySeason: it.storySeason ?? null,\r\n    storyVibes: Array.isArray(it.storyVibes)\r\n      ? (it.storyVibes as string[])\r\n      : null,\r\n  };\r\n}\r\n\r\n/**\r\n * Find the META row for an item by id.\r\n */\r\nasync function findRawItemById(id: string) {\r\n  const resp = await ddb.send(\r\n    new ScanCommand({\r\n      TableName: TABLE_NAME,\r\n      FilterExpression:\r\n        \"begins_with(#pk, :itemPrefix) AND #sk = :meta AND #id = :id\",\r\n      ExpressionAttributeNames: {\r\n        \"#pk\": \"pk\",\r\n        \"#sk\": \"sk\",\r\n        \"#id\": \"id\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":itemPrefix\": { S: \"ITEM#\" },\r\n        \":meta\": { S: \"META\" },\r\n        \":id\": { S: id },\r\n      },\r\n      Limit: 1,\r\n    }),\r\n  );\r\n  if (!resp.Items || resp.Items.length === 0) return null;\r\n  return resp.Items[0];\r\n}\r\n\r\nfunction pkOf(raw: any) {\r\n  if (raw.pk?.S && raw.sk?.S) {\r\n    return { pk: raw.pk.S as string, sk: raw.sk.S as string };\r\n  }\r\n  throw new Error(\"ClosetResolverFn: could not infer pk/sk\");\r\n}\r\n\r\n// ---------- resolvers ----------\r\n\r\n/**\r\n * Create a new closet item in DRAFT state for the current user.\r\n */\r\nasync function createClosetItem(\r\n  event: AppSyncEvent,\r\n  args: { title?: string | null },\r\n): Promise<ClosetItem> {\r\n  const ownerSub = getUserSub(event);\r\n  const id = randomUUID();\r\n  const now = new Date().toISOString();\r\n\r\n  const item = {\r\n    pk: { S: `ITEM#${id}` },\r\n    sk: { S: \"META\" },\r\n    id: { S: id },\r\n    userId: { S: ownerSub }, // mirror ownerSub into userId for GraphQL\r\n    ownerSub: { S: ownerSub },\r\n    title: { S: args.title ?? \"Untitled upload\" },\r\n    status: { S: \"DRAFT\" },\r\n    audience: { S: \"PUBLIC\" },\r\n    createdAt: { S: now },\r\n    updatedAt: { S: now },\r\n  };\r\n\r\n  await ddb.send(\r\n    new PutItemCommand({\r\n      TableName: TABLE_NAME,\r\n      Item: item,\r\n      ConditionExpression: \"attribute_not_exists(pk)\",\r\n    }),\r\n  );\r\n\r\n  return {\r\n    id,\r\n    userId: ownerSub,\r\n    ownerSub,\r\n    title: item.title.S!,\r\n    mediaKey: null,\r\n    status: \"DRAFT\",\r\n    audience: \"PUBLIC\",\r\n    reason: null,\r\n    createdAt: now,\r\n    updatedAt: now,\r\n    storyTitle: null,\r\n    storySeason: null,\r\n    storyVibes: null,\r\n  };\r\n}\r\n\r\n/**\r\n * Attach or change the S3 media key for an item.\r\n */\r\nasync function updateClosetMediaKey(\r\n  event: AppSyncEvent,\r\n  args: { id: string; mediaKey: string | null },\r\n): Promise<ClosetItem> {\r\n  const ownerSub = getUserSub(event);\r\n\r\n  const base = await findRawItemById(args.id);\r\n  if (!base) throw new Error(`Closet item not found for id=${args.id}`);\r\n  const { pk, sk } = pkOf(base);\r\n  const now = new Date().toISOString();\r\n\r\n  const resp = await ddb.send(\r\n    new UpdateItemCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: { pk: { S: pk }, sk: { S: sk } },\r\n      ConditionExpression: \"#ownerSub = :owner\",\r\n      UpdateExpression: \"SET #mediaKey = :mk, #updatedAt = :now\",\r\n      ExpressionAttributeNames: {\r\n        \"#mediaKey\": \"mediaKey\",\r\n        \"#updatedAt\": \"updatedAt\",\r\n        \"#ownerSub\": \"ownerSub\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":mk\": args.mediaKey ? { S: args.mediaKey } : { NULL: true },\r\n        \":now\": { S: now },\r\n        \":owner\": { S: ownerSub },\r\n      },\r\n      ReturnValues: \"ALL_NEW\",\r\n    }),\r\n  );\r\n\r\n  if (!resp.Attributes) {\r\n    throw new Error(\"updateClosetMediaKey: update returned no attributes\");\r\n  }\r\n  return mapClosetItem(resp.Attributes);\r\n}\r\n\r\n/**\r\n * Move an item from DRAFT to PENDING and kick off the approval workflow.\r\n */\r\nasync function requestClosetApproval(\r\n  event: AppSyncEvent,\r\n  args: { id: string },\r\n): Promise<ClosetItem> {\r\n  const ownerSub = getUserSub(event);\r\n  const base = await findRawItemById(args.id);\r\n  if (!base) throw new Error(`Closet item not found for id=${args.id}`);\r\n  const { pk, sk } = pkOf(base);\r\n  const now = new Date().toISOString();\r\n\r\n  // Mark as PENDING\r\n  const upd = await ddb.send(\r\n    new UpdateItemCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: { pk: { S: pk }, sk: { S: sk } },\r\n      ConditionExpression: \"#ownerSub = :owner\",\r\n      UpdateExpression: \"SET #status = :pending, #updatedAt = :now\",\r\n      ExpressionAttributeNames: {\r\n        \"#status\": \"status\",\r\n        \"#updatedAt\": \"updatedAt\",\r\n        \"#ownerSub\": \"ownerSub\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":pending\": { S: \"PENDING\" },\r\n        \":now\": { S: now },\r\n        \":owner\": { S: ownerSub },\r\n      },\r\n      ReturnValues: \"ALL_NEW\",\r\n    }),\r\n  );\r\n\r\n  // Kick off Step Functions workflow (if configured)\r\n  if (APPROVAL_SM_ARN) {\r\n    await sfn.send(\r\n      new StartExecutionCommand({\r\n        stateMachineArn: APPROVAL_SM_ARN,\r\n        input: JSON.stringify({\r\n          itemId: args.id,\r\n          ownerSub,\r\n        }),\r\n      }),\r\n    );\r\n  }\r\n\r\n  if (!upd.Attributes) {\r\n    throw new Error(\"requestClosetApproval: update returned no attributes\");\r\n  }\r\n  return mapClosetItem(upd.Attributes);\r\n}\r\n\r\n/**\r\n * Items for the current user, newest first.\r\n */\r\nasync function myCloset(event: AppSyncEvent): Promise<ClosetItem[]> {\r\n  const ownerSub = getUserSub(event);\r\n\r\n  const resp = await ddb.send(\r\n    new ScanCommand({\r\n      TableName: TABLE_NAME,\r\n      FilterExpression:\r\n        \"begins_with(#pk, :itemPrefix) AND #sk = :meta AND #ownerSub = :owner\",\r\n      ExpressionAttributeNames: {\r\n        \"#pk\": \"pk\",\r\n        \"#sk\": \"sk\",\r\n        \"#ownerSub\": \"ownerSub\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":itemPrefix\": { S: \"ITEM#\" },\r\n        \":meta\": { S: \"META\" },\r\n        \":owner\": { S: ownerSub },\r\n      },\r\n    }),\r\n  );\r\n\r\n  const items = (resp.Items || []).map(mapClosetItem);\r\n  items.sort((a, b) => (a.createdAt < b.createdAt ? 1 : -1));\r\n  return items;\r\n}\r\n\r\n/**\r\n * Public feed (\"Lala's Closet\").\r\n *\r\n * For now we show:\r\n *   - pk begins_with \"ITEM#\"\r\n *   - sk == \"META\"\r\n *   - status in {APPROVED, PUBLISHED}\r\n *   - audience == PUBLIC\r\n *\r\n * We always return a ClosetFeedPage object with items + nextToken=null.\r\n */\r\nasync function closetFeed(\r\n  _event: AppSyncEvent,\r\n  args: { limit?: number | null; nextToken?: string | null },\r\n): Promise<ClosetFeedPage> {\r\n  const limit =\r\n    typeof args.limit === \"number\" && args.limit > 0 ? args.limit : 50;\r\n\r\n  const resp = await ddb.send(\r\n    new ScanCommand({\r\n      TableName: TABLE_NAME,\r\n      FilterExpression:\r\n        \"begins_with(#pk, :itemPrefix) AND #sk = :meta AND \" +\r\n        \"(#status = :approved OR #status = :published) AND #audience = :public\",\r\n      ExpressionAttributeNames: {\r\n        \"#pk\": \"pk\",\r\n        \"#sk\": \"sk\",\r\n        \"#status\": \"status\",\r\n        \"#audience\": \"audience\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":itemPrefix\": { S: \"ITEM#\" },\r\n        \":meta\": { S: \"META\" },\r\n        \":approved\": { S: \"APPROVED\" },\r\n        \":published\": { S: \"PUBLISHED\" },\r\n        \":public\": { S: \"PUBLIC\" },\r\n      },\r\n    }),\r\n  );\r\n\r\n  const allItems = (resp.Items || []).map(mapClosetItem);\r\n  allItems.sort((a, b) => (a.createdAt < b.createdAt ? 1 : -1));\r\n\r\n  return {\r\n    items: allItems.slice(0, limit),\r\n    nextToken: null,\r\n  };\r\n}\r\n\r\n/**\r\n * Update story metadata for an item (Bestie-only UX, but auth enforced\r\n * by ownership here; admin flows can be added later if needed).\r\n */\r\nasync function updateClosetItemStory(\r\n  event: AppSyncEvent,\r\n  args: {\r\n    input: {\r\n      id: string;\r\n      storyTitle?: string | null;\r\n      storySeason?: string | null;\r\n      storyVibes?: string[] | null;\r\n    };\r\n  },\r\n): Promise<ClosetItem> {\r\n  const ownerSub = getUserSub(event);\r\n  const { id, storyTitle, storySeason, storyVibes } = args.input || {};\r\n\r\n  if (!id) {\r\n    throw new Error(\"updateClosetItemStory: id is required\");\r\n  }\r\n\r\n  const base = await findRawItemById(id);\r\n  if (!base) throw new Error(`Closet item not found for id=${id}`);\r\n  const { pk, sk } = pkOf(base);\r\n  const now = new Date().toISOString();\r\n\r\n  const names: Record<string, string> = {\r\n    \"#updatedAt\": \"updatedAt\",\r\n    \"#ownerSub\": \"ownerSub\",\r\n  };\r\n  const values: Record<string, any> = {\r\n    \":now\": { S: now },\r\n    \":owner\": { S: ownerSub },\r\n  };\r\n\r\n  const setParts: string[] = [\"#updatedAt = :now\"];\r\n  const removeParts: string[] = [];\r\n\r\n  // storyTitle\r\n  if (typeof storyTitle !== \"undefined\") {\r\n    names[\"#storyTitle\"] = \"storyTitle\";\r\n    const trimmed = storyTitle ? storyTitle.trim() : \"\";\r\n    if (trimmed) {\r\n      values[\":storyTitle\"] = { S: trimmed };\r\n      setParts.push(\"#storyTitle = :storyTitle\");\r\n    } else {\r\n      removeParts.push(\"#storyTitle\");\r\n    }\r\n  }\r\n\r\n  // storySeason\r\n  if (typeof storySeason !== \"undefined\") {\r\n    names[\"#storySeason\"] = \"storySeason\";\r\n    const trimmed = storySeason ? storySeason.trim() : \"\";\r\n    if (trimmed) {\r\n      values[\":storySeason\"] = { S: trimmed };\r\n      setParts.push(\"#storySeason = :storySeason\");\r\n    } else {\r\n      removeParts.push(\"#storySeason\");\r\n    }\r\n  }\r\n\r\n  // storyVibes\r\n  if (typeof storyVibes !== \"undefined\") {\r\n    names[\"#storyVibes\"] = \"storyVibes\";\r\n    if (Array.isArray(storyVibes) && storyVibes.length > 0) {\r\n      values[\":storyVibes\"] = {\r\n        L: storyVibes.map((v) => ({ S: String(v) })),\r\n      };\r\n      setParts.push(\"#storyVibes = :storyVibes\");\r\n    } else {\r\n      removeParts.push(\"#storyVibes\");\r\n    }\r\n  }\r\n\r\n  let updateExpression = \"SET \" + setParts.join(\", \");\r\n  if (removeParts.length > 0) {\r\n    updateExpression += \" REMOVE \" + removeParts.join(\", \");\r\n  }\r\n\r\n  const resp = await ddb.send(\r\n    new UpdateItemCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: { pk: { S: pk }, sk: { S: sk } },\r\n      ConditionExpression: \"#ownerSub = :owner\",\r\n      ExpressionAttributeNames: names,\r\n      ExpressionAttributeValues: values,\r\n      UpdateExpression: updateExpression,\r\n      ReturnValues: \"ALL_NEW\",\r\n    }),\r\n  );\r\n\r\n  if (!resp.Attributes) {\r\n    throw new Error(\"updateClosetItemStory: update returned no attributes\");\r\n  }\r\n\r\n  return mapClosetItem(resp.Attributes);\r\n}\r\n\r\n// ---------- handler ----------\r\n\r\nexport const handler = async (event: AppSyncEvent) => {\r\n  const { parentTypeName, fieldName } = event.info;\r\n\r\n  if (parentTypeName === \"Query\") {\r\n    if (fieldName === \"myCloset\") {\r\n      return myCloset(event);\r\n    }\r\n    if (fieldName === \"closetFeed\") {\r\n      return closetFeed(event, event.arguments || {});\r\n    }\r\n  }\r\n\r\n  if (parentTypeName === \"Mutation\") {\r\n    if (fieldName === \"createClosetItem\") {\r\n      return createClosetItem(event, event.arguments);\r\n    }\r\n    if (fieldName === \"requestClosetApproval\") {\r\n      return requestClosetApproval(event, event.arguments);\r\n    }\r\n    if (fieldName === \"updateClosetMediaKey\") {\r\n      return updateClosetMediaKey(event, event.arguments);\r\n    }\r\n    if (fieldName === \"updateClosetItemStory\") {\r\n      return updateClosetItemStory(event, event.arguments);\r\n    }\r\n  }\r\n\r\n  throw new Error(\r\n    `ClosetResolverFn: unknown field ${parentTypeName}.${fieldName}`,\r\n  );\r\n};\r\n"],
  "mappings": "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",
  "names": ["index_exports", "__export", "handler", "__toCommonJS", "import_client_dynamodb", "import_util_dynamodb", "import_client_sfn", "import_crypto", "ddb", "sfn", "TABLE_NAME", "APPROVAL_SM_ARN", "getUserSub", "event", "sub", "mapClosetItem", "raw", "it", "userId", "findRawItemById", "id", "resp", "pkOf", "createClosetItem", "args", "ownerSub", "now", "item", "updateClosetMediaKey", "base", "pk", "sk", "requestClosetApproval", "upd", "myCloset", "items", "a", "b", "closetFeed", "_event", "limit", "allItems", "updateClosetItemStory", "storyTitle", "storySeason", "storyVibes", "names", "values", "setParts", "removeParts", "trimmed", "v", "updateExpression", "parentTypeName", "fieldName"]
}
