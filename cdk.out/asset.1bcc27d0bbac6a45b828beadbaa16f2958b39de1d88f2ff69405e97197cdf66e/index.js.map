{
  "version": 3,
  "sources": ["../../lambda/admin/moderation.ts"],
  "sourcesContent": ["// lambda/admin/moderation.ts\r\n//\r\n// Admin moderation + tools entrypoint (placeholder).\r\n// This enforces ADMIN-only access and gives you a few\r\n// stub resolvers you can wire up in the schema/AppSync.\r\n//\r\n// You can expand this later to:\r\n// - approve/reject uploads, bios, comments, bg changes, affiliate links\r\n// - launch challenges/polls/games\r\n// - send shoutouts / targeted invites, etc.\r\n\r\ntype AppSyncIdentity = {\r\n  sub?: string;\r\n  username?: string;\r\n  claims?: { [key: string]: any };\r\n  groups?: string[] | null;\r\n};\r\n\r\ntype AppSyncEvent = {\r\n  identity?: AppSyncIdentity;\r\n  info: { fieldName: string };\r\n  arguments: any;\r\n};\r\n\r\nconst { TABLE_NAME = \"\" } = process.env;\r\n// NOTE: we don't *require* TABLE_NAME yet in this stub \u2013 you can\r\n// start reading/writing Dynamo later without breaking deploy.\r\n\r\n/** Check if the caller is in the Cognito \"admin\" group. */\r\nfunction isAdmin(identity?: AppSyncIdentity): boolean {\r\n  if (!identity) return false;\r\n\r\n  const claimsGroups =\r\n    identity.claims?.[\"cognito:groups\"] ??\r\n    identity.claims?.[\"custom:groups\"] ??\r\n    identity.groups;\r\n\r\n  const groups = Array.isArray(claimsGroups)\r\n    ? claimsGroups\r\n    : typeof claimsGroups === \"string\"\r\n    ? claimsGroups.split(\",\")\r\n    : [];\r\n\r\n  // IdentityStack creates groups \"admin\" and \"creator\"\r\n  return groups.includes(\"admin\") || groups.includes(\"ADMIN\");\r\n}\r\n\r\nexport const handler = async (event: AppSyncEvent) => {\r\n  const field = event.info.fieldName;\r\n  const identity = event.identity;\r\n\r\n  if (!identity?.sub) {\r\n    throw new Error(\"Unauthorized\");\r\n  }\r\n\r\n  if (!isAdmin(identity)) {\r\n    throw new Error(\"Forbidden\");\r\n  }\r\n\r\n  // \uD83D\uDD10 From this point on, we know it's an admin.\r\n\r\n  switch (field) {\r\n    // Simple health-check / can-I-hit-admin-endpoints?\r\n    case \"adminModerationPing\":\r\n      return {\r\n        ok: true,\r\n        at: new Date().toISOString(),\r\n      };\r\n\r\n    // Placeholder moderation queue\r\n    case \"adminListModerationQueue\":\r\n      return {\r\n        items: [],\r\n        nextToken: null,\r\n      };\r\n\r\n    // Placeholder approve/reject / status update\r\n    case \"adminUpdateModerationStatus\":\r\n      return {\r\n        ok: true,\r\n        updatedAt: new Date().toISOString(),\r\n      };\r\n\r\n    // Placeholder for community/event management\r\n    case \"adminLaunchChallenge\":\r\n      return {\r\n        ok: true,\r\n        challengeId: \"placeholder\",\r\n      };\r\n\r\n    // Placeholder for shoutouts / targeted invites\r\n    case \"adminSendShoutout\":\r\n      return {\r\n        ok: true,\r\n      };\r\n\r\n    default:\r\n      throw new Error(`No resolver implemented for field ${field}`);\r\n  }\r\n};\r\n"],
  "mappings": "yaAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,aAAAE,IAAA,eAAAC,EAAAH,GAwBA,GAAM,CAAE,WAAAI,EAAa,EAAG,EAAI,QAAQ,IAKpC,SAASC,EAAQC,EAAqC,CA7BtD,IAAAC,EAAAC,EA8BE,GAAI,CAACF,EAAU,MAAO,GAEtB,IAAMG,IACJF,EAAAD,EAAS,SAAT,YAAAC,EAAkB,sBAClBC,EAAAF,EAAS,SAAT,YAAAE,EAAkB,mBAClBF,EAAS,OAELI,EAAS,MAAM,QAAQD,CAAY,EACrCA,EACA,OAAOA,GAAiB,SACxBA,EAAa,MAAM,GAAG,EACtB,CAAC,EAGL,OAAOC,EAAO,SAAS,OAAO,GAAKA,EAAO,SAAS,OAAO,CAC5D,CAEO,IAAMR,EAAU,MAAOS,GAAwB,CACpD,IAAMC,EAAQD,EAAM,KAAK,UACnBL,EAAWK,EAAM,SAEvB,GAAI,EAACL,GAAA,MAAAA,EAAU,KACb,MAAM,IAAI,MAAM,cAAc,EAGhC,GAAI,CAACD,EAAQC,CAAQ,EACnB,MAAM,IAAI,MAAM,WAAW,EAK7B,OAAQM,EAAO,CAEb,IAAK,sBACH,MAAO,CACL,GAAI,GACJ,GAAI,IAAI,KAAK,EAAE,YAAY,CAC7B,EAGF,IAAK,2BACH,MAAO,CACL,MAAO,CAAC,EACR,UAAW,IACb,EAGF,IAAK,8BACH,MAAO,CACL,GAAI,GACJ,UAAW,IAAI,KAAK,EAAE,YAAY,CACpC,EAGF,IAAK,uBACH,MAAO,CACL,GAAI,GACJ,YAAa,aACf,EAGF,IAAK,oBACH,MAAO,CACL,GAAI,EACN,EAEF,QACE,MAAM,IAAI,MAAM,qCAAqCA,CAAK,EAAE,CAChE,CACF",
  "names": ["moderation_exports", "__export", "handler", "__toCommonJS", "TABLE_NAME", "isAdmin", "identity", "_a", "_b", "claimsGroups", "groups", "event", "field"]
}
