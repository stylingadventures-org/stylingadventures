{
  "version": 3,
  "sources": ["../../lambda/prime/tea-report-resolver.ts"],
  "sourcesContent": ["/**\r\n * lambda/prime/tea-report-resolver.ts\r\n * \r\n * Handles Tea Report queries and mutations:\r\n * - Generate daily/weekly/monthly Tea Reports\r\n * - Fetch report history\r\n * - Get character drama\r\n * - Track relationship status\r\n * - Admin management of reports and hot takes\r\n */\r\n\r\nimport {\r\n  DynamoDBClient,\r\n  PutItemCommand,\r\n  QueryCommand,\r\n  UpdateItemCommand,\r\n  GetItemCommand,\r\n} from \"@aws-sdk/client-dynamodb\";\r\nimport { marshall, unmarshall } from \"@aws-sdk/util-dynamodb\";\r\nimport { randomUUID } from \"crypto\";\r\nimport { AppSyncIdentityCognito } from \"aws-lambda\";\r\n\r\nconst ddb = new DynamoDBClient({});\r\nconst TABLE_NAME = process.env.TABLE_NAME!;\r\n\r\ntype SAIdentity = (AppSyncIdentityCognito & { groups?: string[] | null }) | null | undefined;\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// Auth helpers\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nfunction assertAuth(identity: SAIdentity): asserts identity {\r\n  if (!identity?.sub) throw new Error(\"Not authenticated\");\r\n}\r\n\r\nfunction assertPrime(identity: SAIdentity): void {\r\n  assertAuth(identity);\r\n  const claims = (identity as any)?.claims || {};\r\n  const raw = claims[\"cognito:groups\"];\r\n  const groups = Array.isArray(raw)\r\n    ? raw\r\n    : String(raw || \"\").split(\",\").map((g) => g.trim()).filter(Boolean);\r\n\r\n  if (!groups.includes(\"PRIME\") && !groups.includes(\"ADMIN\")) {\r\n    throw new Error(\"PRIME or ADMIN tier required\");\r\n  }\r\n}\r\n\r\nfunction isAdmin(identity: SAIdentity): boolean {\r\n  const claims = (identity as any)?.claims || {};\r\n  const raw = claims[\"cognito:groups\"];\r\n  const groups = Array.isArray(raw)\r\n    ? raw\r\n    : String(raw || \"\").split(\",\").map((g) => g.trim()).filter(Boolean);\r\n  return groups.includes(\"ADMIN\") || groups.includes(\"PRIME\");\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// Types\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\ninterface TeaReport {\r\n  id: string;\r\n  reportId: string;\r\n  generatedAt: string;\r\n  period: \"DAILY\" | \"WEEKLY\" | \"MONTHLY\";\r\n  headline: string;\r\n  summary: string;\r\n  teaItems: TeaItem[];\r\n  dramaMeter: number;\r\n  relationshipUpdates: RelationshipStatus[];\r\n  hotTakes: HotTake[];\r\n  viewCount: number;\r\n  shareCount: number;\r\n}\r\n\r\ninterface TeaItem {\r\n  id: string;\r\n  reportId: string;\r\n  title: string;\r\n  description: string;\r\n  teaLevel: number;\r\n  category: string;\r\n  characters: string[];\r\n  relatedEpisode?: string;\r\n  relatedMusic?: string;\r\n  timestamp: string;\r\n}\r\n\r\ninterface RelationshipStatus {\r\n  character1: string;\r\n  character2: string;\r\n  status: string;\r\n  confidence: number;\r\n  lastUpdated: string;\r\n}\r\n\r\ninterface HotTake {\r\n  id: string;\r\n  author: string;\r\n  content: string;\r\n  sentiment: string;\r\n  reactionCount: number;\r\n  timestamp: string;\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// Helpers\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nfunction nowIso() {\r\n  return new Date().toISOString();\r\n}\r\n\r\nfunction pkForTeaReport() {\r\n  return \"TEA#REPORT\";\r\n}\r\n\r\nfunction skForTeaReport(reportId: string) {\r\n  return `REPORT#${reportId}`;\r\n}\r\n\r\nfunction pkForRelationship() {\r\n  return \"TEA#RELATIONSHIP\";\r\n}\r\n\r\nfunction skForRelationship(char1: string, char2: string) {\r\n  return `REL#${[char1, char2].sort().join(\"#\")}`;\r\n}\r\n\r\nconst ddbMarshal = (value: any) =>\r\n  marshall(value, { removeUndefinedValues: true });\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// Queries\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function handleLatestTeaReport(identity: SAIdentity): Promise<TeaReport | null> {\r\n  assertPrime(identity);\r\n\r\n  const res = await ddb.send(\r\n    new QueryCommand({\r\n      TableName: TABLE_NAME,\r\n      KeyConditionExpression: \"pk = :pk\",\r\n      ScanIndexForward: false,\r\n      Limit: 1,\r\n      ExpressionAttributeValues: ddbMarshal({\r\n        \":pk\": pkForTeaReport(),\r\n      }),\r\n    }),\r\n  );\r\n\r\n  const raw = (res.Items ?? [])[0];\r\n  if (!raw) return null;\r\n\r\n  return unmarshall(raw) as TeaReport;\r\n}\r\n\r\nasync function handleTeaReportHistory(\r\n  args: {\r\n    period?: string;\r\n    limit?: number;\r\n    nextToken?: string;\r\n  },\r\n  identity: SAIdentity,\r\n): Promise<{ items: TeaReport[]; nextToken: string | null }> {\r\n  assertPrime(identity);\r\n\r\n  const limit = Math.min(args.limit ?? 10, 50);\r\n\r\n  const res = await ddb.send(\r\n    new QueryCommand({\r\n      TableName: TABLE_NAME,\r\n      KeyConditionExpression: \"pk = :pk\",\r\n      ExpressionAttributeValues: ddbMarshal({\r\n        \":pk\": pkForTeaReport(),\r\n      }),\r\n      ScanIndexForward: false,\r\n      Limit: limit,\r\n      ExclusiveStartKey: args.nextToken ? JSON.parse(Buffer.from(args.nextToken, \"base64\").toString()) : undefined,\r\n    }),\r\n  );\r\n\r\n  const items = (res.Items ?? []).map((raw) => unmarshall(raw) as TeaReport);\r\n\r\n  let nextToken = null;\r\n  if (res.LastEvaluatedKey) {\r\n    nextToken = Buffer.from(JSON.stringify(res.LastEvaluatedKey)).toString(\"base64\");\r\n  }\r\n\r\n  return { items, nextToken };\r\n}\r\n\r\nasync function handleCharacterDrama(\r\n  args: { characterName: string },\r\n  identity: SAIdentity,\r\n): Promise<TeaItem[]> {\r\n  assertPrime(identity);\r\n\r\n  const res = await ddb.send(\r\n    new QueryCommand({\r\n      TableName: TABLE_NAME,\r\n      KeyConditionExpression: \"pk = :pk\",\r\n      ScanIndexForward: false,\r\n      ExpressionAttributeValues: ddbMarshal({\r\n        \":pk\": pkForTeaReport(),\r\n      }),\r\n    }),\r\n  );\r\n\r\n  const allReports = (res.Items ?? []).map((raw) => unmarshall(raw) as TeaReport);\r\n  const allTeaItems = allReports.flatMap((report) => report.teaItems ?? []);\r\n\r\n  return allTeaItems.filter((item) =>\r\n    item.characters?.includes(args.characterName),\r\n  );\r\n}\r\n\r\nasync function handleRelationshipStatus(\r\n  args: { character1: string; character2: string },\r\n  identity: SAIdentity,\r\n): Promise<RelationshipStatus | null> {\r\n  assertPrime(identity);\r\n\r\n  const res = await ddb.send(\r\n    new GetItemCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: ddbMarshal({\r\n        pk: pkForRelationship(),\r\n        sk: skForRelationship(args.character1, args.character2),\r\n      }),\r\n    }),\r\n  );\r\n\r\n  if (!res.Item) return null;\r\n  return unmarshall(res.Item) as RelationshipStatus;\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// Mutations (Admin only)\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function handleAdminGenerateTeaReport(\r\n  args: {\r\n    period: \"DAILY\" | \"WEEKLY\" | \"MONTHLY\";\r\n    sourceEpisodes?: string[];\r\n    sourceMusic?: string[];\r\n  },\r\n  identity: SAIdentity,\r\n): Promise<TeaReport> {\r\n  assertPrime(identity);\r\n  if (!isAdmin(identity)) throw new Error(\"ADMIN required\");\r\n\r\n  const reportId = randomUUID();\r\n  const now = nowIso();\r\n\r\n  // Generate sample tea items and hot takes\r\n  const teaItems: TeaItem[] = [\r\n    {\r\n      id: randomUUID(),\r\n      reportId,\r\n      title: \"Lala x Crew Studio Sessions\",\r\n      description: \"Behind-the-scenes tension during latest recording\",\r\n      teaLevel: 7,\r\n      category: \"BEHIND_THE_SCENES\",\r\n      characters: [\"Lala\", \"CrewMember1\"],\r\n      timestamp: now,\r\n    },\r\n  ];\r\n\r\n  const hotTakes: HotTake[] = [\r\n    {\r\n      id: randomUUID(),\r\n      author: \"Anonymous Fan\",\r\n      content: \"The vibes this week were immaculate!\",\r\n      sentiment: \"POSITIVE\",\r\n      reactionCount: 234,\r\n      timestamp: now,\r\n    },\r\n  ];\r\n\r\n  const report: TeaReport = {\r\n    id: reportId,\r\n    reportId,\r\n    generatedAt: now,\r\n    period: args.period,\r\n    headline: `${args.period} Tea Report: Drama Meter \uD83C\uDF75`,\r\n    summary: \"Latest happenings in the Lala universe\",\r\n    teaItems,\r\n    dramaMeter: 6,\r\n    relationshipUpdates: [],\r\n    hotTakes,\r\n    viewCount: 0,\r\n    shareCount: 0,\r\n  };\r\n\r\n  await ddb.send(\r\n    new PutItemCommand({\r\n      TableName: TABLE_NAME,\r\n      Item: ddbMarshal({\r\n        pk: pkForTeaReport(),\r\n        sk: skForTeaReport(reportId),\r\n        entityType: \"TEA_REPORT\",\r\n        gsi1pk: `TEA#PERIOD#${args.period}`,\r\n        gsi1sk: now,\r\n        ...report,\r\n      }),\r\n    }),\r\n  );\r\n\r\n  return report;\r\n}\r\n\r\nasync function handleAdminAddHotTake(\r\n  args: {\r\n    reportId: string;\r\n    authorCharacter: string;\r\n    content: string;\r\n  },\r\n  identity: SAIdentity,\r\n): Promise<HotTake> {\r\n  assertPrime(identity);\r\n  if (!isAdmin(identity)) throw new Error(\"ADMIN required\");\r\n\r\n  const hotTake: HotTake = {\r\n    id: randomUUID(),\r\n    author: args.authorCharacter,\r\n    content: args.content,\r\n    sentiment: \"NEUTRAL\",\r\n    reactionCount: 0,\r\n    timestamp: nowIso(),\r\n  };\r\n\r\n  // Note: In production, would update report with new hot take\r\n  // For now, returning the created hot take\r\n\r\n  return hotTake;\r\n}\r\n\r\nasync function handleAdminUpdateRelationshipStatus(\r\n  args: {\r\n    character1: string;\r\n    character2: string;\r\n    status: string;\r\n  },\r\n  identity: SAIdentity,\r\n): Promise<RelationshipStatus> {\r\n  assertPrime(identity);\r\n  if (!isAdmin(identity)) throw new Error(\"ADMIN required\");\r\n\r\n  const now = nowIso();\r\n  const relStatus: RelationshipStatus = {\r\n    character1: args.character1,\r\n    character2: args.character2,\r\n    status: args.status,\r\n    confidence: 0.85,\r\n    lastUpdated: now,\r\n  };\r\n\r\n  await ddb.send(\r\n    new PutItemCommand({\r\n      TableName: TABLE_NAME,\r\n      Item: ddbMarshal({\r\n        pk: pkForRelationship(),\r\n        sk: skForRelationship(args.character1, args.character2),\r\n        entityType: \"RELATIONSHIP\",\r\n        ...relStatus,\r\n      }),\r\n    }),\r\n  );\r\n\r\n  return relStatus;\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// AppSync Lambda resolver entrypoint\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nexport const handler = async (event: any) => {\r\n  console.log(\"TeaReportResolverFn event\", JSON.stringify(event));\r\n\r\n  const fieldName = event.info?.fieldName as string | undefined;\r\n\r\n  try {\r\n    switch (fieldName) {\r\n      case \"latestTeaReport\":\r\n        return await handleLatestTeaReport(event.identity);\r\n\r\n      case \"teaReportHistory\":\r\n        return await handleTeaReportHistory(event.arguments || {}, event.identity);\r\n\r\n      case \"characterDrama\":\r\n        return await handleCharacterDrama(event.arguments, event.identity);\r\n\r\n      case \"relationshipStatus\":\r\n        return await handleRelationshipStatus(event.arguments, event.identity);\r\n\r\n      case \"adminGenerateTeaReport\":\r\n        return await handleAdminGenerateTeaReport(event.arguments, event.identity);\r\n\r\n      case \"adminAddHotTake\":\r\n        return await handleAdminAddHotTake(event.arguments, event.identity);\r\n\r\n      case \"adminUpdateRelationshipStatus\":\r\n        return await handleAdminUpdateRelationshipStatus(event.arguments, event.identity);\r\n\r\n      default:\r\n        throw new Error(`Unknown field: ${fieldName}`);\r\n    }\r\n  } catch (err: any) {\r\n    console.error(\"TeaReportResolverFn error\", err);\r\n    throw err;\r\n  }\r\n};\r\n"],
  "mappings": "yaAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,aAAAE,IAAA,eAAAC,EAAAH,GAWA,IAAAI,EAMO,oCACPC,EAAqC,kCACrCC,EAA2B,kBAGrBC,EAAM,IAAI,iBAAe,CAAC,CAAC,EAC3BC,EAAa,QAAQ,IAAI,WAQ/B,SAASC,EAAWC,EAAwC,CAC1D,GAAI,CAACA,GAAU,IAAK,MAAM,IAAI,MAAM,mBAAmB,CACzD,CAEA,SAASC,EAAYD,EAA4B,CAC/CD,EAAWC,CAAQ,EAEnB,IAAME,GADUF,GAAkB,QAAU,CAAC,GAC1B,gBAAgB,EAC7BG,EAAS,MAAM,QAAQD,CAAG,EAC5BA,EACA,OAAOA,GAAO,EAAE,EAAE,MAAM,GAAG,EAAE,IAAKE,GAAMA,EAAE,KAAK,CAAC,EAAE,OAAO,OAAO,EAEpE,GAAI,CAACD,EAAO,SAAS,OAAO,GAAK,CAACA,EAAO,SAAS,OAAO,EACvD,MAAM,IAAI,MAAM,8BAA8B,CAElD,CAEA,SAASE,EAAQL,EAA+B,CAE9C,IAAME,GADUF,GAAkB,QAAU,CAAC,GAC1B,gBAAgB,EAC7BG,EAAS,MAAM,QAAQD,CAAG,EAC5BA,EACA,OAAOA,GAAO,EAAE,EAAE,MAAM,GAAG,EAAE,IAAKE,GAAMA,EAAE,KAAK,CAAC,EAAE,OAAO,OAAO,EACpE,OAAOD,EAAO,SAAS,OAAO,GAAKA,EAAO,SAAS,OAAO,CAC5D,CAuDA,SAASG,GAAS,CAChB,OAAO,IAAI,KAAK,EAAE,YAAY,CAChC,CAEA,SAASC,GAAiB,CACxB,MAAO,YACT,CAEA,SAASC,EAAeC,EAAkB,CACxC,MAAO,UAAUA,CAAQ,EAC3B,CAEA,SAASC,GAAoB,CAC3B,MAAO,kBACT,CAEA,SAASC,EAAkBC,EAAeC,EAAe,CACvD,MAAO,OAAO,CAACD,EAAOC,CAAK,EAAE,KAAK,EAAE,KAAK,GAAG,CAAC,EAC/C,CAEA,IAAMC,EAAcC,MAClB,YAASA,EAAO,CAAE,sBAAuB,EAAK,CAAC,EAMjD,eAAeC,EAAsBhB,EAAiD,CACpFC,EAAYD,CAAQ,EAcpB,IAAME,IAZM,MAAML,EAAI,KACpB,IAAI,eAAa,CACf,UAAWC,EACX,uBAAwB,WACxB,iBAAkB,GAClB,MAAO,EACP,0BAA2BgB,EAAW,CACpC,MAAOP,EAAe,CACxB,CAAC,CACH,CAAC,CACH,GAEiB,OAAS,CAAC,GAAG,CAAC,EAC/B,OAAKL,KAEE,cAAWA,CAAG,EAFJ,IAGnB,CAEA,eAAee,EACbC,EAKAlB,EAC2D,CAC3DC,EAAYD,CAAQ,EAEpB,IAAMmB,EAAQ,KAAK,IAAID,EAAK,OAAS,GAAI,EAAE,EAErCE,EAAM,MAAMvB,EAAI,KACpB,IAAI,eAAa,CACf,UAAWC,EACX,uBAAwB,WACxB,0BAA2BgB,EAAW,CACpC,MAAOP,EAAe,CACxB,CAAC,EACD,iBAAkB,GAClB,MAAOY,EACP,kBAAmBD,EAAK,UAAY,KAAK,MAAM,OAAO,KAAKA,EAAK,UAAW,QAAQ,EAAE,SAAS,CAAC,EAAI,MACrG,CAAC,CACH,EAEMG,GAASD,EAAI,OAAS,CAAC,GAAG,IAAKlB,MAAQ,cAAWA,CAAG,CAAc,EAErEoB,EAAY,KAChB,OAAIF,EAAI,mBACNE,EAAY,OAAO,KAAK,KAAK,UAAUF,EAAI,gBAAgB,CAAC,EAAE,SAAS,QAAQ,GAG1E,CAAE,MAAAC,EAAO,UAAAC,CAAU,CAC5B,CAEA,eAAeC,EACbL,EACAlB,EACoB,CACpB,OAAAC,EAAYD,CAAQ,IAER,MAAMH,EAAI,KACpB,IAAI,eAAa,CACf,UAAWC,EACX,uBAAwB,WACxB,iBAAkB,GAClB,0BAA2BgB,EAAW,CACpC,MAAOP,EAAe,CACxB,CAAC,CACH,CAAC,CACH,GAEwB,OAAS,CAAC,GAAG,IAAKL,MAAQ,cAAWA,CAAG,CAAc,EAC/C,QAASsB,GAAWA,EAAO,UAAY,CAAC,CAAC,EAErD,OAAQC,GACzBA,EAAK,YAAY,SAASP,EAAK,aAAa,CAC9C,CACF,CAEA,eAAeQ,EACbR,EACAlB,EACoC,CACpCC,EAAYD,CAAQ,EAEpB,IAAMoB,EAAM,MAAMvB,EAAI,KACpB,IAAI,iBAAe,CACjB,UAAWC,EACX,IAAKgB,EAAW,CACd,GAAIJ,EAAkB,EACtB,GAAIC,EAAkBO,EAAK,WAAYA,EAAK,UAAU,CACxD,CAAC,CACH,CAAC,CACH,EAEA,OAAKE,EAAI,QACF,cAAWA,EAAI,IAAI,EADJ,IAExB,CAMA,eAAeO,EACbT,EAKAlB,EACoB,CAEpB,GADAC,EAAYD,CAAQ,EAChB,CAACK,EAAQL,CAAQ,EAAG,MAAM,IAAI,MAAM,gBAAgB,EAExD,IAAMS,KAAW,cAAW,EACtBmB,EAAMtB,EAAO,EAGbuB,EAAsB,CAC1B,CACE,MAAI,cAAW,EACf,SAAApB,EACA,MAAO,8BACP,YAAa,oDACb,SAAU,EACV,SAAU,oBACV,WAAY,CAAC,OAAQ,aAAa,EAClC,UAAWmB,CACb,CACF,EAEME,EAAsB,CAC1B,CACE,MAAI,cAAW,EACf,OAAQ,gBACR,QAAS,uCACT,UAAW,WACX,cAAe,IACf,UAAWF,CACb,CACF,EAEMJ,EAAoB,CACxB,GAAIf,EACJ,SAAAA,EACA,YAAamB,EACb,OAAQV,EAAK,OACb,SAAU,GAAGA,EAAK,MAAM,qCACxB,QAAS,yCACT,SAAAW,EACA,WAAY,EACZ,oBAAqB,CAAC,EACtB,SAAAC,EACA,UAAW,EACX,WAAY,CACd,EAEA,aAAMjC,EAAI,KACR,IAAI,iBAAe,CACjB,UAAWC,EACX,KAAMgB,EAAW,CACf,GAAIP,EAAe,EACnB,GAAIC,EAAeC,CAAQ,EAC3B,WAAY,aACZ,OAAQ,cAAcS,EAAK,MAAM,GACjC,OAAQU,EACR,GAAGJ,CACL,CAAC,CACH,CAAC,CACH,EAEOA,CACT,CAEA,eAAeO,EACbb,EAKAlB,EACkB,CAElB,GADAC,EAAYD,CAAQ,EAChB,CAACK,EAAQL,CAAQ,EAAG,MAAM,IAAI,MAAM,gBAAgB,EAcxD,MAZyB,CACvB,MAAI,cAAW,EACf,OAAQkB,EAAK,gBACb,QAASA,EAAK,QACd,UAAW,UACX,cAAe,EACf,UAAWZ,EAAO,CACpB,CAMF,CAEA,eAAe0B,EACbd,EAKAlB,EAC6B,CAE7B,GADAC,EAAYD,CAAQ,EAChB,CAACK,EAAQL,CAAQ,EAAG,MAAM,IAAI,MAAM,gBAAgB,EAExD,IAAM4B,EAAMtB,EAAO,EACb2B,EAAgC,CACpC,WAAYf,EAAK,WACjB,WAAYA,EAAK,WACjB,OAAQA,EAAK,OACb,WAAY,IACZ,YAAaU,CACf,EAEA,aAAM/B,EAAI,KACR,IAAI,iBAAe,CACjB,UAAWC,EACX,KAAMgB,EAAW,CACf,GAAIJ,EAAkB,EACtB,GAAIC,EAAkBO,EAAK,WAAYA,EAAK,UAAU,EACtD,WAAY,eACZ,GAAGe,CACL,CAAC,CACH,CAAC,CACH,EAEOA,CACT,CAMO,IAAMzC,EAAU,MAAO0C,GAAe,CAC3C,QAAQ,IAAI,4BAA6B,KAAK,UAAUA,CAAK,CAAC,EAE9D,IAAMC,EAAYD,EAAM,MAAM,UAE9B,GAAI,CACF,OAAQC,EAAW,CACjB,IAAK,kBACH,OAAO,MAAMnB,EAAsBkB,EAAM,QAAQ,EAEnD,IAAK,mBACH,OAAO,MAAMjB,EAAuBiB,EAAM,WAAa,CAAC,EAAGA,EAAM,QAAQ,EAE3E,IAAK,iBACH,OAAO,MAAMX,EAAqBW,EAAM,UAAWA,EAAM,QAAQ,EAEnE,IAAK,qBACH,OAAO,MAAMR,EAAyBQ,EAAM,UAAWA,EAAM,QAAQ,EAEvE,IAAK,yBACH,OAAO,MAAMP,EAA6BO,EAAM,UAAWA,EAAM,QAAQ,EAE3E,IAAK,kBACH,OAAO,MAAMH,EAAsBG,EAAM,UAAWA,EAAM,QAAQ,EAEpE,IAAK,gCACH,OAAO,MAAMF,EAAoCE,EAAM,UAAWA,EAAM,QAAQ,EAElF,QACE,MAAM,IAAI,MAAM,kBAAkBC,CAAS,EAAE,CACjD,CACF,OAASC,EAAU,CACjB,cAAQ,MAAM,4BAA6BA,CAAG,EACxCA,CACR,CACF",
  "names": ["tea_report_resolver_exports", "__export", "handler", "__toCommonJS", "import_client_dynamodb", "import_util_dynamodb", "import_crypto", "ddb", "TABLE_NAME", "assertAuth", "identity", "assertPrime", "raw", "groups", "g", "isAdmin", "nowIso", "pkForTeaReport", "skForTeaReport", "reportId", "pkForRelationship", "skForRelationship", "char1", "char2", "ddbMarshal", "value", "handleLatestTeaReport", "handleTeaReportHistory", "args", "limit", "res", "items", "nextToken", "handleCharacterDrama", "report", "item", "handleRelationshipStatus", "handleAdminGenerateTeaReport", "now", "teaItems", "hotTakes", "handleAdminAddHotTake", "handleAdminUpdateRelationshipStatus", "relStatus", "event", "fieldName", "err"]
}
