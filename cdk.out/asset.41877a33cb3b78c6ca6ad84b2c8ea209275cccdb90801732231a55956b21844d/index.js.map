{
  "version": 3,
  "sources": ["../../lambda/prime/mock-social-feed.ts"],
  "sourcesContent": ["// lambda/prime/mock-social-feed.ts\r\n\r\n/**\r\n * Prime Studios - Mock Social Feed Generator\r\n *\r\n * Purpose:\r\n *  - Generate IG Reels / YT Shorts style embeds for immersive story UI.\r\n *  - Internal-only helper for Prime Studios tools / preview UIs.\r\n *\r\n * Behavior:\r\n *  - GENERATE_FEED: returns a list of \"posts\" tied to an episode / story.\r\n *  - GET_POST: returns a single mock post by ID.\r\n *\r\n * This is intentionally mock-only for now (no DB writes).\r\n */\r\n\r\nexport type MockSocialAction = \"GENERATE_FEED\" | \"GET_POST\";\r\n\r\nexport interface GenerateFeedInput {\r\n  episodeId?: string;\r\n  storyId?: string;\r\n  characterId?: string;\r\n  count?: number; // default 6\r\n}\r\n\r\nexport interface GetPostInput {\r\n  postId: string;\r\n}\r\n\r\nexport interface MockSocialFeedEvent {\r\n  action: MockSocialAction;\r\n  generateFeed?: GenerateFeedInput;\r\n  getPost?: GetPostInput;\r\n}\r\n\r\nexport type SocialPlatform = \"instagram_reel\" | \"youtube_short\" | \"tiktok\";\r\n\r\nexport interface MockSocialPost {\r\n  postId: string;\r\n  platform: SocialPlatform;\r\n\r\n  // Link targets (front-end can turn into embeds)\r\n  shareUrl: string;\r\n  thumbnailUrl: string;\r\n\r\n  // Episode / story context\r\n  episodeId?: string;\r\n  storyId?: string;\r\n  characterId?: string;\r\n\r\n  // Pretty UI bits\r\n  title: string;\r\n  caption: string;\r\n  durationSeconds: number;\r\n\r\n  // Fake performance metrics for UI testing\r\n  views: number;\r\n  likes: number;\r\n  comments: number;\r\n\r\n  createdAt: string;\r\n\r\n  // Optional: CTA that can deep-link back into your episode UI\r\n  cta?: {\r\n    label: string;\r\n    type: \"WATCH_EPISODE\" | \"SHOP_OUTFIT\" | \"JOIN_POLL\" | \"FOLLOW_CHARACTER\";\r\n    targetId?: string;\r\n  };\r\n}\r\n\r\nexport interface GenerateFeedResult {\r\n  kind: \"feed\";\r\n  posts: MockSocialPost[];\r\n}\r\n\r\nexport interface GetPostResult {\r\n  kind: \"post\";\r\n  post: MockSocialPost;\r\n}\r\n\r\nexport type MockSocialResult = GenerateFeedResult | GetPostResult;\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// helpers\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nfunction nowIso(): string {\r\n  return new Date().toISOString();\r\n}\r\n\r\nfunction randomId(prefix: string): string {\r\n  return `${prefix}-${Math.random().toString(36).slice(2, 10)}`;\r\n}\r\n\r\nfunction pickPlatform(idx: number): SocialPlatform {\r\n  const platforms: SocialPlatform[] = [\r\n    \"instagram_reel\",\r\n    \"youtube_short\",\r\n    \"tiktok\",\r\n  ];\r\n  return platforms[idx % platforms.length];\r\n}\r\n\r\nfunction fakeMetrics(seed: number) {\r\n  // Very simple deterministic-ish metrics so the UI has stable-ish values\r\n  const base = 1_000 + seed * 137;\r\n  return {\r\n    views: base,\r\n    likes: Math.floor(base * 0.18),\r\n    comments: Math.floor(base * 0.03),\r\n  };\r\n}\r\n\r\nfunction buildMockPost(\r\n  idx: number,\r\n  ctx: { episodeId?: string; storyId?: string; characterId?: string },\r\n): MockSocialPost {\r\n  const platform = pickPlatform(idx);\r\n  const postId = randomId(\"post\");\r\n  const createdAt = nowIso();\r\n  const metrics = fakeMetrics(idx + 1);\r\n\r\n  const episodeTag = ctx.episodeId ? `EP ${ctx.episodeId}` : \"Prime Studios\";\r\n  const charTag = ctx.characterId ? `with ${ctx.characterId}` : \"with the Besties\";\r\n\r\n  const title = `${episodeTag}: Scene ${idx + 1}`;\r\n  const caption = `POV: You just unlocked a new outfit ${charTag} \u2728`;\r\n\r\n  const ctaType: NonNullable<MockSocialPost[\"cta\"]>[\"type\"] =\r\n    idx % 3 === 0\r\n      ? \"WATCH_EPISODE\"\r\n      : idx % 3 === 1\r\n      ? \"SHOP_OUTFIT\"\r\n      : \"JOIN_POLL\";\r\n\r\n  return {\r\n    postId,\r\n    platform,\r\n    shareUrl: `https://prime.stylingadventures.local/${platform}/${postId}`,\r\n    thumbnailUrl: `https://prime.stylingadventures.local/thumbs/${postId}.jpg`,\r\n\r\n    episodeId: ctx.episodeId,\r\n    storyId: ctx.storyId,\r\n    characterId: ctx.characterId,\r\n\r\n    title,\r\n    caption,\r\n    durationSeconds: 12 + (idx % 8), // 12\u201319s shorts\r\n\r\n    views: metrics.views,\r\n    likes: metrics.likes,\r\n    comments: metrics.comments,\r\n\r\n    createdAt,\r\n\r\n    cta: {\r\n      label:\r\n        ctaType === \"WATCH_EPISODE\"\r\n          ? \"Watch episode\"\r\n          : ctaType === \"SHOP_OUTFIT\"\r\n          ? \"Shop the look\"\r\n          : \"Vote in poll\",\r\n      type: ctaType,\r\n      targetId:\r\n        ctaType === \"WATCH_EPISODE\"\r\n          ? ctx.episodeId\r\n          : ctaType === \"SHOP_OUTFIT\"\r\n          ? \"outfit-placeholder\"\r\n          : \"poll-placeholder\",\r\n    },\r\n  };\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// action handlers\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function handleGenerateFeed(\r\n  input: GenerateFeedInput,\r\n): Promise<GenerateFeedResult> {\r\n  const count = input.count && input.count > 0 ? input.count : 6;\r\n\r\n  const posts: MockSocialPost[] = [];\r\n  for (let i = 0; i < count; i++) {\r\n    posts.push(\r\n      buildMockPost(i, {\r\n        episodeId: input.episodeId,\r\n        storyId: input.storyId,\r\n        characterId: input.characterId,\r\n      }),\r\n    );\r\n  }\r\n\r\n  console.log(\r\n    \"MockSocialFeed GENERATE_FEED:\",\r\n    JSON.stringify({ input, postsCount: posts.length }, null, 2),\r\n  );\r\n\r\n  return { kind: \"feed\", posts };\r\n}\r\n\r\nasync function handleGetPost(input: GetPostInput): Promise<GetPostResult> {\r\n  if (!input.postId) {\r\n    throw new Error(\"MockSocialFeed GET_POST: missing postId\");\r\n  }\r\n\r\n  // For now, we just generate a deterministic-ish mock post from the ID.\r\n  const idxSeed = Math.abs(hashStringToInt(input.postId)) % 10;\r\n\r\n  const post = buildMockPost(idxSeed, {\r\n    episodeId: undefined,\r\n    storyId: undefined,\r\n    characterId: undefined,\r\n  });\r\n\r\n  // Override the auto id so the returned post matches the requested ID.\r\n  post.postId = input.postId;\r\n  post.shareUrl = `https://prime.stylingadventures.local/reels/${input.postId}`;\r\n  post.thumbnailUrl = `https://prime.stylingadventures.local/thumbs/${input.postId}.jpg`;\r\n\r\n  console.log(\r\n    \"MockSocialFeed GET_POST:\",\r\n    JSON.stringify({ input, post }, null, 2),\r\n  );\r\n\r\n  return { kind: \"post\", post };\r\n}\r\n\r\n// Simple deterministic hash for GET_POST so metrics feel stable-ish.\r\nfunction hashStringToInt(str: string): number {\r\n  let hash = 0;\r\n  for (const ch of str) {\r\n    hash = (hash * 31 + ch.charCodeAt(0)) | 0;\r\n  }\r\n  // make non-negative\r\n  return hash >>> 0;\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// Lambda handler\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nexport const handler = async (\r\n  event: MockSocialFeedEvent,\r\n): Promise<MockSocialResult> => {\r\n  console.log(\r\n    \"MockSocialFeed incoming event:\",\r\n    JSON.stringify(event, null, 2),\r\n  );\r\n\r\n  if (!event || !event.action) {\r\n    throw new Error(\"MockSocialFeed: missing action\");\r\n  }\r\n\r\n  switch (event.action) {\r\n    case \"GENERATE_FEED\":\r\n      if (!event.generateFeed) {\r\n        throw new Error(\r\n          \"MockSocialFeed GENERATE_FEED: missing 'generateFeed' payload\",\r\n        );\r\n      }\r\n      return handleGenerateFeed(event.generateFeed);\r\n\r\n    case \"GET_POST\":\r\n      if (!event.getPost) {\r\n        throw new Error(\r\n          \"MockSocialFeed GET_POST: missing 'getPost' payload\",\r\n        );\r\n      }\r\n      return handleGetPost(event.getPost);\r\n\r\n    default:\r\n      throw new Error(\r\n        `MockSocialFeed: unsupported action ${(event as any).action}`,\r\n      );\r\n  }\r\n};\r\n"],
  "mappings": "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",
  "names": ["mock_social_feed_exports", "__export", "handler", "__toCommonJS", "nowIso", "randomId", "prefix", "pickPlatform", "idx", "platforms", "fakeMetrics", "seed", "base", "buildMockPost", "ctx", "platform", "postId", "createdAt", "metrics", "episodeTag", "charTag", "title", "caption", "ctaType", "handleGenerateFeed", "input", "count", "posts", "i", "handleGetPost", "idxSeed", "hashStringToInt", "post", "str", "hash", "ch", "event"]
}
