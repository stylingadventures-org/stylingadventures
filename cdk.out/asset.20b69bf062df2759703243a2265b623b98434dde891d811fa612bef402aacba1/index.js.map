{
  "version": 3,
  "sources": ["../../lambda/creator-tools/index.ts", "../../lambda/creator/ai.ts", "../../../../../node_modules/uuid/dist/esm/stringify.js", "../../../../../node_modules/uuid/dist/esm/rng.js", "../../../../../node_modules/uuid/dist/esm/native.js", "../../../../../node_modules/uuid/dist/esm/v4.js"],
  "sourcesContent": ["// lambda/creator-tools/index.ts\r\n\r\n// Re-use the unified Creator Tools handler (AI + cabinets/folders/assets)\r\nexport { handler } from \"../creator/ai\";\r\n", "// lambda/creator/ai.ts\r\nimport { DynamoDBClient } from \"@aws-sdk/client-dynamodb\";\r\nimport {\r\n  DynamoDBDocumentClient,\r\n  QueryCommand,\r\n  PutCommand,\r\n  UpdateCommand,\r\n  DeleteCommand,\r\n  GetCommand,\r\n} from \"@aws-sdk/lib-dynamodb\";\r\nimport { v4 as uuid } from \"uuid\";\r\nimport { S3Client, PutObjectCommand } from \"@aws-sdk/client-s3\";\r\nimport { getSignedUrl } from \"@aws-sdk/s3-request-presigner\";\r\n\r\nconst ddb = DynamoDBDocumentClient.from(new DynamoDBClient({}));\r\nconst s3 = new S3Client({});\r\n\r\nconst TABLE_NAME = process.env.TABLE_NAME!;\r\nconst CREATOR_MEDIA_BUCKET = process.env.CREATOR_MEDIA_BUCKET!;\r\nconst PK = process.env.PK_NAME || \"pk\";\r\nconst SK = process.env.SK_NAME || \"sk\";\r\nconst STATUS_GSI = process.env.STATUS_GSI || \"gsi1\";\r\n\r\nfunction now() {\r\n  return new Date().toISOString();\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// GraphQL handler \u2013 router\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\nexport const handler = async (event: any) => {\r\n  console.log(\"[CreatorTools] event\", JSON.stringify(event));\r\n  const field = event.info?.fieldName;\r\n  const sub =\r\n    event.identity?.sub ||\r\n    event.identity?.claims?.sub ||\r\n    \"anonymous\";\r\n\r\n  switch (field) {\r\n    // CABINETS\r\n    case \"creatorCabinets\":\r\n      return listCabinets(sub);\r\n    case \"creatorCabinet\":\r\n      return getCabinet(sub, event.arguments?.id);\r\n    case \"createCreatorCabinet\":\r\n      return createCabinet(sub, event.arguments?.input);\r\n    case \"updateCreatorCabinet\":\r\n      return updateCabinet(\r\n        sub,\r\n        event.arguments?.id,\r\n        event.arguments?.input,\r\n      );\r\n    case \"deleteCreatorCabinet\":\r\n      return deleteCabinet(sub, event.arguments?.id);\r\n\r\n    // FOLDERS\r\n    case \"creatorFolders\":\r\n      return listFolders(sub, event.arguments?.cabinetId);\r\n    case \"createCreatorFolder\":\r\n      return createFolder(sub, event.arguments?.input);\r\n    case \"renameCreatorFolder\":\r\n      return renameFolder(sub, event.arguments?.input);\r\n    case \"deleteCreatorFolder\":\r\n      return deleteFolder(\r\n        sub,\r\n        event.arguments?.id,\r\n        event.arguments?.cabinetId,\r\n      );\r\n\r\n    // ASSETS\r\n    case \"creatorCabinetAssets\":\r\n      return listAssets(sub, event.arguments);\r\n    case \"createCreatorAssetUpload\":\r\n      return createAssetUpload(sub, event.arguments?.input);\r\n    case \"updateCreatorAsset\":\r\n      return updateAsset(sub, event.arguments?.input);\r\n    case \"deleteCreatorAsset\":\r\n      return deleteAsset(\r\n        sub,\r\n        event.arguments?.id,\r\n        event.arguments?.cabinetId,\r\n      );\r\n    case \"moveCreatorAsset\":\r\n      return moveAsset(sub, event.arguments?.input);\r\n\r\n    // AI\r\n    case \"creatorAiSuggest\":\r\n      return runCreatorAi(event);\r\n\r\n    default:\r\n      throw new Error(`Unknown field ${field}`);\r\n  }\r\n};\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// Helpers \u2013 mapping helpers\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nfunction mapCabinet(item: any) {\r\n  if (!item) return null;\r\n  return {\r\n    id: item.id,\r\n    ownerSub: item.ownerSub,\r\n    name: item.name,\r\n    description: item.description ?? null,\r\n    defaultCategory: item.defaultCategory ?? null,\r\n    tags: item.tags ?? [],\r\n    createdAt: item.createdAt,\r\n    updatedAt: item.updatedAt,\r\n    assetCount: item.assetCount ?? 0,\r\n  };\r\n}\r\n\r\nfunction mapFolder(item: any) {\r\n  if (!item) return null;\r\n  return {\r\n    id: item.id,\r\n    cabinetId: item.cabinetId,\r\n    name: item.name,\r\n    specialKind: item.specialKind ?? null,\r\n    createdAt: item.createdAt,\r\n    updatedAt: item.updatedAt,\r\n  };\r\n}\r\n\r\nfunction mapAsset(item: any) {\r\n  if (!item) return null;\r\n\r\n  // Ensure kind is always one of PHOTO | VIDEO | OTHER (schema: CreatorAssetKind!)\r\n  const rawKind = (item.kind as string) || \"OTHER\";\r\n  const kind =\r\n    rawKind === \"PHOTO\" || rawKind === \"VIDEO\" ? rawKind : \"OTHER\";\r\n\r\n  return {\r\n    id: item.id,\r\n    cabinetId: item.cabinetId,\r\n    folderId: item.folderId ?? null,\r\n    ownerSub: item.ownerSub,\r\n    kind,\r\n    category: item.category ?? null,\r\n    title: item.title ?? null,\r\n    notes: item.notes ?? null,\r\n    tags: item.tags ?? [],\r\n    s3Key: item.s3Key,\r\n    contentType: item.contentType ?? null,\r\n    createdAt: item.createdAt,\r\n    updatedAt: item.updatedAt,\r\n  };\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// CABINETS\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function listCabinets(sub: string) {\r\n  const res = await ddb.send(\r\n    new QueryCommand({\r\n      TableName: TABLE_NAME,\r\n      IndexName: STATUS_GSI,\r\n      KeyConditionExpression:\r\n        \"#gpk = :gpk AND begins_with(#gsk, :prefix)\",\r\n      ExpressionAttributeNames: {\r\n        \"#gpk\": \"gsi1pk\",\r\n        \"#gsk\": \"gsi1sk\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":gpk\": `CREATOR#${sub}`,\r\n        \":prefix\": \"CAB#\",\r\n      },\r\n    }),\r\n  );\r\n\r\n  const items = res.Items ?? [];\r\n  return items.map(mapCabinet);\r\n}\r\n\r\nasync function getCabinet(sub: string, id: string) {\r\n  if (!id) throw new Error(\"id is required\");\r\n\r\n  const res = await ddb.send(\r\n    new GetCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${id}`,\r\n        [SK]: \"META\",\r\n      },\r\n    }),\r\n  );\r\n\r\n  if (!res.Item || res.Item.ownerSub !== sub) {\r\n    // hide existence of other peoples\u2019 cabinets\r\n    return null;\r\n  }\r\n\r\n  return mapCabinet(res.Item);\r\n}\r\n\r\nasync function createCabinet(sub: string, input: any) {\r\n  if (!input?.name) {\r\n    throw new Error(\"name is required\");\r\n  }\r\n\r\n  const id = uuid();\r\n  const nowIso = now();\r\n\r\n  const item = {\r\n    [PK]: `CAB#${id}`,\r\n    [SK]: \"META\",\r\n    type: \"CABINET\",\r\n    id,\r\n    ownerSub: sub,\r\n    name: input.name,\r\n    description: input.description ?? null,\r\n    defaultCategory: input.defaultCategory ?? null,\r\n    tags: input.tags ?? [],\r\n    assetCount: 0,\r\n    createdAt: nowIso,\r\n    updatedAt: nowIso,\r\n    // GSI to list cabinets per creator\r\n    gsi1pk: `CREATOR#${sub}`,\r\n    gsi1sk: `CAB#${nowIso}#${id}`,\r\n  };\r\n\r\n  await ddb.send(\r\n    new PutCommand({\r\n      TableName: TABLE_NAME,\r\n      Item: item,\r\n      ConditionExpression: \"attribute_not_exists(#pk)\",\r\n      ExpressionAttributeNames: {\r\n        \"#pk\": PK,\r\n      },\r\n    }),\r\n  );\r\n\r\n  return mapCabinet(item);\r\n}\r\n\r\nasync function updateCabinet(sub: string, id: string, input: any) {\r\n  if (!id) throw new Error(\"id is required\");\r\n  if (!input) throw new Error(\"input is required\");\r\n\r\n  const nowIso = now();\r\n\r\n  const names: Record<string, string> = {\r\n    \"#updatedAt\": \"updatedAt\",\r\n    \"#ownerSub\": \"ownerSub\",\r\n  };\r\n  const values: Record<string, any> = {\r\n    \":updatedAt\": nowIso,\r\n    \":ownerSub\": sub,\r\n  };\r\n  const sets: string[] = [\"#updatedAt = :updatedAt\"];\r\n\r\n  if (Object.prototype.hasOwnProperty.call(input, \"name\")) {\r\n    names[\"#name\"] = \"name\";\r\n    values[\":name\"] = input.name;\r\n    sets.push(\"#name = :name\");\r\n  }\r\n  if (Object.prototype.hasOwnProperty.call(input, \"description\")) {\r\n    names[\"#description\"] = \"description\";\r\n    values[\":description\"] = input.description ?? null;\r\n    sets.push(\"#description = :description\");\r\n  }\r\n  if (\r\n    Object.prototype.hasOwnProperty.call(input, \"defaultCategory\")\r\n  ) {\r\n    names[\"#defaultCategory\"] = \"defaultCategory\";\r\n    values[\":defaultCategory\"] = input.defaultCategory ?? null;\r\n    sets.push(\"#defaultCategory = :defaultCategory\");\r\n  }\r\n  if (Object.prototype.hasOwnProperty.call(input, \"tags\")) {\r\n    names[\"#tags\"] = \"tags\";\r\n    values[\":tags\"] = input.tags ?? [];\r\n    sets.push(\"#tags = :tags\");\r\n  }\r\n\r\n  const res = await ddb.send(\r\n    new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${id}`,\r\n        [SK]: \"META\",\r\n      },\r\n      UpdateExpression: \"SET \" + sets.join(\", \"),\r\n      ConditionExpression: \"#ownerSub = :ownerSub\",\r\n      ExpressionAttributeNames: names,\r\n      ExpressionAttributeValues: values,\r\n      ReturnValues: \"ALL_NEW\",\r\n    }),\r\n  );\r\n\r\n  return mapCabinet(res.Attributes);\r\n}\r\n\r\nasync function deleteCabinet(sub: string, id: string) {\r\n  if (!id) throw new Error(\"id is required\");\r\n\r\n  const pkValue = `CAB#${id}`;\r\n\r\n  // First fetch all rows for this cabinet to confirm ownership & cascade delete.\r\n  const res = await ddb.send(\r\n    new QueryCommand({\r\n      TableName: TABLE_NAME,\r\n      KeyConditionExpression: \"#pk = :pk\",\r\n      ExpressionAttributeNames: {\r\n        \"#pk\": PK,\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":pk\": pkValue,\r\n      },\r\n    }),\r\n  );\r\n\r\n  const items = res.Items ?? [];\r\n  const meta = items.find((it) => it.type === \"CABINET\");\r\n\r\n  if (!meta || meta.ownerSub !== sub) {\r\n    // Not your cabinet \u2192 pretend it doesn't exist\r\n    return false;\r\n  }\r\n\r\n  // Best-effort cascade delete\r\n  await Promise.all(\r\n    items.map((item) =>\r\n      ddb.send(\r\n        new DeleteCommand({\r\n          TableName: TABLE_NAME,\r\n          Key: {\r\n            [PK]: item[PK],\r\n            [SK]: item[SK],\r\n          },\r\n        }),\r\n      ),\r\n    ),\r\n  );\r\n\r\n  return true;\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// FOLDERS\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function listFolders(sub: string, cabinetId: string) {\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n\r\n  // optional: check cabinet ownership (soft check)\r\n  const cabinet = await getCabinet(sub, cabinetId);\r\n  if (!cabinet) {\r\n    // hide if not owner\r\n    return [];\r\n  }\r\n\r\n  const res = await ddb.send(\r\n    new QueryCommand({\r\n      TableName: TABLE_NAME,\r\n      KeyConditionExpression:\r\n        \"#pk = :pk AND begins_with(#sk, :prefix)\",\r\n      ExpressionAttributeNames: {\r\n        \"#pk\": PK,\r\n        \"#sk\": SK,\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":pk\": `CAB#${cabinetId}`,\r\n        \":prefix\": \"FOLDER#\",\r\n      },\r\n    }),\r\n  );\r\n\r\n  const items = res.Items ?? [];\r\n  return items.map(mapFolder);\r\n}\r\n\r\nasync function createFolder(sub: string, input: any) {\r\n  const { cabinetId, name } = input || {};\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n  if (!name) throw new Error(\"name is required\");\r\n\r\n  const cabinet = await getCabinet(sub, cabinetId);\r\n  if (!cabinet) {\r\n    throw new Error(\"Cabinet not found\");\r\n  }\r\n\r\n  const id = uuid();\r\n  const nowIso = now();\r\n\r\n  const item = {\r\n    [PK]: `CAB#${cabinetId}`,\r\n    [SK]: `FOLDER#${id}`,\r\n    type: \"FOLDER\",\r\n    id,\r\n    cabinetId,\r\n    ownerSub: sub,\r\n    name,\r\n    specialKind: null,\r\n    createdAt: nowIso,\r\n    updatedAt: nowIso,\r\n  };\r\n\r\n  await ddb.send(\r\n    new PutCommand({\r\n      TableName: TABLE_NAME,\r\n      Item: item,\r\n      ConditionExpression:\r\n        \"attribute_not_exists(#pk) AND attribute_not_exists(#sk)\",\r\n      ExpressionAttributeNames: {\r\n        \"#pk\": PK,\r\n        \"#sk\": SK,\r\n      },\r\n    }),\r\n  );\r\n\r\n  return mapFolder(item);\r\n}\r\n\r\nasync function renameFolder(sub: string, input: any) {\r\n  const { id, cabinetId, name } = input || {};\r\n  if (!id) throw new Error(\"id is required\");\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n  if (!name) throw new Error(\"name is required\");\r\n\r\n  const nowIso = now();\r\n\r\n  const res = await ddb.send(\r\n    new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: `FOLDER#${id}`,\r\n      },\r\n      UpdateExpression:\r\n        \"SET #name = :name, #updatedAt = :updatedAt\",\r\n      ConditionExpression: \"#ownerSub = :ownerSub\",\r\n      ExpressionAttributeNames: {\r\n        \"#name\": \"name\",\r\n        \"#updatedAt\": \"updatedAt\",\r\n        \"#ownerSub\": \"ownerSub\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":name\": name,\r\n        \":updatedAt\": nowIso,\r\n        \":ownerSub\": sub,\r\n      },\r\n      ReturnValues: \"ALL_NEW\",\r\n    }),\r\n  );\r\n\r\n  return mapFolder(res.Attributes);\r\n}\r\n\r\nasync function deleteFolder(\r\n  sub: string,\r\n  id: string,\r\n  cabinetId: string,\r\n) {\r\n  if (!id) throw new Error(\"id is required\");\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n\r\n  // Delete the folder row (with ownership check)\r\n  await ddb.send(\r\n    new DeleteCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: `FOLDER#${id}`,\r\n      },\r\n      ConditionExpression: \"#ownerSub = :ownerSub\",\r\n      ExpressionAttributeNames: {\r\n        \"#ownerSub\": \"ownerSub\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":ownerSub\": sub,\r\n      },\r\n    }),\r\n  );\r\n\r\n  // Best-effort cleanup: move any assets in this folder to \"unsorted\" (null folderId)\r\n  const res = await ddb.send(\r\n    new QueryCommand({\r\n      TableName: TABLE_NAME,\r\n      KeyConditionExpression:\r\n        \"#pk = :pk AND begins_with(#sk, :prefix)\",\r\n      FilterExpression: \"#folderId = :folderId\",\r\n      ExpressionAttributeNames: {\r\n        \"#pk\": PK,\r\n        \"#sk\": SK,\r\n        \"#folderId\": \"folderId\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":pk\": `CAB#${cabinetId}`,\r\n        \":prefix\": \"ASSET#\",\r\n        \":folderId\": id,\r\n      },\r\n    }),\r\n  );\r\n\r\n  const assets = res.Items ?? [];\r\n  await Promise.all(\r\n    assets.map((asset) =>\r\n      ddb.send(\r\n        new UpdateCommand({\r\n          TableName: TABLE_NAME,\r\n          Key: {\r\n            [PK]: asset[PK],\r\n            [SK]: asset[SK],\r\n          },\r\n          UpdateExpression: \"SET #folderId = :null\",\r\n          ExpressionAttributeNames: {\r\n            \"#folderId\": \"folderId\",\r\n          },\r\n          ExpressionAttributeValues: {\r\n            \":null\": null,\r\n          },\r\n        }),\r\n      ),\r\n    ),\r\n  );\r\n\r\n  return true;\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// ASSETS\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function listAssets(sub: string, args: any) {\r\n  const {\r\n    cabinetId,\r\n    folderId,\r\n    category,\r\n    tag,\r\n    search,\r\n    limit = 50,\r\n    nextToken,\r\n  } = args || {};\r\n\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n\r\n  const cabinet = await getCabinet(sub, cabinetId);\r\n  if (!cabinet) {\r\n    // Hide if not owner\r\n    return {\r\n      items: [],\r\n      nextToken: null,\r\n    };\r\n  }\r\n\r\n  const queryInput: any = {\r\n    TableName: TABLE_NAME,\r\n    KeyConditionExpression:\r\n      \"#pk = :pk AND begins_with(#sk, :prefix)\",\r\n    ExpressionAttributeNames: {\r\n      \"#pk\": PK,\r\n      \"#sk\": SK,\r\n    },\r\n    ExpressionAttributeValues: {\r\n      \":pk\": `CAB#${cabinetId}`,\r\n      \":prefix\": \"ASSET#\",\r\n    },\r\n    Limit: limit,\r\n  };\r\n\r\n  if (nextToken) {\r\n    queryInput.ExclusiveStartKey = {\r\n      [PK]: `CAB#${cabinetId}`,\r\n      [SK]: nextToken,\r\n    };\r\n  }\r\n\r\n  const res = await ddb.send(new QueryCommand(queryInput));\r\n  let items = (res.Items ?? []).filter((it) => it.type === \"ASSET\");\r\n\r\n  // In-memory filters\r\n  if (folderId !== undefined && folderId !== null) {\r\n    items = items.filter((it) => it.folderId === folderId);\r\n  }\r\n  if (category) {\r\n    items = items.filter((it) => it.category === category);\r\n  }\r\n  if (tag) {\r\n    items = items.filter(\r\n      (it) => Array.isArray(it.tags) && it.tags.includes(tag),\r\n    );\r\n  }\r\n  if (search) {\r\n    const q = String(search).toLowerCase();\r\n    items = items.filter((it) => {\r\n      const title = (it.title ?? \"\").toLowerCase();\r\n      const notes = (it.notes ?? \"\").toLowerCase();\r\n      return title.includes(q) || notes.includes(q);\r\n    });\r\n  }\r\n\r\n  const connectionNextToken = res.LastEvaluatedKey\r\n    ? res.LastEvaluatedKey[SK]\r\n    : null;\r\n\r\n  return {\r\n    items: items.map(mapAsset),\r\n    nextToken: connectionNextToken,\r\n  };\r\n}\r\n\r\n// Upload flow\r\nasync function createAssetUpload(sub: string, input: any) {\r\n  const {\r\n    cabinetId,\r\n    folderId,\r\n    category,\r\n    title,\r\n    notes,\r\n    tags = [],\r\n    filename,\r\n    contentType,\r\n    kind,\r\n  } = input || {};\r\n\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n  if (!filename) throw new Error(\"filename is required\");\r\n  if (!contentType) throw new Error(\"contentType is required\");\r\n\r\n  // Ensure cabinet exists + belongs to user\r\n  const cabinet = await getCabinet(sub, cabinetId);\r\n  if (!cabinet) {\r\n    throw new Error(\"Cabinet not found\");\r\n  }\r\n\r\n  const assetId = uuid();\r\n  const folderPart = folderId || \"unsorted\";\r\n  const safeName = filename.replace(/[^a-zA-Z0-9._-]/g, \"_\");\r\n\r\n  const s3Key = [\r\n    \"creator-media\",\r\n    sub,\r\n    cabinetId,\r\n    folderPart,\r\n    `${assetId}-${safeName}`,\r\n  ].join(\"/\");\r\n\r\n  const nowIso = now();\r\n\r\n  const normalizedKind =\r\n    kind === \"PHOTO\" || kind === \"VIDEO\" ? kind : \"OTHER\";\r\n\r\n  // 1) create ASSET row in Dynamo (pending upload)\r\n  await ddb.send(\r\n    new PutCommand({\r\n      TableName: TABLE_NAME,\r\n      Item: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: `ASSET#${assetId}`,\r\n        type: \"ASSET\",\r\n        id: assetId,\r\n        cabinetId,\r\n        folderId: folderId ?? null,\r\n        ownerSub: sub,\r\n        kind: normalizedKind,\r\n        category: category ?? null,\r\n        title: title ?? null,\r\n        notes: notes ?? null,\r\n        tags,\r\n        s3Key,\r\n        contentType,\r\n        createdAt: nowIso,\r\n        updatedAt: nowIso,\r\n      },\r\n    }),\r\n  );\r\n\r\n  // Best-effort: bump cabinet.assetCount\r\n  await ddb.send(\r\n    new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: \"META\",\r\n      },\r\n      UpdateExpression:\r\n        \"SET #assetCount = if_not_exists(#assetCount, :zero) + :one, #updatedAt = :updatedAt\",\r\n      ExpressionAttributeNames: {\r\n        \"#assetCount\": \"assetCount\",\r\n        \"#updatedAt\": \"updatedAt\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":zero\": 0,\r\n        \":one\": 1,\r\n        \":updatedAt\": nowIso,\r\n      },\r\n    }),\r\n  );\r\n\r\n  // 2) make a presigned URL so the browser can PUT the file\r\n  const putCmd = new PutObjectCommand({\r\n    Bucket: CREATOR_MEDIA_BUCKET,\r\n    Key: s3Key,\r\n    ContentType: contentType,\r\n  });\r\n\r\n  const uploadUrl = await getSignedUrl(s3, putCmd, {\r\n    expiresIn: 900,\r\n  });\r\n\r\n  return {\r\n    uploadUrl,\r\n    asset: {\r\n      id: assetId,\r\n      cabinetId,\r\n      folderId,\r\n      ownerSub: sub,\r\n      kind: normalizedKind,\r\n      category,\r\n      title,\r\n      notes,\r\n      tags,\r\n      s3Key,\r\n      contentType,\r\n      createdAt: nowIso,\r\n      updatedAt: nowIso,\r\n    },\r\n  };\r\n}\r\n\r\nasync function updateAsset(sub: string, input: any) {\r\n  const { id, cabinetId } = input || {};\r\n  if (!id) throw new Error(\"id is required\");\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n\r\n  const nowIso = now();\r\n\r\n  const names: Record<string, string> = {\r\n    \"#updatedAt\": \"updatedAt\",\r\n    \"#ownerSub\": \"ownerSub\",\r\n  };\r\n  const values: Record<string, any> = {\r\n    \":updatedAt\": nowIso,\r\n    \":ownerSub\": sub,\r\n  };\r\n  const sets: string[] = [\"#updatedAt = :updatedAt\"];\r\n\r\n  if (Object.prototype.hasOwnProperty.call(input, \"folderId\")) {\r\n    names[\"#folderId\"] = \"folderId\";\r\n    values[\":folderId\"] = input.folderId ?? null;\r\n    sets.push(\"#folderId = :folderId\");\r\n  }\r\n  if (Object.prototype.hasOwnProperty.call(input, \"category\")) {\r\n    names[\"#category\"] = \"category\";\r\n    values[\":category\"] = input.category ?? null;\r\n    sets.push(\"#category = :category\");\r\n  }\r\n  if (Object.prototype.hasOwnProperty.call(input, \"title\")) {\r\n    names[\"#title\"] = \"title\";\r\n    values[\":title\"] = input.title ?? null;\r\n    sets.push(\"#title = :title\");\r\n  }\r\n  if (Object.prototype.hasOwnProperty.call(input, \"notes\")) {\r\n    names[\"#notes\"] = \"notes\";\r\n    values[\":notes\"] = input.notes ?? null;\r\n    sets.push(\"#notes = :notes\");\r\n  }\r\n  if (Object.prototype.hasOwnProperty.call(input, \"tags\")) {\r\n    names[\"#tags\"] = \"tags\";\r\n    values[\":tags\"] = input.tags ?? [];\r\n    sets.push(\"#tags = :tags\");\r\n  }\r\n\r\n  const res = await ddb.send(\r\n    new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: `ASSET#${id}`,\r\n      },\r\n      UpdateExpression: \"SET \" + sets.join(\", \"),\r\n      ConditionExpression: \"#ownerSub = :ownerSub\",\r\n      ExpressionAttributeNames: names,\r\n      ExpressionAttributeValues: values,\r\n      ReturnValues: \"ALL_NEW\",\r\n    }),\r\n  );\r\n\r\n  return mapAsset(res.Attributes);\r\n}\r\n\r\nasync function deleteAsset(\r\n  sub: string,\r\n  id: string,\r\n  cabinetId: string,\r\n) {\r\n  if (!id) throw new Error(\"id is required\");\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n\r\n  const nowIso = now();\r\n\r\n  // 1) Delete the asset row with ownership check\r\n  await ddb.send(\r\n    new DeleteCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: `ASSET#${id}`,\r\n      },\r\n      ConditionExpression: \"#ownerSub = :ownerSub\",\r\n      ExpressionAttributeNames: {\r\n        \"#ownerSub\": \"ownerSub\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":ownerSub\": sub,\r\n      },\r\n    }),\r\n  );\r\n\r\n  // 2) Best-effort: decrement assetCount\r\n  await ddb.send(\r\n    new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: \"META\",\r\n      },\r\n      UpdateExpression:\r\n        \"SET #assetCount = if_not_exists(#assetCount, :zero) - :one, #updatedAt = :updatedAt\",\r\n      ExpressionAttributeNames: {\r\n        \"#assetCount\": \"assetCount\",\r\n        \"#updatedAt\": \"updatedAt\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":zero\": 0,\r\n        \":one\": 1,\r\n        \":updatedAt\": nowIso,\r\n      },\r\n    }),\r\n  );\r\n\r\n  return true;\r\n}\r\n\r\nasync function moveAsset(sub: string, input: any) {\r\n  const { id, cabinetId, destinationFolderId } = input || {};\r\n  if (!id) throw new Error(\"id is required\");\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n\r\n  const nowIso = now();\r\n\r\n  const res = await ddb.send(\r\n    new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: `ASSET#${id}`,\r\n      },\r\n      UpdateExpression:\r\n        \"SET #folderId = :folderId, #updatedAt = :updatedAt\",\r\n      ConditionExpression: \"#ownerSub = :ownerSub\",\r\n      ExpressionAttributeNames: {\r\n        \"#folderId\": \"folderId\",\r\n        \"#updatedAt\": \"updatedAt\",\r\n        \"#ownerSub\": \"ownerSub\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":folderId\": destinationFolderId ?? null,\r\n        \":updatedAt\": nowIso,\r\n        \":ownerSub\": sub,\r\n      },\r\n      ReturnValues: \"ALL_NEW\",\r\n    }),\r\n  );\r\n\r\n  return mapAsset(res.Attributes);\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// AI \u2013 simple stub (safe until you wire Bedrock)\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function runCreatorAi(event: any) {\r\n  const text: string = event.arguments?.text ?? \"\";\r\n  const kind: string = event.arguments?.kind ?? \"OTHER\";\r\n\r\n  const base = text || \"your content\";\r\n\r\n  const suggestions: string[] = [];\r\n\r\n  if (kind === \"CAPTION\") {\r\n    suggestions.push(\r\n      `Behind the scenes of ${base} \u2728`,\r\n      `Styling ${base} so you don't have to \uD83D\uDC85`,\r\n    );\r\n  } else if (kind === \"HASHTAGS\") {\r\n    suggestions.push(\r\n      \"#stylingadventures #creatorlife #behindthescenes\",\r\n      \"#outfitinspo #contentcreator #filmingday\",\r\n    );\r\n  } else {\r\n    suggestions.push(`Planning ideas for ${base}`);\r\n  }\r\n\r\n  return { suggestions };\r\n}\r\n", "import validate from './validate.js';\nconst byteToHex = [];\nfor (let i = 0; i < 256; ++i) {\n    byteToHex.push((i + 0x100).toString(16).slice(1));\n}\nexport function unsafeStringify(arr, offset = 0) {\n    return (byteToHex[arr[offset + 0]] +\n        byteToHex[arr[offset + 1]] +\n        byteToHex[arr[offset + 2]] +\n        byteToHex[arr[offset + 3]] +\n        '-' +\n        byteToHex[arr[offset + 4]] +\n        byteToHex[arr[offset + 5]] +\n        '-' +\n        byteToHex[arr[offset + 6]] +\n        byteToHex[arr[offset + 7]] +\n        '-' +\n        byteToHex[arr[offset + 8]] +\n        byteToHex[arr[offset + 9]] +\n        '-' +\n        byteToHex[arr[offset + 10]] +\n        byteToHex[arr[offset + 11]] +\n        byteToHex[arr[offset + 12]] +\n        byteToHex[arr[offset + 13]] +\n        byteToHex[arr[offset + 14]] +\n        byteToHex[arr[offset + 15]]).toLowerCase();\n}\nfunction stringify(arr, offset = 0) {\n    const uuid = unsafeStringify(arr, offset);\n    if (!validate(uuid)) {\n        throw TypeError('Stringified UUID is invalid');\n    }\n    return uuid;\n}\nexport default stringify;\n", "import { randomFillSync } from 'crypto';\nconst rnds8Pool = new Uint8Array(256);\nlet poolPtr = rnds8Pool.length;\nexport default function rng() {\n    if (poolPtr > rnds8Pool.length - 16) {\n        randomFillSync(rnds8Pool);\n        poolPtr = 0;\n    }\n    return rnds8Pool.slice(poolPtr, (poolPtr += 16));\n}\n", "import { randomUUID } from 'crypto';\nexport default { randomUUID };\n", "import native from './native.js';\nimport rng from './rng.js';\nimport { unsafeStringify } from './stringify.js';\nfunction v4(options, buf, offset) {\n    if (native.randomUUID && !buf && !options) {\n        return native.randomUUID();\n    }\n    options = options || {};\n    const rnds = options.random ?? options.rng?.() ?? rng();\n    if (rnds.length < 16) {\n        throw new Error('Random bytes length must be >= 16');\n    }\n    rnds[6] = (rnds[6] & 0x0f) | 0x40;\n    rnds[8] = (rnds[8] & 0x3f) | 0x80;\n    if (buf) {\n        offset = offset || 0;\n        if (offset < 0 || offset + 16 > buf.length) {\n            throw new RangeError(`UUID byte range ${offset}:${offset + 15} is out of buffer bounds`);\n        }\n        for (let i = 0; i < 16; ++i) {\n            buf[offset + i] = rnds[i];\n        }\n        return buf;\n    }\n    return unsafeStringify(rnds);\n}\nexport default v4;\n"],
  "mappings": "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",
  "names": ["index_exports", "__export", "handler", "__toCommonJS", "import_client_dynamodb", "import_lib_dynamodb", "byteToHex", "i", "unsafeStringify", "arr", "offset", "import_crypto", "rnds8Pool", "poolPtr", "rng", "import_crypto", "native_default", "v4", "options", "buf", "offset", "native_default", "rnds", "rng", "i", "unsafeStringify", "v4_default", "import_client_s3", "import_s3_request_presigner", "ddb", "s3", "TABLE_NAME", "CREATOR_MEDIA_BUCKET", "PK", "SK", "STATUS_GSI", "now", "handler", "event", "field", "sub", "listCabinets", "getCabinet", "createCabinet", "updateCabinet", "deleteCabinet", "listFolders", "createFolder", "renameFolder", "deleteFolder", "listAssets", "createAssetUpload", "updateAsset", "deleteAsset", "moveAsset", "runCreatorAi", "mapCabinet", "item", "mapFolder", "mapAsset", "rawKind", "kind", "id", "res", "input", "v4_default", "nowIso", "names", "values", "sets", "pkValue", "items", "meta", "it", "cabinetId", "name", "assets", "asset", "args", "folderId", "category", "tag", "search", "limit", "nextToken", "queryInput", "q", "title", "notes", "connectionNextToken", "tags", "filename", "contentType", "assetId", "folderPart", "safeName", "s3Key", "normalizedKind", "putCmd", "destinationFolderId", "text", "base", "suggestions"]
}
