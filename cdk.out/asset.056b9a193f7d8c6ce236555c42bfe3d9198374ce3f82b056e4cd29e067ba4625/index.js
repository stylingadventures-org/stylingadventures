"use strict";var a=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var f=Object.getOwnPropertyNames;var w=Object.prototype.hasOwnProperty;var g=(e,s)=>{for(var n in s)a(e,n,{get:s[n],enumerable:!0})},E=(e,s,n,t)=>{if(s&&typeof s=="object"||typeof s=="function")for(let r of f(s))!w.call(e,r)&&r!==n&&a(e,r,{get:()=>s[r],enumerable:!(t=d(s,r))||t.enumerable});return e};var S=e=>E(a({},"__esModule",{value:!0}),e);var R={};g(R,{handler:()=>B});module.exports=S(R);var o=require("@aws-sdk/client-cognito-identity-provider"),y=process.env.USER_POOL_ID,b=process.env.AWS_REGION||"us-east-1",v=new o.CognitoIdentityProviderClient({region:b});function u(){return new Date().toISOString()}async function l(e){return{active:!0,since:u(),until:null,source:"TRIAL"}}async function I(e,s){let n=s!=="ep-1"?!0:(await l(e)).active;return{allowed:n,reason:n?null:"BESTIE_REQUIRED"}}async function p(e){return{active:!0,since:u(),until:null,source:"TRIAL"}}async function i(e,s,n){return{active:n,since:u(),until:null,source:"ADMIN"}}async function c(e){let s=new o.ListUsersCommand({UserPoolId:y,Filter:`email = "${e}"`,Limit:1}),t=((await v.send(s)).Users||[])[0];return t&&(t.Attributes||[]).find(m=>m.Name==="sub")?.Value||null}var B=async e=>{let s=e.info.fieldName;switch(s){case"meBestieStatus":return l(e);case"isEpisodeEarlyAccess":{let n=e.arguments.id;if(!n)throw new Error("Missing id");return I(e,n)}case"claimBestieTrial":return p(e);case"adminSetBestie":{let{userSub:n,active:t}=e.arguments;if(!n)throw new Error("Missing userSub");return i(e,n,!!t)}case"adminRevokeBestie":{let{userSub:n}=e.arguments;if(!n)throw new Error("Missing userSub");return i(e,n,!1)}case"adminSetBestieByEmail":{let{email:n,active:t}=e.arguments,r=await c(n);if(!r)throw new Error("User does not exist.");return i(e,r,!!t)}case"adminRevokeBestieByEmail":{let{email:n}=e.arguments,t=await c(n);if(!t)throw new Error("User does not exist.");return i(e,t,!1)}default:throw new Error(`Unknown field ${s}`)}};0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
