"use strict";var l=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var b=Object.getOwnPropertyNames;var p=Object.prototype.hasOwnProperty;var w=(a,n)=>{for(var e in n)l(a,e,{get:n[e],enumerable:!0})},A=(a,n,e,s)=>{if(n&&typeof n=="object"||typeof n=="function")for(let t of b(n))!p.call(a,t)&&t!==e&&l(a,t,{get:()=>n[t],enumerable:!(s=E(n,t))||s.enumerable});return a};var y=a=>A(l({},"__esModule",{value:!0}),a);var G={};w(G,{handler:()=>N});module.exports=y(G);var r=require("@aws-sdk/client-dynamodb"),o=require("@aws-sdk/util-dynamodb"),u=new r.DynamoDBClient({}),d=process.env.TABLE_NAME,g=process.env.ADMIN_GROUP_NAME||"ADMIN",m="SETTINGS",c="GLOBAL",i={animationsEnabled:!0,soundsEnabled:!0,autoBadgeGrant:!0,badgeRules:[]};function f(a){let n=a.identity?.claims||{},e=n["cognito:groups"]??n["custom:groups"]??a.identity?.groups??[],s=Array.isArray(e)?e:typeof e=="string"?e.split(","):[];return s.includes(g)||s.includes(g.toLowerCase())}var N=async a=>{if(!a.identity?.sub)throw new Error("Unauthorized");if(!f(a))throw new Error("Forbidden: admin only");if(!d)throw new Error("Missing TABLE_NAME");switch(a.info.fieldName){case"getAdminSettings":{let n=await u.send(new r.GetItemCommand({TableName:d,Key:(0,o.marshall)({pk:m,sk:c})}));if(!n.Item)return i;let e=(0,o.unmarshall)(n.Item);return{animationsEnabled:e.animationsEnabled??i.animationsEnabled,soundsEnabled:e.soundsEnabled??i.soundsEnabled,autoBadgeGrant:e.autoBadgeGrant??i.autoBadgeGrant,badgeRules:e.badgeRules??i.badgeRules}}case"updateAdminSettings":{let n=a.arguments.input||{},e=await u.send(new r.GetItemCommand({TableName:d,Key:(0,o.marshall)({pk:m,sk:c})})),s=e.Item?(0,o.unmarshall)(e.Item):{},t={...i,...s,...n};return await u.send(new r.PutItemCommand({TableName:d,Item:(0,o.marshall)({pk:m,sk:c,...t})})),{animationsEnabled:t.animationsEnabled,soundsEnabled:t.soundsEnabled,autoBadgeGrant:t.autoBadgeGrant,badgeRules:t.badgeRules??[]}}default:throw new Error("Unknown field: "+a.info.fieldName)}};0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
