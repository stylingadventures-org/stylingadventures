"use strict";var l=Object.defineProperty;var f=Object.getOwnPropertyDescriptor;var g=Object.getOwnPropertyNames;var E=Object.prototype.hasOwnProperty;var y=(e,t)=>{for(var n in t)l(e,n,{get:t[n],enumerable:!0})},A=(e,t,n,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of g(t))!E.call(e,s)&&s!==n&&l(e,s,{get:()=>t[s],enumerable:!(o=f(t,s))||o.enumerable});return e};var D=e=>A(l({},"__esModule",{value:!0}),e);var L={};y(L,{handler:()=>x});module.exports=D(L);var c=require("@aws-sdk/client-dynamodb"),a=require("@aws-sdk/lib-dynamodb"),m=process.env.TABLE_NAME,r=a.DynamoDBDocumentClient.from(new c.DynamoDBClient({}),{marshallOptions:{removeUndefinedValues:!0}}),x=async e=>{let n=`USER#${e.identity?.sub}`,o="PROFILE",d=(await r.send(new a.GetCommand({TableName:m,Key:{pk:n,sk:o}}))).Item||{pk:n,sk:o,xp:0,coins:0,level:1,badges:[]};if(e.info.fieldName==="getMyProfile")return u(d);if(e.info.fieldName==="grantBadge"){let{userId:p,badge:i}=e.arguments,b=await r.send(new a.UpdateCommand({TableName:m,Key:{pk:`USER#${p}`,sk:"PROFILE"},UpdateExpression:"ADD badges :b",ExpressionAttributeValues:{":b":r.createSet?r.createSet([i]):[i]},ReturnValues:"ALL_NEW"}));return u(b.Attributes||d)}};function u(e){return{userId:String(e.pk||"").replace("USER#",""),level:e.level??1,xp:e.xp??0,coins:e.coins??0,badges:Array.isArray(e.badges)?e.badges:[],lastEventAt:e.lastEventAt||null}}0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
