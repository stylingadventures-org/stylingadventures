"use strict";var c=Object.defineProperty;var f=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var A=Object.prototype.hasOwnProperty;var O=(e,n)=>{for(var t in n)c(e,t,{get:n[t],enumerable:!0})},m=(e,n,t,r)=>{if(n&&typeof n=="object"||typeof n=="function")for(let s of h(n))!A.call(e,s)&&s!==t&&c(e,s,{get:()=>n[s],enumerable:!(r=f(n,s))||r.enumerable});return e};var p=e=>m(c({},"__esModule",{value:!0}),e);var T={};O(T,{handler:()=>w});module.exports=p(T);var o=require("@aws-sdk/client-s3"),C=new o.S3Client({region:process.env.AWS_REGION||"us-east-1",forcePathStyle:!0}),I=process.env.BUCKET,g=String(process.env.ALLOWED_ORIGINS||"").split(",").map(e=>e.trim()).filter(Boolean),x=process.env.WEB_ORIGIN||process.env.ORIGIN||"";function d(e){let n=e.headers?.origin||e.headers?.Origin||e.headers?.["x-origin"]||"";return g.length>0?g.includes(n)?n:void 0:x||void 0}function i(e){let n={"Content-Type":"application/json","Access-Control-Allow-Headers":"Authorization,Content-Type,X-Amz-Date,X-Api-Key,X-Amz-Security-Token","Access-Control-Allow-Methods":"GET,OPTIONS","Access-Control-Allow-Credentials":"true",Vary:"Origin"};return e&&(n["Access-Control-Allow-Origin"]=e),n}function S(e,n,t={}){let r=d(e);return{statusCode:200,headers:{...i(r),...t},body:JSON.stringify(n)}}function P(e,n,t){let r=d(e);return!!(e.headers?.origin||e.headers?.Origin)&&!r?{statusCode:403,headers:i(void 0),body:JSON.stringify({message:"CORS: origin not allowed"})}:{statusCode:n,headers:i(r),body:JSON.stringify({message:t})}}function E(e){return e.httpMethod??e.requestContext?.http?.method??"GET"}function R(e){return e.requestContext?.authorizer?.claims??e.requestContext?.authorizer?.jwt?.claims??{}}var w=async e=>{if(E(e)==="OPTIONS"){let n=d(e);return!n&&(e.headers?.origin||e.headers?.Origin)?{statusCode:403,headers:i(void 0),body:""}:{statusCode:204,headers:i(n),body:""}}try{let t=R(e)?.sub,r=(e?.queryStringParameters?.prefix??"").replace(/\.\./g,"").replace(/^[/\\]+/,""),l=`${t?`users/${t}/`:""}${r}`,a=await C.send(new o.ListObjectsV2Command({Bucket:I,Prefix:l||void 0,MaxKeys:1e3})),y=(a.Contents??[]).map(u=>({key:u.Key,size:u.Size,lastModified:u.LastModified?.toISOString?.()??null}));return S(e,{prefix:l,items:y,isTruncated:!!a.IsTruncated,nextToken:a.NextContinuationToken??null})}catch(n){return console.error(n),P(e,500,n?.message??String(n))}};0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
