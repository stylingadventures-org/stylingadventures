{
  "version": 3,
  "sources": ["../../lambda/game/leaderboard.ts"],
  "sourcesContent": ["import { DynamoDBClient } from \"@aws-sdk/client-dynamodb\";\r\nimport { DynamoDBDocumentClient, QueryCommand } from \"@aws-sdk/lib-dynamodb\";\r\n\r\nconst ddb = DynamoDBDocumentClient.from(new DynamoDBClient({}));\r\nconst TABLE = process.env.TABLE_NAME!;\r\n\r\nexport const handler = async (event: any) => {\r\n  const { fieldName } = event.info;\r\n  const { limit = 10, season = \"GLOBAL\" } = event.arguments || {};\r\n\r\n  if (fieldName === \"topXP\" || fieldName === \"topCoins\") {\r\n    const pk = `LEADERBOARD#${season}`;\r\n    const resp = await ddb.send(new QueryCommand({\r\n      TableName: TABLE,\r\n      IndexName: \"gsi1\",                                 // \u2705 lowercase\r\n      KeyConditionExpression: \"gsi1pk = :p AND begins_with(gsi1sk, :xp)\",\r\n      ExpressionAttributeValues: { \":p\": pk, \":xp\": \"XP#\" },\r\n      ScanIndexForward: false,                           // highest first\r\n      Limit: Math.min(100, limit),\r\n    }));\r\n\r\n    let rank = 1;\r\n    return (resp.Items ?? []).map(i => ({\r\n      userId: (i.pk as string).replace(\"USER#\",\"\"),\r\n      displayName: i.displayName ?? undefined,\r\n      xp: i.xp ?? null,\r\n      coins: i.coins ?? null,\r\n      rank: rank++,\r\n    }));\r\n  }\r\n\r\n  throw new Error(`Unknown field ${fieldName}`);\r\n};\r\n"],
  "mappings": "yaAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,aAAAE,IAAA,eAAAC,EAAAH,GAAA,IAAAI,EAA+B,oCAC/BC,EAAqD,iCAE/CC,EAAM,yBAAuB,KAAK,IAAI,iBAAe,CAAC,CAAC,CAAC,EACxDC,EAAQ,QAAQ,IAAI,WAEbL,EAAU,MAAOM,GAAe,CAC3C,GAAM,CAAE,UAAAC,CAAU,EAAID,EAAM,KACtB,CAAE,MAAAE,EAAQ,GAAI,OAAAC,EAAS,QAAS,EAAIH,EAAM,WAAa,CAAC,EAE9D,GAAIC,IAAc,SAAWA,IAAc,WAAY,CACrD,IAAMG,EAAK,eAAeD,CAAM,GAC1BE,EAAO,MAAMP,EAAI,KAAK,IAAI,eAAa,CAC3C,UAAWC,EACX,UAAW,OACX,uBAAwB,2CACxB,0BAA2B,CAAE,KAAMK,EAAI,MAAO,KAAM,EACpD,iBAAkB,GAClB,MAAO,KAAK,IAAI,IAAKF,CAAK,CAC5B,CAAC,CAAC,EAEEI,EAAO,EACX,OAAQD,EAAK,OAAS,CAAC,GAAG,IAAIE,IAAM,CAClC,OAASA,EAAE,GAAc,QAAQ,QAAQ,EAAE,EAC3C,YAAaA,EAAE,aAAe,OAC9B,GAAIA,EAAE,IAAM,KACZ,MAAOA,EAAE,OAAS,KAClB,KAAMD,GACR,EAAE,CACJ,CAEA,MAAM,IAAI,MAAM,iBAAiBL,CAAS,EAAE,CAC9C",
  "names": ["leaderboard_exports", "__export", "handler", "__toCommonJS", "import_client_dynamodb", "import_lib_dynamodb", "ddb", "TABLE", "event", "fieldName", "limit", "season", "pk", "resp", "rank", "i"]
}
