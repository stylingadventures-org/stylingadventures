{
  "version": 3,
  "sources": ["../../lambda/game/leaderboard.ts", "../../lambda/_shared/env.ts"],
  "sourcesContent": ["import { DynamoDBClient } from \"@aws-sdk/client-dynamodb\";\r\nimport { DynamoDBDocumentClient, QueryCommand } from \"@aws-sdk/lib-dynamodb\";\r\nimport { TABLE_NAME } from \"../_shared/env\";\r\n\r\nconst ddb = DynamoDBDocumentClient.from(new DynamoDBClient({}));\r\n\r\nexport const handler = async (event: any) => {\r\n  const { fieldName } = event.info;\r\n  const { limit = 10, season = \"GLOBAL\" } = event.arguments || {};\r\n\r\n  if (fieldName === \"topXP\" || fieldName === \"topCoins\") {\r\n    const pk = `LEADERBOARD#${season}`;\r\n    const resp = await ddb.send(new QueryCommand({\r\n      TableName: TABLE_NAME,\r\n      IndexName: \"gsi1\",                                 // \u2705 lowercase\r\n      KeyConditionExpression: \"gsi1pk = :p AND begins_with(gsi1sk, :xp)\",\r\n      ExpressionAttributeValues: { \":p\": pk, \":xp\": \"XP#\" },\r\n      ScanIndexForward: false,                           // highest first\r\n      Limit: Math.min(100, limit),\r\n    }));\r\n\r\n    let rank = 1;\r\n    return (resp.Items ?? []).map(i => ({\r\n      userId: (i.pk as string).replace(\"USER#\",\"\"),\r\n      displayName: i.displayName ?? undefined,\r\n      xp: i.xp ?? null,\r\n      coins: i.coins ?? null,\r\n      rank: rank++,\r\n    }));\r\n  }\r\n\r\n  throw new Error(`Unknown field ${fieldName}`);\r\n};\r\n", "// lambda/_shared/env.ts\r\nexport const TABLE_NAME =\r\n  process.env.TABLE_NAME ??\r\n  process.env.APP_TABLE ??\r\n  process.env.TABLE ??\r\n  \"\";\r\n\r\nif (!TABLE_NAME) {\r\n  // Fail fast at cold start so you notice during deploy/tests\r\n  throw new Error(\r\n    \"Missing DynamoDB table env. Provide TABLE_NAME (or APP_TABLE / TABLE).\"\r\n  );\r\n}\r\n"],
  "mappings": "yaAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,aAAAE,IAAA,eAAAC,EAAAH,GAAA,IAAAI,EAA+B,oCAC/BC,EAAqD,iCCA9C,IAAMC,EACX,QAAQ,IAAI,YACZ,QAAQ,IAAI,WACZ,QAAQ,IAAI,OACZ,GAEF,GAAI,CAACA,EAEH,MAAM,IAAI,MACR,wEACF,EDPF,IAAMC,EAAM,yBAAuB,KAAK,IAAI,iBAAe,CAAC,CAAC,CAAC,EAEjDC,EAAU,MAAOC,GAAe,CAC3C,GAAM,CAAE,UAAAC,CAAU,EAAID,EAAM,KACtB,CAAE,MAAAE,EAAQ,GAAI,OAAAC,EAAS,QAAS,EAAIH,EAAM,WAAa,CAAC,EAE9D,GAAIC,IAAc,SAAWA,IAAc,WAAY,CACrD,IAAMG,EAAK,eAAeD,CAAM,GAC1BE,EAAO,MAAMP,EAAI,KAAK,IAAI,eAAa,CAC3C,UAAWQ,EACX,UAAW,OACX,uBAAwB,2CACxB,0BAA2B,CAAE,KAAMF,EAAI,MAAO,KAAM,EACpD,iBAAkB,GAClB,MAAO,KAAK,IAAI,IAAKF,CAAK,CAC5B,CAAC,CAAC,EAEEK,EAAO,EACX,OAAQF,EAAK,OAAS,CAAC,GAAG,IAAI,IAAM,CAClC,OAAS,EAAE,GAAc,QAAQ,QAAQ,EAAE,EAC3C,YAAa,EAAE,aAAe,OAC9B,GAAI,EAAE,IAAM,KACZ,MAAO,EAAE,OAAS,KAClB,KAAME,GACR,EAAE,CACJ,CAEA,MAAM,IAAI,MAAM,iBAAiBN,CAAS,EAAE,CAC9C",
  "names": ["leaderboard_exports", "__export", "handler", "__toCommonJS", "import_client_dynamodb", "import_lib_dynamodb", "TABLE_NAME", "ddb", "handler", "event", "fieldName", "limit", "season", "pk", "resp", "TABLE_NAME", "rank"]
}
