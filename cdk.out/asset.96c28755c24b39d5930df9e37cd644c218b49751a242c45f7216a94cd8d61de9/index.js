"use strict";var n=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var c=Object.getOwnPropertyNames;var h=Object.prototype.hasOwnProperty;var r=(o,e)=>{for(var s in e)n(o,s,{get:e[s],enumerable:!0})},p=(o,e,s,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let t of c(e))!h.call(o,t)&&t!==s&&n(o,t,{get:()=>e[t],enumerable:!(i=d(e,t))||i.enumerable});return o};var f=o=>p(n({},"__esModule",{value:!0}),o);var k={};r(k,{handler:()=>N});module.exports=f(k);function a(o,e,s,i){return{code:o,severity:e,message:s,path:i}}function y(o,e){!o.episodeId&&!o.slug&&e.push(a("MISSING_EPISODE_ID","ERROR","Episode must have an 'episodeId' or 'slug'."))}function E(o,e){!o.title||!o.title.trim()?e.push(a("MISSING_TITLE","ERROR","Episode must have a title.","title")):o.title.length>140&&e.push(a("TITLE_TOO_LONG","WARNING","Episode title is quite long (over 140 chars).","title"))}function I(o,e){let s=o.components??[];if(!Array.isArray(s)||s.length===0){e.push(a("NO_COMPONENTS","ERROR","Episode must contain at least one component.","components"));return}s.forEach((i,t)=>{i.kind||e.push(a("COMPONENT_KIND_MISSING","ERROR",`Component at index ${t} is missing 'kind'.`,`components[${t}]`)),i.id||e.push(a("COMPONENT_ID_MISSING","WARNING",`Component at index ${t} is missing 'id'.`,`components[${t}]`))})}function C(o){let e=o.components??[],s=i=>e.some(t=>typeof t.kind=="string"&&t.kind===i);return{hasInvite:s("invite"),hasEnvelope:s("envelope"),hasCloset:s("closet"),hasOutfit:s("outfit"),hasDialogue:s("dialogue"),hasSideQuests:s("side-quest")||s("sideQuest")||s("side_quest"),hasCoinsConfig:s("coins")||s("coin-config")||s("rewards"),hasLocations:s("location")||s("locations"),hasPhotoshoots:s("photoshoot")||s("photoshoots")}}function m(o,e){o.hasInvite||e.push(a("NO_INVITE","WARNING","No 'invite' component found \u2013 consider adding an entry hook.")),o.hasDialogue||e.push(a("NO_DIALOGUE","WARNING","No 'dialogue' components found \u2013 episode may feel silent.")),o.hasCoinsConfig||e.push(a("NO_COINS_CONFIG","INFO","No coins / rewards configuration found; gig may not reward XP/coins."))}function g(o,e,s){let i=o.layoutChecklist;return i?(i.passed||s.push(a("LAYOUT_CHECKLIST_FAILED",e?"ERROR":"WARNING","Layout checklist did not pass all rules.","layoutChecklist")),Array.isArray(i.issues)&&i.issues.forEach(t=>s.push(a(`LAYOUT_${t.code??"ISSUE"}`,t.severity??"WARNING",t.message??"Layout checklist issue.",t.path))),{hasLayoutChecklist:!0,layoutChecklistPassed:!!i.passed}):(e?s.push(a("MISSING_LAYOUT_CHECKLIST","ERROR","Layout checklist is required but was not provided.","layoutChecklist")):s.push(a("MISSING_LAYOUT_CHECKLIST","WARNING","No layoutChecklist present; episode will skip layout safety checks.","layoutChecklist")),{hasLayoutChecklist:!1,layoutChecklistPassed:null})}var N=async o=>{console.log("ValidateEpisode incoming event:",JSON.stringify(o,null,2));let e=[];if(!o||!o.episode)return e.push(a("MISSING_EPISODE","ERROR","ValidateEpisode requires 'episode' in the payload.")),{ok:!1,issues:e,episode:o?.episode??{},summary:{hasInvite:!1,hasEnvelope:!1,hasCloset:!1,hasOutfit:!1,hasDialogue:!1,hasSideQuests:!1,hasCoinsConfig:!1,hasLocations:!1,hasPhotoshoots:!1,hasLayoutChecklist:!1,layoutChecklistPassed:null}};let s={status:"draft",...o.episode};y(s,e),E(s,e),I(s,e);let i=C(s);m(i,e);let t=g(s,o.requireLayoutChecklist,e),l={ok:e.every(u=>u.severity!=="ERROR"),issues:e,episode:s,summary:{...i,hasLayoutChecklist:t.hasLayoutChecklist,layoutChecklistPassed:t.layoutChecklistPassed}};return console.log("ValidateEpisode result:",JSON.stringify(l,null,2)),l};0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
