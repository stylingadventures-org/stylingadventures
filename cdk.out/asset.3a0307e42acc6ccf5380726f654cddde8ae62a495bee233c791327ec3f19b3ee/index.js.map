{
  "version": 3,
  "sources": ["../../lambda/creator/ai.ts"],
  "sourcesContent": ["// lambda/creator/ai.ts\r\nimport { AppSyncIdentityCognito } from \"aws-lambda\";\r\n\r\ntype UserTier = \"FREE\" | \"BESTIE\" | \"CREATOR\" | \"COLLAB\" | \"ADMIN\" | \"PRIME\";\r\n\r\ntype SAIdentity =\r\n  | (AppSyncIdentityCognito & { groups?: string[] | null })\r\n  | null\r\n  | undefined;\r\n\r\n// Prefer explicit token tier claim; fall back to groups if needed.\r\nfunction getUserTier(identity: SAIdentity): UserTier {\r\n  const claims = (identity as any)?.claims || {};\r\n\r\n  const claimTier =\r\n    (claims[\"tier\"] as string | undefined) ??\r\n    (claims[\"custom:tier\"] as string | undefined);\r\n\r\n  const validTiers: UserTier[] = [\r\n    \"FREE\",\r\n    \"BESTIE\",\r\n    \"CREATOR\",\r\n    \"COLLAB\",\r\n    \"ADMIN\",\r\n    \"PRIME\",\r\n  ];\r\n\r\n  if (claimTier && validTiers.includes(claimTier as UserTier)) {\r\n    return claimTier as UserTier;\r\n  }\r\n\r\n  const rawGroups = claims[\"cognito:groups\"];\r\n  const groups = Array.isArray(rawGroups)\r\n    ? rawGroups\r\n    : String(rawGroups || \"\")\r\n        .split(\",\")\r\n        .map((g) => g.trim())\r\n        .filter(Boolean);\r\n\r\n  if (groups.includes(\"ADMIN\")) return \"ADMIN\";\r\n  if (groups.includes(\"PRIME\")) return \"PRIME\";\r\n  if (groups.includes(\"COLLAB\")) return \"COLLAB\";\r\n  if (groups.includes(\"CREATOR\")) return \"CREATOR\";\r\n  if (groups.includes(\"BESTIE\")) return \"BESTIE\";\r\n\r\n  return \"FREE\";\r\n}\r\n\r\nfunction requireCreatorOrHigher(identity: SAIdentity): UserTier {\r\n  const tier = getUserTier(identity);\r\n  if (![\"CREATOR\", \"COLLAB\", \"ADMIN\", \"PRIME\"].includes(tier)) {\r\n    throw new Error(\"Creator tier required\");\r\n  }\r\n  return tier;\r\n}\r\n\r\nexport const handler = async (event: any) => {\r\n  console.log(\"CreatorAiFn event\", JSON.stringify(event));\r\n  const fieldName = event.info?.fieldName as string | undefined;\r\n  const identity: SAIdentity = event.identity;\r\n\r\n  requireCreatorOrHigher(identity);\r\n\r\n  switch (fieldName) {\r\n    case \"creatorAiSuggest\": {\r\n      const { text, kind } = event.arguments || {};\r\n      const safeText = (text as string | undefined) ?? \"\";\r\n\r\n      // Stubbed responses \u2013 we\u2019ll swap this for Bedrock Claude later.\r\n      if (kind === \"CAPTION\") {\r\n        return {\r\n          suggestions: [\r\n            `\u2728 ${safeText || \"New look\"} \u2014 styled by you.`,\r\n            `Outfit check: ${safeText || \"today's fit\"} \u2728`,\r\n          ],\r\n        };\r\n      }\r\n\r\n      if (kind === \"HASHTAGS\") {\r\n        return {\r\n          suggestions: [\"#stylelala\", \"#outfitoftheday\", \"#creatorbestie\"],\r\n        };\r\n      }\r\n\r\n      return {\r\n        suggestions: [\"Try a short, punchy hook + 3 strong hashtags.\"],\r\n      };\r\n    }\r\n\r\n    default:\r\n      throw new Error(`Unsupported field in CreatorAiFn: ${fieldName}`);\r\n  }\r\n};\r\n"],
  "mappings": "yaAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,aAAAE,IAAA,eAAAC,EAAAH,GAWA,SAASI,EAAYC,EAAgC,CACnD,IAAMC,EAAUD,GAAkB,QAAU,CAAC,EAEvCE,EACHD,EAAO,MACPA,EAAO,aAAa,EAWvB,GAAIC,GAT2B,CAC7B,OACA,SACA,UACA,SACA,QACA,OACF,EAE4B,SAASA,CAAqB,EACxD,OAAOA,EAGT,IAAMC,EAAYF,EAAO,gBAAgB,EACnCG,EAAS,MAAM,QAAQD,CAAS,EAClCA,EACA,OAAOA,GAAa,EAAE,EACnB,MAAM,GAAG,EACT,IAAKE,GAAMA,EAAE,KAAK,CAAC,EACnB,OAAO,OAAO,EAErB,OAAID,EAAO,SAAS,OAAO,EAAU,QACjCA,EAAO,SAAS,OAAO,EAAU,QACjCA,EAAO,SAAS,QAAQ,EAAU,SAClCA,EAAO,SAAS,SAAS,EAAU,UACnCA,EAAO,SAAS,QAAQ,EAAU,SAE/B,MACT,CAEA,SAASE,EAAuBN,EAAgC,CAC9D,IAAMO,EAAOR,EAAYC,CAAQ,EACjC,GAAI,CAAC,CAAC,UAAW,SAAU,QAAS,OAAO,EAAE,SAASO,CAAI,EACxD,MAAM,IAAI,MAAM,uBAAuB,EAEzC,OAAOA,CACT,CAEO,IAAMV,EAAU,MAAOW,GAAe,CAC3C,QAAQ,IAAI,oBAAqB,KAAK,UAAUA,CAAK,CAAC,EACtD,IAAMC,EAAYD,EAAM,MAAM,UACxBR,EAAuBQ,EAAM,SAInC,OAFAF,EAAuBN,CAAQ,EAEvBS,EAAW,CACjB,IAAK,mBAAoB,CACvB,GAAM,CAAE,KAAAC,EAAM,KAAAC,CAAK,EAAIH,EAAM,WAAa,CAAC,EACrCI,EAAYF,GAA+B,GAGjD,OAAIC,IAAS,UACJ,CACL,YAAa,CACX,UAAKC,GAAY,UAAU,yBAC3B,iBAAiBA,GAAY,aAAa,SAC5C,CACF,EAGED,IAAS,WACJ,CACL,YAAa,CAAC,aAAc,kBAAmB,gBAAgB,CACjE,EAGK,CACL,YAAa,CAAC,+CAA+C,CAC/D,CACF,CAEA,QACE,MAAM,IAAI,MAAM,qCAAqCF,CAAS,EAAE,CACpE,CACF",
  "names": ["ai_exports", "__export", "handler", "__toCommonJS", "getUserTier", "identity", "claims", "claimTier", "rawGroups", "groups", "g", "requireCreatorOrHigher", "tier", "event", "fieldName", "text", "kind", "safeText"]
}
