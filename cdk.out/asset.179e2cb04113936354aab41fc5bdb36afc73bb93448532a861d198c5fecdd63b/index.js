"use strict";var i=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var l=Object.getOwnPropertyNames;var d=Object.prototype.hasOwnProperty;var p=(e,t)=>{for(var n in t)i(e,n,{get:t[n],enumerable:!0})},g=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of l(t))!d.call(e,a)&&a!==n&&i(e,a,{get:()=>t[a],enumerable:!(r=m(t,a))||r.enumerable});return e};var h=e=>g(i({},"__esModule",{value:!0}),e);var x={};p(x,{handler:()=>P});module.exports=h(x);var o=require("@aws-sdk/client-s3"),f=new o.S3Client({}),c=(process.env.WEB_BUCKET||process.env.BUCKET||"").trim(),w="thumbs/",P=async e=>{try{if((e.requestContext?.http?.method||"").toUpperCase()==="OPTIONS")return{statusCode:204,headers:u(),body:""};if(!c)return s(500,{message:"Missing WEB_BUCKET (or BUCKET) env var"});let n=((e.queryStringParameters||{}).key||"").trim();if(!n||!n.startsWith(w))return s(400,{message:"Missing or invalid 'key' query parameter"});try{let r=await f.send(new o.HeadObjectCommand({Bucket:c,Key:n}));return s(200,{exists:!0,contentLength:r.ContentLength??null,contentType:r.ContentType??null})}catch(r){return r?.$metadata?.httpStatusCode===404||r?.name==="NotFound"?s(404,{exists:!1}):s(502,{message:"S3 head failed",error:y(r)})}}catch(t){return s(500,{message:"Unhandled error",error:y(t)})}};function s(e,t){return{statusCode:e,headers:u(),body:JSON.stringify(t)}}function u(){return{"content-type":"application/json","access-control-allow-origin":"*","access-control-allow-methods":"GET,HEAD,OPTIONS","access-control-allow-headers":"authorization,content-type,x-amz-date,x-api-key,x-amz-security-token","cache-control":"private, max-age=2"}}function y(e){if(typeof e=="string")return e;if(e&&typeof e=="object"&&"message"in e)return String(e.message);try{return JSON.stringify(e)}catch{return"Unknown error"}}0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
