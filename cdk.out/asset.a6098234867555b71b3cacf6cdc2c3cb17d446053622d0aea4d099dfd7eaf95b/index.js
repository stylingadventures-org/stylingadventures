"use strict";var d=Object.defineProperty;var g=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var c=Object.prototype.hasOwnProperty;var y=(t,e)=>{for(var o in e)d(t,o,{get:e[o],enumerable:!0})},b=(t,e,o,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of m(e))!c.call(t,s)&&s!==o&&d(t,s,{get:()=>e[s],enumerable:!(n=g(e,s))||n.enumerable});return t};var E=t=>b(d({},"__esModule",{value:!0}),t);var f={};y(f,{handler:()=>A});module.exports=E(f);var u=require("@aws-sdk/client-dynamodb"),i=require("@aws-sdk/lib-dynamodb"),l=process.env.TABLE_NAME,p=i.DynamoDBDocumentClient.from(new u.DynamoDBClient({}),{marshallOptions:{removeUndefinedValues:!0}}),A=async t=>{let{fieldName:e}=t.info,o=t.identity;if(e==="getMyProfile"){let n=o?.sub;if(!n)throw new Error("Unauthenticated");let a=(await p.send(new i.GetCommand({TableName:l,Key:{pk:`USER#${n}`,sk:"PROFILE"}}))).Item||{pk:`USER#${n}`,sk:"PROFILE",xp:0,coins:0,level:1,badges:[]};return{userId:n,level:a.level??1,xp:a.xp??0,coins:a.coins??0,badges:Array.isArray(a.badges)?a.badges:[],lastEventAt:a.lastEventAt??null}}if(e==="grantBadge"){let{userId:n,badge:s}=t.arguments,r=(await p.send(new i.UpdateCommand({TableName:l,Key:{pk:`USER#${n}`,sk:"PROFILE"},UpdateExpression:"SET badges = list_append(if_not_exists(badges, :empty), :b)",ExpressionAttributeValues:{":empty":[],":b":[s]},ReturnValues:"ALL_NEW"}))).Attributes||{};return{userId:n,level:r.level??1,xp:r.xp??0,coins:r.coins??0,badges:Array.isArray(r.badges)?r.badges:[],lastEventAt:r.lastEventAt??null}}throw new Error("Unknown field")};0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
