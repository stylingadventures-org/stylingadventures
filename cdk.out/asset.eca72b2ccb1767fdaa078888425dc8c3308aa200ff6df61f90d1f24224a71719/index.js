"use strict";var a=Object.defineProperty;var S=Object.getOwnPropertyDescriptor;var c=Object.getOwnPropertyNames;var d=Object.prototype.hasOwnProperty;var g=(s,e)=>{for(var n in e)a(s,n,{get:e[n],enumerable:!0})},m=(s,e,n,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let t of c(e))!d.call(s,t)&&t!==n&&a(s,t,{get:()=>e[t],enumerable:!(o=S(e,t))||o.enumerable});return s};var p=s=>m(a({},"__esModule",{value:!0}),s);var l={};g(l,{handler:()=>k});module.exports=p(l);var i=require("@aws-sdk/client-dynamodb"),E=new i.DynamoDBClient({}),{TABLE_NAME:r=""}=process.env;if(!r)throw new Error("Missing env: TABLE_NAME");var k=async s=>{for(let e of s.Records){if(!e.Sns?.Message)continue;let n;try{n=JSON.parse(e.Sns.Message)}catch{console.warn("Bad SNS message:",e.Sns.Message);continue}let o=n?.token,t=n?.itemId;if(!o||!t){console.warn("Missing token or itemId in SNS message:",n);continue}await E.send(new i.UpdateItemCommand({TableName:r,Key:{pk:{S:`ITEM#${t}`},sk:{S:"META"}},UpdateExpression:"SET approvalToken = :t, updatedAt = :u, gsi2pk = if_not_exists(gsi2pk, :g2), gsi2sk = if_not_exists(gsi2sk, :u)",ExpressionAttributeValues:{":t":{S:o},":u":{S:new Date().toISOString()},":g2":{S:"STATUS#PENDING"}}}))}};0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
