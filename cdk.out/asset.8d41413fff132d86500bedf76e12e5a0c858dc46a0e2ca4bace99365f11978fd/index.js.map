{
  "version": 3,
  "sources": ["../../lambda/game/gameplay.ts", "../../lambda/_shared/env.ts"],
  "sourcesContent": ["// lambda/game/gameplay.ts\r\nimport { DynamoDBClient } from \"@aws-sdk/client-dynamodb\";\r\nimport {\r\n  DynamoDBDocumentClient,\r\n  UpdateCommand,\r\n  PutCommand,\r\n  GetCommand,\r\n  QueryCommand,\r\n} from \"@aws-sdk/lib-dynamodb\";\r\nimport { AppSyncIdentityCognito } from \"aws-lambda\";\r\nimport { TABLE_NAME } from \"../_shared/env\";\r\n\r\nconst ddb = DynamoDBDocumentClient.from(new DynamoDBClient({}), {\r\n  marshallOptions: { removeUndefinedValues: true },\r\n});\r\n\r\n// AppSync sometimes sends groups: null \u2013 accept null|undefined.\r\ntype SAIdentity = (AppSyncIdentityCognito & { groups?: string[] | null }) | null | undefined;\r\n\r\ntype AppSyncEvent = {\r\n  arguments: any;\r\n  info: { fieldName: string };\r\n  identity?: SAIdentity;\r\n};\r\n\r\nfunction isAdmin(id: SAIdentity): boolean {\r\n  const g = (id as any)?.groups;\r\n  return Array.isArray(g) && g.includes(\"ADMIN\");\r\n}\r\nfunction assertSelfOrAdmin(targetUserId: string, identity?: SAIdentity) {\r\n  if (!identity?.sub) throw new Error(\"Unauthenticated\");\r\n  if (!isAdmin(identity) && identity.sub !== targetUserId) throw new Error(\"Forbidden\");\r\n}\r\n\r\n// Accept object or JSON string\r\nfunction coerceMeta(m: unknown): Record<string, any> | null {\r\n  if (m == null) return null;\r\n  if (typeof m === \"string\") {\r\n    try { return JSON.parse(m); } catch { return { raw: m }; }\r\n  }\r\n  return typeof m === \"object\" ? (m as any) : { value: m };\r\n}\r\nfunction levelFromXp(xp: number): number {\r\n  let lvl = 1, need = 100, left = xp;\r\n  while (left >= need) { left -= need; lvl++; need += 50; }\r\n  return lvl;\r\n}\r\nfunction pad(n: number, width = 12) {\r\n  const s = Math.max(0, n | 0).toString();\r\n  return s.padStart(width, \"0\");\r\n}\r\n\r\nexport const handler = async (event: AppSyncEvent) => {\r\n  const { fieldName } = event.info;\r\n  const identity = event.identity;\r\n\r\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n  // PROFILE: read + set display name\r\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n  if (fieldName === \"getMyProfile\") {\r\n    if (!identity?.sub) throw new Error(\"Unauthenticated\");\r\n    const userId = identity.sub;\r\n\r\n    const got = await ddb.send(new GetCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: { pk: `USER#${userId}`, sk: \"PROFILE\" },\r\n    }));\r\n    const xp = Number(got.Item?.xp ?? 0);\r\n    return {\r\n      userId,\r\n      displayName: (got.Item?.displayName as string) || null,\r\n      level: levelFromXp(xp),\r\n      xp,\r\n      coins: Number(got.Item?.coins ?? 0),\r\n      badges: Array.isArray(got.Item?.badges) ? (got.Item!.badges as string[]) : [],\r\n      lastEventAt: got.Item?.lastEventAt ?? null,\r\n    };\r\n  }\r\n\r\n  if (fieldName === \"setDisplayName\") {\r\n    if (!identity?.sub) throw new Error(\"Unauthenticated\");\r\n    const userId = identity.sub;\r\n    const raw = (event.arguments?.displayName as string) || \"\";\r\n    const name = raw.trim().slice(0, 40);\r\n\r\n    const upd = await ddb.send(new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: { pk: `USER#${userId}`, sk: \"PROFILE\" },\r\n      UpdateExpression:\r\n        \"SET displayName = :n, updatedAt = :u, xp = if_not_exists(xp,:z), coins = if_not_exists(coins,:z)\",\r\n      ExpressionAttributeValues: {\r\n        \":n\": name,\r\n        \":u\": new Date().toISOString(),\r\n        \":z\": 0,\r\n      },\r\n      ReturnValues: \"ALL_NEW\",\r\n    }));\r\n    const xp = Number(upd.Attributes?.xp ?? 0);\r\n    return {\r\n      userId,\r\n      displayName: (upd.Attributes?.displayName as string) || null,\r\n      level: levelFromXp(xp),\r\n      xp,\r\n      coins: Number(upd.Attributes?.coins ?? 0),\r\n      badges: Array.isArray(upd.Attributes?.badges) ? (upd.Attributes!.badges as string[]) : [],\r\n      lastEventAt: upd.Attributes?.lastEventAt ?? null,\r\n    };\r\n  }\r\n\r\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n  // GAMEPLAY: log event / award\r\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n  if (fieldName === \"logGameEvent\") {\r\n    if (!identity?.sub) throw new Error(\"Unauthenticated\");\r\n    const userId = identity.sub;\r\n    const nowIso = new Date().toISOString();\r\n\r\n    const input = event.arguments?.input ?? {};\r\n    const evType: string = input.type || \"UNKNOWN\";\r\n    const metadata = coerceMeta(input.metadata);\r\n\r\n    const xpInc =\r\n      evType === \"LEVEL_CLEAR\" ? 50 :\r\n      evType === \"DAILY_LOGIN\" ? 10 :\r\n      evType === \"SHARE\"       ? 5  :\r\n      evType === \"STYLE_IT\"    ? Math.max(1, Math.round((metadata?.score ?? 5) / 5)) :\r\n      1;\r\n\r\n    const coinInc =\r\n      evType === \"LEVEL_CLEAR\" ? 5 :\r\n      evType === \"DAILY_LOGIN\" ? 1 :\r\n      0;\r\n\r\n    const upd = await ddb.send(new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: { pk: `USER#${userId}`, sk: \"PROFILE\" },\r\n      UpdateExpression: `\r\n        SET xp = if_not_exists(xp,:z) + :xi,\r\n            coins = if_not_exists(coins,:z) + :ci,\r\n            lastEventAt = :now\r\n      `.replace(/\\s+/g, \" \"),\r\n      ExpressionAttributeValues: { \":z\": 0, \":xi\": xpInc, \":ci\": coinInc, \":now\": nowIso },\r\n      ReturnValues: \"ALL_NEW\",\r\n    }));\r\n    const xpNow = Number(upd.Attributes?.xp ?? 0);\r\n\r\n    await ddb.send(new PutCommand({\r\n      TableName: TABLE_NAME,\r\n      Item: {\r\n        pk: `USER#${userId}`,\r\n        sk: \"LEADER\",\r\n        gsi1pk: \"LEADERBOARD#GLOBAL\",\r\n        gsi1sk: `XP#${pad(xpNow)}#${userId}`,\r\n        xp: xpNow,\r\n        coins: Number(upd.Attributes?.coins ?? 0),\r\n        updatedAt: nowIso,\r\n        type: \"LEADER\",\r\n      },\r\n    }));\r\n\r\n    await ddb.send(new PutCommand({\r\n      TableName: TABLE_NAME,\r\n      Item: {\r\n        pk: `USER#${userId}`,\r\n        sk: `EVENT#${Date.now()}`,\r\n        type: \"EVENT\",\r\n        evType,\r\n        metadata,\r\n        at: nowIso,\r\n      },\r\n      ConditionExpression: \"attribute_not_exists(pk)\",\r\n    })).catch(() => {});\r\n\r\n    return {\r\n      userId,\r\n      displayName: (upd.Attributes?.displayName as string) || null,\r\n      level: levelFromXp(xpNow),\r\n      xp: xpNow,\r\n      coins: Number(upd.Attributes?.coins ?? 0),\r\n      badges: Array.isArray(upd.Attributes?.badges) ? (upd.Attributes!.badges as string[]) : [],\r\n      lastEventAt: upd.Attributes?.lastEventAt ?? nowIso,\r\n    };\r\n  }\r\n\r\n  if (fieldName === \"awardCoins\") {\r\n    const { userId, coins, xp } = event.arguments.input as { userId: string; coins: number; xp?: number };\r\n    assertSelfOrAdmin(userId, identity);\r\n\r\n    const incCoins = Math.max(0, coins | 0);\r\n    const incXp = Math.max(0, (xp ?? 0) | 0);\r\n\r\n    const upd = await ddb.send(new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: { pk: `USER#${userId}`, sk: \"PROFILE\" },\r\n      UpdateExpression: \"SET coins = if_not_exists(coins,:z) + :c, xp = if_not_exists(xp,:z) + :x\",\r\n      ExpressionAttributeValues: { \":z\": 0, \":c\": incCoins, \":x\": incXp },\r\n      ReturnValues: \"ALL_NEW\",\r\n    }));\r\n    const xpNow = Number(upd.Attributes?.xp ?? 0);\r\n\r\n    await ddb.send(new PutCommand({\r\n      TableName: TABLE_NAME,\r\n      Item: {\r\n        pk: `USER#${userId}`,\r\n        sk: \"LEADER\",\r\n        gsi1pk: \"LEADERBOARD#GLOBAL\",\r\n        gsi1sk: `XP#${pad(xpNow)}#${userId}`,\r\n        xp: xpNow,\r\n        coins: Number(upd.Attributes?.coins ?? 0),\r\n        updatedAt: new Date().toISOString(),\r\n        type: \"LEADER\",\r\n      },\r\n    }));\r\n\r\n    return {\r\n      userId,\r\n      displayName: (upd.Attributes?.displayName as string) || null,\r\n      level: levelFromXp(xpNow),\r\n      xp: xpNow,\r\n      coins: Number(upd.Attributes?.coins ?? 0),\r\n      badges: Array.isArray(upd.Attributes?.badges) ? (upd.Attributes!.badges as string[]) : [],\r\n      lastEventAt: upd.Attributes?.lastEventAt ?? null,\r\n    };\r\n  }\r\n\r\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n  // LEADERBOARD: simple global XP\r\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n  if (fieldName === \"topXP\") {\r\n    const limit = Math.max(1, Math.min(100, Number(event.arguments?.limit ?? 10)));\r\n    const out = await ddb.send(new QueryCommand({\r\n      TableName: TABLE_NAME,\r\n      IndexName: \"gsi1\",\r\n      KeyConditionExpression: \"gsi1pk = :p\",\r\n      ExpressionAttributeValues: { \":p\": \"LEADERBOARD#GLOBAL\" },\r\n      ScanIndexForward: false, // highest XP first\r\n      Limit: limit,\r\n    }));\r\n    const items = out.Items ?? [];\r\n    // Enrich with displayName from profile (best-effort)\r\n    const results = await Promise.all(items.map(async (it, i) => {\r\n      const userId = (it.pk as string).replace(\"USER#\", \"\");\r\n      let displayName: string | undefined;\r\n      try {\r\n        const got = await ddb.send(new GetCommand({\r\n          TableName: TABLE_NAME,\r\n          Key: { pk: `USER#${userId}`, sk: \"PROFILE\" },\r\n          ProjectionExpression: \"displayName\",\r\n        }));\r\n        displayName = got.Item?.displayName as string | undefined;\r\n      } catch {}\r\n      return {\r\n        userId,\r\n        displayName,\r\n        xp: Number(it.xp ?? 0),\r\n        coins: Number(it.coins ?? 0),\r\n        rank: i + 1,\r\n      };\r\n    }));\r\n    return results;\r\n  }\r\n\r\n  throw new Error(`Unknown field ${fieldName}`);\r\n};\r\n", "// lambda/_shared/env.ts\r\nexport const TABLE_NAME =\r\n  process.env.TABLE_NAME ??\r\n  process.env.APP_TABLE ??\r\n  process.env.TABLE ??\r\n  \"\";\r\n\r\nif (!TABLE_NAME) {\r\n  // Fail fast at cold start so you notice during deploy/tests\r\n  throw new Error(\r\n    \"Missing DynamoDB table env. Provide TABLE_NAME (or APP_TABLE / TABLE).\"\r\n  );\r\n}\r\n"],
  "mappings": "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",
  "names": ["gameplay_exports", "__export", "handler", "__toCommonJS", "import_client_dynamodb", "import_lib_dynamodb", "TABLE_NAME", "ddb", "isAdmin", "id", "g", "assertSelfOrAdmin", "targetUserId", "identity", "coerceMeta", "m", "levelFromXp", "xp", "lvl", "need", "left", "pad", "n", "width", "handler", "event", "fieldName", "userId", "got", "TABLE_NAME", "name", "upd", "nowIso", "input", "evType", "metadata", "xpInc", "coinInc", "xpNow", "coins", "incCoins", "incXp", "limit", "items", "it", "i", "displayName"]
}
