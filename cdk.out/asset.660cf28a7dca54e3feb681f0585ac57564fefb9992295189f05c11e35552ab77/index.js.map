{
  "version": 3,
  "sources": ["../../lambda/analytics/ingest.ts"],
  "sourcesContent": ["import { S3Client, PutObjectCommand } from \"@aws-sdk/client-s3\";\r\n\r\nconst s3 = new S3Client({});\r\nconst BUCKET = process.env.ANALYTICS_BUCKET_NAME!;\r\nconst TABLE_NAME = process.env.TABLE_NAME || \"\";\r\n\r\nexport const handler = async (event: any) => {\r\n  console.log(\"AnalyticsIngestFn event\", JSON.stringify(event));\r\n\r\n  const records = Array.isArray(event?.Records)\r\n    ? event.Records\r\n    : [event];\r\n\r\n  const now = new Date();\r\n  const date = now.toISOString().slice(0, 10);\r\n  const key = `events/date=${date}/${now.getTime()}.json`;\r\n\r\n  const body = JSON.stringify(records, null, 2);\r\n\r\n  await s3.send(\r\n    new PutObjectCommand({\r\n      Bucket: BUCKET,\r\n      Key: key,\r\n      Body: body,\r\n      ContentType: \"application/json\",\r\n    }),\r\n  );\r\n\r\n  return { ok: true, bucket: BUCKET, key };\r\n};\r\n"],
  "mappings": "yaAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,aAAAE,IAAA,eAAAC,EAAAH,GAAA,IAAAI,EAA2C,8BAErCC,EAAK,IAAI,WAAS,CAAC,CAAC,EACpBC,EAAS,QAAQ,IAAI,sBACrBC,EAAa,QAAQ,IAAI,YAAc,GAEhCL,EAAU,MAAOM,GAAe,CAC3C,QAAQ,IAAI,0BAA2B,KAAK,UAAUA,CAAK,CAAC,EAE5D,IAAMC,EAAU,MAAM,QAAQD,GAAO,OAAO,EACxCA,EAAM,QACN,CAACA,CAAK,EAEJE,EAAM,IAAI,KAEVC,EAAM,eADCD,EAAI,YAAY,EAAE,MAAM,EAAG,EAAE,CACX,IAAIA,EAAI,QAAQ,CAAC,QAE1CE,EAAO,KAAK,UAAUH,EAAS,KAAM,CAAC,EAE5C,aAAMJ,EAAG,KACP,IAAI,mBAAiB,CACnB,OAAQC,EACR,IAAKK,EACL,KAAMC,EACN,YAAa,kBACf,CAAC,CACH,EAEO,CAAE,GAAI,GAAM,OAAQN,EAAQ,IAAAK,CAAI,CACzC",
  "names": ["ingest_exports", "__export", "handler", "__toCommonJS", "import_client_s3", "s3", "BUCKET", "TABLE_NAME", "event", "records", "now", "key", "body"]
}
