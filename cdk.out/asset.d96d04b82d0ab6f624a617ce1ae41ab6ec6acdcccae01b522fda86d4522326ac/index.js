"use strict";var h=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var P=Object.getOwnPropertyNames;var C=Object.prototype.hasOwnProperty;var f=(e,t)=>{for(var o in t)h(e,o,{get:t[o],enumerable:!0})},O=(e,t,o,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of P(t))!C.call(e,n)&&n!==o&&h(e,n,{get:()=>t[n],enumerable:!(r=E(t,n))||r.enumerable});return e};var T=e=>O(h({},"__esModule",{value:!0}),e);var N={};f(N,{handler:()=>I});module.exports=T(N);var d=require("@aws-sdk/client-dynamodb"),a=require("@aws-sdk/lib-dynamodb"),M=a.DynamoDBDocumentClient.from(new d.DynamoDBClient({})),w=process.env.TABLE_NAME,S=process.env.PK_NAME||"pk",x=process.env.SK_NAME||"sk";function _(){return new Date().toISOString()}var I=async e=>{let t=e?.creatorId||e?.creatorSub||e?.userId||e?.userSub;if(!t)throw new Error("creatorId is required");let o=`CREATOR#${t}`,r="GOAL_COMPASS",n=_(),k=await M.send(new a.GetCommand({TableName:w,Key:{[S]:o,[x]:r}}));if(!k.Item)return{ok:!1,reason:"NO_GOAL_COMPASS",creatorId:t};let s=k.Item.contentMixTarget??{personality:30,nurture:30,authority:20,conversion:20},i=(c,m)=>{let y=Math.max(0,c-m),b=c+m;return Math.round(y+Math.random()*(b-y))},A={personality:i(s.personality??30,10),nurture:i(s.nurture??30,10),authority:i(s.authority??20,10),conversion:i(s.conversion??20,10)},u=c=>{let m=s[c]??0,y=A[c]??0;return Math.abs(y-m)},p=Math.max(u("personality"),u("nurture"),u("authority"),u("conversion")),l="ON_PATH";return p>25?l="OFF_PATH":p>15&&(l="SLIGHTLY_OFF"),await M.send(new a.UpdateCommand({TableName:w,Key:{[S]:o,[x]:r},UpdateExpression:"SET #contentMixActual = :contentMixActual, #weeklyPathStatus = :weeklyPathStatus, #lastWeeklyCheckAt = :now",ExpressionAttributeNames:{"#contentMixActual":"contentMixActual","#weeklyPathStatus":"weeklyPathStatus","#lastWeeklyCheckAt":"lastWeeklyCheckAt"},ExpressionAttributeValues:{":contentMixActual":A,":weeklyPathStatus":l,":now":n}})),{ok:!0,creatorId:t,contentMixActual:A,weeklyPathStatus:l,lastWeeklyCheckAt:n}};0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
