"use strict";var s=Object.defineProperty;var a=Object.getOwnPropertyDescriptor;var d=Object.getOwnPropertyNames;var g=Object.prototype.hasOwnProperty;var p=(o,e)=>{for(var l in e)s(o,l,{get:e[l],enumerable:!0})},c=(o,e,l,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let t of d(e))!g.call(o,t)&&t!==l&&s(o,t,{get:()=>e[t],enumerable:!(r=a(e,t))||r.enumerable});return o};var P=o=>c(s({},"__esModule",{value:!0}),o);var M={};p(M,{handler:()=>f});module.exports=P(M);function I(o){return`${o}-${Math.random().toString(36).slice(2,10)}`}function i(){return new Date().toISOString()}async function u(o){if(!o.episodeId)throw new Error("PollManager CREATE_POLL: missing episodeId");if(!o.title)throw new Error("PollManager CREATE_POLL: missing title");if(!o.question)throw new Error("PollManager CREATE_POLL: missing question");if(!o.options||o.options.length<2)throw new Error("PollManager CREATE_POLL: need at least 2 options");let e=I("poll"),l=i(),r={pollId:e,episodeId:o.episodeId,sceneId:o.sceneId,branchKey:o.branchKey,title:o.title,question:o.question,options:o.options.map((t,n)=>({id:t.id||`opt-${n+1}`,label:t.label})),allowMultiple:!!o.allowMultiple,closesAt:o.closesAt,createdAt:l};return console.log("PollManager CREATE_POLL:",JSON.stringify(r,null,2)),{kind:"created",poll:r}}async function E(o){if(!o.pollId)throw new Error("PollManager VOTE: missing pollId");if(!o.userId)throw new Error("PollManager VOTE: missing userId");if(!o.optionIds||o.optionIds.length===0)throw new Error("PollManager VOTE: no optionIds provided");let e=i(),l={pollId:o.pollId,userId:o.userId,optionIds:o.optionIds,recordedAt:e};console.log("PollManager VOTE:",JSON.stringify(l,null,2));let r={pollId:o.pollId,totalVotes:42,byOption:o.optionIds.map((t,n)=>({optionId:t,label:`Option ${n+1}`,votes:10+n*2,percentage:100/o.optionIds.length}))};return{kind:"voted",receipt:l,resultsPreview:r}}async function w(o){if(!o.pollId)throw new Error("PollManager GET_RESULTS: missing pollId");let e={pollId:o.pollId,totalVotes:100,byOption:[{optionId:"opt-1",label:"Option 1",votes:60,percentage:60},{optionId:"opt-2",label:"Option 2",votes:25,percentage:25},{optionId:"opt-3",label:"Option 3",votes:15,percentage:15}]};return console.log("PollManager GET_RESULTS (mock):",JSON.stringify(e,null,2)),{kind:"results",results:e}}var f=async o=>{if(console.log("PollManager incoming event:",JSON.stringify(o,null,2)),!o||!o.action)throw new Error("PollManager: missing action");switch(o.action){case"CREATE_POLL":if(!o.createPoll)throw new Error("PollManager CREATE_POLL: missing 'createPoll' payload");return u(o.createPoll);case"VOTE":if(!o.vote)throw new Error("PollManager VOTE: missing 'vote' payload");return E(o.vote);case"GET_RESULTS":if(!o.results)throw new Error("PollManager GET_RESULTS: missing 'results' payload");return w(o.results);default:throw new Error(`PollManager: unsupported action ${o.action}`)}};0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
