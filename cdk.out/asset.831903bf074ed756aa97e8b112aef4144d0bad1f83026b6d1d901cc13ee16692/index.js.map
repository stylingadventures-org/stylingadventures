{
  "version": 3,
  "sources": ["../../lambda/analytics/admin-metrics.ts"],
  "sourcesContent": ["// lambda/analytics/admin-metrics.ts\r\n//\r\n// Lightweight placeholder lambda for admin analytics.\r\n// This unblocks CDK synth/deploy while giving you a\r\n// secure, admin-only resolver you can wire up later.\r\n\r\ntype AppSyncEvent = {\r\n  identity?: {\r\n    sub?: string;\r\n    username?: string;\r\n    claims?: {\r\n      [key: string]: any;\r\n    };\r\n    groups?: string[] | null;\r\n  };\r\n  info?: {\r\n    fieldName?: string;\r\n  };\r\n  arguments?: any;\r\n};\r\n\r\ntype AdminAnalyticsSummary = {\r\n  generatedAt: string;\r\n  notes: string;\r\n};\r\n\r\nfunction isAdmin(identity: AppSyncEvent[\"identity\"]): boolean {\r\n  if (!identity) return false;\r\n\r\n  // Prefer JWT claims from Cognito\r\n  const claimsGroups =\r\n    identity.claims?.[\"cognito:groups\"] ??\r\n    identity.claims?.[\"custom:groups\"] ??\r\n    identity.groups;\r\n\r\n  const groups = Array.isArray(claimsGroups)\r\n    ? claimsGroups\r\n    : typeof claimsGroups === \"string\"\r\n    ? claimsGroups.split(\",\")\r\n    : [];\r\n\r\n  // We\u2019re using the lowercase \"admin\" group from IdentityStack\r\n  return groups.includes(\"admin\") || groups.includes(\"ADMIN\");\r\n}\r\n\r\nexport const handler = async (\r\n  event: AppSyncEvent,\r\n): Promise<AdminAnalyticsSummary> => {\r\n  const field = event.info?.fieldName || \"\";\r\n  const identity = event.identity;\r\n\r\n  if (!identity?.sub) {\r\n    throw new Error(\"Unauthorized\");\r\n  }\r\n\r\n  if (!isAdmin(identity)) {\r\n    throw new Error(\"Forbidden\");\r\n  }\r\n\r\n  // For now we just support a single field; you can add more later\r\n  if (field === \"adminAnalyticsSummary\") {\r\n    const now = new Date().toISOString();\r\n\r\n    // TODO: hook into S3 logs, DDB, or whatever pipeline you build\r\n    // For now, return a stub summary so frontend can integrate.\r\n    return {\r\n      generatedAt: now,\r\n      notes:\r\n        \"Admin analytics backend is wired. Replace this placeholder with real metrics (XP, coins, livestream engagement, etc).\",\r\n    };\r\n  }\r\n\r\n  throw new Error(`Unknown field ${field} in admin-metrics lambda`);\r\n};\r\n"],
  "mappings": "yaAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,aAAAE,IAAA,eAAAC,EAAAH,GA0BA,SAASI,EAAQC,EAA6C,CA1B9D,IAAAC,EAAAC,EA2BE,GAAI,CAACF,EAAU,MAAO,GAGtB,IAAMG,IACJF,EAAAD,EAAS,SAAT,YAAAC,EAAkB,sBAClBC,EAAAF,EAAS,SAAT,YAAAE,EAAkB,mBAClBF,EAAS,OAELI,EAAS,MAAM,QAAQD,CAAY,EACrCA,EACA,OAAOA,GAAiB,SACxBA,EAAa,MAAM,GAAG,EACtB,CAAC,EAGL,OAAOC,EAAO,SAAS,OAAO,GAAKA,EAAO,SAAS,OAAO,CAC5D,CAEO,IAAMP,EAAU,MACrBQ,GACmC,CA/CrC,IAAAJ,EAgDE,IAAMK,IAAQL,EAAAI,EAAM,OAAN,YAAAJ,EAAY,YAAa,GACjCD,EAAWK,EAAM,SAEvB,GAAI,EAACL,GAAA,MAAAA,EAAU,KACb,MAAM,IAAI,MAAM,cAAc,EAGhC,GAAI,CAACD,EAAQC,CAAQ,EACnB,MAAM,IAAI,MAAM,WAAW,EAI7B,GAAIM,IAAU,wBAKZ,MAAO,CACL,YALU,IAAI,KAAK,EAAE,YAAY,EAMjC,MACE,uHACJ,EAGF,MAAM,IAAI,MAAM,iBAAiBA,CAAK,0BAA0B,CAClE",
  "names": ["admin_metrics_exports", "__export", "handler", "__toCommonJS", "isAdmin", "identity", "_a", "_b", "claimsGroups", "groups", "event", "field"]
}
