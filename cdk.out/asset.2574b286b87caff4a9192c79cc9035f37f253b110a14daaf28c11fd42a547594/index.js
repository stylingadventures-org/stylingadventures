"use strict";var c=Object.defineProperty;var f=Object.getOwnPropertyDescriptor;var g=Object.getOwnPropertyNames;var N=Object.prototype.hasOwnProperty;var y=(e,n)=>{for(var s in n)c(e,s,{get:n[s],enumerable:!0})},w=(e,n,s,r)=>{if(n&&typeof n=="object"||typeof n=="function")for(let t of g(n))!N.call(e,t)&&t!==s&&c(e,t,{get:()=>n[t],enumerable:!(r=f(n,t))||r.enumerable});return e};var B=e=>w(c({},"__esModule",{value:!0}),e);var x={};y(x,{handler:()=>L});module.exports=B(x);var l=require("@aws-sdk/client-dynamodb"),o=require("@aws-sdk/lib-dynamodb");var a=process.env.TABLE_NAME??process.env.APP_TABLE??process.env.TABLE??"";if(!a)throw new Error("Missing DynamoDB table env. Provide TABLE_NAME (or APP_TABLE / TABLE).");var d=o.DynamoDBDocumentClient.from(new l.DynamoDBClient({})),L=async e=>{let{fieldName:n}=e.info,s=e.arguments||{},r=Math.min(100,Math.max(1,Number(s.limit??10))),t=s.season||"GLOBAL";if(n!=="topXP"&&n!=="topCoins")throw new Error(`Unknown field ${n}`);let E=`LEADERBOARD#${t}`,u=(await d.send(new o.QueryCommand({TableName:a,IndexName:"gsi1",KeyConditionExpression:"gsi1pk = :p AND begins_with(gsi1sk, :xp)",ExpressionAttributeValues:{":p":E,":xp":"XP#"},ScanIndexForward:!1,Limit:r}))).Items??[],A=1;return await Promise.all(u.map(async i=>{let m=String(i.pk||"").replace("USER#",""),p=i.displayName;if(!p&&m)try{p=(await d.send(new o.GetCommand({TableName:a,Key:{pk:`USER#${m}`,sk:"PROFILE"},ProjectionExpression:"displayName"}))).Item?.displayName}catch{}return{rank:A++,userId:m,displayName:p,xp:Number(i.xp??0),coins:Number(i.coins??0)}}))};0&&(module.exports={handler});
