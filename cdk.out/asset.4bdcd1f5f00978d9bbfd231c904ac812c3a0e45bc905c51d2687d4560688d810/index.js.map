{
  "version": 3,
  "sources": ["../../lambda/game/leaderboard.ts"],
  "sourcesContent": ["import { DynamoDBClient, QueryCommand } from \"@aws-sdk/client-dynamodb\";\r\nconst ddb = new DynamoDBClient({});\r\nconst TABLE = process.env.TABLE_NAME!;\r\n\r\nexport const handler = async (event: any) => {\r\n  const { fieldName } = event.info;\r\n  const { limit = 10, season = 'GLOBAL' } = event.arguments || {};\r\n\r\n  if (fieldName === 'topXP' || fieldName === 'topCoins') {\r\n    const pk = `LEADERBOARD#${season}`;\r\n    const resp = await ddb.send(new QueryCommand({\r\n      TableName: TABLE,\r\n      IndexName: 'GSI1',\r\n      KeyConditionExpression: 'gsi1pk = :p',\r\n      ExpressionAttributeValues: { ':p': { S: pk } },\r\n      // descending because we store \"SCORE#-value\"\r\n      ScanIndexForward: true,\r\n      Limit: Math.min(100, limit)\r\n    }));\r\n\r\n    let rank = 1;\r\n    return (resp.Items ?? []).map(i => ({\r\n      userId: (i.pk.S ?? '').replace('USER#',''),\r\n      displayName: i.displayName?.S,\r\n      xp: i.xp ? Number(i.xp.N) : null,\r\n      coins: i.coins ? Number(i.coins.N) : null,\r\n      rank: rank++\r\n    }));\r\n  }\r\n\r\n  throw new Error(`Unknown field ${fieldName}`);\r\n};\r\n"],
  "mappings": "yaAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,aAAAE,IAAA,eAAAC,EAAAH,GAAA,IAAAI,EAA6C,oCACvCC,EAAM,IAAI,iBAAe,CAAC,CAAC,EAC3BC,EAAQ,QAAQ,IAAI,WAEbJ,EAAU,MAAOK,GAAe,CAC3C,GAAM,CAAE,UAAAC,CAAU,EAAID,EAAM,KACtB,CAAE,MAAAE,EAAQ,GAAI,OAAAC,EAAS,QAAS,EAAIH,EAAM,WAAa,CAAC,EAE9D,GAAIC,IAAc,SAAWA,IAAc,WAAY,CACrD,IAAMG,EAAK,eAAeD,CAAM,GAC1BE,EAAO,MAAMP,EAAI,KAAK,IAAI,eAAa,CAC3C,UAAWC,EACX,UAAW,OACX,uBAAwB,cACxB,0BAA2B,CAAE,KAAM,CAAE,EAAGK,CAAG,CAAE,EAE7C,iBAAkB,GAClB,MAAO,KAAK,IAAI,IAAKF,CAAK,CAC5B,CAAC,CAAC,EAEEI,EAAO,EACX,OAAQD,EAAK,OAAS,CAAC,GAAG,IAAIE,IAAM,CAClC,QAASA,EAAE,GAAG,GAAK,IAAI,QAAQ,QAAQ,EAAE,EACzC,YAAaA,EAAE,aAAa,EAC5B,GAAIA,EAAE,GAAK,OAAOA,EAAE,GAAG,CAAC,EAAI,KAC5B,MAAOA,EAAE,MAAQ,OAAOA,EAAE,MAAM,CAAC,EAAI,KACrC,KAAMD,GACR,EAAE,CACJ,CAEA,MAAM,IAAI,MAAM,iBAAiBL,CAAS,EAAE,CAC9C",
  "names": ["leaderboard_exports", "__export", "handler", "__toCommonJS", "import_client_dynamodb", "ddb", "TABLE", "event", "fieldName", "limit", "season", "pk", "resp", "rank", "i"]
}
