"use strict";var m=Object.defineProperty;var c=Object.getOwnPropertyDescriptor;var E=Object.getOwnPropertyNames;var w=Object.prototype.hasOwnProperty;var S=(t,e)=>{for(var n in e)m(t,n,{get:e[n],enumerable:!0})},A=(t,e,n,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of E(e))!w.call(t,r)&&r!==n&&m(t,r,{get:()=>e[r],enumerable:!(s=c(e,r))||s.enumerable});return t};var C=t=>A(m({},"__esModule",{value:!0}),t);var T={};S(T,{handler:()=>N});module.exports=C(T);var i=require("@aws-sdk/client-dynamodb"),p=require("@aws-sdk/util-dynamodb"),o=new i.DynamoDBClient({}),a=process.env.APP_TABLE;function u(t){if(!t)throw new Error("Closet item not found");let e=(0,p.unmarshall)(t);if(!e.id||!e.userId||!e.ownerSub||!e.status||!e.createdAt||!e.updatedAt)throw new Error("Closet item missing required fields");return e}async function g(){return((await o.send(new i.QueryCommand({TableName:a,KeyConditionExpression:"pk = :pk",ExpressionAttributeValues:{":pk":{S:"CLOSET"},":pending":{S:"PENDING"}},FilterExpression:"#st = :pending",ExpressionAttributeNames:{"#st":"status"}}))).Items||[]).map(n=>u(n))}async function I(t){let e=new Date().toISOString(),n=await o.send(new i.UpdateItemCommand({TableName:a,Key:{pk:{S:"CLOSET"},sk:{S:t}},UpdateExpression:"SET #st = :approved, updatedAt = :now REMOVE reason",ExpressionAttributeNames:{"#st":"status"},ExpressionAttributeValues:{":approved":{S:"APPROVED"},":now":{S:e}},ReturnValues:"ALL_NEW"}));return u(n.Attributes)}async function f(t,e){let n=new Date().toISOString(),s=["#st = :rejected","updatedAt = :now"],r={"#st":"status"},d={":rejected":{S:"REJECTED"},":now":{S:n}};e&&e.trim()?(s.push("reason = :reason"),d[":reason"]={S:e.trim()}):(s.push("reason = :emptyReason"),d[":emptyReason"]={S:""});let l=await o.send(new i.UpdateItemCommand({TableName:a,Key:{pk:{S:"CLOSET"},sk:{S:t}},UpdateExpression:"SET "+s.join(", "),ExpressionAttributeNames:r,ExpressionAttributeValues:d,ReturnValues:"ALL_NEW"}));return u(l.Attributes)}async function y(t,e){let n=new Date().toISOString(),s=await o.send(new i.UpdateItemCommand({TableName:a,Key:{pk:{S:"CLOSET"},sk:{S:t}},UpdateExpression:"SET audience = :aud, updatedAt = :now",ExpressionAttributeValues:{":aud":{S:e},":now":{S:n}},ReturnValues:"ALL_NEW"}));return u(s.Attributes)}var N=async t=>{let e=t.info?.parentTypeName,n=t.info?.fieldName;if(e==="Query"&&n==="adminListPending")return await g();if(e==="Mutation"&&n==="adminApproveItem"){let{id:s}=t.arguments||{};if(!s)throw new Error("id is required");return await I(s)}if(e==="Mutation"&&n==="adminRejectItem"){let{id:s,reason:r}=t.arguments||{};if(!s)throw new Error("id is required");return await f(s,r??null)}if(e==="Mutation"&&n==="adminSetClosetAudience"){let{id:s,audience:r}=t.arguments||{};if(!s||!r)throw new Error("id and audience are required");return await y(s,r)}throw new Error(`Unknown field ${e}.${n}`)};0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
