{
  "version": 3,
  "sources": ["../../lambda/closet/admin.ts"],
  "sourcesContent": ["import {\r\n  DynamoDBClient,\r\n  QueryCommand,\r\n  UpdateItemCommand,\r\n  PutItemCommand,\r\n  ScanCommand,\r\n  AttributeValue,\r\n  GetItemCommand,\r\n  DeleteItemCommand,\r\n} from \"@aws-sdk/client-dynamodb\";\r\nimport {\r\n  SFNClient,\r\n  SendTaskFailureCommand,\r\n  SendTaskSuccessCommand,\r\n  StartExecutionCommand,\r\n} from \"@aws-sdk/client-sfn\";\r\n\r\nconst ddb = new DynamoDBClient({});\r\nconst sfn = new SFNClient({});\r\n\r\nconst {\r\n  TABLE_NAME = \"\",\r\n  ADMIN_GROUP_NAME: ADMIN_GROUP_NAME_RAW = \"admin\",\r\n  CREATOR_GROUP_NAME: CREATOR_GROUP_NAME_RAW = \"creator\",\r\n} = process.env;\r\n\r\n// \u2705 explicit fan SM ARN (fallback to legacy APPROVAL_SM_ARN)\r\nconst FAN_APPROVAL_SM_ARN =\r\n  process.env.FAN_APPROVAL_SM_ARN || process.env.APPROVAL_SM_ARN || \"\";\r\n\r\nif (!TABLE_NAME) throw new Error(\"Missing env: TABLE_NAME\");\r\n\r\nconst ADMIN_GROUP_NAME = ADMIN_GROUP_NAME_RAW.toLowerCase();\r\nconst CREATOR_GROUP_NAME = CREATOR_GROUP_NAME_RAW.toLowerCase();\r\n\r\nconst nowIso = () => new Date().toISOString();\r\nconst S = (v: string): AttributeValue => ({ S: v });\r\n\r\ntype AppSyncEvent = {\r\n  info: { fieldName: string };\r\n  arguments: any;\r\n  identity?: any;\r\n};\r\n\r\n// \u2705 MUST match GraphQL schema exactly\r\ntype ClosetStatusApi = \"PENDING\" | \"APPROVED\" | \"PUBLISHED\" | \"REJECTED\";\r\n\r\n// \u2705 DB may contain legacy values that are NOT in the schema\r\ntype ClosetStatusDb = ClosetStatusApi | \"DRAFT\" | \"ARCHIVED\" | string;\r\n\r\nconst VALID_CLOSET_STATUSES = new Set<ClosetStatusApi>([\r\n  \"PENDING\",\r\n  \"APPROVED\",\r\n  \"PUBLISHED\",\r\n  \"REJECTED\",\r\n]);\r\n\r\nfunction normalizeClosetStatus(raw: unknown): ClosetStatusApi {\r\n  const v = String(raw ?? \"\").trim().toUpperCase();\r\n\r\n  if (VALID_CLOSET_STATUSES.has(v as ClosetStatusApi)) {\r\n    return v as ClosetStatusApi;\r\n  }\r\n\r\n  // Legacy mappings (never leak to GraphQL)\r\n  if (v === \"DRAFT\") return \"PENDING\";\r\n  if (v === \"ARCHIVED\") return \"REJECTED\";\r\n\r\n  console.warn(\"[Closet] Invalid status from DDB; defaulting to PENDING:\", raw);\r\n  return \"PENDING\";\r\n}\r\n\r\ntype ClosetItem = {\r\n  id: string;\r\n  userId: string;\r\n  ownerSub: string;\r\n  status: ClosetStatusApi;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n  mediaKey: string;\r\n  rawMediaKey?: string;\r\n  title: string;\r\n  reason?: string;\r\n  season?: string | null;\r\n  vibes?: string | null;\r\n  audience?: string | null;\r\n\r\n  // categorization\r\n  category?: string | null;\r\n  subcategory?: string | null;\r\n\r\n  // pinned highlight flag\r\n  pinned?: boolean;\r\n\r\n  favoriteCount?: number;\r\n  viewerHasFaved?: boolean;\r\n};\r\n\r\ntype AdminCreateClosetItemInput = {\r\n  ownerId?: string | null;\r\n\r\n  title: string;\r\n  rawMediaKey?: string | null;\r\n  mediaKey?: string | null;\r\n\r\n  season?: string | null;\r\n  vibes?: string | null;\r\n\r\n  category?: string | null;\r\n  subcategory?: string | null;\r\n\r\n  description?: string | null;\r\n  story?: string | null;\r\n  audience?: string | null;\r\n};\r\n\r\ntype AdminUpdateClosetItemInput = {\r\n  id?: string | null;\r\n\r\n  title?: string | null;\r\n  category?: string | null;\r\n  subcategory?: string | null;\r\n  audience?: string | null;\r\n\r\n  pinned?: boolean | null;\r\n  season?: string | null;\r\n  vibes?: string | null;\r\n};\r\n\r\ntype AdminClosetItemsPage = {\r\n  items: ClosetItem[];\r\n  nextToken?: string | null;\r\n};\r\n\r\nfunction parseGroups(identity: any): string[] {\r\n  const claims = identity?.claims || {};\r\n  const raw =\r\n    claims[\"cognito:groups\"] ||\r\n    claims[\"custom:groups\"] ||\r\n    identity?.groups ||\r\n    [];\r\n  if (Array.isArray(raw)) {\r\n    return raw.map((g) => String(g));\r\n  }\r\n  if (typeof raw === \"string\") {\r\n    return raw\r\n      .split(\",\")\r\n      .map((x) => x.trim())\r\n      .filter(Boolean);\r\n  }\r\n  return [];\r\n}\r\n\r\nfunction getIdentity(event: AppSyncEvent) {\r\n  const identity = event.identity as any;\r\n  const claims = identity?.claims || {};\r\n  const sub = identity?.sub || claims.sub;\r\n\r\n  if (!sub) throw new Error(\"Unauthorized\");\r\n\r\n  const groups = parseGroups(identity);\r\n  const groupsLc = groups.map((g) => g.toLowerCase());\r\n\r\n  const isAdmin = groupsLc.includes(ADMIN_GROUP_NAME);\r\n  const isCreator = groupsLc.includes(CREATOR_GROUP_NAME);\r\n\r\n  return { sub, isAdmin, isCreator, groups };\r\n}\r\n\r\n/**\r\n * Defensive mapper from raw Dynamo item -> ClosetItem.\r\n * - Never assumes attributes exist; falls back to empty strings.\r\n * - Ensures createdAt / updatedAt are non-empty ISO strings.\r\n * - Normalizes status so it ALWAYS matches GraphQL enum.\r\n */\r\nfunction mapItem(raw: any, extra?: Partial<ClosetItem>): ClosetItem {\r\n  const idAttr = raw.id?.S ?? \"\";\r\n  const ownerSubAttr = raw.ownerSub?.S ?? \"\";\r\n\r\n  const statusRaw: ClosetStatusDb =\r\n    (raw.status?.S as ClosetStatusDb | undefined) ?? \"PENDING\";\r\n  const statusAttr = normalizeClosetStatus(statusRaw);\r\n\r\n  const createdAtAttr = raw.createdAt?.S || nowIso();\r\n  const updatedAtAttr = raw.updatedAt?.S || createdAtAttr;\r\n\r\n  const favoriteCountAttr = (raw.favoriteCount as any)?.N;\r\n  const favoriteCount =\r\n    typeof favoriteCountAttr === \"string\" ? Number(favoriteCountAttr) : 0;\r\n\r\n  const pinnedAttr = raw.pinned as any;\r\n  const pinned =\r\n    typeof pinnedAttr?.BOOL === \"boolean\" ? pinnedAttr.BOOL : undefined;\r\n\r\n  return {\r\n    id: idAttr,\r\n    userId: ownerSubAttr,\r\n    ownerSub: ownerSubAttr,\r\n    status: statusAttr,\r\n    createdAt: createdAtAttr,\r\n    updatedAt: updatedAtAttr,\r\n    mediaKey: raw.mediaKey?.S ?? \"\",\r\n    rawMediaKey: raw.rawMediaKey?.S ?? \"\",\r\n    title: raw.title?.S ?? \"\",\r\n    reason: raw.reason?.S ?? \"\",\r\n    season: raw.season?.S ?? null,\r\n    vibes: raw.vibes?.S ?? null,\r\n    audience: raw.audience?.S ?? null,\r\n\r\n    category: raw.category?.S ?? null,\r\n    subcategory: raw.subcategory?.S ?? null,\r\n\r\n    pinned,\r\n\r\n    favoriteCount,\r\n    viewerHasFaved: false,\r\n    ...extra,\r\n  };\r\n}\r\n\r\nfunction randomId() {\r\n  if ((globalThis as any).crypto?.randomUUID) {\r\n    return (globalThis as any).crypto.randomUUID();\r\n  }\r\n  return `${Date.now().toString(36)}-${Math.random().toString(36).slice(2, 10)}`;\r\n}\r\n\r\n// simple base64 wrapper for LastEvaluatedKey\r\nfunction encodeToken(key?: Record<string, AttributeValue>): string | null {\r\n  if (!key) return null;\r\n  return Buffer.from(JSON.stringify(key), \"utf8\").toString(\"base64\");\r\n}\r\nfunction decodeToken(\r\n  token?: string | null,\r\n): Record<string, AttributeValue> | undefined {\r\n  if (!token) return undefined;\r\n  try {\r\n    return JSON.parse(Buffer.from(String(token), \"base64\").toString(\"utf8\"));\r\n  } catch {\r\n    return undefined;\r\n  }\r\n}\r\n\r\nfunction toLimit(raw: any, fallback: number) {\r\n  const n = Number(raw);\r\n  if (!Number.isFinite(n) || n <= 0) return fallback;\r\n  return Math.min(Math.floor(n), 200);\r\n}\r\n\r\n/* ============== Queries ============== */\r\n\r\nexport const adminListPending = async (\r\n  event: AppSyncEvent,\r\n): Promise<AdminClosetItemsPage> => {\r\n  const { isAdmin } = getIdentity(event);\r\n  if (!isAdmin) throw new Error(\"Forbidden\");\r\n\r\n  const args = event.arguments || {};\r\n  const limit = toLimit(args.limit, 100);\r\n  const exclusiveKey = decodeToken(args.nextToken);\r\n\r\n  const out = await ddb.send(\r\n    new QueryCommand({\r\n      TableName: TABLE_NAME,\r\n      IndexName: \"gsi2\", // STATUS index\r\n      KeyConditionExpression: \"gsi2pk = :p\",\r\n      ExpressionAttributeValues: { \":p\": S(\"STATUS#PENDING\") },\r\n      ScanIndexForward: true,\r\n      ProjectionExpression:\r\n        \"id, ownerSub, #s, createdAt, updatedAt, mediaKey, rawMediaKey, title, reason, season, vibes, audience, favoriteCount, category, subcategory, pinned\",\r\n      ExpressionAttributeNames: { \"#s\": \"status\" },\r\n      Limit: limit,\r\n      ExclusiveStartKey: exclusiveKey,\r\n    }),\r\n  );\r\n\r\n  const items = (out.Items || []).map((it) =>\r\n    mapItem({\r\n      ...it,\r\n      status: it[\"status\"],\r\n    }),\r\n  );\r\n\r\n  // \u2705 NEVER return null/undefined for a Connection type\r\n  return {\r\n    items: items ?? [],\r\n    nextToken: encodeToken(out.LastEvaluatedKey) ?? null,\r\n  };\r\n};\r\n\r\nexport const adminListClosetItems = async (\r\n  event: AppSyncEvent,\r\n): Promise<AdminClosetItemsPage> => {\r\n  const { isAdmin } = getIdentity(event);\r\n  if (!isAdmin) throw new Error(\"Forbidden\");\r\n\r\n  const args = event.arguments || {};\r\n  const limit = toLimit(args.limit, 50);\r\n  const exclusiveKey = decodeToken(args.nextToken);\r\n\r\n  const status = args.status as string | undefined;\r\n\r\n  if (status) {\r\n    const normalized = normalizeClosetStatus(status);\r\n\r\n    const out = await ddb.send(\r\n      new QueryCommand({\r\n        TableName: TABLE_NAME,\r\n        IndexName: \"gsi2\",\r\n        KeyConditionExpression: \"gsi2pk = :p\",\r\n        ExpressionAttributeValues: { \":p\": S(`STATUS#${normalized}`) },\r\n        ScanIndexForward: false, // newest first\r\n        ProjectionExpression:\r\n          \"id, ownerSub, #s, createdAt, updatedAt, mediaKey, rawMediaKey, title, reason, season, vibes, audience, favoriteCount, category, subcategory, pinned\",\r\n        ExpressionAttributeNames: { \"#s\": \"status\" },\r\n        Limit: limit,\r\n        ExclusiveStartKey: exclusiveKey,\r\n      }),\r\n    );\r\n\r\n    const items = (out.Items || []).map((it) =>\r\n      mapItem({\r\n        ...it,\r\n        status: it[\"status\"],\r\n      }),\r\n    );\r\n\r\n    return {\r\n      items: items ?? [],\r\n      nextToken: encodeToken(out.LastEvaluatedKey) ?? null,\r\n    };\r\n  }\r\n\r\n  const out = await ddb.send(\r\n    new ScanCommand({\r\n      TableName: TABLE_NAME,\r\n      FilterExpression: \"begins_with(pk, :p)\",\r\n      ExpressionAttributeValues: { \":p\": S(\"ITEM#\") },\r\n      ProjectionExpression:\r\n        \"id, ownerSub, #s, createdAt, updatedAt, mediaKey, rawMediaKey, title, reason, season, vibes, audience, favoriteCount, category, subcategory, pinned\",\r\n      ExpressionAttributeNames: { \"#s\": \"status\" },\r\n      Limit: limit,\r\n      ExclusiveStartKey: exclusiveKey,\r\n    }),\r\n  );\r\n\r\n  const items = (out.Items || []).map((it) =>\r\n    mapItem({\r\n      ...it,\r\n      status: it[\"status\"],\r\n    }),\r\n  );\r\n\r\n  items.sort(\r\n    (a, b) =>\r\n      new Date(b.createdAt || 0).getTime() -\r\n      new Date(a.createdAt || 0).getTime(),\r\n  );\r\n\r\n  return {\r\n    items: items ?? [],\r\n    nextToken: encodeToken(out.LastEvaluatedKey) ?? null,\r\n  };\r\n};\r\n\r\nexport const adminListBestieClosetItems = async (\r\n  event: AppSyncEvent,\r\n): Promise<AdminClosetItemsPage> => {\r\n  const page = await adminListClosetItems(event);\r\n\r\n  const bestieAudiences = new Set<string>([\"BESTIE\", \"EXCLUSIVE\"]);\r\n\r\n  const filtered = (page.items || []).filter((it) => {\r\n    const aud = (it.audience || \"\").toUpperCase();\r\n    return bestieAudiences.has(aud);\r\n  });\r\n\r\n  return {\r\n    items: filtered ?? [],\r\n    nextToken: page.nextToken ?? null,\r\n  };\r\n};\r\n\r\nexport const closetFeed = async (\r\n  event: AppSyncEvent,\r\n): Promise<AdminClosetItemsPage> => {\r\n  const { sub } = getIdentity(event);\r\n  const sortArg = (event.arguments?.sort as string | undefined) ?? \"NEWEST\";\r\n  const sort: \"NEWEST\" | \"MOST_LOVED\" =\r\n    sortArg === \"MOST_LOVED\" ? \"MOST_LOVED\" : \"NEWEST\";\r\n\r\n  const favOut = await ddb.send(\r\n    new QueryCommand({\r\n      TableName: TABLE_NAME,\r\n      KeyConditionExpression: \"pk = :pk AND begins_with(sk, :sk)\",\r\n      ExpressionAttributeValues: {\r\n        \":pk\": S(`FAV#${sub}`),\r\n        \":sk\": S(\"CLOSET#\"),\r\n      },\r\n    }),\r\n  );\r\n\r\n  const favIds = new Set(\r\n    (favOut.Items || []).map((f) => {\r\n      const sk = f.sk?.S ?? \"\";\r\n      if (sk.startsWith(\"CLOSET#\")) {\r\n        return sk.substring(\"CLOSET#\".length);\r\n      }\r\n      return f.closetId?.S ?? \"\";\r\n    }),\r\n  );\r\n\r\n  const out = await ddb.send(\r\n    new ScanCommand({\r\n      TableName: TABLE_NAME,\r\n      FilterExpression: \"begins_with(pk, :p)\",\r\n      ExpressionAttributeValues: { \":p\": S(\"ITEM#\") },\r\n      ProjectionExpression:\r\n        \"id, ownerSub, #s, createdAt, updatedAt, mediaKey, rawMediaKey, title, audience, favoriteCount, category, subcategory, season, vibes, pinned\",\r\n      ExpressionAttributeNames: { \"#s\": \"status\" },\r\n    }),\r\n  );\r\n\r\n  const collected: ClosetItem[] = [];\r\n\r\n  for (const it of out.Items || []) {\r\n    // Normalize BEFORE filtering so legacy values don't break logic.\r\n    const status = normalizeClosetStatus(it.status?.S);\r\n\r\n    if (status !== \"APPROVED\" && status !== \"PUBLISHED\") continue;\r\n\r\n    const createdAtVal = it.createdAt?.S || \"\";\r\n    if (!createdAtVal.trim()) continue;\r\n\r\n    const mapped = mapItem(\r\n      {\r\n        ...it,\r\n        status: it[\"status\"],\r\n        createdAt: { S: createdAtVal },\r\n        updatedAt: it.updatedAt ?? { S: createdAtVal },\r\n      },\r\n      {\r\n        viewerHasFaved: favIds.has(it.id?.S ?? \"\"),\r\n      },\r\n    );\r\n\r\n    collected.push(mapped);\r\n  }\r\n\r\n  collected.sort((a, b) => {\r\n    const aTime = new Date(a.createdAt || 0).getTime();\r\n    const bTime = new Date(b.createdAt || 0).getTime();\r\n\r\n    if (sort === \"MOST_LOVED\") {\r\n      const af = a.favoriteCount ?? 0;\r\n      const bf = b.favoriteCount ?? 0;\r\n      if (bf !== af) return bf - af;\r\n      return bTime - aTime;\r\n    }\r\n\r\n    return bTime - aTime;\r\n  });\r\n\r\n  return {\r\n    items: collected ?? [],\r\n    nextToken: null,\r\n  };\r\n};\r\n\r\nexport const topClosetLooks = async (\r\n  event: AppSyncEvent,\r\n): Promise<ClosetItem[]> => {\r\n  const conn = await closetFeed({\r\n    ...event,\r\n    arguments: { ...(event.arguments || {}), sort: \"NEWEST\" },\r\n  });\r\n  return conn.items ?? [];\r\n};\r\n\r\n/* ============== Mutations ============== */\r\n\r\nexport const adminCreateClosetItem = async (\r\n  event: AppSyncEvent,\r\n): Promise<ClosetItem> => {\r\n  const { sub, isAdmin } = getIdentity(event);\r\n  if (!isAdmin) throw new Error(\"Forbidden\");\r\n\r\n  const input = (event.arguments?.input || {}) as AdminCreateClosetItemInput;\r\n\r\n  if (!input.title?.trim()) throw new Error(\"title is required\");\r\n\r\n  const rawKey = input.rawMediaKey || input.mediaKey;\r\n  if (!rawKey) throw new Error(\"rawMediaKey is required\");\r\n\r\n  const id = randomId();\r\n  const now = nowIso();\r\n\r\n  await ddb.send(\r\n    new PutItemCommand({\r\n      TableName: TABLE_NAME,\r\n      Item: {\r\n        pk: S(`ITEM#${id}`),\r\n        sk: S(\"META\"),\r\n        id: S(id),\r\n        ownerSub: S(sub),\r\n        gsi2pk: S(\"STATUS#PENDING\"),\r\n        gsi2sk: S(now),\r\n        status: S(\"PENDING\"),\r\n        createdAt: S(now),\r\n        updatedAt: S(now),\r\n        title: S(input.title.trim()),\r\n        rawMediaKey: S(rawKey),\r\n        favoriteCount: { N: \"0\" },\r\n\r\n        ...(input.season ? { season: S(input.season) } : {}),\r\n        ...(input.vibes ? { vibes: S(input.vibes) } : {}),\r\n        ...(input.category ? { category: S(input.category) } : {}),\r\n        ...(input.subcategory ? { subcategory: S(input.subcategory) } : {}),\r\n        ...(input.audience ? { audience: S(input.audience) } : {}),\r\n        ...(input.description ? { description: S(input.description) } : {}),\r\n        ...(input.story ? { story: S(input.story) } : {}),\r\n      },\r\n    }),\r\n  );\r\n\r\n  // \u2705 Start FAN approval workflow (WAIT_FOR_TASK_TOKEN)\r\n  if (FAN_APPROVAL_SM_ARN) {\r\n    try {\r\n      await sfn.send(\r\n        new StartExecutionCommand({\r\n          stateMachineArn: FAN_APPROVAL_SM_ARN,\r\n          input: JSON.stringify({\r\n            item: {\r\n              id,\r\n              ownerSub: sub,\r\n              userId: sub, // \u2705 fixed typo (was \"userrelubed\")\r\n              s3Key: rawKey,\r\n            },\r\n          }),\r\n        }),\r\n      );\r\n    } catch (err) {\r\n      console.error(\"Failed to start FAN approval Step Function\", err);\r\n    }\r\n  } else {\r\n    console.warn(\r\n      \"FAN_APPROVAL_SM_ARN is not set; adminCreateClosetItem will not trigger the fan approval workflow.\",\r\n    );\r\n  }\r\n\r\n  return {\r\n    id,\r\n    userId: sub,\r\n    ownerSub: sub,\r\n    status: \"PENDING\",\r\n    createdAt: now,\r\n    updatedAt: now,\r\n    title: input.title.trim(),\r\n    mediaKey: \"\",\r\n    rawMediaKey: rawKey,\r\n    reason: \"\",\r\n    season: input.season ?? null,\r\n    vibes: input.vibes ?? null,\r\n    audience: input.audience ?? null,\r\n    category: input.category ?? null,\r\n    subcategory: input.subcategory ?? null,\r\n    favoriteCount: 0,\r\n    viewerHasFaved: false,\r\n  };\r\n};\r\n\r\nexport const adminApproveItem = async (\r\n  event: AppSyncEvent,\r\n): Promise<ClosetItem> => {\r\n  const { isAdmin } = getIdentity(event);\r\n  if (!isAdmin) throw new Error(\"Forbidden\");\r\n\r\n  const id = event.arguments?.closetItemId as string;\r\n  if (!id) throw new Error(\"closetItemId required\");\r\n\r\n  const now = nowIso();\r\n\r\n  const out = await ddb.send(\r\n    new UpdateItemCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: { pk: S(`ITEM#${id}`), sk: S(\"META\") },\r\n      UpdateExpression:\r\n        \"SET #s = :s, updatedAt = :u, gsi2pk = :g2pk, gsi2sk = :g2sk REMOVE reason, approvalToken, taskToken\",\r\n      ExpressionAttributeNames: { \"#s\": \"status\" },\r\n      ExpressionAttributeValues: {\r\n        \":s\": S(\"APPROVED\"),\r\n        \":u\": S(now),\r\n        \":g2pk\": S(\"STATUS#APPROVED\"),\r\n        \":g2sk\": S(now),\r\n      },\r\n      ReturnValues: \"ALL_OLD\",\r\n    }),\r\n  );\r\n\r\n  const prev = out.Attributes!;\r\n  const token = prev.taskToken?.S ?? prev.approvalToken?.S;\r\n\r\n  if (token) {\r\n    try {\r\n      await sfn.send(\r\n        new SendTaskSuccessCommand({\r\n          taskToken: token,\r\n          output: JSON.stringify({ decision: \"APPROVE\" }),\r\n        }),\r\n      );\r\n    } catch (err) {\r\n      console.warn(\"SendTaskSuccess failed (token may be stale)\", err);\r\n    }\r\n  }\r\n\r\n  return mapItem({\r\n    ...prev,\r\n    status: S(\"APPROVED\"),\r\n  });\r\n};\r\n\r\nexport const adminRejectItem = async (\r\n  event: AppSyncEvent,\r\n): Promise<ClosetItem> => {\r\n  const { isAdmin } = getIdentity(event);\r\n  if (!isAdmin) throw new Error(\"Forbidden\");\r\n\r\n  const id = event.arguments?.closetItemId as string;\r\n  const reason = (event.arguments?.reason as string) || \"\";\r\n  if (!id) throw new Error(\"closetItemId required\");\r\n\r\n  const now = nowIso();\r\n\r\n  const out = await ddb.send(\r\n    new UpdateItemCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: { pk: S(`ITEM#${id}`), sk: S(\"META\") },\r\n      UpdateExpression:\r\n        \"SET #s = :s, updatedAt = :u, gsi2pk = :g2pk, gsi2sk = :g2sk, reason = :r REMOVE approvalToken, taskToken\",\r\n      ExpressionAttributeNames: { \"#s\": \"status\" },\r\n      ExpressionAttributeValues: {\r\n        \":s\": S(\"REJECTED\"),\r\n        \":u\": S(now),\r\n        \":g2pk\": S(\"STATUS#REJECTED\"),\r\n        \":g2sk\": S(now),\r\n        \":r\": S(reason),\r\n      },\r\n      ReturnValues: \"ALL_OLD\",\r\n    }),\r\n  );\r\n\r\n  const prev = out.Attributes!;\r\n  const token = prev.taskToken?.S ?? prev.approvalToken?.S;\r\n\r\n  if (token) {\r\n    try {\r\n      await sfn.send(\r\n        new SendTaskFailureCommand({\r\n          taskToken: token,\r\n          error: \"Rejected\",\r\n          cause: reason || \"Rejected by admin\",\r\n        }),\r\n      );\r\n    } catch (err) {\r\n      console.warn(\"SendTaskFailure failed (token may be stale)\", err);\r\n    }\r\n  }\r\n\r\n  return mapItem({\r\n    ...prev,\r\n    status: S(\"REJECTED\"),\r\n    reason: S(reason),\r\n  });\r\n};\r\n\r\nexport const adminPublishClosetItem = async (\r\n  event: AppSyncEvent,\r\n): Promise<ClosetItem> => {\r\n  const { isAdmin } = getIdentity(event);\r\n  if (!isAdmin) throw new Error(\"Forbidden\");\r\n\r\n  const id = event.arguments?.closetItemId as string;\r\n  if (!id) throw new Error(\"closetItemId required\");\r\n\r\n  const now = nowIso();\r\n\r\n  const out = await ddb.send(\r\n    new UpdateItemCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: { pk: S(`ITEM#${id}`), sk: S(\"META\") },\r\n      UpdateExpression:\r\n        \"SET #s = :s, updatedAt = :u, gsi2pk = :g2pk, gsi2sk = :g2sk\",\r\n      ExpressionAttributeNames: { \"#s\": \"status\" },\r\n      ExpressionAttributeValues: {\r\n        \":s\": S(\"PUBLISHED\"),\r\n        \":u\": S(now),\r\n        \":g2pk\": S(\"STATUS#PUBLISHED\"),\r\n        \":g2sk\": S(now),\r\n      },\r\n      ReturnValues: \"ALL_NEW\",\r\n    }),\r\n  );\r\n\r\n  if (!out.Attributes) {\r\n    throw new Error(\"Closet item not found\");\r\n  }\r\n\r\n  return mapItem(out.Attributes);\r\n};\r\n\r\nexport const adminUpdateClosetItem = async (\r\n  event: AppSyncEvent,\r\n): Promise<ClosetItem> => {\r\n  const { isAdmin } = getIdentity(event);\r\n  if (!isAdmin) throw new Error(\"Forbidden\");\r\n\r\n  const args = event.arguments || {};\r\n  const rawInput = (args.input || {}) as AdminUpdateClosetItemInput;\r\n\r\n  const id =\r\n    (args.closetItemId as string | undefined) ??\r\n    (rawInput.id as string | undefined) ??\r\n    (args.id as string | undefined);\r\n\r\n  if (!id) throw new Error(\"closetItemId or input.id required\");\r\n\r\n  const existing = await ddb.send(\r\n    new GetItemCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: { pk: S(`ITEM#${id}`), sk: S(\"META\") },\r\n    }),\r\n  );\r\n  if (!existing.Item) {\r\n    throw new Error(\"Closet item not found\");\r\n  }\r\n\r\n  const input: AdminUpdateClosetItemInput = { ...rawInput };\r\n  (\r\n    [\"title\", \"category\", \"subcategory\", \"audience\", \"pinned\", \"season\", \"vibes\"] as const\r\n  ).forEach((field) => {\r\n    if ((args as any)[field] !== undefined && (input as any)[field] === undefined) {\r\n      (input as any)[field] = (args as any)[field];\r\n    }\r\n  });\r\n\r\n  const now = nowIso();\r\n\r\n  const updateExpr: string[] = [\"#updatedAt = :u\"];\r\n  const exprNames: Record<string, string> = {\r\n    \"#updatedAt\": \"updatedAt\",\r\n  };\r\n  const exprValues: Record<string, AttributeValue> = {\r\n    \":u\": S(now),\r\n  };\r\n\r\n  if (input.title !== undefined) {\r\n    updateExpr.push(\"#title = :title\");\r\n    exprNames[\"#title\"] = \"title\";\r\n    exprValues[\":title\"] = input.title === null ? { NULL: true } : S(input.title);\r\n  }\r\n\r\n  if (input.category !== undefined) {\r\n    updateExpr.push(\"#category = :category\");\r\n    exprNames[\"#category\"] = \"category\";\r\n    exprValues[\":category\"] =\r\n      input.category === null ? { NULL: true } : S(input.category);\r\n  }\r\n\r\n  if (input.subcategory !== undefined) {\r\n    updateExpr.push(\"#subcategory = :subcategory\");\r\n    exprNames[\"#subcategory\"] = \"subcategory\";\r\n    exprValues[\":subcategory\"] =\r\n      input.subcategory === null ? { NULL: true } : S(input.subcategory);\r\n  }\r\n\r\n  if (input.audience !== undefined) {\r\n    updateExpr.push(\"audience = :audience\");\r\n    exprValues[\":audience\"] =\r\n      input.audience === null ? { NULL: true } : S(input.audience);\r\n  }\r\n\r\n  if (input.season !== undefined) {\r\n    updateExpr.push(\"season = :season\");\r\n    exprValues[\":season\"] =\r\n      input.season === null ? { NULL: true } : S(input.season);\r\n  }\r\n\r\n  if (input.vibes !== undefined) {\r\n    updateExpr.push(\"vibes = :vibes\");\r\n    exprValues[\":vibes\"] = input.vibes === null ? { NULL: true } : S(input.vibes);\r\n  }\r\n\r\n  if (input.pinned !== undefined) {\r\n    updateExpr.push(\"pinned = :pinned\");\r\n    exprValues[\":pinned\"] =\r\n      input.pinned === null ? { NULL: true } : { BOOL: Boolean(input.pinned) };\r\n  }\r\n\r\n  if (updateExpr.length === 1) {\r\n    throw new Error(\"No fields provided to update\");\r\n  }\r\n\r\n  const out = await ddb.send(\r\n    new UpdateItemCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: { pk: S(`ITEM#${id}`), sk: S(\"META\") },\r\n      UpdateExpression: `SET ${updateExpr.join(\", \")}`,\r\n      ExpressionAttributeNames: exprNames,\r\n      ExpressionAttributeValues: exprValues,\r\n      ReturnValues: \"ALL_NEW\",\r\n    }),\r\n  );\r\n\r\n  if (!out.Attributes) {\r\n    throw new Error(\"Closet item not found\");\r\n  }\r\n\r\n  return mapItem(out.Attributes);\r\n};\r\n\r\nexport const adminSetClosetAudience = async (\r\n  event: AppSyncEvent,\r\n): Promise<ClosetItem> => {\r\n  const { isAdmin } = getIdentity(event);\r\n  if (!isAdmin) throw new Error(\"Forbidden\");\r\n\r\n  const id = event.arguments?.closetItemId as string;\r\n  const audience = event.arguments?.audience as string;\r\n\r\n  if (!id) throw new Error(\"closetItemId required\");\r\n  if (!audience) throw new Error(\"audience required\");\r\n\r\n  const now = nowIso();\r\n\r\n  const out = await ddb.send(\r\n    new UpdateItemCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: { pk: S(`ITEM#${id}`), sk: S(\"META\") },\r\n      UpdateExpression: \"SET audience = :aud, updatedAt = :u\",\r\n      ExpressionAttributeValues: {\r\n        \":aud\": S(audience),\r\n        \":u\": S(now),\r\n      },\r\n      ReturnValues: \"ALL_NEW\",\r\n    }),\r\n  );\r\n\r\n  if (!out.Attributes) {\r\n    throw new Error(\"Closet item not found\");\r\n  }\r\n\r\n  return mapItem(out.Attributes);\r\n};\r\n\r\nexport const toggleFavoriteClosetItem = async (\r\n  event: AppSyncEvent,\r\n): Promise<ClosetItem> => {\r\n  const { sub } = getIdentity(event);\r\n\r\n  const id = event.arguments?.id as string;\r\n  const favoriteOnArg = event.arguments?.favoriteOn as boolean | null | undefined;\r\n  const legacyOnArg = event.arguments?.on as boolean | null | undefined;\r\n\r\n  const onArg = typeof favoriteOnArg === \"boolean\" ? favoriteOnArg : legacyOnArg;\r\n\r\n  if (!id) throw new Error(\"id required\");\r\n\r\n  const getOut = await ddb.send(\r\n    new GetItemCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: { pk: S(`ITEM#${id}`), sk: S(\"META\") },\r\n    }),\r\n  );\r\n  const base = getOut.Item;\r\n  if (!base) throw new Error(\"Closet item not found\");\r\n\r\n  const favKey = { pk: S(`FAV#${sub}`), sk: S(`CLOSET#${id}`) };\r\n\r\n  const favOut = await ddb.send(\r\n    new GetItemCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: favKey,\r\n    }),\r\n  );\r\n\r\n  const currentlyOn = !!favOut.Item;\r\n  const targetOn = typeof onArg === \"boolean\" ? onArg : !currentlyOn;\r\n\r\n  const now = nowIso();\r\n  let delta = 0;\r\n\r\n  if (targetOn && !currentlyOn) {\r\n    delta = 1;\r\n    await ddb.send(\r\n      new PutItemCommand({\r\n        TableName: TABLE_NAME,\r\n        Item: {\r\n          ...favKey,\r\n          userSub: S(sub),\r\n          closetId: S(id),\r\n          createdAt: S(now),\r\n        },\r\n      }),\r\n    );\r\n  } else if (!targetOn && currentlyOn) {\r\n    delta = -1;\r\n    await ddb.send(\r\n      new DeleteItemCommand({\r\n        TableName: TABLE_NAME,\r\n        Key: favKey,\r\n      }),\r\n    );\r\n  }\r\n\r\n  if (delta !== 0) {\r\n    await ddb.send(\r\n      new UpdateItemCommand({\r\n        TableName: TABLE_NAME,\r\n        Key: { pk: S(`ITEM#${id}`), sk: S(\"META\") },\r\n        UpdateExpression:\r\n          \"SET favoriteCount = if_not_exists(favoriteCount, :zero) + :delta, updatedAt = :u\",\r\n        ExpressionAttributeValues: {\r\n          \":zero\": { N: \"0\" },\r\n          \":delta\": { N: String(delta) },\r\n          \":u\": S(now),\r\n        },\r\n      }),\r\n    );\r\n  }\r\n\r\n  const currentCountAttr = (base as any).favoriteCount?.N;\r\n  const currentCount =\r\n    typeof currentCountAttr === \"string\" ? Number(currentCountAttr) : 0;\r\n  const nextCount = Math.max(0, currentCount + delta);\r\n\r\n  return mapItem(base, {\r\n    favoriteCount: nextCount,\r\n    viewerHasFaved: targetOn,\r\n  });\r\n};\r\n\r\n/* ============== Dispatcher ============== */\r\n\r\nexport const handler = async (event: AppSyncEvent) => {\r\n  const field = event.info.fieldName;\r\n\r\n  if (field === \"adminListPending\") return adminListPending(event);\r\n  if (field === \"adminListClosetItems\") return adminListClosetItems(event);\r\n  if (field === \"adminListBestieClosetItems\")\r\n    return adminListBestieClosetItems(event);\r\n  if (field === \"adminCreateClosetItem\") return adminCreateClosetItem(event);\r\n  if (field === \"adminApproveItem\") return adminApproveItem(event);\r\n  if (field === \"adminRejectItem\") return adminRejectItem(event);\r\n  if (field === \"adminPublishClosetItem\") return adminPublishClosetItem(event);\r\n  if (field === \"adminSetClosetAudience\") return adminSetClosetAudience(event);\r\n  if (field === \"adminUpdateClosetItem\") return adminUpdateClosetItem(event);\r\n  if (field === \"closetFeed\") return closetFeed(event);\r\n  if (field === \"topClosetLooks\") return topClosetLooks(event);\r\n\r\n  if (field === \"toggleFavoriteClosetItem\" || field === \"likeClosetItem\") {\r\n    return toggleFavoriteClosetItem(event);\r\n  }\r\n\r\n  throw new Error(`No resolver implemented for field ${field}`);\r\n};\r\n\r\n\r\n"],
  "mappings": "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",
  "names": ["admin_exports", "__export", "adminApproveItem", "adminCreateClosetItem", "adminListBestieClosetItems", "adminListClosetItems", "adminListPending", "adminPublishClosetItem", "adminRejectItem", "adminSetClosetAudience", "adminUpdateClosetItem", "closetFeed", "handler", "toggleFavoriteClosetItem", "topClosetLooks", "__toCommonJS", "import_client_dynamodb", "import_client_sfn", "ddb", "sfn", "TABLE_NAME", "ADMIN_GROUP_NAME_RAW", "CREATOR_GROUP_NAME_RAW", "FAN_APPROVAL_SM_ARN", "ADMIN_GROUP_NAME", "CREATOR_GROUP_NAME", "nowIso", "S", "v", "VALID_CLOSET_STATUSES", "normalizeClosetStatus", "raw", "parseGroups", "identity", "claims", "g", "x", "getIdentity", "event", "sub", "groups", "groupsLc", "isAdmin", "isCreator", "mapItem", "extra", "idAttr", "ownerSubAttr", "statusRaw", "statusAttr", "createdAtAttr", "updatedAtAttr", "favoriteCountAttr", "favoriteCount", "pinnedAttr", "pinned", "randomId", "encodeToken", "key", "decodeToken", "token", "toLimit", "fallback", "n", "args", "limit", "exclusiveKey", "out", "it", "status", "normalized", "items", "a", "b", "page", "bestieAudiences", "aud", "sort", "favOut", "favIds", "f", "sk", "collected", "createdAtVal", "mapped", "aTime", "bTime", "af", "bf", "input", "rawKey", "id", "now", "err", "prev", "reason", "rawInput", "field", "updateExpr", "exprNames", "exprValues", "audience", "favoriteOnArg", "legacyOnArg", "onArg", "base", "favKey", "currentlyOn", "targetOn", "delta", "currentCountAttr", "currentCount", "nextCount"]
}
