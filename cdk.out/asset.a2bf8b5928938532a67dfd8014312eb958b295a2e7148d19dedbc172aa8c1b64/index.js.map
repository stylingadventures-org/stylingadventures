{
  "version": 3,
  "sources": ["../../lambda/creator-tools/index.ts", "../../../../../node_modules/uuid/dist/esm/stringify.js", "../../../../../node_modules/uuid/dist/esm/rng.js", "../../../../../node_modules/uuid/dist/esm/native.js", "../../../../../node_modules/uuid/dist/esm/v4.js"],
  "sourcesContent": ["import { DynamoDBClient } from \"@aws-sdk/client-dynamodb\";\r\nimport {\r\n  DynamoDBDocumentClient,\r\n  QueryCommand,\r\n  PutCommand,\r\n  UpdateCommand,\r\n  DeleteCommand,\r\n  GetCommand,\r\n} from \"@aws-sdk/lib-dynamodb\";\r\nimport { v4 as uuid } from \"uuid\";\r\nimport { S3Client, PutObjectCommand } from \"@aws-sdk/client-s3\";\r\nimport { getSignedUrl } from \"@aws-sdk/s3-request-presigner\";\r\nimport {\r\n  SFNClient,\r\n  StartSyncExecutionCommand,\r\n} from \"@aws-sdk/client-sfn\";\r\n\r\nconst ddb = DynamoDBDocumentClient.from(new DynamoDBClient({}));\r\nconst s3 = new S3Client({});\r\nconst sfnClient = new SFNClient({});\r\n\r\nconst TABLE_NAME = process.env.TABLE_NAME!;\r\nconst CREATOR_MEDIA_BUCKET = process.env.CREATOR_MEDIA_BUCKET!;\r\nconst PK = process.env.PK_NAME || \"pk\";\r\nconst SK = process.env.SK_NAME || \"sk\";\r\nconst STATUS_GSI = process.env.STATUS_GSI || \"gsi1\";\r\nconst SOCIAL_PULSE_SFN_ARN = process.env.SOCIAL_PULSE_SFN_ARN || \"\";\r\n\r\nfunction now() {\r\n  return new Date().toISOString();\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// Monetization HQ \u2013 earnings by platform (mocked, windowed)\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\ntype CreatorRevenueWindow = \"LAST_7_DAYS\" | \"LAST_30_DAYS\" | \"LAST_90_DAYS\";\r\n\r\nasync function creatorRevenueByPlatformResolver(event: any) {\r\n  const window: CreatorRevenueWindow =\r\n    event.arguments?.window || \"LAST_30_DAYS\";\r\n\r\n  const days =\r\n    window === \"LAST_7_DAYS\"\r\n      ? 7\r\n      : window === \"LAST_90_DAYS\"\r\n      ? 90\r\n      : 30;\r\n\r\n  // Simple sample fake data; you can swap this for real pipelines later.\r\n  const currency = \"USD\";\r\n\r\n  const platforms = [\r\n    {\r\n      platform: \"tiktok\",\r\n      label: \"TikTok / Reels\",\r\n      currency,\r\n      amount: 420.5,\r\n      lastPayoutAt: new Date().toISOString(),\r\n    },\r\n    {\r\n      platform: \"youtube\",\r\n      label: \"YouTube\",\r\n      currency,\r\n      amount: 310.2,\r\n      lastPayoutAt: new Date(\r\n        Date.now() - 3 * 86400000,\r\n      ).toISOString(),\r\n    },\r\n    {\r\n      platform: \"instagram\",\r\n      label: \"Instagram\",\r\n      currency,\r\n      amount: 165.0,\r\n      lastPayoutAt: null,\r\n    },\r\n  ];\r\n\r\n  const platformTotal = platforms.reduce(\r\n    (sum, p) => sum + p.amount,\r\n    0,\r\n  );\r\n\r\n  // Generate a simple upward trend timeseries\r\n  const today = new Date();\r\n  const timeseries = Array.from({ length: days }).map((_, i) => {\r\n    const d = new Date(today);\r\n    d.setDate(today.getDate() - (days - 1 - i));\r\n\r\n    const base = platformTotal / days;\r\n    const variance =\r\n      (i / (days - 1 || 1)) * 0.4 + 0.8; // ~0.8x to 1.2x\r\n\r\n    return {\r\n      date: d.toISOString().slice(0, 10), // YYYY-MM-DD\r\n      totalRevenue: Math.round(base * variance * 100) / 100,\r\n    };\r\n  });\r\n\r\n  const totalRevenue = timeseries.reduce(\r\n    (sum, p) => sum + p.totalRevenue,\r\n    0,\r\n  );\r\n\r\n  return {\r\n    currency,\r\n    totalRevenue,\r\n    platforms,\r\n    timeseries,\r\n  };\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// Director Suite \u2013 shoot plans (Dynamo persistence)\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function getDirectorShootPlan(sub: string, id: string) {\r\n  if (!sub) throw new Error(\"Not authenticated\");\r\n  if (!id) throw new Error(\"id is required\");\r\n\r\n  const pk = `CREATOR#${sub}`;\r\n  const sk = `DIRECTOR_SHOOT#${id}`;\r\n\r\n  const res = await ddb.send(\r\n    new GetCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: { [PK]: pk, [SK]: sk },\r\n    }),\r\n  );\r\n\r\n  if (!res.Item) return null;\r\n\r\n  const item = res.Item as any;\r\n\r\n  return {\r\n    id: item.id,\r\n    creatorId: sub,\r\n    shootName: item.shootName,\r\n    primaryPlatform: item.primaryPlatform,\r\n    objective: item.objective,\r\n    scenes: item.scenes || [],\r\n    createdAt: item.createdAt,\r\n    updatedAt: item.updatedAt,\r\n  };\r\n}\r\n\r\ninterface DirectorSceneInput {\r\n  id: string;\r\n  title: string;\r\n  shotType?: string | null;\r\n  location?: string | null;\r\n  mood?: string | null;\r\n  beats?: string | null;\r\n}\r\n\r\ninterface SaveDirectorShootPlanInput {\r\n  id?: string | null;\r\n  shootName: string;\r\n  primaryPlatform: string;\r\n  objective: string;\r\n  scenes: DirectorSceneInput[];\r\n}\r\n\r\nasync function saveDirectorShootPlan(\r\n  sub: string,\r\n  input: SaveDirectorShootPlanInput,\r\n) {\r\n  if (!sub) throw new Error(\"Not authenticated\");\r\n  if (!input) throw new Error(\"input is required\");\r\n\r\n  const id = input.id || \"default\";\r\n  const nowIso = now();\r\n\r\n  const pk = `CREATOR#${sub}`;\r\n  const sk = `DIRECTOR_SHOOT#${id}`;\r\n\r\n  const item = {\r\n    [PK]: pk,\r\n    [SK]: sk,\r\n    id,\r\n    creatorId: sub,\r\n    shootName: input.shootName,\r\n    primaryPlatform: input.primaryPlatform,\r\n    objective: input.objective,\r\n    scenes: input.scenes || [],\r\n    createdAt: nowIso,\r\n    updatedAt: nowIso,\r\n    type: \"DIRECTOR_SHOOT_PLAN\",\r\n  };\r\n\r\n  await ddb.send(\r\n    new PutCommand({\r\n      TableName: TABLE_NAME,\r\n      Item: item,\r\n    }),\r\n  );\r\n\r\n  return {\r\n    id,\r\n    creatorId: sub,\r\n    shootName: item.shootName,\r\n    primaryPlatform: item.primaryPlatform,\r\n    objective: item.objective,\r\n    scenes: item.scenes,\r\n    createdAt: item.createdAt,\r\n    updatedAt: item.updatedAt,\r\n  };\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// Mapping helpers\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nfunction mapCabinet(item: any) {\r\n  if (!item) return null;\r\n  return {\r\n    id: item.id,\r\n    ownerSub: item.ownerSub,\r\n    name: item.name,\r\n    description: item.description ?? null,\r\n    defaultCategory: item.defaultCategory ?? null,\r\n    tags: item.tags ?? [],\r\n    createdAt: item.createdAt,\r\n    updatedAt: item.updatedAt,\r\n    assetCount: item.assetCount ?? 0,\r\n  };\r\n}\r\n\r\nfunction mapFolder(item: any) {\r\n  if (!item) return null;\r\n  return {\r\n    id: item.id,\r\n    cabinetId: item.cabinetId,\r\n    name: item.name,\r\n    specialKind: item.specialKind ?? null,\r\n    createdAt: item.createdAt,\r\n    updatedAt: item.updatedAt,\r\n  };\r\n}\r\n\r\nfunction mapAsset(item: any) {\r\n  if (!item) return null;\r\n  return {\r\n    id: item.id,\r\n    cabinetId: item.cabinetId,\r\n    folderId: item.folderId ?? null,\r\n    ownerSub: item.ownerSub,\r\n    // ensure non-null for GraphQL\r\n    kind: item.kind ?? \"OTHER\",\r\n    category: item.category ?? null,\r\n    title: item.title ?? null,\r\n    notes: item.notes ?? null,\r\n    tags: item.tags ?? [],\r\n    s3Key: item.s3Key,\r\n    contentType: item.contentType ?? null,\r\n    createdAt: item.createdAt,\r\n    updatedAt: item.updatedAt,\r\n\r\n    // moderation defaults\r\n    moderationStatus: item.moderationStatus ?? \"ACTIVE\",\r\n    moderationReason: item.moderationReason ?? null,\r\n    moderatedBy: item.moderatedBy ?? null,\r\n    moderatedAt: item.moderatedAt ?? null,\r\n  };\r\n}\r\n\r\nfunction mapCreatorPrBoard(item: any) {\r\n  if (!item) return null;\r\n  return {\r\n    id: item.id,\r\n    creatorId: item.creatorId,\r\n    title: item.title,\r\n    description: item.description ?? null,\r\n    goalCompassSnapshot: item.goalCompassSnapshot ?? null,\r\n    timeHorizonFrom: item.timeHorizonFrom ?? null,\r\n    timeHorizonTo: item.timeHorizonTo ?? null,\r\n    createdAt: item.createdAt,\r\n    updatedAt: item.updatedAt,\r\n  };\r\n}\r\n\r\nfunction mapCreatorPrItem(item: any) {\r\n  if (!item) return null;\r\n  return {\r\n    id: item.id,\r\n    boardId: item.boardId,\r\n    creatorId: item.creatorId,\r\n\r\n    title: item.title,\r\n    platform: item.platform,\r\n    status: item.status ?? \"IDEA\",\r\n\r\n    notes: item.notes ?? null,\r\n\r\n    pulseId: item.pulseId ?? null,\r\n    contentIdeaId: item.contentIdeaId ?? null,\r\n\r\n    emotionalToneLabels: item.emotionalToneLabels ?? [],\r\n    audienceResponseLabel: item.audienceResponseLabel ?? null,\r\n    brandAlignmentScore:\r\n      typeof item.brandAlignmentScore === \"number\"\r\n        ? item.brandAlignmentScore\r\n        : null,\r\n    prRiskLevel: item.prRiskLevel ?? null,\r\n    lastEmotionalReviewAt: item.lastEmotionalReviewAt ?? null,\r\n\r\n    directorShootPlanId: item.directorShootPlanId ?? null,\r\n    directorAssetIds: item.directorAssetIds ?? [],\r\n    scheduleSlotId: item.scheduleSlotId ?? null,\r\n\r\n    createdAt: item.createdAt,\r\n    updatedAt: item.updatedAt,\r\n  };\r\n}\r\n\r\nfunction mapCreatorSocialPulseItem(item: any, sub: string) {\r\n  if (!item) return null;\r\n\r\n  const skVal = item[SK] as string | undefined;\r\n  let id = item.id as string | undefined;\r\n\r\n  if (!id && typeof skVal === \"string\" && skVal.startsWith(\"PULSE#\")) {\r\n    id = skVal.slice(\"PULSE#\".length);\r\n  }\r\n\r\n  return {\r\n    id: id!,\r\n    creatorId: item.creatorId ?? sub,\r\n    niche: item.niche ?? null,\r\n    platforms: Array.isArray(item.platforms) ? item.platforms : [],\r\n    trendBriefs: Array.isArray(item.trendBriefs) ? item.trendBriefs : [],\r\n    contentIdeas: Array.isArray(item.contentIdeas) ? item.contentIdeas : [],\r\n    createdAt: item.createdAt ?? item.updatedAt ?? now(),\r\n  };\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// CABINETS\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function listCabinets(sub: string) {\r\n  const res = await ddb.send(\r\n    new QueryCommand({\r\n      TableName: TABLE_NAME,\r\n      IndexName: STATUS_GSI,\r\n      KeyConditionExpression:\r\n        \"#gpk = :gpk AND begins_with(#gsk, :prefix)\",\r\n      ExpressionAttributeNames: {\r\n        \"#gpk\": \"gsi1pk\",\r\n        \"#gsk\": \"gsi1sk\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":gpk\": `CREATOR#${sub}`,\r\n        \":prefix\": \"CAB#\",\r\n      },\r\n    }),\r\n  );\r\n\r\n  let items = res.Items ?? [];\r\n\r\n  // If this creator has no cabinets yet, auto-create a starter one.\r\n  if (items.length === 0) {\r\n    const starter = await createDefaultCabinetForCreator(sub);\r\n    items = [starter];\r\n  }\r\n\r\n  return items.map(mapCabinet);\r\n}\r\n\r\nasync function getCabinet(sub: string, id: string) {\r\n  if (!id) throw new Error(\"id is required\");\r\n\r\n  const res = await ddb.send(\r\n    new GetCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${id}`,\r\n        [SK]: \"META\",\r\n      },\r\n    }),\r\n  );\r\n\r\n  if (!res.Item || res.Item.ownerSub !== sub) {\r\n    // hide existence of other peoples\u2019 cabinets\r\n    return null;\r\n  }\r\n\r\n  return mapCabinet(res.Item);\r\n}\r\n\r\nasync function createDefaultCabinetForCreator(sub: string) {\r\n  const nowIso = now();\r\n  const id = uuid();\r\n\r\n  const item = {\r\n    [PK]: `CAB#${id}`,\r\n    [SK]: \"META\",\r\n    type: \"CABINET\",\r\n    id,\r\n    ownerSub: sub,\r\n    name: \"From my closet\",\r\n    description:\r\n      \"Imported looks and outfit references from your Bestie closet\",\r\n    defaultCategory: \"OUTFIT_REFS\",\r\n    tags: [\"closet-import\"],\r\n    assetCount: 0,\r\n    createdAt: nowIso,\r\n    updatedAt: nowIso,\r\n    gsi1pk: `CREATOR#${sub}`,\r\n    gsi1sk: `CAB#${nowIso}#${id}`,\r\n  };\r\n\r\n  await ddb.send(\r\n    new PutCommand({\r\n      TableName: TABLE_NAME,\r\n      Item: item,\r\n      ConditionExpression: \"attribute_not_exists(#pk)\",\r\n      ExpressionAttributeNames: {\r\n        \"#pk\": PK,\r\n      },\r\n    }),\r\n  );\r\n\r\n  return item;\r\n}\r\n\r\nasync function createCabinet(sub: string, input: any) {\r\n  if (!input?.name) {\r\n    throw new Error(\"name is required\");\r\n  }\r\n\r\n  const id = uuid();\r\n  const nowIso = now();\r\n\r\n  const item = {\r\n    [PK]: `CAB#${id}`,\r\n    [SK]: \"META\",\r\n    type: \"CABINET\",\r\n    id,\r\n    ownerSub: sub,\r\n    name: input.name,\r\n    description: input.description ?? null,\r\n    defaultCategory: input.defaultCategory ?? null,\r\n    tags: input.tags ?? [],\r\n    assetCount: 0,\r\n    createdAt: nowIso,\r\n    updatedAt: nowIso,\r\n    // GSI to list cabinets per creator\r\n    gsi1pk: `CREATOR#${sub}`,\r\n    gsi1sk: `CAB#${nowIso}#${id}`,\r\n  };\r\n\r\n  await ddb.send(\r\n    new PutCommand({\r\n      TableName: TABLE_NAME,\r\n      Item: item,\r\n      ConditionExpression: \"attribute_not_exists(#pk)\",\r\n      ExpressionAttributeNames: {\r\n        \"#pk\": PK,\r\n      },\r\n    }),\r\n  );\r\n\r\n  return mapCabinet(item);\r\n}\r\n\r\nasync function updateCabinet(sub: string, input: any) {\r\n  const id = input?.id;\r\n  if (!id) throw new Error(\"id is required\");\r\n  if (!input) throw new Error(\"input is required\");\r\n\r\n  const nowIso = now();\r\n\r\n  const names: Record<string, string> = {\r\n    \"#updatedAt\": \"updatedAt\",\r\n    \"#ownerSub\": \"ownerSub\",\r\n  };\r\n  const values: Record<string, any> = {\r\n    \":updatedAt\": nowIso,\r\n    \":ownerSub\": sub,\r\n  };\r\n  const sets: string[] = [\"#updatedAt = :updatedAt\"];\r\n\r\n  if (Object.prototype.hasOwnProperty.call(input, \"name\")) {\r\n    names[\"#name\"] = \"name\";\r\n    values[\":name\"] = input.name;\r\n    sets.push(\"#name = :name\");\r\n  }\r\n  if (Object.prototype.hasOwnProperty.call(input, \"description\")) {\r\n    names[\"#description\"] = \"description\";\r\n    values[\":description\"] = input.description ?? null;\r\n    sets.push(\"#description = :description\");\r\n  }\r\n  if (Object.prototype.hasOwnProperty.call(input, \"defaultCategory\")) {\r\n    names[\"#defaultCategory\"] = \"defaultCategory\";\r\n    values[\":defaultCategory\"] = input.defaultCategory ?? null;\r\n    sets.push(\"#defaultCategory = :defaultCategory\");\r\n  }\r\n  if (Object.prototype.hasOwnProperty.call(input, \"tags\")) {\r\n    names[\"#tags\"] = \"tags\";\r\n    values[\":tags\"] = input.tags ?? [];\r\n    sets.push(\"#tags = :tags\");\r\n  }\r\n\r\n  const res = await ddb.send(\r\n    new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${id}`,\r\n        [SK]: \"META\",\r\n      },\r\n      UpdateExpression: \"SET \" + sets.join(\", \"),\r\n      ConditionExpression: \"#ownerSub = :ownerSub\",\r\n      ExpressionAttributeNames: names,\r\n      ExpressionAttributeValues: values,\r\n      ReturnValues: \"ALL_NEW\",\r\n    }),\r\n  );\r\n\r\n  return mapCabinet(res.Attributes);\r\n}\r\n\r\nasync function deleteCabinet(sub: string, id: string) {\r\n  if (!id) throw new Error(\"id is required\");\r\n\r\n  const pkValue = `CAB#${id}`;\r\n\r\n  // First fetch all rows for this cabinet to confirm ownership & cascade delete.\r\n  const res = await ddb.send(\r\n    new QueryCommand({\r\n      TableName: TABLE_NAME,\r\n      KeyConditionExpression: \"#pk = :pk\",\r\n      ExpressionAttributeNames: {\r\n        \"#pk\": PK,\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":pk\": pkValue,\r\n      },\r\n    }),\r\n  );\r\n\r\n  const items = res.Items ?? [];\r\n  const meta = items.find((it) => it.type === \"CABINET\");\r\n\r\n  if (!meta || meta.ownerSub !== sub) {\r\n    // Not your cabinet \u2192 pretend it doesn't exist\r\n    return false;\r\n  }\r\n\r\n  // Best-effort cascade delete\r\n  await Promise.all(\r\n    items.map((item) =>\r\n      ddb.send(\r\n        new DeleteCommand({\r\n          TableName: TABLE_NAME,\r\n          Key: {\r\n            [PK]: item[PK],\r\n            [SK]: item[SK],\r\n          },\r\n        }),\r\n      ),\r\n    ),\r\n  );\r\n\r\n  return true;\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// FOLDERS\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function listFolders(sub: string, cabinetId: string) {\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n\r\n  // optional: check cabinet ownership\r\n  const cabinet = await getCabinet(sub, cabinetId);\r\n  if (!cabinet) {\r\n    // hide if not owner\r\n    return [];\r\n  }\r\n\r\n  const res = await ddb.send(\r\n    new QueryCommand({\r\n      TableName: TABLE_NAME,\r\n      KeyConditionExpression:\r\n        \"#pk = :pk AND begins_with(#sk, :prefix)\",\r\n      ExpressionAttributeNames: {\r\n        \"#pk\": PK,\r\n        \"#sk\": SK,\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":pk\": `CAB#${cabinetId}`,\r\n        \":prefix\": \"FOLDER#\",\r\n      },\r\n    }),\r\n  );\r\n\r\n  const items = res.Items ?? [];\r\n  return items.map(mapFolder);\r\n}\r\n\r\nasync function createFolder(sub: string, input: any) {\r\n  const { cabinetId, name } = input || {};\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n  if (!name) throw new Error(\"name is required\");\r\n\r\n  const cabinet = await getCabinet(sub, cabinetId);\r\n  if (!cabinet) {\r\n    throw new Error(\"Cabinet not found\");\r\n  }\r\n\r\n  const id = uuid();\r\n  const nowIso = now();\r\n\r\n  const item = {\r\n    [PK]: `CAB#${cabinetId}`,\r\n    [SK]: `FOLDER#${id}`,\r\n    type: \"FOLDER\",\r\n    id,\r\n    cabinetId,\r\n    ownerSub: sub,\r\n    name,\r\n    specialKind: null,\r\n    createdAt: nowIso,\r\n    updatedAt: nowIso,\r\n  };\r\n\r\n  await ddb.send(\r\n    new PutCommand({\r\n      TableName: TABLE_NAME,\r\n      Item: item,\r\n      ConditionExpression:\r\n        \"attribute_not_exists(#pk) AND attribute_not_exists(#sk)\",\r\n      ExpressionAttributeNames: {\r\n        \"#pk\": PK,\r\n        \"#sk\": SK,\r\n      },\r\n    }),\r\n  );\r\n\r\n  return mapFolder(item);\r\n}\r\n\r\nasync function renameFolder(sub: string, input: any) {\r\n  const { id, cabinetId, name } = input || {};\r\n  if (!id) throw new Error(\"id is required\");\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n  if (!name) throw new Error(\"name is required\");\r\n\r\n  const nowIso = now();\r\n\r\n  const res = await ddb.send(\r\n    new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: `FOLDER#${id}`,\r\n      },\r\n      UpdateExpression: \"SET #name = :name, #updatedAt = :updatedAt\",\r\n      ConditionExpression: \"#ownerSub = :ownerSub\",\r\n      ExpressionAttributeNames: {\r\n        \"#name\": \"name\",\r\n        \"#updatedAt\": \"updatedAt\",\r\n        \"#ownerSub\": \"ownerSub\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":name\": name,\r\n        \":updatedAt\": nowIso,\r\n        \":ownerSub\": sub,\r\n      },\r\n      ReturnValues: \"ALL_NEW\",\r\n    }),\r\n  );\r\n\r\n  return mapFolder(res.Attributes);\r\n}\r\n\r\nasync function deleteFolder(sub: string, id: string, cabinetId: string) {\r\n  if (!id) throw new Error(\"id is required\");\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n\r\n  // Delete the folder row (with ownership check)\r\n  await ddb.send(\r\n    new DeleteCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: `FOLDER#${id}`,\r\n      },\r\n      ConditionExpression: \"#ownerSub = :ownerSub\",\r\n      ExpressionAttributeNames: {\r\n        \"#ownerSub\": \"ownerSub\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":ownerSub\": sub,\r\n      },\r\n    }),\r\n  );\r\n\r\n  // Best-effort cleanup: move any assets in this folder to \"unsorted\" (null folderId)\r\n  const res = await ddb.send(\r\n    new QueryCommand({\r\n      TableName: TABLE_NAME,\r\n      KeyConditionExpression:\r\n        \"#pk = :pk AND begins_with(#sk, :prefix)\",\r\n      ExpressionAttributeNames: {\r\n        \"#pk\": PK,\r\n        \"#sk\": SK,\r\n        \"#folderId\": \"folderId\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":pk\": `CAB#${cabinetId}`,\r\n        \":prefix\": \"ASSET#\",\r\n        \":folderId\": id,\r\n      },\r\n      FilterExpression: \"#folderId = :folderId\",\r\n    }),\r\n  );\r\n\r\n  const assets = res.Items ?? [];\r\n  await Promise.all(\r\n    assets.map((asset) =>\r\n      ddb.send(\r\n        new UpdateCommand({\r\n          TableName: TABLE_NAME,\r\n          Key: {\r\n            [PK]: asset[PK],\r\n            [SK]: asset[SK],\r\n          },\r\n          UpdateExpression: \"SET #folderId = :null\",\r\n          ExpressionAttributeNames: {\r\n            \"#folderId\": \"folderId\",\r\n          },\r\n          ExpressionAttributeValues: {\r\n            \":null\": null,\r\n          },\r\n        }),\r\n      ),\r\n    ),\r\n  );\r\n\r\n  return true;\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// ASSETS \u2013 creator-facing\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function listAssets(sub: string, args: any) {\r\n  const {\r\n    cabinetId,\r\n    folderId,\r\n    category,\r\n    tag,\r\n    search,\r\n    limit = 50,\r\n    nextToken,\r\n  } = args || {};\r\n\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n\r\n  const cabinet = await getCabinet(sub, cabinetId);\r\n  if (!cabinet) {\r\n    // Hide if not owner\r\n    return {\r\n      items: [],\r\n      nextToken: null,\r\n    };\r\n  }\r\n\r\n  const queryInput: any = {\r\n    TableName: TABLE_NAME,\r\n    KeyConditionExpression:\r\n      \"#pk = :pk AND begins_with(#sk, :prefix)\",\r\n    ExpressionAttributeNames: {\r\n      \"#pk\": PK,\r\n      \"#sk\": SK,\r\n    },\r\n    ExpressionAttributeValues: {\r\n      \":pk\": `CAB#${cabinetId}`,\r\n      \":prefix\": \"ASSET#\",\r\n    },\r\n    Limit: limit,\r\n  };\r\n\r\n  if (nextToken) {\r\n    queryInput.ExclusiveStartKey = {\r\n      [PK]: `CAB#${cabinetId}`,\r\n      [SK]: nextToken,\r\n    };\r\n  }\r\n\r\n  const res = await ddb.send(new QueryCommand(queryInput));\r\n  let items = (res.Items ?? []).filter((it) => it.type === \"ASSET\");\r\n\r\n  // Hide moderated assets for the creator UI:\r\n  items = items.filter((it) => {\r\n    const status = String(it.moderationStatus ?? \"ACTIVE\").toUpperCase();\r\n    return status === \"ACTIVE\";\r\n  });\r\n\r\n  // In-memory filters\r\n  if (folderId !== undefined && folderId !== null) {\r\n    items = items.filter((it) => it.folderId === folderId);\r\n  }\r\n  if (category) {\r\n    items = items.filter((it) => it.category === category);\r\n  }\r\n  if (tag) {\r\n    items = items.filter(\r\n      (it) => Array.isArray(it.tags) && it.tags.includes(tag),\r\n    );\r\n  }\r\n  if (search) {\r\n    const q = String(search).toLowerCase();\r\n    items = items.filter((it) => {\r\n      const title = (it.title ?? \"\").toLowerCase();\r\n      const notes = (it.notes ?? \"\").toLowerCase();\r\n      return title.includes(q) || notes.includes(q);\r\n    });\r\n  }\r\n\r\n  const connectionNextToken =\r\n    res.LastEvaluatedKey ? res.LastEvaluatedKey[SK] : null;\r\n\r\n  return {\r\n    items: items.map(mapAsset),\r\n    nextToken: connectionNextToken,\r\n  };\r\n}\r\n\r\n// Upload flow\r\nasync function createAssetUpload(sub: string, input: any) {\r\n  const {\r\n    cabinetId,\r\n    folderId,\r\n    category,\r\n    title,\r\n    notes,\r\n    tags = [],\r\n    fileName,\r\n    filename, // tolerate old name\r\n    contentType,\r\n    kind,\r\n  } = input || {};\r\n\r\n  const finalFileName = fileName ?? filename;\r\n\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n  if (!finalFileName) throw new Error(\"fileName is required\");\r\n  if (!contentType) throw new Error(\"contentType is required\");\r\n\r\n  // Ensure cabinet exists + belongs to user\r\n  const cabinet = await getCabinet(sub, cabinetId);\r\n  if (!cabinet) {\r\n    throw new Error(\"Cabinet not found\");\r\n  }\r\n\r\n  const assetId = uuid();\r\n  const folderPart = folderId || \"unsorted\";\r\n  const safeName = String(finalFileName).replace(/[^a-zA-Z0-9._-]/g, \"_\");\r\n\r\n  const s3Key = [\r\n    \"creator-media\",\r\n    sub,\r\n    cabinetId,\r\n    folderPart,\r\n    `${assetId}-${safeName}`,\r\n  ].join(\"/\");\r\n\r\n  const nowIso = now();\r\n  const assetKind = kind ?? \"OTHER\";\r\n\r\n  const item = {\r\n    [PK]: `CAB#${cabinetId}`,\r\n    [SK]: `ASSET#${assetId}`,\r\n    type: \"ASSET\",\r\n    id: assetId,\r\n    cabinetId,\r\n    folderId: folderId ?? null,\r\n    ownerSub: sub,\r\n    kind: assetKind,\r\n    category: category ?? null,\r\n    title: title ?? null,\r\n    notes: notes ?? null,\r\n    tags,\r\n    s3Key,\r\n    contentType,\r\n    createdAt: nowIso,\r\n    updatedAt: nowIso,\r\n\r\n    // moderation defaults\r\n    moderationStatus: \"ACTIVE\" as const,\r\n    moderationReason: null,\r\n    moderatedBy: null,\r\n    moderatedAt: null,\r\n\r\n    // GSI for admin listing by user\r\n    gsi1pk: `CREATOR#${sub}`,\r\n    gsi1sk: `CAB_ASSET#${cabinetId}#${nowIso}#${assetId}`,\r\n  };\r\n\r\n  // 1) create ASSET row in Dynamo (pending upload)\r\n  await ddb.send(\r\n    new PutCommand({\r\n      TableName: TABLE_NAME,\r\n      Item: item,\r\n    }),\r\n  );\r\n\r\n  // Best-effort: bump cabinet.assetCount\r\n  await ddb.send(\r\n    new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: \"META\",\r\n      },\r\n      UpdateExpression:\r\n        \"SET #assetCount = if_not_exists(#assetCount, :zero) + :one, #updatedAt = :updatedAt\",\r\n      ExpressionAttributeNames: {\r\n        \"#assetCount\": \"assetCount\",\r\n        \"#updatedAt\": \"updatedAt\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":zero\": 0,\r\n        \":one\": 1,\r\n        \":updatedAt\": nowIso,\r\n      },\r\n    }),\r\n  );\r\n\r\n  // 2) make a presigned URL so the browser can PUT the file\r\n  const putCmd = new PutObjectCommand({\r\n    Bucket: CREATOR_MEDIA_BUCKET,\r\n    Key: s3Key,\r\n    ContentType: contentType,\r\n  });\r\n\r\n  const uploadUrl = await getSignedUrl(s3, putCmd, { expiresIn: 900 });\r\n\r\n  return {\r\n    uploadUrl,\r\n    asset: mapAsset(item),\r\n  };\r\n}\r\n\r\nasync function updateAsset(sub: string, input: any) {\r\n  const { id, cabinetId } = input || {};\r\n  if (!id) throw new Error(\"id is required\");\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n\r\n  const nowIso = now();\r\n\r\n  const names: Record<string, string> = {\r\n    \"#updatedAt\": \"updatedAt\",\r\n    \"#ownerSub\": \"ownerSub\",\r\n  };\r\n  const values: Record<string, any> = {\r\n    \":updatedAt\": nowIso,\r\n    \":ownerSub\": sub,\r\n  };\r\n  const sets: string[] = [\"#updatedAt = :updatedAt\"];\r\n\r\n  if (Object.prototype.hasOwnProperty.call(input, \"folderId\")) {\r\n    names[\"#folderId\"] = \"folderId\";\r\n    values[\":folderId\"] = input.folderId ?? null;\r\n    sets.push(\"#folderId = :folderId\");\r\n  }\r\n  if (Object.prototype.hasOwnProperty.call(input, \"category\")) {\r\n    names[\"#category\"] = \"category\";\r\n    values[\":category\"] = input.category ?? null;\r\n    sets.push(\"#category = :category\");\r\n  }\r\n  if (Object.prototype.hasOwnProperty.call(input, \"title\")) {\r\n    names[\"#title\"] = \"title\";\r\n    values[\":title\"] = input.title ?? null;\r\n    sets.push(\"#title = :title\");\r\n  }\r\n  if (Object.prototype.hasOwnProperty.call(input, \"notes\")) {\r\n    names[\"#notes\"] = \"notes\";\r\n    values[\":notes\"] = input.notes ?? null;\r\n    sets.push(\"#notes = :notes\");\r\n  }\r\n  if (Object.prototype.hasOwnProperty.call(input, \"tags\")) {\r\n    names[\"#tags\"] = \"tags\";\r\n    values[\":tags\"] = input.tags ?? [];\r\n    sets.push(\"#tags = :tags\");\r\n  }\r\n  if (Object.prototype.hasOwnProperty.call(input, \"kind\")) {\r\n    names[\"#kind\"] = \"kind\";\r\n    values[\":kind\"] = input.kind ?? \"OTHER\";\r\n    sets.push(\"#kind = :kind\");\r\n  }\r\n  if (Object.prototype.hasOwnProperty.call(input, \"contentType\")) {\r\n    names[\"#contentType\"] = \"contentType\";\r\n    values[\":contentType\"] = input.contentType ?? null;\r\n    sets.push(\"#contentType = :contentType\");\r\n  }\r\n\r\n  const res = await ddb.send(\r\n    new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: `ASSET#${id}`,\r\n      },\r\n      UpdateExpression: \"SET \" + sets.join(\", \"),\r\n      ConditionExpression: \"#ownerSub = :ownerSub\",\r\n      ExpressionAttributeNames: names,\r\n      ExpressionAttributeValues: values,\r\n      ReturnValues: \"ALL_NEW\",\r\n    }),\r\n  );\r\n\r\n  return mapAsset(res.Attributes);\r\n}\r\n\r\nasync function deleteAsset(sub: string, id: string, cabinetId: string) {\r\n  if (!id) throw new Error(\"id is required\");\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n\r\n  const nowIso = now();\r\n\r\n  // 1) Delete the asset row with ownership check\r\n  await ddb.send(\r\n    new DeleteCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: `ASSET#${id}`,\r\n      },\r\n      ConditionExpression: \"#ownerSub = :ownerSub\",\r\n      ExpressionAttributeNames: {\r\n        \"#ownerSub\": \"ownerSub\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":ownerSub\": sub,\r\n      },\r\n    }),\r\n  );\r\n\r\n  // 2) Best-effort: decrement assetCount\r\n  await ddb.send(\r\n    new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: \"META\",\r\n      },\r\n      UpdateExpression:\r\n        \"SET #assetCount = if_not_exists(#assetCount, :zero) - :one, #updatedAt = :updatedAt\",\r\n      ExpressionAttributeNames: {\r\n        \"#assetCount\": \"assetCount\",\r\n        \"#updatedAt\": \"updatedAt\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":zero\": 0,\r\n        \":one\": 1,\r\n        \":updatedAt\": nowIso,\r\n      },\r\n    }),\r\n  );\r\n\r\n  return true;\r\n}\r\n\r\nasync function moveAsset(sub: string, input: any) {\r\n  const { id, cabinetId, destinationFolderId } = input || {};\r\n  if (!id) throw new Error(\"id is required\");\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n\r\n  const nowIso = now();\r\n\r\n  const res = await ddb.send(\r\n    new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: `ASSET#${id}`,\r\n      },\r\n      UpdateExpression:\r\n        \"SET #folderId = :folderId, #updatedAt = :updatedAt\",\r\n      ConditionExpression: \"#ownerSub = :ownerSub\",\r\n      ExpressionAttributeNames: {\r\n        \"#folderId\": \"folderId\",\r\n        \"#updatedAt\": \"updatedAt\",\r\n        \"#ownerSub\": \"ownerSub\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":folderId\": destinationFolderId ?? null,\r\n        \":updatedAt\": nowIso,\r\n        \":ownerSub\": sub,\r\n      },\r\n      ReturnValues: \"ALL_NEW\",\r\n    }),\r\n  );\r\n\r\n  return mapAsset(res.Attributes);\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// ASSETS \u2013 admin listing / moderation\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function adminListCreatorAssetsByUser(args: any) {\r\n  const {\r\n    ownerSub,\r\n    cabinetId,\r\n    folderId,\r\n    moderationStatus,\r\n    includeSoftDeleted = true,\r\n    limit = 50,\r\n  } = args || {};\r\n\r\n  if (!ownerSub) throw new Error(\"ownerSub is required\");\r\n\r\n  const res = await ddb.send(\r\n    new QueryCommand({\r\n      TableName: TABLE_NAME,\r\n      IndexName: STATUS_GSI,\r\n      KeyConditionExpression:\r\n        \"#gpk = :gpk AND begins_with(#gsk, :prefix)\",\r\n      ExpressionAttributeNames: {\r\n        \"#gpk\": \"gsi1pk\",\r\n        \"#gsk\": \"gsi1sk\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":gpk\": `CREATOR#${ownerSub}`,\r\n        \":prefix\": \"CAB_ASSET#\",\r\n      },\r\n      Limit: limit,\r\n    }),\r\n  );\r\n\r\n  let items = (res.Items ?? []).filter((it) => it.type === \"ASSET\");\r\n\r\n  if (cabinetId) {\r\n    items = items.filter((it) => it.cabinetId === cabinetId);\r\n  }\r\n  if (folderId !== undefined && folderId !== null) {\r\n    items = items.filter((it) => it.folderId === folderId);\r\n  }\r\n\r\n  if (moderationStatus) {\r\n    const wanted = String(moderationStatus).toUpperCase();\r\n    items = items.filter(\r\n      (it) =>\r\n        String(it.moderationStatus ?? \"ACTIVE\").toUpperCase() === wanted,\r\n    );\r\n  }\r\n\r\n  if (!includeSoftDeleted) {\r\n    items = items.filter(\r\n      (it) =>\r\n        String(it.moderationStatus ?? \"ACTIVE\").toUpperCase() !==\r\n        \"SOFT_DELETED\",\r\n    );\r\n  }\r\n\r\n  return {\r\n    items: items.map(mapAsset),\r\n    nextToken: null, // simple for now; can add JSON-encoded LastEvaluatedKey later\r\n  };\r\n}\r\n\r\nasync function adminGetCreatorAsset(args: any) {\r\n  const { cabinetId, id } = args || {};\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n  if (!id) throw new Error(\"id is required\");\r\n\r\n  const res = await ddb.send(\r\n    new GetCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: `ASSET#${id}`,\r\n      },\r\n    }),\r\n  );\r\n\r\n  if (!res.Item || res.Item.type !== \"ASSET\") {\r\n    return null;\r\n  }\r\n\r\n  return mapAsset(res.Item);\r\n}\r\n\r\nasync function adminModerateCreatorAsset(adminSub: string, input: any) {\r\n  const { cabinetId, id, moderationStatus, moderationReason, tags } =\r\n    input || {};\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n  if (!id) throw new Error(\"id is required\");\r\n  if (!moderationStatus) throw new Error(\"moderationStatus is required\");\r\n\r\n  const nowIso = now();\r\n\r\n  const names: Record<string, string> = {\r\n    \"#moderationStatus\": \"moderationStatus\",\r\n    \"#updatedAt\": \"updatedAt\",\r\n    \"#moderatedAt\": \"moderatedAt\",\r\n    \"#moderatedBy\": \"moderatedBy\",\r\n  };\r\n  const values: Record<string, any> = {\r\n    \":moderationStatus\": moderationStatus,\r\n    \":updatedAt\": nowIso,\r\n    \":moderatedAt\": nowIso,\r\n    \":moderatedBy\": adminSub,\r\n  };\r\n  const sets: string[] = [\r\n    \"#moderationStatus = :moderationStatus\",\r\n    \"#updatedAt = :updatedAt\",\r\n    \"#moderatedAt = :moderatedAt\",\r\n    \"#moderatedBy = :moderatedBy\",\r\n  ];\r\n\r\n  if (Object.prototype.hasOwnProperty.call(input, \"moderationReason\")) {\r\n    names[\"#moderationReason\"] = \"moderationReason\";\r\n    values[\":moderationReason\"] = moderationReason ?? null;\r\n    sets.push(\"#moderationReason = :moderationReason\");\r\n  }\r\n\r\n  if (Array.isArray(tags)) {\r\n    names[\"#tags\"] = \"tags\";\r\n    values[\":tags\"] = tags;\r\n    sets.push(\"#tags = :tags\");\r\n  }\r\n\r\n  const res = await ddb.send(\r\n    new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: `ASSET#${id}`,\r\n      },\r\n      UpdateExpression: \"SET \" + sets.join(\", \"),\r\n      ReturnValues: \"ALL_NEW\",\r\n    }),\r\n  );\r\n\r\n  return mapAsset(res.Attributes);\r\n}\r\n\r\nasync function adminRejectCreatorAsset(adminSub: string, input: any) {\r\n  if (!input) throw new Error(\"input is required\");\r\n  const { cabinetId, id, moderationReason, tags } = input;\r\n\r\n  return adminModerateCreatorAsset(adminSub, {\r\n    cabinetId,\r\n    id,\r\n    moderationStatus: \"REJECTED\",\r\n    moderationReason,\r\n    tags,\r\n  });\r\n}\r\n\r\nasync function adminSoftDeleteCreatorAsset(adminSub: string, input: any) {\r\n  const { cabinetId, id, reason } = input || {};\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n  if (!id) throw new Error(\"id is required\");\r\n\r\n  const nowIso = now();\r\n\r\n  const res = await ddb.send(\r\n    new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: `ASSET#${id}`,\r\n      },\r\n      UpdateExpression:\r\n        \"SET #moderationStatus = :status, #moderationReason = :reason, #moderatedBy = :moderatedBy, #moderatedAt = :moderatedAt, #updatedAt = :updatedAt\",\r\n      ExpressionAttributeNames: {\r\n        \"#moderationStatus\": \"moderationStatus\",\r\n        \"#moderationReason\": \"moderationReason\",\r\n        \"#moderatedBy\": \"moderatedBy\",\r\n        \"#moderatedAt\": \"moderatedAt\",\r\n        \"#updatedAt\": \"updatedAt\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":status\": \"SOFT_DELETED\",\r\n        \":reason\": reason ?? null,\r\n        \":moderatedBy\": adminSub,\r\n        \":moderatedAt\": nowIso,\r\n        \":updatedAt\": nowIso,\r\n      },\r\n      ReturnValues: \"ALL_NEW\",\r\n    }),\r\n  );\r\n\r\n  return mapAsset(res.Attributes);\r\n}\r\n\r\nasync function adminRestoreCreatorAsset(adminSub: string, input: any) {\r\n  const { cabinetId, id } = input || {};\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n  if (!id) throw new Error(\"id is required\");\r\n\r\n  const nowIso = now();\r\n\r\n  const res = await ddb.send(\r\n    new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: `ASSET#${id}`,\r\n      },\r\n      UpdateExpression:\r\n        \"SET #moderationStatus = :status, #moderationReason = :reason, #moderatedBy = :moderatedBy, #moderatedAt = :moderatedAt, #updatedAt = :updatedAt\",\r\n      ExpressionAttributeNames: {\r\n        \"#moderationStatus\": \"moderationStatus\",\r\n        \"#moderationReason\": \"moderationReason\",\r\n        \"#moderatedBy\": \"moderatedBy\",\r\n        \"#moderatedAt\": \"moderatedAt\",\r\n        \"#updatedAt\": \"updatedAt\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":status\": \"ACTIVE\",\r\n        \":reason\": null,\r\n        \":moderatedBy\": adminSub,\r\n        \":moderatedAt\": nowIso,\r\n        \":updatedAt\": nowIso,\r\n      },\r\n      ReturnValues: \"ALL_NEW\",\r\n    }),\r\n  );\r\n\r\n  return mapAsset(res.Attributes);\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// Creator PR & Content Studio \u2013 boards & items\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function listCreatorPrBoards(sub: string) {\r\n  const res = await ddb.send(\r\n    new QueryCommand({\r\n      TableName: TABLE_NAME,\r\n      IndexName: STATUS_GSI,\r\n      KeyConditionExpression:\r\n        \"#gpk = :gpk AND begins_with(#gsk, :prefix)\",\r\n      ExpressionAttributeNames: {\r\n        \"#gpk\": \"gsi1pk\",\r\n        \"#gsk\": \"gsi1sk\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":gpk\": `CREATOR#${sub}`,\r\n        \":prefix\": \"CPB#\",\r\n      },\r\n    }),\r\n  );\r\n\r\n  const items = (res.Items ?? []).filter(\r\n    (it) => it.type === \"CREATOR_PR_BOARD\",\r\n  );\r\n\r\n  return items.map(mapCreatorPrBoard);\r\n}\r\n\r\nasync function listCreatorPrItemsByBoard(\r\n  sub: string,\r\n  boardId: string,\r\n) {\r\n  if (!boardId) throw new Error(\"boardId is required\");\r\n\r\n  // Enforce ownership\r\n  await requireCreatorPrBoard(sub, boardId);\r\n\r\n  const res = await ddb.send(\r\n    new QueryCommand({\r\n      TableName: TABLE_NAME,\r\n      KeyConditionExpression:\r\n        \"#pk = :pk AND begins_with(#sk, :prefix)\",\r\n      ExpressionAttributeNames: {\r\n        \"#pk\": PK,\r\n        \"#sk\": SK,\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":pk\": `CPB#${boardId}`,\r\n        \":prefix\": \"ITEM#\",\r\n      },\r\n    }),\r\n  );\r\n\r\n  const items = (res.Items ?? []).filter(\r\n    (it) => it.type === \"CREATOR_PR_ITEM\",\r\n  );\r\n\r\n  return items.map(mapCreatorPrItem);\r\n}\r\n\r\nasync function createCreatorPrBoard(sub: string, input: any) {\r\n  if (!input) throw new Error(\"input is required\");\r\n  if (!input.title) throw new Error(\"title is required\");\r\n\r\n  const nowIso = now();\r\n  const boardId = uuid();\r\n\r\n  // Snapshot the current goal compass (or defaults) at the moment of creation\r\n  const compass = await getCreatorGoalCompass(sub);\r\n\r\n  const goalCompassSnapshot = compass\r\n    ? {\r\n        primaryGoal: compass.primaryGoal ?? null,\r\n        timeHorizon: compass.timeHorizon ?? null,\r\n        weeklyCapacity: compass.weeklyCapacity ?? null,\r\n        focusAreas: compass.focusAreas ?? null,\r\n        riskTolerance: compass.riskTolerance ?? null,\r\n        contentMixTarget: compass.contentMixTarget ?? null,\r\n      }\r\n    : null;\r\n\r\n  const item = {\r\n    [PK]: `CPB#${boardId}`,\r\n    [SK]: \"META\",\r\n    type: \"CREATOR_PR_BOARD\",\r\n\r\n    id: boardId,\r\n    creatorId: sub,\r\n    ownerSub: sub,\r\n    title: input.title,\r\n    description: input.description ?? null,\r\n    goalCompassSnapshot,\r\n    timeHorizonFrom: input.timeHorizonFrom ?? null,\r\n    timeHorizonTo: input.timeHorizonTo ?? null,\r\n\r\n    createdAt: nowIso,\r\n    updatedAt: nowIso,\r\n\r\n    // GSI1: list boards per creator\r\n    gsi1pk: `CREATOR#${sub}`,\r\n    gsi1sk: `CPB#${nowIso}#${boardId}`,\r\n  };\r\n\r\n  await ddb.send(\r\n    new PutCommand({\r\n      TableName: TABLE_NAME,\r\n      Item: item,\r\n      ConditionExpression: \"attribute_not_exists(#pk)\",\r\n      ExpressionAttributeNames: {\r\n        \"#pk\": PK,\r\n      },\r\n    }),\r\n  );\r\n\r\n  return mapCreatorPrBoard(item);\r\n}\r\n\r\nasync function requireCreatorPrBoard(sub: string, boardId: string) {\r\n  if (!boardId) throw new Error(\"boardId is required\");\r\n\r\n  const res = await ddb.send(\r\n    new GetCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CPB#${boardId}`,\r\n        [SK]: \"META\",\r\n      },\r\n    }),\r\n  );\r\n\r\n  const item = res.Item;\r\n  if (!item || item.ownerSub !== sub) {\r\n    // Don't leak existence if not owned\r\n    throw new Error(\"CreatorPrBoard not found\");\r\n  }\r\n\r\n  return item;\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// Creator Social Pulse \u2013 pulses + content ideas\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function requireCreatorSocialPulse(\r\n  sub: string,\r\n  pulseId: string,\r\n) {\r\n  if (!pulseId) throw new Error(\"pulseId is required\");\r\n\r\n  const res = await ddb.send(\r\n    new GetCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CREATOR#${sub}`,\r\n        [SK]: `PULSE#${pulseId}`,\r\n      },\r\n    }),\r\n  );\r\n\r\n  if (!res.Item) {\r\n    throw new Error(\"CreatorSocialPulse not found\");\r\n  }\r\n\r\n  return res.Item;\r\n}\r\n\r\nfunction findContentIdea(\r\n  pulseItem: any,\r\n  contentIdeaId: string,\r\n): any {\r\n  const ideas = Array.isArray(pulseItem.contentIdeas)\r\n    ? pulseItem.contentIdeas\r\n    : [];\r\n\r\n  const idea =\r\n    ideas.find((i: any) => i.id === contentIdeaId) ??\r\n    ideas.find((i: any) => i.ideaId === contentIdeaId);\r\n\r\n  if (!idea) {\r\n    throw new Error(\"Content idea not found in pulse\");\r\n  }\r\n\r\n  return idea;\r\n}\r\n\r\nasync function listCreatorSocialPulses(\r\n  sub: string,\r\n  args: { limit?: number; nextToken?: string } | null,\r\n) {\r\n  const { limit = 20, nextToken } = args || {};\r\n\r\n  const queryInput: any = {\r\n    TableName: TABLE_NAME,\r\n    KeyConditionExpression:\r\n      \"#pk = :pk AND begins_with(#sk, :prefix)\",\r\n    ExpressionAttributeNames: {\r\n      \"#pk\": PK,\r\n      \"#sk\": SK,\r\n    },\r\n    ExpressionAttributeValues: {\r\n      \":pk\": `CREATOR#${sub}`,\r\n      \":prefix\": \"PULSE#\",\r\n    },\r\n    Limit: limit,\r\n  };\r\n\r\n  if (nextToken) {\r\n    queryInput.ExclusiveStartKey = {\r\n      [PK]: `CREATOR#${sub}`,\r\n      [SK]: nextToken,\r\n    };\r\n  }\r\n\r\n  const res = await ddb.send(new QueryCommand(queryInput));\r\n  const items = res.Items ?? [];\r\n\r\n  return items.map((it) => mapCreatorSocialPulseItem(it, sub));\r\n}\r\n\r\nasync function generateSocialPulse(\r\n  sub: string,\r\n  input: any | null,\r\n) {\r\n  if (!sub) throw new Error(\"Not authenticated\");\r\n\r\n  // If we don't have an SFN ARN configured yet, fall back to the simple\r\n  // in-Lambda implementation so dev environments don't break.\r\n  if (!SOCIAL_PULSE_SFN_ARN) {\r\n    console.warn(\r\n      \"[SocialPulse] SOCIAL_PULSE_SFN_ARN not set \u2013 using local fallback\",\r\n    );\r\n\r\n    const nowIso = now();\r\n    const pulseId = uuid();\r\n\r\n    const pk = `CREATOR#${sub}`;\r\n    const sk = `PULSE#${pulseId}`;\r\n\r\n    const nicheOverride = input?.nicheOverride ?? null;\r\n    const platformsInput: string[] | undefined = input?.platforms;\r\n\r\n    const defaultPlatforms: string[] =\r\n      platformsInput && platformsInput.length\r\n        ? platformsInput\r\n        : [\"TIKTOK\", \"INSTAGRAM\", \"YOUTUBE_SHORTS\"];\r\n\r\n    const item = {\r\n      [PK]: pk,\r\n      [SK]: sk,\r\n      type: \"CREATOR_SOCIAL_PULSE\",\r\n\r\n      id: pulseId,\r\n      creatorId: sub,\r\n      niche: nicheOverride,\r\n      platforms: defaultPlatforms,\r\n\r\n      trendBriefs: [] as any[],\r\n      contentIdeas: [] as any[],\r\n\r\n      createdAt: nowIso,\r\n      updatedAt: nowIso,\r\n    };\r\n\r\n    await ddb.send(\r\n      new PutCommand({\r\n        TableName: TABLE_NAME,\r\n        Item: item,\r\n        ConditionExpression:\r\n          \"attribute_not_exists(#pk) AND attribute_not_exists(#sk)\",\r\n        ExpressionAttributeNames: {\r\n          \"#pk\": PK,\r\n          \"#sk\": SK,\r\n        },\r\n      }),\r\n    );\r\n\r\n    return mapCreatorSocialPulseItem(item, sub);\r\n  }\r\n\r\n  // --- Normal path: call the Express state machine synchronously ---\r\n\r\n  const payload = {\r\n    creatorId: sub,\r\n    nicheOverride: input?.nicheOverride ?? null,\r\n    platforms: input?.platforms ?? null,\r\n  };\r\n\r\n  const resp = await sfnClient.send(\r\n    new StartSyncExecutionCommand({\r\n      stateMachineArn: SOCIAL_PULSE_SFN_ARN,\r\n      input: JSON.stringify(payload),\r\n    }),\r\n  );\r\n\r\n  if (!resp.output) {\r\n    throw new Error(\"Social Pulse state machine returned no output\");\r\n  }\r\n\r\n  // We design the persist step to return a final CreatorSocialPulse-ish object.\r\n  const output = JSON.parse(resp.output);\r\n\r\n  // If persist step returns the raw Dynamo item, map it. If it already looks\r\n  // like a GraphQL shape, just pass it through.\r\n  if (output && output.pk && output.sk) {\r\n    return mapCreatorSocialPulseItem(output, sub);\r\n  }\r\n\r\n  return {\r\n    id: output.id,\r\n    creatorId: output.creatorId ?? sub,\r\n    niche: output.niche ?? null,\r\n    platforms: output.platforms ?? [],\r\n    trendBriefs: output.trendBriefs ?? [],\r\n    contentIdeas: output.contentIdeas ?? [],\r\n    createdAt: output.createdAt ?? now(),\r\n  } as any;\r\n}\r\n\r\nasync function addContentIdeaToBoard(\r\n  sub: string,\r\n  input: any,\r\n) {\r\n  if (!input) throw new Error(\"input is required\");\r\n\r\n  const { boardId, pulseId, contentIdeaId } = input;\r\n\r\n  if (!boardId) throw new Error(\"boardId is required\");\r\n  if (!pulseId) throw new Error(\"pulseId is required\");\r\n  if (!contentIdeaId) {\r\n    throw new Error(\"contentIdeaId is required\");\r\n  }\r\n\r\n  // 1) Enforce that the board belongs to this creator\r\n  await requireCreatorPrBoard(sub, boardId);\r\n\r\n  // 2) Load the Social Pulse and locate the idea\r\n  const pulse = await requireCreatorSocialPulse(sub, pulseId);\r\n  const idea = findContentIdea(pulse, contentIdeaId);\r\n\r\n  const nowIso = now();\r\n  const itemId = uuid();\r\n\r\n  // Decide initial platform / status / notes based on idea + overrides\r\n  const platform: string =\r\n    input.platform ?? idea.recommendedPlatform ?? \"TIKTOK\";\r\n\r\n  const status: string = input.status ?? \"IDEA\";\r\n\r\n  const notes: string | null = input.notes ?? idea.hook ?? null;\r\n\r\n  const item = {\r\n    [PK]: `CPB#${boardId}`,\r\n    [SK]: `ITEM#${nowIso}#${itemId}`,\r\n    type: \"CREATOR_PR_ITEM\",\r\n\r\n    id: itemId,\r\n    boardId,\r\n    creatorId: sub,\r\n    ownerSub: sub,\r\n\r\n    title: idea.title,\r\n    platform,\r\n    status,\r\n\r\n    notes,\r\n\r\n    pulseId,\r\n    contentIdeaId,\r\n\r\n    // Snapshot bare idea so changes to future pulses don't retroactively\r\n    // mutate this planned content.\r\n    ideaSnapshot: {\r\n      title: idea.title,\r\n      hook: idea.hook ?? null,\r\n      outline: idea.outline ?? null,\r\n      recommendedPlatform: idea.recommendedPlatform ?? null,\r\n      recommendedLengthSec: idea.recommendedLengthSec ?? null,\r\n    },\r\n\r\n    // Emotional PR Engine fields start empty; will be filled by analysis job.\r\n    emotionalToneLabels: [],\r\n    audienceResponseLabel: null,\r\n    brandAlignmentScore: null,\r\n    prRiskLevel: null,\r\n    lastEmotionalReviewAt: null,\r\n\r\n    directorShootPlanId: null,\r\n    directorAssetIds: [],\r\n    scheduleSlotId: null,\r\n\r\n    createdAt: nowIso,\r\n    updatedAt: nowIso,\r\n\r\n    // GSI for listing PR items by creator\r\n    gsi1pk: `CREATOR#${sub}`,\r\n    gsi1sk: `CPI#${boardId}#${nowIso}#${itemId}`,\r\n  };\r\n\r\n  await ddb.send(\r\n    new PutCommand({\r\n      TableName: TABLE_NAME,\r\n      Item: item,\r\n      ConditionExpression: \"attribute_not_exists(#pk)\",\r\n      ExpressionAttributeNames: {\r\n        \"#pk\": PK,\r\n      },\r\n    }),\r\n  );\r\n\r\n  return mapCreatorPrItem(item);\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// CREATOR GOAL COMPASS\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nfunction defaultGoalCompass() {\r\n  return {\r\n    primaryGoal: \"GROWTH\", // \"GROWTH\" | \"BALANCE\" | \"BUSINESS_FIRST\"\r\n    timeHorizon: \"90_DAYS\", // \"30_DAYS\" | \"90_DAYS\" | \"YEAR\"\r\n    weeklyCapacity: 5,\r\n    focusAreas: [\"PERSONALITY\", \"NURTURE\"],\r\n    riskTolerance: \"MEDIUM\",\r\n    notes: null,\r\n    updatedAt: null,\r\n\r\n    contentMixTarget: {\r\n      personality: 30,\r\n      nurture: 30,\r\n      authority: 20,\r\n      conversion: 20,\r\n    },\r\n    contentMixActual: null,\r\n    weeklyPathStatus: null,\r\n    lastWeeklyCheckAt: null,\r\n  };\r\n}\r\n\r\nasync function getCreatorGoalCompass(sub: string) {\r\n  const res = await ddb.send(\r\n    new GetCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CREATOR#${sub}`,\r\n        [SK]: \"GOAL_COMPASS\",\r\n      },\r\n    }),\r\n  );\r\n\r\n  if (!res.Item) {\r\n    // no record yet -> return defaults (client can still save)\r\n    return defaultGoalCompass();\r\n  }\r\n\r\n  const it = res.Item as any;\r\n\r\n  return {\r\n    primaryGoal: it.primaryGoal ?? \"GROWTH\",\r\n    timeHorizon: it.timeHorizon ?? \"90_DAYS\",\r\n    weeklyCapacity:\r\n      typeof it.weeklyCapacity === \"number\" ? it.weeklyCapacity : 5,\r\n    focusAreas:\r\n      Array.isArray(it.focusAreas) && it.focusAreas.length\r\n        ? it.focusAreas\r\n        : [\"PERSONALITY\", \"NURTURE\"],\r\n    riskTolerance: it.riskTolerance ?? \"MEDIUM\",\r\n    notes: it.notes ?? null,\r\n    updatedAt: it.updatedAt ?? null,\r\n\r\n    contentMixTarget: it.contentMixTarget ?? null,\r\n    contentMixActual: it.contentMixActual ?? null,\r\n    weeklyPathStatus: it.weeklyPathStatus ?? null,\r\n    lastWeeklyCheckAt: it.lastWeeklyCheckAt ?? null,\r\n  };\r\n}\r\n\r\nasync function updateCreatorGoalCompass(sub: string, input: any) {\r\n  if (!input) throw new Error(\"input is required\");\r\n\r\n  const nowIso = now();\r\n\r\n  // We treat this as an upsert that overwrites the current compass.\r\n  const item: any = {\r\n    [PK]: `CREATOR#${sub}`,\r\n    [SK]: \"GOAL_COMPASS\",\r\n    type: \"CREATOR_GOAL_COMPASS\",\r\n\r\n    primaryGoal: input.primaryGoal ?? \"GROWTH\",\r\n    timeHorizon: input.timeHorizon ?? \"90_DAYS\",\r\n    weeklyCapacity:\r\n      typeof input.weeklyCapacity === \"number\"\r\n        ? input.weeklyCapacity\r\n        : 5,\r\n    focusAreas:\r\n      Array.isArray(input.focusAreas) && input.focusAreas.length\r\n        ? input.focusAreas\r\n        : [\"PERSONALITY\", \"NURTURE\"],\r\n    riskTolerance: input.riskTolerance ?? \"MEDIUM\",\r\n    notes: input.notes ?? null,\r\n    updatedAt: nowIso,\r\n\r\n    contentMixTarget:\r\n      input.contentMixTarget ?? {\r\n        personality: 30,\r\n        nurture: 30,\r\n        authority: 20,\r\n        conversion: 20,\r\n      },\r\n    // contentMixActual, weeklyPathStatus, lastWeeklyCheckAt\r\n    // will normally be written by analytics pipelines, not the UI.\r\n  };\r\n\r\n  await ddb.send(\r\n    new PutCommand({\r\n      TableName: TABLE_NAME,\r\n      Item: item,\r\n    }),\r\n  );\r\n\r\n  return {\r\n    primaryGoal: item.primaryGoal,\r\n    timeHorizon: item.timeHorizon,\r\n    weeklyCapacity: item.weeklyCapacity,\r\n    focusAreas: item.focusAreas,\r\n    riskTolerance: item.riskTolerance,\r\n    notes: item.notes,\r\n    updatedAt: item.updatedAt,\r\n\r\n    contentMixTarget: item.contentMixTarget,\r\n    contentMixActual: item.contentMixActual ?? null,\r\n    weeklyPathStatus: item.weeklyPathStatus ?? null,\r\n    lastWeeklyCheckAt: item.lastWeeklyCheckAt ?? null,\r\n  };\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// Director Suite \u2013 Emotion Preview\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\ntype ContentMixShape = {\r\n  personality: number;\r\n  nurture: number;\r\n  authority: number;\r\n  conversion: number;\r\n};\r\n\r\nasync function runCreatorEmotionPreview(event: any): Promise<any> {\r\n  const sub =\r\n    event.identity?.sub ||\r\n    event.identity?.claims?.sub ||\r\n    event.arguments?.creatorId;\r\n\r\n  if (!sub) {\r\n    throw new Error(\"Missing creator identity\");\r\n  }\r\n\r\n  const creatorId = sub;\r\n  const pkValue = `CREATOR#${creatorId}`;\r\n  const skValue = \"GOAL_COMPASS\";\r\n\r\n  const res = await ddb.send(\r\n    new GetCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: pkValue,\r\n        [SK]: skValue,\r\n      },\r\n    }),\r\n  );\r\n\r\n  const item = res.Item as any | undefined;\r\n\r\n  // Default target if they don't have a compass yet\r\n  const defaultTarget: ContentMixShape = {\r\n    personality: 30,\r\n    nurture: 30,\r\n    authority: 20,\r\n    conversion: 20,\r\n  };\r\n\r\n  const target: ContentMixShape = item?.contentMixTarget ?? defaultTarget;\r\n  const actual: ContentMixShape = item?.contentMixActual ?? target;\r\n\r\n  const weeklyPathStatus: string = item?.weeklyPathStatus ?? \"ON_PATH\";\r\n  const lastWeeklyCheckAt: string | undefined =\r\n    item?.lastWeeklyCheckAt ?? item?.updatedAt;\r\n\r\n  return {\r\n    target,\r\n    actual,\r\n    weeklyPathStatus,\r\n    lastWeeklyCheckAt: lastWeeklyCheckAt || null,\r\n  };\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// CREATOR SOCIAL OS \u2013 WEEKLY SCHEDULE\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nfunction mapScheduleSlot(item: any) {\r\n  if (!item) return null;\r\n  return {\r\n    id: item.id,\r\n    creatorSub: item.creatorSub,\r\n    weekOf: item.weekOf,\r\n    day: item.day,\r\n    timeOfDay: item.timeOfDay,\r\n    platformHint: item.platformHint ?? null,\r\n    focusHint: item.focusHint ?? null,\r\n    status: item.status ?? \"PLANNED\",\r\n    notes: item.notes ?? null,\r\n    directorShootId: item.directorShootId ?? null,\r\n    createdAt: item.createdAt,\r\n    updatedAt: item.updatedAt,\r\n  };\r\n}\r\n\r\nasync function creatorScheduleWeek(sub: string, weekOf: string) {\r\n  if (!weekOf) throw new Error(\"weekOf is required\");\r\n\r\n  const res = await ddb.send(\r\n    new QueryCommand({\r\n      TableName: TABLE_NAME,\r\n      KeyConditionExpression:\r\n        \"#pk = :pk AND begins_with(#sk, :skPrefix)\",\r\n      ExpressionAttributeNames: {\r\n        \"#pk\": PK,\r\n        \"#sk\": SK,\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":pk\": `CREATOR#${sub}`,\r\n        \":skPrefix\": `SCHEDULE#${weekOf}#`,\r\n      },\r\n    }),\r\n  );\r\n\r\n  const items =\r\n    (res.Items || []).filter(\r\n      (it) => it.type === \"CREATOR_SCHEDULE_SLOT\",\r\n    ) ?? [];\r\n\r\n  return {\r\n    weekOf,\r\n    slots: items.map(mapScheduleSlot),\r\n  };\r\n}\r\n\r\nasync function upsertCreatorScheduleSlot(sub: string, input: any) {\r\n  if (!input) throw new Error(\"input is required\");\r\n  const { weekOf, day, timeOfDay } = input;\r\n  if (!weekOf) throw new Error(\"weekOf is required\");\r\n  if (!day) throw new Error(\"day is required\");\r\n  if (!timeOfDay) throw new Error(\"timeOfDay is required\");\r\n\r\n  const id = input.id || uuid();\r\n  const nowIso = now();\r\n\r\n  const item = {\r\n    [PK]: `CREATOR#${sub}`,\r\n    [SK]: `SCHEDULE#${weekOf}#${id}`,\r\n    type: \"CREATOR_SCHEDULE_SLOT\",\r\n    id,\r\n    creatorSub: sub,\r\n    weekOf,\r\n    day,\r\n    timeOfDay,\r\n    platformHint: input.platformHint ?? null,\r\n    focusHint: input.focusHint ?? null,\r\n    status: input.status ?? \"PLANNED\",\r\n    notes: input.notes ?? null,\r\n    directorShootId: input.directorShootId ?? null,\r\n    createdAt: input.createdAt || nowIso,\r\n    updatedAt: nowIso,\r\n  };\r\n\r\n  await ddb.send(\r\n    new PutCommand({\r\n      TableName: TABLE_NAME,\r\n      Item: item,\r\n    }),\r\n  );\r\n\r\n  return mapScheduleSlot(item);\r\n}\r\n\r\nasync function deleteCreatorScheduleSlot(\r\n  sub: string,\r\n  id: string,\r\n  weekOf: string,\r\n) {\r\n  if (!id) throw new Error(\"id is required\");\r\n  if (!weekOf) throw new Error(\"weekOf is required\");\r\n\r\n  await ddb.send(\r\n    new DeleteCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CREATOR#${sub}`,\r\n        [SK]: `SCHEDULE#${weekOf}#${id}`,\r\n      },\r\n    }),\r\n  );\r\n\r\n  return true;\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// IMPORT FROM CLOSET \u2192 CABINET\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function importClosetItemToCabinet(sub: string, input: any) {\r\n  const {\r\n    closetItemId,\r\n    cabinetId,\r\n    folderId,\r\n    kind,\r\n    title,\r\n    notes,\r\n    tags = [],\r\n  } = input || {};\r\n\r\n  if (!closetItemId) throw new Error(\"closetItemId is required\");\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n\r\n  // 1) Ensure target cabinet belongs to this user\r\n  const cabinet = await getCabinet(sub, cabinetId);\r\n  if (!cabinet) {\r\n    throw new Error(\"Cabinet not found\");\r\n  }\r\n\r\n  // 2) Look up the closet item.\r\n  //\r\n  // NOTE: This assumes closet items are keyed by:\r\n  //   pk = `CLOSET#${sub}`\r\n  //   sk = `ITEM#${closetItemId}`\r\n  //\r\n  // If your actual pattern is different, adjust PK/SK accordingly.\r\n  const closetRes = await ddb.send(\r\n    new GetCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CLOSET#${sub}`,\r\n        [SK]: `ITEM#${closetItemId}`,\r\n      },\r\n    }),\r\n  );\r\n\r\n  const closetItem = closetRes.Item;\r\n  if (!closetItem || (closetItem as any).ownerSub !== sub) {\r\n    throw new Error(\"Closet item not found\");\r\n  }\r\n\r\n  const assetId = uuid();\r\n  const nowIso = now();\r\n\r\n  // Reuse the existing closet media key if possible.\r\n  const s3Key =\r\n    (closetItem as any).mediaKey ||\r\n    (closetItem as any).rawMediaKey ||\r\n    (() => {\r\n      throw new Error(\"Closet item has no media key\");\r\n    })();\r\n\r\n  const assetKind = kind ?? \"PHOTO\";\r\n  const finalTitle = title ?? (closetItem as any).title ?? null;\r\n  const finalNotes = notes ?? (closetItem as any).notes ?? null;\r\n  const finalTags =\r\n    tags.length ? tags : (closetItem as any).colorTags ?? [];\r\n\r\n  const item = {\r\n    [PK]: `CAB#${cabinetId}`,\r\n    [SK]: `ASSET#${assetId}`,\r\n    type: \"ASSET\",\r\n    id: assetId,\r\n    cabinetId,\r\n    folderId: folderId ?? null,\r\n    ownerSub: sub,\r\n    kind: assetKind,\r\n    category: \"OUTFIT_REFS\",\r\n    title: finalTitle,\r\n    notes: finalNotes,\r\n    tags: finalTags,\r\n    s3Key,\r\n    contentType: (closetItem as any).contentType ?? \"image/jpeg\",\r\n    createdAt: nowIso,\r\n    updatedAt: nowIso,\r\n    sourceClosetItemId: closetItemId,\r\n\r\n    // moderation defaults\r\n    moderationStatus: \"ACTIVE\" as const,\r\n    moderationReason: null,\r\n    moderatedBy: null,\r\n    moderatedAt: null,\r\n\r\n    // GSI for admin listing by user\r\n    gsi1pk: `CREATOR#${sub}`,\r\n    gsi1sk: `CAB_ASSET#${cabinetId}#${nowIso}#${assetId}`,\r\n  };\r\n\r\n  await ddb.send(\r\n    new PutCommand({\r\n      TableName: TABLE_NAME,\r\n      Item: item,\r\n    }),\r\n  );\r\n\r\n  // Best-effort bump cabinet assetCount\r\n  await ddb.send(\r\n    new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: \"META\",\r\n      },\r\n      UpdateExpression:\r\n        \"SET #assetCount = if_not_exists(#assetCount, :zero) + :one, #updatedAt = :updatedAt\",\r\n      ExpressionAttributeNames: {\r\n        \"#assetCount\": \"assetCount\",\r\n        \"#updatedAt\": \"updatedAt\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":zero\": 0,\r\n        \":one\": 1,\r\n        \":updatedAt\": nowIso,\r\n      },\r\n    }),\r\n  );\r\n\r\n  return mapAsset(item);\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// AI \u2013 stubbed (safe, no Bedrock needed)\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function runCreatorAi(event: any) {\r\n  const text: string = event.arguments?.text ?? \"\";\r\n  const kind: string = event.arguments?.kind ?? \"OTHER\";\r\n\r\n  const base = text || \"your content\";\r\n  const suggestions: string[] = [];\r\n\r\n  if (kind === \"CAPTION\") {\r\n    suggestions.push(\r\n      `Behind the scenes of ${base} \u2728`,\r\n      `Styling ${base} so you don't have to \uD83D\uDC85`,\r\n    );\r\n  } else if (kind === \"HASHTAGS\") {\r\n    suggestions.push(\r\n      \"#stylingadventures #creatorlife #behindthescenes\",\r\n      \"#outfitinspo #contentcreator #filmingday\",\r\n    );\r\n  } else {\r\n    suggestions.push(`Planning ideas for ${base}`);\r\n  }\r\n\r\n  return { suggestions };\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// GraphQL handler \u2013 router\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nexport const handler = async (event: any) => {\r\n  const field = event.info?.fieldName;\r\n  const sub =\r\n    event.identity?.sub ||\r\n    event.identity?.claims?.sub ||\r\n    \"anonymous\";\r\n  const args = event.arguments || {};\r\n\r\n  switch (field) {\r\n    // CABINETS\r\n    case \"creatorCabinets\":\r\n      return listCabinets(sub);\r\n    case \"creatorCabinet\":\r\n      return getCabinet(sub, args.id);\r\n    case \"createCreatorCabinet\":\r\n      return createCabinet(sub, args.input);\r\n    case \"updateCreatorCabinet\":\r\n      return updateCabinet(sub, args.input);\r\n    case \"deleteCreatorCabinet\":\r\n      return deleteCabinet(sub, args.id);\r\n\r\n    // FOLDERS\r\n    case \"creatorCabinetFolders\":\r\n      return listFolders(sub, args.cabinetId);\r\n\r\n    // Back-compat alias\r\n    case \"creatorFolders\":\r\n      return listFolders(sub, args.cabinetId);\r\n\r\n    case \"createCreatorFolder\":\r\n      return createFolder(sub, args.input);\r\n    case \"renameCreatorFolder\":\r\n      return renameFolder(sub, args.input);\r\n    case \"deleteCreatorFolder\":\r\n      return deleteFolder(\r\n        sub,\r\n        args.id,\r\n        args.cabinetId,\r\n      );\r\n\r\n    // ASSETS \u2013 creator-facing\r\n    case \"creatorCabinetAssets\":\r\n      return listAssets(sub, args);\r\n    case \"createCreatorAssetUpload\":\r\n      return createAssetUpload(sub, args.input);\r\n    case \"updateCreatorAsset\":\r\n      return updateAsset(sub, args.input);\r\n    case \"deleteCreatorAsset\":\r\n      return deleteAsset(sub, args.id, args.cabinetId);\r\n    case \"moveCreatorAsset\":\r\n      return moveAsset(sub, args.input);\r\n    case \"importClosetItemToCabinet\":\r\n      return importClosetItemToCabinet(sub, args.input);\r\n\r\n    // ADMIN moderation / listing\r\n    case \"adminListCreatorAssetsByUser\":\r\n      return adminListCreatorAssetsByUser(args);\r\n    case \"adminGetCreatorAsset\":\r\n      return adminGetCreatorAsset(args);\r\n    case \"adminModerateCreatorAsset\":\r\n      return adminModerateCreatorAsset(sub, args.input);\r\n    case \"adminSoftDeleteCreatorAsset\":\r\n      return adminSoftDeleteCreatorAsset(sub, args.input);\r\n    case \"adminRestoreCreatorAsset\":\r\n      return adminRestoreCreatorAsset(sub, args.input);\r\n    case \"adminRejectCreatorAsset\":\r\n      return adminRejectCreatorAsset(sub, args.input);\r\n\r\n    // Monetization HQ \u2013 earnings by platform (mocked)\r\n    case \"creatorRevenueByPlatform\":\r\n      return creatorRevenueByPlatformResolver(event);\r\n\r\n    // Goal compass (creator alignment)\r\n    case \"creatorGoalCompass\":\r\n      return getCreatorGoalCompass(sub);\r\n    case \"updateCreatorGoalCompass\":\r\n      return updateCreatorGoalCompass(sub, args.input);\r\n\r\n    // Emotion preview vs Goal Compass\r\n    case \"runCreatorEmotionPreview\":\r\n      return runCreatorEmotionPreview(event);\r\n\r\n    // Creator Social OS \u2013 weekly schedule\r\n    case \"creatorScheduleWeek\":\r\n      return creatorScheduleWeek(sub, args.weekOf);\r\n    case \"upsertCreatorScheduleSlot\":\r\n      return upsertCreatorScheduleSlot(sub, args.input);\r\n    case \"deleteCreatorScheduleSlot\":\r\n      return deleteCreatorScheduleSlot(sub, args.id, args.weekOf);\r\n\r\n    // PR & Content Studio (planner)\r\n    case \"creatorPrBoards\":\r\n      return listCreatorPrBoards(sub);\r\n    case \"creatorPrItemsByBoard\":\r\n      return listCreatorPrItemsByBoard(sub, args.boardId);\r\n    case \"createCreatorPrBoard\":\r\n      return createCreatorPrBoard(sub, args.input);\r\n    case \"addContentIdeaToBoard\":\r\n      return addContentIdeaToBoard(sub, args.input);\r\n\r\n    // Director Suite \u2013 shoot plans\r\n    case \"getDirectorShootPlan\":\r\n      return getDirectorShootPlan(sub, args.id);\r\n    case \"saveDirectorShootPlan\":\r\n      return saveDirectorShootPlan(sub, args.input);\r\n\r\n    // Social Pulse\r\n    case \"creatorSocialPulses\":\r\n      return listCreatorSocialPulses(sub, {\r\n        limit: args.limit,\r\n        nextToken: args.nextToken,\r\n      });\r\n    case \"generateSocialPulse\":\r\n      return generateSocialPulse(sub, args.input);\r\n\r\n    // AI\r\n    case \"creatorAiSuggest\":\r\n      return runCreatorAi(event);\r\n\r\n    default:\r\n      throw new Error(`Unknown field ${field}`);\r\n  }\r\n};\r\n\r\n", "import validate from './validate.js';\nconst byteToHex = [];\nfor (let i = 0; i < 256; ++i) {\n    byteToHex.push((i + 0x100).toString(16).slice(1));\n}\nexport function unsafeStringify(arr, offset = 0) {\n    return (byteToHex[arr[offset + 0]] +\n        byteToHex[arr[offset + 1]] +\n        byteToHex[arr[offset + 2]] +\n        byteToHex[arr[offset + 3]] +\n        '-' +\n        byteToHex[arr[offset + 4]] +\n        byteToHex[arr[offset + 5]] +\n        '-' +\n        byteToHex[arr[offset + 6]] +\n        byteToHex[arr[offset + 7]] +\n        '-' +\n        byteToHex[arr[offset + 8]] +\n        byteToHex[arr[offset + 9]] +\n        '-' +\n        byteToHex[arr[offset + 10]] +\n        byteToHex[arr[offset + 11]] +\n        byteToHex[arr[offset + 12]] +\n        byteToHex[arr[offset + 13]] +\n        byteToHex[arr[offset + 14]] +\n        byteToHex[arr[offset + 15]]).toLowerCase();\n}\nfunction stringify(arr, offset = 0) {\n    const uuid = unsafeStringify(arr, offset);\n    if (!validate(uuid)) {\n        throw TypeError('Stringified UUID is invalid');\n    }\n    return uuid;\n}\nexport default stringify;\n", "import { randomFillSync } from 'crypto';\nconst rnds8Pool = new Uint8Array(256);\nlet poolPtr = rnds8Pool.length;\nexport default function rng() {\n    if (poolPtr > rnds8Pool.length - 16) {\n        randomFillSync(rnds8Pool);\n        poolPtr = 0;\n    }\n    return rnds8Pool.slice(poolPtr, (poolPtr += 16));\n}\n", "import { randomUUID } from 'crypto';\nexport default { randomUUID };\n", "import native from './native.js';\nimport rng from './rng.js';\nimport { unsafeStringify } from './stringify.js';\nfunction v4(options, buf, offset) {\n    if (native.randomUUID && !buf && !options) {\n        return native.randomUUID();\n    }\n    options = options || {};\n    const rnds = options.random ?? options.rng?.() ?? rng();\n    if (rnds.length < 16) {\n        throw new Error('Random bytes length must be >= 16');\n    }\n    rnds[6] = (rnds[6] & 0x0f) | 0x40;\n    rnds[8] = (rnds[8] & 0x3f) | 0x80;\n    if (buf) {\n        offset = offset || 0;\n        if (offset < 0 || offset + 16 > buf.length) {\n            throw new RangeError(`UUID byte range ${offset}:${offset + 15} is out of buffer bounds`);\n        }\n        for (let i = 0; i < 16; ++i) {\n            buf[offset + i] = rnds[i];\n        }\n        return buf;\n    }\n    return unsafeStringify(rnds);\n}\nexport default v4;\n"],
  "mappings": "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",
  "names": ["index_exports", "__export", "handler", "__toCommonJS", "import_client_dynamodb", "import_lib_dynamodb", "byteToHex", "i", "unsafeStringify", "arr", "offset", "import_crypto", "rnds8Pool", "poolPtr", "rng", "import_crypto", "native_default", "v4", "options", "buf", "offset", "native_default", "rnds", "rng", "i", "unsafeStringify", "v4_default", "import_client_s3", "import_s3_request_presigner", "import_client_sfn", "ddb", "s3", "sfnClient", "TABLE_NAME", "CREATOR_MEDIA_BUCKET", "PK", "SK", "STATUS_GSI", "SOCIAL_PULSE_SFN_ARN", "now", "creatorRevenueByPlatformResolver", "event", "window", "days", "currency", "platforms", "platformTotal", "sum", "p", "today", "timeseries", "_", "i", "d", "base", "variance", "totalRevenue", "getDirectorShootPlan", "sub", "id", "pk", "sk", "res", "item", "saveDirectorShootPlan", "input", "nowIso", "mapCabinet", "mapFolder", "mapAsset", "mapCreatorPrBoard", "mapCreatorPrItem", "mapCreatorSocialPulseItem", "skVal", "listCabinets", "items", "createDefaultCabinetForCreator", "getCabinet", "v4_default", "createCabinet", "updateCabinet", "names", "values", "sets", "deleteCabinet", "pkValue", "meta", "it", "listFolders", "cabinetId", "createFolder", "name", "renameFolder", "deleteFolder", "assets", "asset", "listAssets", "args", "folderId", "category", "tag", "search", "limit", "nextToken", "queryInput", "q", "title", "notes", "connectionNextToken", "createAssetUpload", "tags", "fileName", "filename", "contentType", "kind", "finalFileName", "assetId", "folderPart", "safeName", "s3Key", "assetKind", "putCmd", "updateAsset", "deleteAsset", "moveAsset", "destinationFolderId", "adminListCreatorAssetsByUser", "ownerSub", "moderationStatus", "includeSoftDeleted", "wanted", "adminGetCreatorAsset", "adminModerateCreatorAsset", "adminSub", "moderationReason", "adminRejectCreatorAsset", "adminSoftDeleteCreatorAsset", "reason", "adminRestoreCreatorAsset", "listCreatorPrBoards", "listCreatorPrItemsByBoard", "boardId", "requireCreatorPrBoard", "createCreatorPrBoard", "compass", "getCreatorGoalCompass", "goalCompassSnapshot", "requireCreatorSocialPulse", "pulseId", "findContentIdea", "pulseItem", "contentIdeaId", "ideas", "idea", "listCreatorSocialPulses", "generateSocialPulse", "nicheOverride", "platformsInput", "defaultPlatforms", "payload", "resp", "output", "addContentIdeaToBoard", "pulse", "itemId", "platform", "status", "defaultGoalCompass", "updateCreatorGoalCompass", "runCreatorEmotionPreview", "skValue", "defaultTarget", "target", "actual", "weeklyPathStatus", "lastWeeklyCheckAt", "mapScheduleSlot", "creatorScheduleWeek", "weekOf", "upsertCreatorScheduleSlot", "day", "timeOfDay", "deleteCreatorScheduleSlot", "importClosetItemToCabinet", "closetItemId", "closetItem", "finalTitle", "finalNotes", "finalTags", "runCreatorAi", "text", "suggestions", "handler", "field"]
}
