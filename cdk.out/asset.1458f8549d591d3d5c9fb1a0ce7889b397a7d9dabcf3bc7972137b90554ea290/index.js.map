{
  "version": 3,
  "sources": ["../../lambda/closet/admin.ts"],
  "sourcesContent": ["import {\r\n  DynamoDBClient,\r\n  QueryCommand,\r\n  UpdateItemCommand,\r\n  PutItemCommand,\r\n  ScanCommand,\r\n  AttributeValue,\r\n  GetItemCommand,\r\n  DeleteItemCommand,\r\n} from \"@aws-sdk/client-dynamodb\";\r\nimport {\r\n  SFNClient,\r\n  SendTaskFailureCommand,\r\n  SendTaskSuccessCommand,\r\n} from \"@aws-sdk/client-sfn\";\r\n\r\nconst ddb = new DynamoDBClient({});\r\nconst sfn = new SFNClient({});\r\n\r\nconst { TABLE_NAME = \"\" } = process.env;\r\nif (!TABLE_NAME) throw new Error(\"Missing env: TABLE_NAME\");\r\n\r\nconst nowIso = () => new Date().toISOString();\r\nconst S = (v: string) => ({ S: v });\r\n\r\ntype AppSyncEvent = {\r\n  info: { fieldName: string };\r\n  arguments: any;\r\n  identity?: any;\r\n};\r\n\r\ntype ClosetStatus = \"DRAFT\" | \"PENDING\" | \"APPROVED\" | \"REJECTED\" | \"PUBLISHED\";\r\n\r\ntype ClosetItem = {\r\n  id: string;\r\n  userId: string;\r\n  ownerSub: string;\r\n  status: ClosetStatus;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n  mediaKey: string;\r\n  rawMediaKey?: string;\r\n  title: string;\r\n  reason?: string;\r\n  season?: string | null;\r\n  vibes?: string | null;\r\n  audience?: string | null;\r\n  favoriteCount?: number;\r\n  viewerHasFaved?: boolean;\r\n};\r\n\r\ntype AdminCreateClosetItemInput = {\r\n  title: string;\r\n  rawMediaKey: string;\r\n  season?: string | null;\r\n  vibes?: string | null;\r\n};\r\n\r\ntype AdminClosetItemsPage = {\r\n  items: ClosetItem[];\r\n  nextToken?: string | null;\r\n};\r\n\r\nfunction getIdentity(event: AppSyncEvent) {\r\n  const claims = (event.identity as any)?.claims || {};\r\n  const sub = (event.identity as any)?.sub || claims.sub;\r\n  const groupsRaw = claims[\"cognito:groups\"];\r\n  const groups = Array.isArray(groupsRaw)\r\n    ? groupsRaw\r\n    : String(groupsRaw || \"\")\r\n        .split(\",\")\r\n        .map((x) => x.trim())\r\n        .filter(Boolean);\r\n\r\n  const isAdmin = groups.includes(\"ADMIN\") || groups.includes(\"COLLAB\");\r\n\r\n  if (!sub) throw new Error(\"Unauthorized\");\r\n\r\n  return { sub, isAdmin };\r\n}\r\n\r\nfunction mapItem(raw: any, extra?: Partial<ClosetItem>): ClosetItem {\r\n  const favoriteCountAttr = (raw.favoriteCount as any)?.N;\r\n  const favoriteCount =\r\n    typeof favoriteCountAttr === \"string\" ? Number(favoriteCountAttr) : 0;\r\n\r\n  return {\r\n    id: raw.id.S!,\r\n    userId: raw.ownerSub.S!,\r\n    ownerSub: raw.ownerSub.S!,\r\n    status: raw.status.S! as ClosetStatus,\r\n    createdAt: raw.createdAt.S!,\r\n    updatedAt: raw.updatedAt.S!,\r\n    mediaKey: raw.mediaKey?.S ?? \"\",\r\n    rawMediaKey: raw.rawMediaKey?.S ?? \"\",\r\n    title: raw.title?.S ?? \"\",\r\n    reason: raw.reason?.S ?? \"\",\r\n    season: raw.season?.S ?? null,\r\n    vibes: raw.vibes?.S ?? null,\r\n    audience: raw.audience?.S ?? null,\r\n    favoriteCount,\r\n    viewerHasFaved: false,\r\n    ...extra,\r\n  };\r\n}\r\n\r\nfunction randomId() {\r\n  if ((globalThis as any).crypto?.randomUUID) {\r\n    return (globalThis as any).crypto.randomUUID();\r\n  }\r\n  return `${Date.now().toString(36)}-${Math.random()\r\n    .toString(36)\r\n    .slice(2, 10)}`;\r\n}\r\n\r\n// simple base64 wrapper for LastEvaluatedKey\r\nfunction encodeToken(key?: Record<string, AttributeValue>): string | null {\r\n  if (!key) return null;\r\n  return Buffer.from(JSON.stringify(key), \"utf8\").toString(\"base64\");\r\n}\r\nfunction decodeToken(\r\n  token?: string | null,\r\n): Record<string, AttributeValue> | undefined {\r\n  if (!token) return undefined;\r\n  try {\r\n    return JSON.parse(Buffer.from(String(token), \"base64\").toString(\"utf8\"));\r\n  } catch {\r\n    return undefined;\r\n  }\r\n}\r\n\r\n/* ============== Queries ============== */\r\n\r\nexport const adminListPending = async (\r\n  event: AppSyncEvent,\r\n): Promise<ClosetItem[]> => {\r\n  const { isAdmin } = getIdentity(event);\r\n  if (!isAdmin) throw new Error(\"Forbidden\");\r\n\r\n  const out = await ddb.send(\r\n    new QueryCommand({\r\n      TableName: TABLE_NAME,\r\n      IndexName: \"gsi2\", // STATUS index\r\n      KeyConditionExpression: \"gsi2pk = :p\",\r\n      ExpressionAttributeValues: { \":p\": S(\"STATUS#PENDING\") },\r\n      ScanIndexForward: true,\r\n      ProjectionExpression:\r\n        \"id, ownerSub, #s, createdAt, updatedAt, mediaKey, rawMediaKey, title, reason, season, vibes, audience, favoriteCount\",\r\n      ExpressionAttributeNames: { \"#s\": \"status\" },\r\n    }),\r\n  );\r\n\r\n  return (out.Items || []).map((it) =>\r\n    mapItem({\r\n      ...it,\r\n      status: it[\"status\"],\r\n    }),\r\n  );\r\n};\r\n\r\nexport const adminListClosetItems = async (\r\n  event: AppSyncEvent,\r\n): Promise<AdminClosetItemsPage> => {\r\n  const { isAdmin } = getIdentity(event);\r\n  if (!isAdmin) throw new Error(\"Forbidden\");\r\n\r\n  const { status, limit = 50, nextToken } = event.arguments || {};\r\n  const exclusiveKey = decodeToken(nextToken);\r\n\r\n  // If a specific status is provided, use gsi2 (STATUS index).\r\n  if (status) {\r\n    const out = await ddb.send(\r\n      new QueryCommand({\r\n        TableName: TABLE_NAME,\r\n        IndexName: \"gsi2\",\r\n        KeyConditionExpression: \"gsi2pk = :p\",\r\n        ExpressionAttributeValues: { \":p\": S(`STATUS#${status}`) },\r\n        ScanIndexForward: false, // newest first\r\n        ProjectionExpression:\r\n          \"id, ownerSub, #s, createdAt, updatedAt, mediaKey, rawMediaKey, title, reason, season, vibes, audience, favoriteCount\",\r\n        ExpressionAttributeNames: { \"#s\": \"status\" },\r\n        Limit: limit,\r\n        ExclusiveStartKey: exclusiveKey,\r\n      }),\r\n    );\r\n\r\n    const items = (out.Items || []).map((it) =>\r\n      mapItem({\r\n        ...it,\r\n        status: it[\"status\"],\r\n      }),\r\n    );\r\n\r\n    return {\r\n      items,\r\n      nextToken: encodeToken(out.LastEvaluatedKey),\r\n    };\r\n  }\r\n\r\n  // Otherwise, do a (small) scan of ITEM# records.\r\n  const out = await ddb.send(\r\n    new ScanCommand({\r\n      TableName: TABLE_NAME,\r\n      FilterExpression: \"begins_with(pk, :p)\",\r\n      ExpressionAttributeValues: { \":p\": S(\"ITEM#\") },\r\n      ProjectionExpression:\r\n        \"id, ownerSub, #s, createdAt, updatedAt, mediaKey, rawMediaKey, title, reason, season, vibes, audience, favoriteCount\",\r\n      ExpressionAttributeNames: { \"#s\": \"status\" },\r\n      Limit: limit,\r\n      ExclusiveStartKey: exclusiveKey,\r\n    }),\r\n  );\r\n\r\n  const items = (out.Items || []).map((it) =>\r\n    mapItem({\r\n      ...it,\r\n      status: it[\"status\"],\r\n    }),\r\n  );\r\n\r\n  // newest first\r\n  items.sort(\r\n    (a, b) =>\r\n      new Date(b.createdAt || 0).getTime() -\r\n      new Date(a.createdAt || 0).getTime(),\r\n  );\r\n\r\n  return {\r\n    items,\r\n    nextToken: encodeToken(out.LastEvaluatedKey),\r\n  };\r\n};\r\n\r\nexport const closetFeed = async (\r\n  event: AppSyncEvent,\r\n): Promise<ClosetItem[]> => {\r\n  const { sub } = getIdentity(event); // ensure authed, capture viewer\r\n  const { sort = \"NEWEST\" } = event.arguments || {};\r\n\r\n  const [itemsOut, favOut] = await Promise.all([\r\n    ddb.send(\r\n      new QueryCommand({\r\n        TableName: TABLE_NAME,\r\n        IndexName: \"gsi2\",\r\n        KeyConditionExpression: \"gsi2pk = :p\",\r\n        ExpressionAttributeValues: { \":p\": S(\"STATUS#PUBLISHED\") },\r\n        ScanIndexForward: sort === \"NEWEST\",\r\n        ProjectionExpression:\r\n          \"id, ownerSub, #s, createdAt, updatedAt, mediaKey, rawMediaKey, title, audience, favoriteCount\",\r\n        ExpressionAttributeNames: { \"#s\": \"status\" },\r\n      }),\r\n    ),\r\n    ddb.send(\r\n      new QueryCommand({\r\n        TableName: TABLE_NAME,\r\n        KeyConditionExpression: \"pk = :pk AND begins_with(sk, :sk)\",\r\n        ExpressionAttributeValues: {\r\n          \":pk\": S(`FAV#${sub}`),\r\n          \":sk\": S(\"CLOSET#\"),\r\n        },\r\n      }),\r\n    ),\r\n  ]);\r\n\r\n  const favIds = new Set(\r\n    (favOut.Items || []).map((f) => {\r\n      const sk = f.sk?.S ?? \"\";\r\n      if (sk.startsWith(\"CLOSET#\")) {\r\n        return sk.substring(\"CLOSET#\".length);\r\n      }\r\n      return f.closetId?.S ?? \"\";\r\n    }),\r\n  );\r\n\r\n  let items = (itemsOut.Items || []).map((it) =>\r\n    mapItem(\r\n      {\r\n        ...it,\r\n        status: it[\"status\"],\r\n      },\r\n      {\r\n        viewerHasFaved: favIds.has(it.id.S as string),\r\n      },\r\n    ),\r\n  );\r\n\r\n  if (sort === \"MOST_LOVED\") {\r\n    items.sort((a, b) => {\r\n      const af = a.favoriteCount ?? 0;\r\n      const bf = b.favoriteCount ?? 0;\r\n      if (bf !== af) return bf - af;\r\n      return (\r\n        new Date(b.createdAt || 0).getTime() -\r\n        new Date(a.createdAt || 0).getTime()\r\n      );\r\n    });\r\n  }\r\n\r\n  return items;\r\n};\r\n\r\nexport const topClosetLooks = async (\r\n  event: AppSyncEvent,\r\n): Promise<ClosetItem[]> => {\r\n  // just reuse closetFeed, but always NEWEST\r\n  return closetFeed({ ...event, arguments: { sort: \"NEWEST\" } });\r\n};\r\n\r\n/* ============== Mutations ============== */\r\n\r\nexport const adminCreateClosetItem = async (\r\n  event: AppSyncEvent,\r\n): Promise<ClosetItem> => {\r\n  const { sub, isAdmin } = getIdentity(event);\r\n  if (!isAdmin) throw new Error(\"Forbidden\");\r\n\r\n  const input = (event.arguments?.input || {}) as AdminCreateClosetItemInput;\r\n\r\n  if (!input.title?.trim()) throw new Error(\"title is required\");\r\n  if (!input.rawMediaKey) throw new Error(\"rawMediaKey is required\");\r\n\r\n  const id = randomId();\r\n  const now = nowIso();\r\n\r\n  await ddb.send(\r\n    new PutItemCommand({\r\n      TableName: TABLE_NAME,\r\n      Item: {\r\n        pk: S(`ITEM#${id}`),\r\n        sk: S(\"META\"),\r\n        id: S(id),\r\n        ownerSub: S(sub),\r\n        gsi2pk: S(\"STATUS#PENDING\"),\r\n        gsi2sk: S(now),\r\n        status: S(\"PENDING\"),\r\n        createdAt: S(now),\r\n        updatedAt: S(now),\r\n        title: S(input.title.trim()),\r\n        rawMediaKey: S(input.rawMediaKey),\r\n        favoriteCount: { N: \"0\" },\r\n        ...(input.season ? { season: S(input.season) } : {}),\r\n        ...(input.vibes ? { vibes: S(input.vibes) } : {}),\r\n      },\r\n    }),\r\n  );\r\n\r\n  return {\r\n    id,\r\n    userId: sub,\r\n    ownerSub: sub,\r\n    status: \"PENDING\",\r\n    createdAt: now,\r\n    updatedAt: now,\r\n    title: input.title.trim(),\r\n    mediaKey: \"\",\r\n    rawMediaKey: input.rawMediaKey,\r\n    reason: \"\",\r\n    season: input.season ?? null,\r\n    vibes: input.vibes ?? null,\r\n    audience: null,\r\n    favoriteCount: 0,\r\n    viewerHasFaved: false,\r\n  };\r\n};\r\n\r\nexport const adminApproveItem = async (\r\n  event: AppSyncEvent,\r\n): Promise<ClosetItem> => {\r\n  const { isAdmin } = getIdentity(event);\r\n  if (!isAdmin) throw new Error(\"Forbidden\");\r\n\r\n  const id = event.arguments?.id as string;\r\n  if (!id) throw new Error(\"id required\");\r\n\r\n  const now = nowIso();\r\n\r\n  const out = await ddb.send(\r\n    new UpdateItemCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: { pk: S(`ITEM#${id}`), sk: S(\"META\") },\r\n      UpdateExpression:\r\n        \"SET #s = :s, updatedAt = :u, gsi2pk = :g2pk, gsi2sk = :g2sk REMOVE reason, approvalToken\",\r\n      ExpressionAttributeNames: { \"#s\": \"status\" },\r\n      ExpressionAttributeValues: {\r\n        \":s\": S(\"APPROVED\"),\r\n        \":u\": S(now),\r\n        \":g2pk\": S(\"STATUS#APPROVED\"),\r\n        \":g2sk\": S(now),\r\n      },\r\n      ReturnValues: \"ALL_OLD\",\r\n    }),\r\n  );\r\n\r\n  const prev = out.Attributes!;\r\n  const token = prev.approvalToken?.S;\r\n\r\n  if (token) {\r\n    try {\r\n      await sfn.send(\r\n        new SendTaskSuccessCommand({\r\n          taskToken: token,\r\n          output: JSON.stringify({ approved: true }),\r\n        }),\r\n      );\r\n    } catch {\r\n      // ignore\r\n    }\r\n  }\r\n\r\n  return mapItem({\r\n    ...prev,\r\n    status: S(\"APPROVED\"),\r\n  });\r\n};\r\n\r\nexport const adminRejectItem = async (\r\n  event: AppSyncEvent,\r\n): Promise<ClosetItem> => {\r\n  const { isAdmin } = getIdentity(event);\r\n  if (!isAdmin) throw new Error(\"Forbidden\");\r\n\r\n  const id = event.arguments?.id as string;\r\n  const reason = (event.arguments?.reason as string) || \"\";\r\n  if (!id) throw new Error(\"id required\");\r\n\r\n  const now = nowIso();\r\n\r\n  const out = await ddb.send(\r\n    new UpdateItemCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: { pk: S(`ITEM#${id}`), sk: S(\"META\") },\r\n      UpdateExpression:\r\n        \"SET #s = :s, updatedAt = :u, gsi2pk = :g2pk, gsi2sk = :g2sk, reason = :r REMOVE approvalToken\",\r\n      ExpressionAttributeNames: { \"#s\": \"status\" },\r\n      ExpressionAttributeValues: {\r\n        \":s\": S(\"REJECTED\"),\r\n        \":u\": S(now),\r\n        \":g2pk\": S(\"STATUS#REJECTED\"),\r\n        \":g2sk\": S(now),\r\n        \":r\": S(reason),\r\n      },\r\n      ReturnValues: \"ALL_OLD\",\r\n    }),\r\n  );\r\n\r\n  const prev = out.Attributes!;\r\n  const token = prev.approvalToken?.S;\r\n\r\n  if (token) {\r\n    try {\r\n      await sfn.send(\r\n        new SendTaskFailureCommand({\r\n          taskToken: token,\r\n          error: \"Rejected\",\r\n          cause: reason || \"Rejected by admin\",\r\n        }),\r\n      );\r\n    } catch {\r\n      // ignore\r\n    }\r\n  }\r\n\r\n  return mapItem({\r\n    ...prev,\r\n    status: S(\"REJECTED\"),\r\n    reason: S(reason),\r\n  });\r\n};\r\n\r\nexport const adminSetClosetAudience = async (): Promise<string> => {\r\n  // still a stub\r\n  return \"NOT_IMPLEMENTED\";\r\n};\r\n\r\nexport const toggleFavoriteClosetItem = async (\r\n  event: AppSyncEvent,\r\n): Promise<ClosetItem> => {\r\n  const { sub } = getIdentity(event);\r\n\r\n  const id = event.arguments?.id as string;\r\n  const favoriteOnArg = event.arguments?.favoriteOn as\r\n    | boolean\r\n    | null\r\n    | undefined;\r\n  const legacyOnArg = event.arguments?.on as boolean | null | undefined;\r\n\r\n  // accept new favoriteOn first, then legacy \"on\"\r\n  const onArg =\r\n    typeof favoriteOnArg === \"boolean\" ? favoriteOnArg : legacyOnArg;\r\n\r\n  if (!id) throw new Error(\"id required\");\r\n\r\n  // load base closet item\r\n  const getOut = await ddb.send(\r\n    new GetItemCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: { pk: S(`ITEM#${id}`), sk: S(\"META\") },\r\n    }),\r\n  );\r\n  const base = getOut.Item;\r\n  if (!base) throw new Error(\"Closet item not found\");\r\n\r\n  const favKey = { pk: S(`FAV#${sub}`), sk: S(`CLOSET#${id}`) };\r\n\r\n  const favOut = await ddb.send(\r\n    new GetItemCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: favKey,\r\n    }),\r\n  );\r\n\r\n  const currentlyOn = !!favOut.Item;\r\n  const targetOn = typeof onArg === \"boolean\" ? onArg : !currentlyOn;\r\n\r\n  const now = nowIso();\r\n  let delta = 0;\r\n\r\n  if (targetOn && !currentlyOn) {\r\n    delta = 1;\r\n    await ddb.send(\r\n      new PutItemCommand({\r\n        TableName: TABLE_NAME,\r\n        Item: {\r\n          ...favKey,\r\n          userSub: S(sub),\r\n          closetId: S(id),\r\n          createdAt: S(now),\r\n        },\r\n      }),\r\n    );\r\n  } else if (!targetOn && currentlyOn) {\r\n    delta = -1;\r\n    await ddb.send(\r\n      new DeleteItemCommand({\r\n        TableName: TABLE_NAME,\r\n        Key: favKey,\r\n      }),\r\n    );\r\n  }\r\n\r\n  if (delta !== 0) {\r\n    await ddb.send(\r\n      new UpdateItemCommand({\r\n        TableName: TABLE_NAME,\r\n        Key: { pk: S(`ITEM#${id}`), sk: S(\"META\") },\r\n        UpdateExpression:\r\n          \"SET favoriteCount = if_not_exists(favoriteCount, :zero) + :delta, updatedAt = :u\",\r\n        ExpressionAttributeValues: {\r\n          \":zero\": { N: \"0\" },\r\n          \":delta\": { N: String(delta) },\r\n          \":u\": S(now),\r\n        },\r\n      }),\r\n    );\r\n  }\r\n\r\n  const currentCountAttr = (base as any).favoriteCount?.N;\r\n  const currentCount =\r\n    typeof currentCountAttr === \"string\" ? Number(currentCountAttr) : 0;\r\n  const nextCount = Math.max(0, currentCount + delta);\r\n\r\n  return mapItem(base, {\r\n    favoriteCount: nextCount,\r\n    viewerHasFaved: targetOn,\r\n  });\r\n};\r\n\r\n/* ============== Dispatcher ============== */\r\n\r\nexport const handler = async (event: AppSyncEvent) => {\r\n  const field = event.info.fieldName;\r\n\r\n  if (field === \"adminListPending\") return adminListPending(event);\r\n  if (field === \"adminListClosetItems\") return adminListClosetItems(event);\r\n  if (field === \"adminCreateClosetItem\") return adminCreateClosetItem(event);\r\n  if (field === \"adminApproveItem\") return adminApproveItem(event);\r\n  if (field === \"adminRejectItem\") return adminRejectItem(event);\r\n  if (field === \"adminSetClosetAudience\") return adminSetClosetAudience();\r\n  if (field === \"closetFeed\") return closetFeed(event);\r\n  if (field === \"topClosetLooks\") return topClosetLooks(event);\r\n  if (field === \"toggleFavoriteClosetItem\")\r\n    return toggleFavoriteClosetItem(event);\r\n\r\n  throw new Error(`No resolver implemented for field ${field}`);\r\n};\r\n"],
  "mappings": "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",
  "names": ["admin_exports", "__export", "adminApproveItem", "adminCreateClosetItem", "adminListClosetItems", "adminListPending", "adminRejectItem", "adminSetClosetAudience", "closetFeed", "handler", "toggleFavoriteClosetItem", "topClosetLooks", "__toCommonJS", "import_client_dynamodb", "import_client_sfn", "ddb", "sfn", "TABLE_NAME", "nowIso", "S", "v", "getIdentity", "event", "claims", "sub", "groupsRaw", "groups", "x", "isAdmin", "mapItem", "raw", "extra", "favoriteCountAttr", "favoriteCount", "randomId", "encodeToken", "key", "decodeToken", "token", "it", "status", "limit", "nextToken", "exclusiveKey", "out", "items", "a", "b", "sort", "itemsOut", "favOut", "favIds", "f", "sk", "af", "bf", "input", "id", "now", "prev", "reason", "favoriteOnArg", "legacyOnArg", "onArg", "base", "favKey", "currentlyOn", "targetOn", "delta", "currentCountAttr", "currentCount", "nextCount", "field"]
}
