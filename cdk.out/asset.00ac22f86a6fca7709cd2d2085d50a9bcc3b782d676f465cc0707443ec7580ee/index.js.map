{
  "version": 3,
  "sources": ["../../lambda/creator/ai.ts"],
  "sourcesContent": ["const STORY_SCHEDULER_ARN = process.env.STORY_SCHEDULER_ARN || \"\";\r\n\r\ntype UserTier = \"FREE\" | \"BESTIE\" | \"CREATOR\" | \"COLLAB\" | \"ADMIN\" | \"PRIME\";\r\n\r\nfunction getUserTier(identity: any): UserTier {\r\n  const claims = identity?.claims || {};\r\n  const tierClaim =\r\n    (claims[\"custom:tier\"] as string | undefined) ||\r\n    (claims[\"tier\"] as string | undefined);\r\n\r\n  const rawGroups = claims[\"cognito:groups\"];\r\n  const groups = Array.isArray(rawGroups)\r\n    ? rawGroups\r\n    : String(rawGroups || \"\")\r\n        .split(\",\")\r\n        .map((g) => g.trim())\r\n        .filter(Boolean);\r\n\r\n  if (groups.includes(\"ADMIN\")) return \"ADMIN\";\r\n  if (groups.includes(\"COLLAB\")) return \"COLLAB\";\r\n  if (groups.includes(\"PRIME\")) return \"PRIME\";\r\n  if (groups.includes(\"CREATOR\")) return \"CREATOR\";\r\n  if (groups.includes(\"BESTIE\")) return \"BESTIE\";\r\n\r\n  if (\r\n    tierClaim &&\r\n    [\"FREE\", \"BESTIE\", \"CREATOR\", \"COLLAB\", \"ADMIN\", \"PRIME\"].includes(\r\n      tierClaim,\r\n    )\r\n  ) {\r\n    return tierClaim as UserTier;\r\n  }\r\n\r\n  return \"FREE\";\r\n}\r\n\r\nfunction requireCreator(identity: any): UserTier {\r\n  const tier = getUserTier(identity);\r\n  if (![\"CREATOR\", \"COLLAB\", \"ADMIN\", \"PRIME\"].includes(tier)) {\r\n    throw new Error(\"Creator tier required\");\r\n  }\r\n  return tier;\r\n}\r\n\r\nexport const handler = async (event: any) => {\r\n  console.log(\"CreatorAiFn event\", JSON.stringify(event));\r\n  const fieldName = event.info?.fieldName as string | undefined;\r\n  const identity = event.identity;\r\n\r\n  requireCreator(identity);\r\n\r\n  switch (fieldName) {\r\n    case \"creatorAiSuggest\": {\r\n      const { text, kind } = event.arguments || {};\r\n      // Stubbed responses \u2013 later we can plug in OpenAI / Bedrock\r\n      if (kind === \"CAPTION\") {\r\n        return {\r\n          suggestions: [\r\n            `\u2728 ${text || \"New look\"} \u2014 styled by you.`,\r\n            `Outfit check: ${text || \"today's fit\"} \u2728`,\r\n          ],\r\n        };\r\n      }\r\n      if (kind === \"HASHTAGS\") {\r\n        return {\r\n          suggestions: [\"#stylelala\", \"#outfitoftheday\", \"#creatorbestie\"],\r\n        };\r\n      }\r\n      return {\r\n        suggestions: [\"Try a short, punchy hook + 3 strong hashtags.\"],\r\n      };\r\n    }\r\n\r\n    default:\r\n      throw new Error(`Unsupported field in CreatorAiFn: ${fieldName}`);\r\n  }\r\n};\r\n"],
  "mappings": "yaAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,aAAAE,IAAA,eAAAC,EAAAH,GAAA,IAAMI,EAAsB,QAAQ,IAAI,qBAAuB,GAI/D,SAASC,EAAYC,EAAyB,CAC5C,IAAMC,EAASD,GAAU,QAAU,CAAC,EAC9BE,EACHD,EAAO,aAAa,GACpBA,EAAO,KAEJE,EAAYF,EAAO,gBAAgB,EACnCG,EAAS,MAAM,QAAQD,CAAS,EAClCA,EACA,OAAOA,GAAa,EAAE,EACnB,MAAM,GAAG,EACT,IAAKE,GAAMA,EAAE,KAAK,CAAC,EACnB,OAAO,OAAO,EAErB,OAAID,EAAO,SAAS,OAAO,EAAU,QACjCA,EAAO,SAAS,QAAQ,EAAU,SAClCA,EAAO,SAAS,OAAO,EAAU,QACjCA,EAAO,SAAS,SAAS,EAAU,UACnCA,EAAO,SAAS,QAAQ,EAAU,SAGpCF,GACA,CAAC,OAAQ,SAAU,UAAW,SAAU,QAAS,OAAO,EAAE,SACxDA,CACF,EAEOA,EAGF,MACT,CAEA,SAASI,EAAeN,EAAyB,CAC/C,IAAMO,EAAOR,EAAYC,CAAQ,EACjC,GAAI,CAAC,CAAC,UAAW,SAAU,QAAS,OAAO,EAAE,SAASO,CAAI,EACxD,MAAM,IAAI,MAAM,uBAAuB,EAEzC,OAAOA,CACT,CAEO,IAAMX,EAAU,MAAOY,GAAe,CAC3C,QAAQ,IAAI,oBAAqB,KAAK,UAAUA,CAAK,CAAC,EACtD,IAAMC,EAAYD,EAAM,MAAM,UACxBR,EAAWQ,EAAM,SAIvB,OAFAF,EAAeN,CAAQ,EAEfS,EAAW,CACjB,IAAK,mBAAoB,CACvB,GAAM,CAAE,KAAAC,EAAM,KAAAC,CAAK,EAAIH,EAAM,WAAa,CAAC,EAE3C,OAAIG,IAAS,UACJ,CACL,YAAa,CACX,UAAKD,GAAQ,UAAU,yBACvB,iBAAiBA,GAAQ,aAAa,SACxC,CACF,EAEEC,IAAS,WACJ,CACL,YAAa,CAAC,aAAc,kBAAmB,gBAAgB,CACjE,EAEK,CACL,YAAa,CAAC,+CAA+C,CAC/D,CACF,CAEA,QACE,MAAM,IAAI,MAAM,qCAAqCF,CAAS,EAAE,CACpE,CACF",
  "names": ["ai_exports", "__export", "handler", "__toCommonJS", "STORY_SCHEDULER_ARN", "getUserTier", "identity", "claims", "tierClaim", "rawGroups", "groups", "g", "requireCreator", "tier", "event", "fieldName", "text", "kind"]
}
