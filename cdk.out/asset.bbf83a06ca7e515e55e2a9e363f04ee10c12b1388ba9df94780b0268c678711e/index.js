"use strict";var g=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var f=Object.prototype.hasOwnProperty;var w=(n,s)=>{for(var i in s)g(n,i,{get:s[i],enumerable:!0})},k=(n,s,i,e)=>{if(s&&typeof s=="object"||typeof s=="function")for(let t of M(s))!f.call(n,t)&&t!==i&&g(n,t,{get:()=>s[t],enumerable:!(e=A(s,t))||e.enumerable});return n};var N=n=>k(g({},"__esModule",{value:!0}),n);var G={};w(G,{handler:()=>_});module.exports=N(G);var r=require("@aws-sdk/client-dynamodb"),o=require("@aws-sdk/util-dynamodb"),c=require("crypto"),a=new r.DynamoDBClient({}),d=process.env.TABLE_NAME;function l(n){let i=(n?.claims||{})["cognito:groups"],e=Array.isArray(i)?i:String(i||"").split(",").map(t=>t.trim()).filter(Boolean);return e.includes("ADMIN")||e.includes("PRIME")}function m(){return new Date().toISOString()}function p(){return"MUSIC#ERA"}function E(n){return`ERA#${n}`}function I(n){return`MUSIC#ERA#${n}`}function D(n){return`SONG#${n}`}function y(n){return`MUSIC#SONG#${n}`}function R(n){return`VIDEO#${n}`}var u=n=>(0,o.marshall)(n,{removeUndefinedValues:!0});async function V(){return((await a.send(new r.QueryCommand({TableName:d,KeyConditionExpression:"pk = :pk",ExpressionAttributeValues:u({":pk":p()})}))).Items??[]).map(s=>(0,o.unmarshall)(s))}async function C(n){let i=((await a.send(new r.QueryCommand({TableName:d,KeyConditionExpression:"pk = :pk AND sk = :sk",ExpressionAttributeValues:u({":pk":p(),":sk":E(n.id)})}))).Items??[])[0];return i?(0,o.unmarshall)(i):null}async function h(n){return((await a.send(new r.QueryCommand({TableName:d,KeyConditionExpression:"pk = :pk AND begins_with(sk, :sk)",ExpressionAttributeValues:u({":pk":I(n.eraId),":sk":"SONG#"})}))).Items??[]).map(i=>(0,o.unmarshall)(i))}async function U(n){return((await a.send(new r.QueryCommand({TableName:d,KeyConditionExpression:"pk = :pk AND begins_with(sk, :sk)",ExpressionAttributeValues:u({":pk":y(n.songId),":sk":"VIDEO#"})}))).Items??[]).map(i=>(0,o.unmarshall)(i))}async function T(n){return null}async function b(n,s){if(!l(s))throw new Error("ADMIN required");let i=(0,c.randomUUID)(),e=m(),t={id:i,name:n.name,description:n.description,aesthetic:n.aesthetic,releaseDate:n.releaseDate,songs:[],musicVideos:[],storyArcs:[],status:"IN_PROGRESS"};return await a.send(new r.PutItemCommand({TableName:d,Item:u({pk:p(),sk:E(i),entityType:"MUSIC_ERA",gsi1pk:"MUSIC#ERA#STATUS#IN_PROGRESS",gsi1sk:e,...t})})),t}async function O(n,s){if(!l(s))throw new Error("ADMIN required");let i=(0,c.randomUUID)(),e=m(),t={id:(0,c.randomUUID)(),songId:i,producer:"TBD",engineerNotes:"",recordedAt:e,studio:"TBD"},S={id:i,title:n.title,eraId:n.eraId,inspirationStory:n.inspirationStory,spotifyUrl:n.spotifyUrl,audioUrl:n.audioUrl,duration:0,studio:t,createdAt:e};return await a.send(new r.PutItemCommand({TableName:d,Item:u({pk:I(n.eraId),sk:D(i),entityType:"SONG",gsi1pk:`MUSIC#ERA#${n.eraId}`,gsi1sk:e,...S})})),S}async function P(n,s){if(!l(s))throw new Error("ADMIN required");let i=(0,c.randomUUID)(),e=m(),t={id:i,songId:n.songId,title:n.title,description:"",s3Key:n.s3Key,duration:0,releaseDate:e,status:"IN_PROGRESS"};return await a.send(new r.PutItemCommand({TableName:d,Item:u({pk:y(n.songId),sk:R(i),entityType:"MUSIC_VIDEO",gsi1pk:"MUSIC#VIDEO#STATUS#IN_PROGRESS",gsi1sk:e,...t})})),t}var _=async n=>{console.log("MusicResolverFn event",JSON.stringify(n));let s=n.info?.fieldName;try{switch(s){case"musicEras":return await V();case"musicEra":return await C(n.arguments);case"eraSongs":return await h(n.arguments);case"songMusicVideos":return await U(n.arguments);case"musicVideo":return await T(n.arguments);case"adminCreateMusicEra":return await b(n.arguments,n.identity);case"adminCreateSong":return await O(n.arguments,n.identity);case"adminCreateMusicVideo":return await P(n.arguments,n.identity);default:throw new Error(`Unknown field: ${s}`)}}catch(i){throw console.error("MusicResolverFn error",i),i}};0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
