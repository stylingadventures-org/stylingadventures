{
  "version": 3,
  "sources": ["../../lambda/upload-api/index.js"],
  "sourcesContent": ["const { S3Client, PutObjectCommand } = require(\"@aws-sdk/client-s3\");\r\nconst {\r\n  S3RequestPresigner,\r\n  getSignedUrl,\r\n} = require(\"@aws-sdk/s3-request-presigner\");\r\n\r\nconst s3 = new S3Client({});\r\n\r\nexports.handler = async (event) => {\r\n  const body = JSON.parse(event.body || \"{}\");\r\n\r\n  const { keyHint = \"upload\", extension = \"jpg\" } = body;\r\n\r\n  const userId =\r\n    event.requestContext.identity?.cognitoIdentityId || \"anonymous\";\r\n\r\n  const key = `${keyHint}/${userId}/${Date.now()}.${extension}`;\r\n\r\n  const url = await getSignedUrl(\r\n    s3,\r\n    new PutObjectCommand({\r\n      Bucket: process.env.BUCKET_NAME,\r\n      Key: key,\r\n      ContentType: body.contentType || \"image/jpeg\",\r\n    }),\r\n    { expiresIn: 3600 },\r\n  );\r\n\r\n  return {\r\n    statusCode: 200,\r\n    headers: {\r\n      \"access-control-allow-origin\": \"*\",\r\n    },\r\n    body: JSON.stringify({ key, url }),\r\n  };\r\n};\r\n"],
  "mappings": "aAAA,GAAM,CAAE,SAAAA,EAAU,iBAAAC,CAAiB,EAAI,QAAQ,oBAAoB,EAC7D,CACJ,mBAAAC,EACA,aAAAC,CACF,EAAI,QAAQ,+BAA+B,EAErCC,EAAK,IAAIJ,EAAS,CAAC,CAAC,EAE1B,QAAQ,QAAU,MAAOK,GAAU,CACjC,IAAMC,EAAO,KAAK,MAAMD,EAAM,MAAQ,IAAI,EAEpC,CAAE,QAAAE,EAAU,SAAU,UAAAC,EAAY,KAAM,EAAIF,EAE5CG,EACJJ,EAAM,eAAe,UAAU,mBAAqB,YAEhDK,EAAM,GAAGH,CAAO,IAAIE,CAAM,IAAI,KAAK,IAAI,CAAC,IAAID,CAAS,GAErDG,EAAM,MAAMR,EAChBC,EACA,IAAIH,EAAiB,CACnB,OAAQ,QAAQ,IAAI,YACpB,IAAKS,EACL,YAAaJ,EAAK,aAAe,YACnC,CAAC,EACD,CAAE,UAAW,IAAK,CACpB,EAEA,MAAO,CACL,WAAY,IACZ,QAAS,CACP,8BAA+B,GACjC,EACA,KAAM,KAAK,UAAU,CAAE,IAAAI,EAAK,IAAAC,CAAI,CAAC,CACnC,CACF",
  "names": ["S3Client", "PutObjectCommand", "S3RequestPresigner", "getSignedUrl", "s3", "event", "body", "keyHint", "extension", "userId", "key", "url"]
}
