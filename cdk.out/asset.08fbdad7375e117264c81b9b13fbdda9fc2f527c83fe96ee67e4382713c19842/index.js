"use strict";var c=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var A=Object.getOwnPropertyNames;var O=Object.prototype.hasOwnProperty;var C=(e,n)=>{for(var t in n)c(e,t,{get:n[t],enumerable:!0})},m=(e,n,t,r)=>{if(n&&typeof n=="object"||typeof n=="function")for(let s of A(n))!O.call(e,s)&&s!==t&&c(e,s,{get:()=>n[s],enumerable:!(r=h(n,s))||r.enumerable});return e};var p=e=>m(c({},"__esModule",{value:!0}),e);var G={};C(G,{handler:()=>b});module.exports=p(G);var o=require("@aws-sdk/client-s3"),S=new o.S3Client({region:process.env.AWS_REGION||"us-east-1",forcePathStyle:!0}),x=process.env.BUCKET,g=String(process.env.ALLOWED_ORIGINS||"").split(",").map(e=>e.trim()).filter(Boolean),P=process.env.WEB_ORIGIN||"",I=["authorization","Authorization","Content-Type","X-Amz-Date","X-Api-Key","X-Amz-Security-Token"].join(",");function d(e){let n=e?.headers?.origin||e?.headers?.Origin||"";return g.length?g.includes(n)?n:void 0:P||void 0}function i(e){let n={"Content-Type":"application/json","Access-Control-Allow-Headers":I,"Access-Control-Allow-Methods":"GET,OPTIONS","Access-Control-Allow-Credentials":"true",Vary:"Origin"};return e&&(n["Access-Control-Allow-Origin"]=e),n}function R(e,n,t={}){let r=d(e);return{statusCode:200,headers:{...i(r),...t},body:JSON.stringify(n)}}function w(e,n,t){let r=d(e);return!!(e.headers?.origin||e.headers?.Origin)&&!r?{statusCode:403,headers:i(void 0),body:JSON.stringify({message:"CORS: origin not allowed"})}:{statusCode:n,headers:i(r),body:JSON.stringify({message:t})}}function T(e){return e.httpMethod??e.requestContext?.http?.method??"GET"}function E(e){return e.requestContext?.authorizer?.claims??e.requestContext?.authorizer?.jwt?.claims??{}}var b=async e=>{if(T(e)==="OPTIONS"){let n=d(e);return!n&&(e.headers?.origin||e.headers?.Origin)?{statusCode:403,headers:i(void 0),body:""}:{statusCode:204,headers:i(n),body:""}}try{let t=E(e)?.sub,r=(e?.queryStringParameters?.prefix??"").replace(/\.\./g,"").replace(/^[/\\]+/,""),l=`${t?`users/${t}/`:""}${r}`,y=e?.queryStringParameters?.nextToken||void 0,a=await S.send(new o.ListObjectsV2Command({Bucket:x,Prefix:l||void 0,ContinuationToken:y,MaxKeys:1e3})),f=(a.Contents??[]).map(u=>({key:u.Key,size:u.Size,lastModified:u.LastModified?.toISOString?.()??null}));return R(e,{prefix:l,items:f,isTruncated:!!a.IsTruncated,nextToken:a.NextContinuationToken??null})}catch(n){return console.error(n),w(e,500,n?.message??String(n))}};0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
