{
  "version": 3,
  "sources": ["../../lambda/creator-tools/index.ts", "../../../../../node_modules/uuid/dist/esm/stringify.js", "../../../../../node_modules/uuid/dist/esm/rng.js", "../../../../../node_modules/uuid/dist/esm/native.js", "../../../../../node_modules/uuid/dist/esm/v4.js"],
  "sourcesContent": ["import { DynamoDBClient } from \"@aws-sdk/client-dynamodb\";\r\nimport {\r\n  DynamoDBDocumentClient,\r\n  QueryCommand,\r\n  PutCommand,\r\n  UpdateCommand,\r\n  DeleteCommand,\r\n  GetCommand,\r\n} from \"@aws-sdk/lib-dynamodb\";\r\nimport { v4 as uuid } from \"uuid\";\r\nimport { S3Client, PutObjectCommand } from \"@aws-sdk/client-s3\";\r\nimport { getSignedUrl } from \"@aws-sdk/s3-request-presigner\";\r\n\r\nconst ddb = DynamoDBDocumentClient.from(new DynamoDBClient({}));\r\nconst s3 = new S3Client({});\r\n\r\nconst TABLE_NAME = process.env.TABLE_NAME!;\r\nconst CREATOR_MEDIA_BUCKET = process.env.CREATOR_MEDIA_BUCKET!;\r\nconst PK = process.env.PK_NAME || \"pk\";\r\nconst SK = process.env.SK_NAME || \"sk\";\r\nconst STATUS_GSI = process.env.STATUS_GSI || \"gsi1\";\r\n\r\nfunction now() {\r\n  return new Date().toISOString();\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// Monetization HQ \u2013 earnings by platform (mocked, windowed)\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function resolveCreatorRevenueByPlatform(event: any) {\r\n  const windowArg: string = event.arguments?.window || \"LAST_30_DAYS\";\r\n\r\n  const days =\r\n    windowArg === \"LAST_7_DAYS\"\r\n      ? 7\r\n      : windowArg === \"LAST_90_DAYS\"\r\n      ? 90\r\n      : 30;\r\n\r\n  // --- sample platform breakdown (Monetization HQ card) ---\r\n  const platforms = [\r\n    {\r\n      platform: \"tiktok\",\r\n      label: \"TikTok Creator Fund\",\r\n      currency: \"USD\",\r\n      amount: 240.5,\r\n      lastPayoutAt: new Date().toISOString(),\r\n    },\r\n    {\r\n      platform: \"instagram\",\r\n      label: \"Instagram bonuses\",\r\n      currency: \"USD\",\r\n      amount: 125.75,\r\n      lastPayoutAt: new Date(\r\n        Date.now() - 4 * 24 * 60 * 60 * 1000,\r\n      ).toISOString(), // 4 days ago\r\n    },\r\n    {\r\n      platform: \"youtube\",\r\n      label: \"YouTube rev share\",\r\n      currency: \"USD\",\r\n      amount: 410.2,\r\n      lastPayoutAt: new Date(\r\n        Date.now() - 9 * 24 * 60 * 60 * 1000,\r\n      ).toISOString(), // 9 days ago\r\n    },\r\n  ];\r\n\r\n  const totalRevenue = platforms.reduce(\r\n    (sum, p) => sum + (p.amount || 0),\r\n    0,\r\n  );\r\n\r\n  // --- sample timeseries (sparkline) ---\r\n  // Smooth-ish \u201Cwavy\u201D cumulative curve so your sparkline has a recognizable shape.\r\n  const timeseries: { date: string; totalRevenue: number }[] = [];\r\n  let cumulative = 0;\r\n\r\n  for (let i = days - 1; i >= 0; i--) {\r\n    const d = new Date();\r\n    d.setDate(d.getDate() - i);\r\n\r\n    const base = totalRevenue / days;\r\n    const wobble =\r\n      Math.sin((i / days) * Math.PI * 2) * (totalRevenue * 0.03);\r\n    const daily = Math.max(0, base + wobble);\r\n\r\n    cumulative += daily;\r\n\r\n    timeseries.push({\r\n      date: d.toISOString().slice(0, 10), // YYYY-MM-DD (AWSDate)\r\n      totalRevenue: Number(cumulative.toFixed(2)),\r\n    });\r\n  }\r\n\r\n  return {\r\n    currency: \"USD\",\r\n    totalRevenue: Number(totalRevenue.toFixed(2)),\r\n    platforms,\r\n    timeseries,\r\n  };\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// GraphQL handler \u2013 router\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\nexport const handler = async (event: any) => {\r\n  const field = event.info?.fieldName;\r\n  const sub =\r\n    event.identity?.sub ||\r\n    event.identity?.claims?.sub ||\r\n    \"anonymous\";\r\n  const args = event.arguments || {};\r\n\r\n  switch (field) {\r\n    // CABINETS\r\n    case \"creatorCabinets\":\r\n      return listCabinets(sub);\r\n    case \"creatorCabinet\":\r\n      return getCabinet(sub, args.id);\r\n    case \"createCreatorCabinet\":\r\n      return createCabinet(sub, args.input);\r\n    case \"updateCreatorCabinet\":\r\n      return updateCabinet(sub, args.input);\r\n    case \"deleteCreatorCabinet\":\r\n      return deleteCabinet(sub, args.id);\r\n\r\n    // FOLDERS\r\n    case \"creatorCabinetFolders\":\r\n      return listFolders(sub, args.cabinetId);\r\n\r\n    // Back-compat alias\r\n    case \"creatorFolders\":\r\n      return listFolders(sub, args.cabinetId);\r\n\r\n    case \"createCreatorFolder\":\r\n      return createFolder(sub, args.input);\r\n    case \"renameCreatorFolder\":\r\n      return renameFolder(sub, args.input);\r\n    case \"deleteCreatorFolder\":\r\n      return deleteFolder(\r\n        sub,\r\n        args.id,\r\n        args.cabinetId,\r\n      );\r\n\r\n    // ASSETS \u2013 creator-facing\r\n    case \"creatorCabinetAssets\":\r\n      return listAssets(sub, args);\r\n    case \"createCreatorAssetUpload\":\r\n      return createAssetUpload(sub, args.input);\r\n    case \"updateCreatorAsset\":\r\n      return updateAsset(sub, args.input);\r\n    case \"deleteCreatorAsset\":\r\n      return deleteAsset(sub, args.id, args.cabinetId);\r\n    case \"moveCreatorAsset\":\r\n      return moveAsset(sub, args.input);\r\n    case \"importClosetItemToCabinet\":\r\n      return importClosetItemToCabinet(sub, args.input);\r\n\r\n    // ADMIN moderation / listing\r\n    case \"adminListCreatorAssetsByUser\":\r\n      return adminListCreatorAssetsByUser(args);\r\n    case \"adminGetCreatorAsset\":\r\n      return adminGetCreatorAsset(args);\r\n    case \"adminModerateCreatorAsset\":\r\n      return adminModerateCreatorAsset(sub, args.input);\r\n    case \"adminSoftDeleteCreatorAsset\":\r\n      return adminSoftDeleteCreatorAsset(sub, args.input);\r\n    case \"adminRestoreCreatorAsset\":\r\n      return adminRestoreCreatorAsset(sub, args.input);\r\n    case \"adminRejectCreatorAsset\":\r\n      return adminRejectCreatorAsset(sub, args.input);\r\n\r\n    // Monetization HQ \u2013 earnings by platform (mocked)\r\n    case \"creatorRevenueByPlatform\":\r\n      return resolveCreatorRevenueByPlatform(event);\r\n\r\n    // Goal compass (creator alignment)\r\n    case \"creatorGoalCompass\":\r\n      return getCreatorGoalCompass(sub);\r\n    case \"updateCreatorGoalCompass\":\r\n      return updateCreatorGoalCompass(sub, args.input);\r\n\r\n    // AI\r\n    case \"creatorAiSuggest\":\r\n      return runCreatorAi(event);\r\n\r\n    default:\r\n      throw new Error(`Unknown field ${field}`);\r\n  }\r\n};\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// Mapping helpers\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nfunction mapCabinet(item: any) {\r\n  if (!item) return null;\r\n  return {\r\n    id: item.id,\r\n    ownerSub: item.ownerSub,\r\n    name: item.name,\r\n    description: item.description ?? null,\r\n    defaultCategory: item.defaultCategory ?? null,\r\n    tags: item.tags ?? [],\r\n    createdAt: item.createdAt,\r\n    updatedAt: item.updatedAt,\r\n    assetCount: item.assetCount ?? 0,\r\n  };\r\n}\r\n\r\nfunction mapFolder(item: any) {\r\n  if (!item) return null;\r\n  return {\r\n    id: item.id,\r\n    cabinetId: item.cabinetId,\r\n    name: item.name,\r\n    specialKind: item.specialKind ?? null,\r\n    createdAt: item.createdAt,\r\n    updatedAt: item.updatedAt,\r\n  };\r\n}\r\n\r\nfunction mapAsset(item: any) {\r\n  if (!item) return null;\r\n  return {\r\n    id: item.id,\r\n    cabinetId: item.cabinetId,\r\n    folderId: item.folderId ?? null,\r\n    ownerSub: item.ownerSub,\r\n    // ensure non-null for GraphQL\r\n    kind: item.kind ?? \"OTHER\",\r\n    category: item.category ?? null,\r\n    title: item.title ?? null,\r\n    notes: item.notes ?? null,\r\n    tags: item.tags ?? [],\r\n    s3Key: item.s3Key,\r\n    contentType: item.contentType ?? null,\r\n    createdAt: item.createdAt,\r\n    updatedAt: item.updatedAt,\r\n\r\n    // moderation defaults\r\n    moderationStatus: item.moderationStatus ?? \"ACTIVE\",\r\n    moderationReason: item.moderationReason ?? null,\r\n    moderatedBy: item.moderatedBy ?? null,\r\n    moderatedAt: item.moderatedAt ?? null,\r\n  };\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// CABINETS\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function listCabinets(sub: string) {\r\n  const res = await ddb.send(\r\n    new QueryCommand({\r\n      TableName: TABLE_NAME,\r\n      IndexName: STATUS_GSI,\r\n      KeyConditionExpression: \"#gpk = :gpk AND begins_with(#gsk, :prefix)\",\r\n      ExpressionAttributeNames: {\r\n        \"#gpk\": \"gsi1pk\",\r\n        \"#gsk\": \"gsi1sk\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":gpk\": `CREATOR#${sub}`,\r\n        \":prefix\": \"CAB#\",\r\n      },\r\n    }),\r\n  );\r\n\r\n  let items = res.Items ?? [];\r\n\r\n  // If this creator has no cabinets yet, auto-create a starter one.\r\n  if (items.length === 0) {\r\n    const starter = await createDefaultCabinetForCreator(sub);\r\n    items = [starter];\r\n  }\r\n\r\n  return items.map(mapCabinet);\r\n}\r\n\r\nasync function getCabinet(sub: string, id: string) {\r\n  if (!id) throw new Error(\"id is required\");\r\n\r\n  const res = await ddb.send(\r\n    new GetCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${id}`,\r\n        [SK]: \"META\",\r\n      },\r\n    }),\r\n  );\r\n\r\n  if (!res.Item || res.Item.ownerSub !== sub) {\r\n    // hide existence of other peoples\u2019 cabinets\r\n    return null;\r\n  }\r\n\r\n  return mapCabinet(res.Item);\r\n}\r\n\r\nasync function createDefaultCabinetForCreator(sub: string) {\r\n  const nowIso = now();\r\n  const id = uuid();\r\n\r\n  const item = {\r\n    [PK]: `CAB#${id}`,\r\n    [SK]: \"META\",\r\n    type: \"CABINET\",\r\n    id,\r\n    ownerSub: sub,\r\n    name: \"From my closet\",\r\n    description:\r\n      \"Imported looks and outfit references from your Bestie closet\",\r\n    defaultCategory: \"OUTFIT_REFS\",\r\n    tags: [\"closet-import\"],\r\n    assetCount: 0,\r\n    createdAt: nowIso,\r\n    updatedAt: nowIso,\r\n    gsi1pk: `CREATOR#${sub}`,\r\n    gsi1sk: `CAB#${nowIso}#${id}`,\r\n  };\r\n\r\n  await ddb.send(\r\n    new PutCommand({\r\n      TableName: TABLE_NAME,\r\n      Item: item,\r\n      ConditionExpression: \"attribute_not_exists(#pk)\",\r\n      ExpressionAttributeNames: {\r\n        \"#pk\": PK,\r\n      },\r\n    }),\r\n  );\r\n\r\n  return item;\r\n}\r\n\r\nasync function createCabinet(sub: string, input: any) {\r\n  if (!input?.name) {\r\n    throw new Error(\"name is required\");\r\n  }\r\n\r\n  const id = uuid();\r\n  const nowIso = now();\r\n\r\n  const item = {\r\n    [PK]: `CAB#${id}`,\r\n    [SK]: \"META\",\r\n    type: \"CABINET\",\r\n    id,\r\n    ownerSub: sub,\r\n    name: input.name,\r\n    description: input.description ?? null,\r\n    defaultCategory: input.defaultCategory ?? null,\r\n    tags: input.tags ?? [],\r\n    assetCount: 0,\r\n    createdAt: nowIso,\r\n    updatedAt: nowIso,\r\n    // GSI to list cabinets per creator\r\n    gsi1pk: `CREATOR#${sub}`,\r\n    gsi1sk: `CAB#${nowIso}#${id}`,\r\n  };\r\n\r\n  await ddb.send(\r\n    new PutCommand({\r\n      TableName: TABLE_NAME,\r\n      Item: item,\r\n      ConditionExpression: \"attribute_not_exists(#pk)\",\r\n      ExpressionAttributeNames: {\r\n        \"#pk\": PK,\r\n      },\r\n    }),\r\n  );\r\n\r\n  return mapCabinet(item);\r\n}\r\n\r\nasync function updateCabinet(sub: string, input: any) {\r\n  const id = input?.id;\r\n  if (!id) throw new Error(\"id is required\");\r\n  if (!input) throw new Error(\"input is required\");\r\n\r\n  const nowIso = now();\r\n\r\n  const names: Record<string, string> = {\r\n    \"#updatedAt\": \"updatedAt\",\r\n    \"#ownerSub\": \"ownerSub\",\r\n  };\r\n  const values: Record<string, any> = {\r\n    \":updatedAt\": nowIso,\r\n    \":ownerSub\": sub,\r\n  };\r\n  const sets: string[] = [\"#updatedAt = :updatedAt\"];\r\n\r\n  if (Object.prototype.hasOwnProperty.call(input, \"name\")) {\r\n    names[\"#name\"] = \"name\";\r\n    values[\":name\"] = input.name;\r\n    sets.push(\"#name = :name\");\r\n  }\r\n  if (Object.prototype.hasOwnProperty.call(input, \"description\")) {\r\n    names[\"#description\"] = \"description\";\r\n    values[\":description\"] = input.description ?? null;\r\n    sets.push(\"#description = :description\");\r\n  }\r\n  if (Object.prototype.hasOwnProperty.call(input, \"defaultCategory\")) {\r\n    names[\"#defaultCategory\"] = \"defaultCategory\";\r\n    values[\":defaultCategory\"] = input.defaultCategory ?? null;\r\n    sets.push(\"#defaultCategory = :defaultCategory\");\r\n  }\r\n  if (Object.prototype.hasOwnProperty.call(input, \"tags\")) {\r\n    names[\"#tags\"] = \"tags\";\r\n    values[\":tags\"] = input.tags ?? [];\r\n    sets.push(\"#tags = :tags\");\r\n  }\r\n\r\n  const res = await ddb.send(\r\n    new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${id}`,\r\n        [SK]: \"META\",\r\n      },\r\n      UpdateExpression: \"SET \" + sets.join(\", \"),\r\n      ConditionExpression: \"#ownerSub = :ownerSub\",\r\n      ExpressionAttributeNames: names,\r\n      ExpressionAttributeValues: values,\r\n      ReturnValues: \"ALL_NEW\",\r\n    }),\r\n  );\r\n\r\n  return mapCabinet(res.Attributes);\r\n}\r\n\r\nasync function deleteCabinet(sub: string, id: string) {\r\n  if (!id) throw new Error(\"id is required\");\r\n\r\n  const pkValue = `CAB#${id}`;\r\n\r\n  // First fetch all rows for this cabinet to confirm ownership & cascade delete.\r\n  const res = await ddb.send(\r\n    new QueryCommand({\r\n      TableName: TABLE_NAME,\r\n      KeyConditionExpression: \"#pk = :pk\",\r\n      ExpressionAttributeNames: {\r\n        \"#pk\": PK,\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":pk\": pkValue,\r\n      },\r\n    }),\r\n  );\r\n\r\n  const items = res.Items ?? [];\r\n  const meta = items.find((it) => it.type === \"CABINET\");\r\n\r\n  if (!meta || meta.ownerSub !== sub) {\r\n    // Not your cabinet \u2192 pretend it doesn't exist\r\n    return false;\r\n  }\r\n\r\n  // Best-effort cascade delete\r\n  await Promise.all(\r\n    items.map((item) =>\r\n      ddb.send(\r\n        new DeleteCommand({\r\n          TableName: TABLE_NAME,\r\n          Key: {\r\n            [PK]: item[PK],\r\n            [SK]: item[SK],\r\n          },\r\n        }),\r\n      ),\r\n    ),\r\n  );\r\n\r\n  return true;\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// FOLDERS\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function listFolders(sub: string, cabinetId: string) {\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n\r\n  // optional: check cabinet ownership\r\n  const cabinet = await getCabinet(sub, cabinetId);\r\n  if (!cabinet) {\r\n    // hide if not owner\r\n    return [];\r\n  }\r\n\r\n  const res = await ddb.send(\r\n    new QueryCommand({\r\n      TableName: TABLE_NAME,\r\n      KeyConditionExpression:\r\n        \"#pk = :pk AND begins_with(#sk, :prefix)\",\r\n      ExpressionAttributeNames: {\r\n        \"#pk\": PK,\r\n        \"#sk\": SK,\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":pk\": `CAB#${cabinetId}`,\r\n        \":prefix\": \"FOLDER#\",\r\n      },\r\n    }),\r\n  );\r\n\r\n  const items = res.Items ?? [];\r\n  return items.map(mapFolder);\r\n}\r\n\r\nasync function createFolder(sub: string, input: any) {\r\n  const { cabinetId, name } = input || {};\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n  if (!name) throw new Error(\"name is required\");\r\n\r\n  const cabinet = await getCabinet(sub, cabinetId);\r\n  if (!cabinet) {\r\n    throw new Error(\"Cabinet not found\");\r\n  }\r\n\r\n  const id = uuid();\r\n  const nowIso = now();\r\n\r\n  const item = {\r\n    [PK]: `CAB#${cabinetId}`,\r\n    [SK]: `FOLDER#${id}`,\r\n    type: \"FOLDER\",\r\n    id,\r\n    cabinetId,\r\n    ownerSub: sub,\r\n    name,\r\n    specialKind: null,\r\n    createdAt: nowIso,\r\n    updatedAt: nowIso,\r\n  };\r\n\r\n  await ddb.send(\r\n    new PutCommand({\r\n      TableName: TABLE_NAME,\r\n      Item: item,\r\n      ConditionExpression:\r\n        \"attribute_not_exists(#pk) AND attribute_not_exists(#sk)\",\r\n      ExpressionAttributeNames: {\r\n        \"#pk\": PK,\r\n        \"#sk\": SK,\r\n      },\r\n    }),\r\n  );\r\n\r\n  return mapFolder(item);\r\n}\r\n\r\nasync function renameFolder(sub: string, input: any) {\r\n  const { id, cabinetId, name } = input || {};\r\n  if (!id) throw new Error(\"id is required\");\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n  if (!name) throw new Error(\"name is required\");\r\n\r\n  const nowIso = now();\r\n\r\n  const res = await ddb.send(\r\n    new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: `FOLDER#${id}`,\r\n      },\r\n      UpdateExpression: \"SET #name = :name, #updatedAt = :updatedAt\",\r\n      ConditionExpression: \"#ownerSub = :ownerSub\",\r\n      ExpressionAttributeNames: {\r\n        \"#name\": \"name\",\r\n        \"#updatedAt\": \"updatedAt\",\r\n        \"#ownerSub\": \"ownerSub\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":name\": name,\r\n        \":updatedAt\": nowIso,\r\n        \":ownerSub\": sub,\r\n      },\r\n      ReturnValues: \"ALL_NEW\",\r\n    }),\r\n  );\r\n\r\n  return mapFolder(res.Attributes);\r\n}\r\n\r\nasync function deleteFolder(sub: string, id: string, cabinetId: string) {\r\n  if (!id) throw new Error(\"id is required\");\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n\r\n  // Delete the folder row (with ownership check)\r\n  await ddb.send(\r\n    new DeleteCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: `FOLDER#${id}`,\r\n      },\r\n      ConditionExpression: \"#ownerSub = :ownerSub\",\r\n      ExpressionAttributeNames: {\r\n        \"#ownerSub\": \"ownerSub\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":ownerSub\": sub,\r\n      },\r\n    }),\r\n  );\r\n\r\n  // Best-effort cleanup: move any assets in this folder to \"unsorted\" (null folderId)\r\n  const res = await ddb.send(\r\n    new QueryCommand({\r\n      TableName: TABLE_NAME,\r\n      KeyConditionExpression:\r\n        \"#pk = :pk AND begins_with(#sk, :prefix)\",\r\n      ExpressionAttributeNames: {\r\n        \"#pk\": PK,\r\n        \"#sk\": SK,\r\n        \"#folderId\": \"folderId\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":pk\": `CAB#${cabinetId}`,\r\n        \":prefix\": \"ASSET#\",\r\n        \":folderId\": id,\r\n      },\r\n      FilterExpression: \"#folderId = :folderId\",\r\n    }),\r\n  );\r\n\r\n  const assets = res.Items ?? [];\r\n  await Promise.all(\r\n    assets.map((asset) =>\r\n      ddb.send(\r\n        new UpdateCommand({\r\n          TableName: TABLE_NAME,\r\n          Key: {\r\n            [PK]: asset[PK],\r\n            [SK]: asset[SK],\r\n          },\r\n          UpdateExpression: \"SET #folderId = :null\",\r\n          ExpressionAttributeNames: {\r\n            \"#folderId\": \"folderId\",\r\n          },\r\n          ExpressionAttributeValues: {\r\n            \":null\": null,\r\n          },\r\n        }),\r\n      ),\r\n    ),\r\n  );\r\n\r\n  return true;\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// ASSETS \u2013 creator-facing\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function listAssets(sub: string, args: any) {\r\n  const {\r\n    cabinetId,\r\n    folderId,\r\n    category,\r\n    tag,\r\n    search,\r\n    limit = 50,\r\n    nextToken,\r\n  } = args || {};\r\n\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n\r\n  const cabinet = await getCabinet(sub, cabinetId);\r\n  if (!cabinet) {\r\n    // Hide if not owner\r\n    return {\r\n      items: [],\r\n      nextToken: null,\r\n    };\r\n  }\r\n\r\n  const queryInput: any = {\r\n    TableName: TABLE_NAME,\r\n    KeyConditionExpression:\r\n      \"#pk = :pk AND begins_with(#sk, :prefix)\",\r\n    ExpressionAttributeNames: {\r\n      \"#pk\": PK,\r\n      \"#sk\": SK,\r\n    },\r\n    ExpressionAttributeValues: {\r\n      \":pk\": `CAB#${cabinetId}`,\r\n      \":prefix\": \"ASSET#\",\r\n    },\r\n    Limit: limit,\r\n  };\r\n\r\n  if (nextToken) {\r\n    queryInput.ExclusiveStartKey = {\r\n      [PK]: `CAB#${cabinetId}`,\r\n      [SK]: nextToken,\r\n    };\r\n  }\r\n\r\n  const res = await ddb.send(new QueryCommand(queryInput));\r\n  let items = (res.Items ?? []).filter((it) => it.type === \"ASSET\");\r\n\r\n  // Hide moderated assets for the creator UI:\r\n  items = items.filter((it) => {\r\n    const status = String(it.moderationStatus ?? \"ACTIVE\").toUpperCase();\r\n    return status === \"ACTIVE\";\r\n  });\r\n\r\n  // In-memory filters\r\n  if (folderId !== undefined && folderId !== null) {\r\n    items = items.filter((it) => it.folderId === folderId);\r\n  }\r\n  if (category) {\r\n    items = items.filter((it) => it.category === category);\r\n  }\r\n  if (tag) {\r\n    items = items.filter(\r\n      (it) => Array.isArray(it.tags) && it.tags.includes(tag),\r\n    );\r\n  }\r\n  if (search) {\r\n    const q = String(search).toLowerCase();\r\n    items = items.filter((it) => {\r\n      const title = (it.title ?? \"\").toLowerCase();\r\n      const notes = (it.notes ?? \"\").toLowerCase();\r\n      return title.includes(q) || notes.includes(q);\r\n    });\r\n  }\r\n\r\n  const connectionNextToken =\r\n    res.LastEvaluatedKey ? res.LastEvaluatedKey[SK] : null;\r\n\r\n  return {\r\n    items: items.map(mapAsset),\r\n    nextToken: connectionNextToken,\r\n  };\r\n}\r\n\r\n// Upload flow\r\nasync function createAssetUpload(sub: string, input: any) {\r\n  const {\r\n    cabinetId,\r\n    folderId,\r\n    category,\r\n    title,\r\n    notes,\r\n    tags = [],\r\n    fileName,\r\n    filename, // tolerate old name\r\n    contentType,\r\n    kind,\r\n  } = input || {};\r\n\r\n  const finalFileName = fileName ?? filename;\r\n\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n  if (!finalFileName) throw new Error(\"fileName is required\");\r\n  if (!contentType) throw new Error(\"contentType is required\");\r\n\r\n  // Ensure cabinet exists + belongs to user\r\n  const cabinet = await getCabinet(sub, cabinetId);\r\n  if (!cabinet) {\r\n    throw new Error(\"Cabinet not found\");\r\n  }\r\n\r\n  const assetId = uuid();\r\n  const folderPart = folderId || \"unsorted\";\r\n  const safeName = String(finalFileName).replace(/[^a-zA-Z0-9._-]/g, \"_\");\r\n\r\n  const s3Key = [\r\n    \"creator-media\",\r\n    sub,\r\n    cabinetId,\r\n    folderPart,\r\n    `${assetId}-${safeName}`,\r\n  ].join(\"/\");\r\n\r\n  const nowIso = now();\r\n  const assetKind = kind ?? \"OTHER\";\r\n\r\n  const item = {\r\n    [PK]: `CAB#${cabinetId}`,\r\n    [SK]: `ASSET#${assetId}`,\r\n    type: \"ASSET\",\r\n    id: assetId,\r\n    cabinetId,\r\n    folderId: folderId ?? null,\r\n    ownerSub: sub,\r\n    kind: assetKind,\r\n    category: category ?? null,\r\n    title: title ?? null,\r\n    notes: notes ?? null,\r\n    tags,\r\n    s3Key,\r\n    contentType,\r\n    createdAt: nowIso,\r\n    updatedAt: nowIso,\r\n\r\n    // moderation defaults\r\n    moderationStatus: \"ACTIVE\" as const,\r\n    moderationReason: null,\r\n    moderatedBy: null,\r\n    moderatedAt: null,\r\n\r\n    // GSI for admin listing by user\r\n    gsi1pk: `CREATOR#${sub}`,\r\n    gsi1sk: `CAB_ASSET#${cabinetId}#${nowIso}#${assetId}`,\r\n  };\r\n\r\n  // 1) create ASSET row in Dynamo (pending upload)\r\n  await ddb.send(\r\n    new PutCommand({\r\n      TableName: TABLE_NAME,\r\n      Item: item,\r\n    }),\r\n  );\r\n\r\n  // Best-effort: bump cabinet.assetCount\r\n  await ddb.send(\r\n    new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: \"META\",\r\n      },\r\n      UpdateExpression:\r\n        \"SET #assetCount = if_not_exists(#assetCount, :zero) + :one, #updatedAt = :updatedAt\",\r\n      ExpressionAttributeNames: {\r\n        \"#assetCount\": \"assetCount\",\r\n        \"#updatedAt\": \"updatedAt\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":zero\": 0,\r\n        \":one\": 1,\r\n        \":updatedAt\": nowIso,\r\n      },\r\n    }),\r\n  );\r\n\r\n  // 2) make a presigned URL so the browser can PUT the file\r\n  const putCmd = new PutObjectCommand({\r\n    Bucket: CREATOR_MEDIA_BUCKET,\r\n    Key: s3Key,\r\n    ContentType: contentType,\r\n  });\r\n\r\n  const uploadUrl = await getSignedUrl(s3, putCmd, { expiresIn: 900 });\r\n\r\n  return {\r\n    uploadUrl,\r\n    asset: mapAsset(item),\r\n  };\r\n}\r\n\r\nasync function updateAsset(sub: string, input: any) {\r\n  const { id, cabinetId } = input || {};\r\n  if (!id) throw new Error(\"id is required\");\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n\r\n  const nowIso = now();\r\n\r\n  const names: Record<string, string> = {\r\n    \"#updatedAt\": \"updatedAt\",\r\n    \"#ownerSub\": \"ownerSub\",\r\n  };\r\n  const values: Record<string, any> = {\r\n    \":updatedAt\": nowIso,\r\n    \":ownerSub\": sub,\r\n  };\r\n  const sets: string[] = [\"#updatedAt = :updatedAt\"];\r\n\r\n  if (Object.prototype.hasOwnProperty.call(input, \"folderId\")) {\r\n    names[\"#folderId\"] = \"folderId\";\r\n    values[\":folderId\"] = input.folderId ?? null;\r\n    sets.push(\"#folderId = :folderId\");\r\n  }\r\n  if (Object.prototype.hasOwnProperty.call(input, \"category\")) {\r\n    names[\"#category\"] = \"category\";\r\n    values[\":category\"] = input.category ?? null;\r\n    sets.push(\"#category = :category\");\r\n  }\r\n  if (Object.prototype.hasOwnProperty.call(input, \"title\")) {\r\n    names[\"#title\"] = \"title\";\r\n    values[\":title\"] = input.title ?? null;\r\n    sets.push(\"#title = :title\");\r\n  }\r\n  if (Object.prototype.hasOwnProperty.call(input, \"notes\")) {\r\n    names[\"#notes\"] = \"notes\";\r\n    values[\":notes\"] = input.notes ?? null;\r\n    sets.push(\"#notes = :notes\");\r\n  }\r\n  if (Object.prototype.hasOwnProperty.call(input, \"tags\")) {\r\n    names[\"#tags\"] = \"tags\";\r\n    values[\":tags\"] = input.tags ?? [];\r\n    sets.push(\"#tags = :tags\");\r\n  }\r\n  if (Object.prototype.hasOwnProperty.call(input, \"kind\")) {\r\n    names[\"#kind\"] = \"kind\";\r\n    values[\":kind\"] = input.kind ?? \"OTHER\";\r\n    sets.push(\"#kind = :kind\");\r\n  }\r\n  if (Object.prototype.hasOwnProperty.call(input, \"contentType\")) {\r\n    names[\"#contentType\"] = \"contentType\";\r\n    values[\":contentType\"] = input.contentType ?? null;\r\n    sets.push(\"#contentType = :contentType\");\r\n  }\r\n\r\n  const res = await ddb.send(\r\n    new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: `ASSET#${id}`,\r\n      },\r\n      UpdateExpression: \"SET \" + sets.join(\", \"),\r\n      ConditionExpression: \"#ownerSub = :ownerSub\",\r\n      ExpressionAttributeNames: names,\r\n      ExpressionAttributeValues: values,\r\n      ReturnValues: \"ALL_NEW\",\r\n    }),\r\n  );\r\n\r\n  return mapAsset(res.Attributes);\r\n}\r\n\r\nasync function deleteAsset(sub: string, id: string, cabinetId: string) {\r\n  if (!id) throw new Error(\"id is required\");\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n\r\n  const nowIso = now();\r\n\r\n  // 1) Delete the asset row with ownership check\r\n  await ddb.send(\r\n    new DeleteCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: `ASSET#${id}`,\r\n      },\r\n      ConditionExpression: \"#ownerSub = :ownerSub\",\r\n      ExpressionAttributeNames: {\r\n        \"#ownerSub\": \"ownerSub\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":ownerSub\": sub,\r\n      },\r\n    }),\r\n  );\r\n\r\n  // 2) Best-effort: decrement assetCount\r\n  await ddb.send(\r\n    new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: \"META\",\r\n      },\r\n      UpdateExpression:\r\n        \"SET #assetCount = if_not_exists(#assetCount, :zero) - :one, #updatedAt = :updatedAt\",\r\n      ExpressionAttributeNames: {\r\n        \"#assetCount\": \"assetCount\",\r\n        \"#updatedAt\": \"updatedAt\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":zero\": 0,\r\n        \":one\": 1,\r\n        \":updatedAt\": nowIso,\r\n      },\r\n    }),\r\n  );\r\n\r\n  return true;\r\n}\r\n\r\nasync function moveAsset(sub: string, input: any) {\r\n  const { id, cabinetId, destinationFolderId } = input || {};\r\n  if (!id) throw new Error(\"id is required\");\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n\r\n  const nowIso = now();\r\n\r\n  const res = await ddb.send(\r\n    new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: `ASSET#${id}`,\r\n      },\r\n      UpdateExpression:\r\n        \"SET #folderId = :folderId, #updatedAt = :updatedAt\",\r\n      ConditionExpression: \"#ownerSub = :ownerSub\",\r\n      ExpressionAttributeNames: {\r\n        \"#folderId\": \"folderId\",\r\n        \"#updatedAt\": \"updatedAt\",\r\n        \"#ownerSub\": \"ownerSub\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":folderId\": destinationFolderId ?? null,\r\n        \":updatedAt\": nowIso,\r\n        \":ownerSub\": sub,\r\n      },\r\n      ReturnValues: \"ALL_NEW\",\r\n    }),\r\n  );\r\n\r\n  return mapAsset(res.Attributes);\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// ASSETS \u2013 admin listing / moderation\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function adminListCreatorAssetsByUser(args: any) {\r\n  const {\r\n    ownerSub,\r\n    cabinetId,\r\n    folderId,\r\n    moderationStatus,\r\n    includeSoftDeleted = true,\r\n    limit = 50,\r\n    // nextToken planned later\r\n  } = args || {};\r\n\r\n  if (!ownerSub) throw new Error(\"ownerSub is required\");\r\n\r\n  const res = await ddb.send(\r\n    new QueryCommand({\r\n      TableName: TABLE_NAME,\r\n      IndexName: STATUS_GSI,\r\n      KeyConditionExpression:\r\n        \"#gpk = :gpk AND begins_with(#gsk, :prefix)\",\r\n      ExpressionAttributeNames: {\r\n        \"#gpk\": \"gsi1pk\",\r\n        \"#gsk\": \"gsi1sk\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":gpk\": `CREATOR#${ownerSub}`,\r\n        \":prefix\": \"CAB_ASSET#\",\r\n      },\r\n      Limit: limit,\r\n    }),\r\n  );\r\n\r\n  let items = (res.Items ?? []).filter((it) => it.type === \"ASSET\");\r\n\r\n  if (cabinetId) {\r\n    items = items.filter((it) => it.cabinetId === cabinetId);\r\n  }\r\n  if (folderId !== undefined && folderId !== null) {\r\n    items = items.filter((it) => it.folderId === folderId);\r\n  }\r\n\r\n  if (moderationStatus) {\r\n    const wanted = String(moderationStatus).toUpperCase();\r\n    items = items.filter(\r\n      (it) =>\r\n        String(it.moderationStatus ?? \"ACTIVE\").toUpperCase() === wanted,\r\n    );\r\n  }\r\n\r\n  if (!includeSoftDeleted) {\r\n    items = items.filter(\r\n      (it) =>\r\n        String(it.moderationStatus ?? \"ACTIVE\").toUpperCase() !==\r\n        \"SOFT_DELETED\",\r\n    );\r\n  }\r\n\r\n  return {\r\n    items: items.map(mapAsset),\r\n    nextToken: null, // simple for now; can add JSON-encoded LastEvaluatedKey later\r\n  };\r\n}\r\n\r\nasync function adminGetCreatorAsset(args: any) {\r\n  const { cabinetId, id } = args || {};\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n  if (!id) throw new Error(\"id is required\");\r\n\r\n  const res = await ddb.send(\r\n    new GetCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: `ASSET#${id}`,\r\n      },\r\n    }),\r\n  );\r\n\r\n  if (!res.Item || res.Item.type !== \"ASSET\") {\r\n    return null;\r\n  }\r\n\r\n  return mapAsset(res.Item);\r\n}\r\n\r\nasync function adminModerateCreatorAsset(adminSub: string, input: any) {\r\n  const { cabinetId, id, moderationStatus, moderationReason, tags } =\r\n    input || {};\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n  if (!id) throw new Error(\"id is required\");\r\n  if (!moderationStatus) throw new Error(\"moderationStatus is required\");\r\n\r\n  const nowIso = now();\r\n\r\n  const names: Record<string, string> = {\r\n    \"#moderationStatus\": \"moderationStatus\",\r\n    \"#updatedAt\": \"updatedAt\",\r\n    \"#moderatedAt\": \"moderatedAt\",\r\n    \"#moderatedBy\": \"moderatedBy\",\r\n  };\r\n  const values: Record<string, any> = {\r\n    \":moderationStatus\": moderationStatus,\r\n    \":updatedAt\": nowIso,\r\n    \":moderatedAt\": nowIso,\r\n    \":moderatedBy\": adminSub,\r\n  };\r\n  const sets: string[] = [\r\n    \"#moderationStatus = :moderationStatus\",\r\n    \"#updatedAt = :updatedAt\",\r\n    \"#moderatedAt = :moderatedAt\",\r\n    \"#moderatedBy = :moderatedBy\",\r\n  ];\r\n\r\n  if (Object.prototype.hasOwnProperty.call(input, \"moderationReason\")) {\r\n    names[\"#moderationReason\"] = \"moderationReason\";\r\n    values[\":moderationReason\"] = moderationReason ?? null;\r\n    sets.push(\"#moderationReason = :moderationReason\");\r\n  }\r\n\r\n  if (Array.isArray(tags)) {\r\n    names[\"#tags\"] = \"tags\";\r\n    values[\":tags\"] = tags;\r\n    sets.push(\"#tags = :tags\");\r\n  }\r\n\r\n  const res = await ddb.send(\r\n    new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: `ASSET#${id}`,\r\n\r\n      },\r\n      UpdateExpression: \"SET \" + sets.join(\", \"),\r\n      ReturnValues: \"ALL_NEW\",\r\n    }),\r\n  );\r\n\r\n  return mapAsset(res.Attributes);\r\n}\r\n\r\nasync function adminRejectCreatorAsset(adminSub: string, input: any) {\r\n  if (!input) throw new Error(\"input is required\");\r\n  const { cabinetId, id, moderationReason, tags } = input;\r\n\r\n  return adminModerateCreatorAsset(adminSub, {\r\n    cabinetId,\r\n    id,\r\n    moderationStatus: \"REJECTED\",\r\n    moderationReason,\r\n    tags,\r\n  });\r\n}\r\n\r\nasync function adminSoftDeleteCreatorAsset(adminSub: string, input: any) {\r\n  const { cabinetId, id, reason } = input || {};\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n  if (!id) throw new Error(\"id is required\");\r\n\r\n  const nowIso = now();\r\n\r\n  const res = await ddb.send(\r\n    new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: `ASSET#${id}`,\r\n      },\r\n      UpdateExpression:\r\n        \"SET #moderationStatus = :status, #moderationReason = :reason, #moderatedBy = :moderatedBy, #moderatedAt = :moderatedAt, #updatedAt = :updatedAt\",\r\n      ExpressionAttributeNames: {\r\n        \"#moderationStatus\": \"moderationStatus\",\r\n        \"#moderationReason\": \"moderationReason\",\r\n        \"#moderatedBy\": \"moderatedBy\",\r\n        \"#moderatedAt\": \"moderatedAt\",\r\n        \"#updatedAt\": \"updatedAt\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":status\": \"SOFT_DELETED\",\r\n        \":reason\": reason ?? null,\r\n        \":moderatedBy\": adminSub,\r\n        \":moderatedAt\": nowIso,\r\n        \":updatedAt\": nowIso,\r\n      },\r\n      ReturnValues: \"ALL_NEW\",\r\n    }),\r\n  );\r\n\r\n  return mapAsset(res.Attributes);\r\n}\r\n\r\nasync function adminRestoreCreatorAsset(adminSub: string, input: any) {\r\n  const { cabinetId, id } = input || {};\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n  if (!id) throw new Error(\"id is required\");\r\n\r\n  const nowIso = now();\r\n\r\n  const res = await ddb.send(\r\n    new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: `ASSET#${id}`,\r\n      },\r\n      UpdateExpression:\r\n        \"SET #moderationStatus = :status, #moderationReason = :reason, #moderatedBy = :moderatedBy, #moderatedAt = :moderatedAt, #updatedAt = :updatedAt\",\r\n      ExpressionAttributeNames: {\r\n        \"#moderationStatus\": \"moderationStatus\",\r\n        \"#moderationReason\": \"moderationReason\",\r\n        \"#moderatedBy\": \"moderatedBy\",\r\n        \"#moderatedAt\": \"moderatedAt\",\r\n        \"#updatedAt\": \"updatedAt\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":status\": \"ACTIVE\",\r\n        \":reason\": null,\r\n        \":moderatedBy\": adminSub,\r\n        \":moderatedAt\": nowIso,\r\n        \":updatedAt\": nowIso,\r\n      },\r\n      ReturnValues: \"ALL_NEW\",\r\n    }),\r\n  );\r\n\r\n  return mapAsset(res.Attributes);\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// CREATOR GOAL COMPASS\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nfunction defaultGoalCompass() {\r\n  return {\r\n    primaryGoal: \"GROWTH\",\r\n    timeHorizon: \"90_DAYS\",\r\n    weeklyCapacity: 5,\r\n    focusAreas: [\"PERSONALITY\", \"NURTURE\"],\r\n    riskTolerance: \"MEDIUM\",\r\n    notes: null,\r\n    updatedAt: null,\r\n  };\r\n}\r\n\r\nasync function getCreatorGoalCompass(sub: string) {\r\n  const res = await ddb.send(\r\n    new GetCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CREATOR#${sub}`,\r\n        [SK]: \"GOAL_COMPASS\",\r\n      },\r\n    }),\r\n  );\r\n\r\n  if (!res.Item) {\r\n    // no record yet -> return defaults (client can still save)\r\n    return defaultGoalCompass();\r\n  }\r\n\r\n  const it = res.Item;\r\n\r\n  return {\r\n    primaryGoal: it.primaryGoal ?? \"GROWTH\",\r\n    timeHorizon: it.timeHorizon ?? \"90_DAYS\",\r\n    weeklyCapacity:\r\n      typeof it.weeklyCapacity === \"number\" ? it.weeklyCapacity : 5,\r\n    focusAreas:\r\n      Array.isArray(it.focusAreas) && it.focusAreas.length\r\n        ? it.focusAreas\r\n        : [\"PERSONALITY\", \"NURTURE\"],\r\n    riskTolerance: it.riskTolerance ?? \"MEDIUM\",\r\n    notes: it.notes ?? null,\r\n    updatedAt: it.updatedAt ?? null,\r\n  };\r\n}\r\n\r\nasync function updateCreatorGoalCompass(sub: string, input: any) {\r\n  if (!input) throw new Error(\"input is required\");\r\n\r\n  const nowIso = now();\r\n\r\n  // We treat this as an upsert that overwrites the current compass.\r\n  const item = {\r\n    [PK]: `CREATOR#${sub}`,\r\n    [SK]: \"GOAL_COMPASS\",\r\n    type: \"CREATOR_GOAL_COMPASS\",\r\n\r\n    primaryGoal: input.primaryGoal ?? \"GROWTH\",\r\n    timeHorizon: input.timeHorizon ?? \"90_DAYS\",\r\n    weeklyCapacity:\r\n      typeof input.weeklyCapacity === \"number\"\r\n        ? input.weeklyCapacity\r\n        : 5,\r\n    focusAreas:\r\n      Array.isArray(input.focusAreas) && input.focusAreas.length\r\n        ? input.focusAreas\r\n        : [\"PERSONALITY\", \"NURTURE\"],\r\n    riskTolerance: input.riskTolerance ?? \"MEDIUM\",\r\n    notes: input.notes ?? null,\r\n    updatedAt: nowIso,\r\n  };\r\n\r\n  await ddb.send(\r\n    new PutCommand({\r\n      TableName: TABLE_NAME,\r\n      Item: item,\r\n    }),\r\n  );\r\n\r\n  return {\r\n    primaryGoal: item.primaryGoal,\r\n    timeHorizon: item.timeHorizon,\r\n    weeklyCapacity: item.weeklyCapacity,\r\n    focusAreas: item.focusAreas,\r\n    riskTolerance: item.riskTolerance,\r\n    notes: item.notes,\r\n    updatedAt: item.updatedAt,\r\n  };\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// IMPORT FROM CLOSET \u2192 CABINET\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function importClosetItemToCabinet(sub: string, input: any) {\r\n  const {\r\n    closetItemId,\r\n    cabinetId,\r\n    folderId,\r\n    kind,\r\n    title,\r\n    notes,\r\n    tags = [],\r\n  } = input || {};\r\n\r\n  if (!closetItemId) throw new Error(\"closetItemId is required\");\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n\r\n  // 1) Ensure target cabinet belongs to this user\r\n  const cabinet = await getCabinet(sub, cabinetId);\r\n  if (!cabinet) {\r\n    throw new Error(\"Cabinet not found\");\r\n  }\r\n\r\n  // 2) Look up the closet item.\r\n  //\r\n  // NOTE: This assumes closet items are keyed by:\r\n  //   pk = `CLOSET#${sub}`\r\n  //   sk = `ITEM#${closetItemId}`\r\n  //\r\n  // If your actual pattern is different, adjust PK/SK accordingly.\r\n  const closetRes = await ddb.send(\r\n    new GetCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CLOSET#${sub}`,\r\n        [SK]: `ITEM#${closetItemId}`,\r\n      },\r\n    }),\r\n  );\r\n\r\n  const closetItem = closetRes.Item;\r\n  if (!closetItem || closetItem.ownerSub !== sub) {\r\n    throw new Error(\"Closet item not found\");\r\n  }\r\n\r\n  const assetId = uuid();\r\n  const nowIso = now();\r\n\r\n  // Reuse the existing closet media key if possible.\r\n  const s3Key =\r\n    closetItem.mediaKey ||\r\n    closetItem.rawMediaKey ||\r\n    (() => {\r\n      throw new Error(\"Closet item has no media key\");\r\n    })();\r\n\r\n  const assetKind = kind ?? \"PHOTO\";\r\n  const finalTitle = title ?? closetItem.title ?? null;\r\n  const finalNotes = notes ?? closetItem.notes ?? null;\r\n  const finalTags = tags.length ? tags : closetItem.colorTags ?? [];\r\n\r\n  const item = {\r\n    [PK]: `CAB#${cabinetId}`,\r\n    [SK]: `ASSET#${assetId}`,\r\n    type: \"ASSET\",\r\n    id: assetId,\r\n    cabinetId,\r\n    folderId: folderId ?? null,\r\n    ownerSub: sub,\r\n    kind: assetKind,\r\n    category: \"OUTFIT_REFS\",\r\n    title: finalTitle,\r\n    notes: finalNotes,\r\n    tags: finalTags,\r\n    s3Key,\r\n    contentType: closetItem.contentType ?? \"image/jpeg\",\r\n    createdAt: nowIso,\r\n    updatedAt: nowIso,\r\n    sourceClosetItemId: closetItemId,\r\n\r\n    // moderation defaults\r\n    moderationStatus: \"ACTIVE\" as const,\r\n    moderationReason: null,\r\n    moderatedBy: null,\r\n    moderatedAt: null,\r\n\r\n    // GSI for admin listing by user\r\n    gsi1pk: `CREATOR#${sub}`,\r\n    gsi1sk: `CAB_ASSET#${cabinetId}#${nowIso}#${assetId}`,\r\n  };\r\n\r\n  await ddb.send(\r\n    new PutCommand({\r\n      TableName: TABLE_NAME,\r\n      Item: item,\r\n    }),\r\n  );\r\n\r\n  // Best-effort bump cabinet assetCount\r\n  await ddb.send(\r\n    new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: \"META\",\r\n      },\r\n      UpdateExpression:\r\n        \"SET #assetCount = if_not_exists(#assetCount, :zero) + :one, #updatedAt = :updatedAt\",\r\n      ExpressionAttributeNames: {\r\n        \"#assetCount\": \"assetCount\",\r\n        \"#updatedAt\": \"updatedAt\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":zero\": 0,\r\n        \":one\": 1,\r\n        \":updatedAt\": nowIso,\r\n      },\r\n    }),\r\n  );\r\n\r\n  return mapAsset(item);\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// AI \u2013 stubbed (safe, no Bedrock needed)\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function runCreatorAi(event: any) {\r\n  const text: string = event.arguments?.text ?? \"\";\r\n  const kind: string = event.arguments?.kind ?? \"OTHER\";\r\n\r\n  const base = text || \"your content\";\r\n  const suggestions: string[] = [];\r\n\r\n  if (kind === \"CAPTION\") {\r\n    suggestions.push(\r\n      `Behind the scenes of ${base} \u2728`,\r\n      `Styling ${base} so you don't have to \uD83D\uDC85`,\r\n    );\r\n  } else if (kind === \"HASHTAGS\") {\r\n    suggestions.push(\r\n      \"#stylingadventures #creatorlife #behindthescenes\",\r\n      \"#outfitinspo #contentcreator #filmingday\",\r\n    );\r\n  } else {\r\n    suggestions.push(`Planning ideas for ${base}`);\r\n  }\r\n\r\n  return { suggestions };\r\n}\r\n", "import validate from './validate.js';\nconst byteToHex = [];\nfor (let i = 0; i < 256; ++i) {\n    byteToHex.push((i + 0x100).toString(16).slice(1));\n}\nexport function unsafeStringify(arr, offset = 0) {\n    return (byteToHex[arr[offset + 0]] +\n        byteToHex[arr[offset + 1]] +\n        byteToHex[arr[offset + 2]] +\n        byteToHex[arr[offset + 3]] +\n        '-' +\n        byteToHex[arr[offset + 4]] +\n        byteToHex[arr[offset + 5]] +\n        '-' +\n        byteToHex[arr[offset + 6]] +\n        byteToHex[arr[offset + 7]] +\n        '-' +\n        byteToHex[arr[offset + 8]] +\n        byteToHex[arr[offset + 9]] +\n        '-' +\n        byteToHex[arr[offset + 10]] +\n        byteToHex[arr[offset + 11]] +\n        byteToHex[arr[offset + 12]] +\n        byteToHex[arr[offset + 13]] +\n        byteToHex[arr[offset + 14]] +\n        byteToHex[arr[offset + 15]]).toLowerCase();\n}\nfunction stringify(arr, offset = 0) {\n    const uuid = unsafeStringify(arr, offset);\n    if (!validate(uuid)) {\n        throw TypeError('Stringified UUID is invalid');\n    }\n    return uuid;\n}\nexport default stringify;\n", "import { randomFillSync } from 'crypto';\nconst rnds8Pool = new Uint8Array(256);\nlet poolPtr = rnds8Pool.length;\nexport default function rng() {\n    if (poolPtr > rnds8Pool.length - 16) {\n        randomFillSync(rnds8Pool);\n        poolPtr = 0;\n    }\n    return rnds8Pool.slice(poolPtr, (poolPtr += 16));\n}\n", "import { randomUUID } from 'crypto';\nexport default { randomUUID };\n", "import native from './native.js';\nimport rng from './rng.js';\nimport { unsafeStringify } from './stringify.js';\nfunction v4(options, buf, offset) {\n    if (native.randomUUID && !buf && !options) {\n        return native.randomUUID();\n    }\n    options = options || {};\n    const rnds = options.random ?? options.rng?.() ?? rng();\n    if (rnds.length < 16) {\n        throw new Error('Random bytes length must be >= 16');\n    }\n    rnds[6] = (rnds[6] & 0x0f) | 0x40;\n    rnds[8] = (rnds[8] & 0x3f) | 0x80;\n    if (buf) {\n        offset = offset || 0;\n        if (offset < 0 || offset + 16 > buf.length) {\n            throw new RangeError(`UUID byte range ${offset}:${offset + 15} is out of buffer bounds`);\n        }\n        for (let i = 0; i < 16; ++i) {\n            buf[offset + i] = rnds[i];\n        }\n        return buf;\n    }\n    return unsafeStringify(rnds);\n}\nexport default v4;\n"],
  "mappings": "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",
  "names": ["index_exports", "__export", "handler", "__toCommonJS", "import_client_dynamodb", "import_lib_dynamodb", "byteToHex", "i", "unsafeStringify", "arr", "offset", "import_crypto", "rnds8Pool", "poolPtr", "rng", "import_crypto", "native_default", "v4", "options", "buf", "offset", "native_default", "rnds", "rng", "i", "unsafeStringify", "v4_default", "import_client_s3", "import_s3_request_presigner", "ddb", "s3", "TABLE_NAME", "CREATOR_MEDIA_BUCKET", "PK", "SK", "STATUS_GSI", "now", "resolveCreatorRevenueByPlatform", "event", "windowArg", "days", "platforms", "totalRevenue", "sum", "p", "timeseries", "cumulative", "i", "d", "base", "wobble", "daily", "handler", "field", "sub", "args", "listCabinets", "getCabinet", "createCabinet", "updateCabinet", "deleteCabinet", "listFolders", "createFolder", "renameFolder", "deleteFolder", "listAssets", "createAssetUpload", "updateAsset", "deleteAsset", "moveAsset", "importClosetItemToCabinet", "adminListCreatorAssetsByUser", "adminGetCreatorAsset", "adminModerateCreatorAsset", "adminSoftDeleteCreatorAsset", "adminRestoreCreatorAsset", "adminRejectCreatorAsset", "getCreatorGoalCompass", "updateCreatorGoalCompass", "runCreatorAi", "mapCabinet", "item", "mapFolder", "mapAsset", "items", "createDefaultCabinetForCreator", "id", "res", "nowIso", "v4_default", "input", "names", "values", "sets", "pkValue", "meta", "it", "cabinetId", "name", "assets", "asset", "folderId", "category", "tag", "search", "limit", "nextToken", "queryInput", "q", "title", "notes", "connectionNextToken", "tags", "fileName", "filename", "contentType", "kind", "finalFileName", "assetId", "folderPart", "safeName", "s3Key", "assetKind", "putCmd", "destinationFolderId", "ownerSub", "moderationStatus", "includeSoftDeleted", "wanted", "adminSub", "moderationReason", "reason", "defaultGoalCompass", "closetItemId", "closetItem", "finalTitle", "finalNotes", "finalTags", "text", "suggestions"]
}
