"use strict";var D=Object.defineProperty;var W=Object.getOwnPropertyDescriptor;var Y=Object.getOwnPropertyNames;var J=Object.prototype.hasOwnProperty;var Q=(e,t)=>{for(var r in t)D(e,r,{get:t[r],enumerable:!0})},X=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Y(t))!J.call(e,o)&&o!==r&&D(e,o,{get:()=>t[o],enumerable:!(n=W(t,o))||n.enumerable});return e};var Z=e=>X(D({},"__esModule",{value:!0}),e);var Re={};Q(Re,{handler:()=>oe});module.exports=Z(Re);var M=require("@aws-sdk/client-dynamodb"),i=require("@aws-sdk/lib-dynamodb");var E=[];for(let e=0;e<256;++e)E.push((e+256).toString(16).slice(1));function P(e,t=0){return(E[e[t+0]]+E[e[t+1]]+E[e[t+2]]+E[e[t+3]]+"-"+E[e[t+4]]+E[e[t+5]]+"-"+E[e[t+6]]+E[e[t+7]]+"-"+E[e[t+8]]+E[e[t+9]]+"-"+E[e[t+10]]+E[e[t+11]]+E[e[t+12]]+E[e[t+13]]+E[e[t+14]]+E[e[t+15]]).toLowerCase()}var V=require("crypto"),B=new Uint8Array(256),O=B.length;function U(){return O>B.length-16&&((0,V.randomFillSync)(B),O=0),B.slice(O,O+=16)}var v=require("crypto"),K={randomUUID:v.randomUUID};function ee(e,t,r){if(K.randomUUID&&!t&&!e)return K.randomUUID();e=e||{};let n=e.random??e.rng?.()??U();if(n.length<16)throw new Error("Random bytes length must be >= 16");if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,t){if(r=r||0,r<0||r+16>t.length)throw new RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let o=0;o<16;++o)t[r+o]=n[o];return t}return P(n)}var I=ee;var $=require("@aws-sdk/client-s3"),G=require("@aws-sdk/s3-request-presigner"),c=i.DynamoDBDocumentClient.from(new M.DynamoDBClient({})),te=new $.S3Client({}),p=process.env.TABLE_NAME,re=process.env.CREATOR_MEDIA_BUCKET,d=process.env.PK_NAME||"pk",u=process.env.SK_NAME||"sk",j=process.env.STATUS_GSI||"gsi1";function g(){return new Date().toISOString()}async function ne(e){let t=e.arguments?.window||"LAST_30_DAYS",r=t==="LAST_7_DAYS"?7:t==="LAST_90_DAYS"?90:30,n=[{platform:"tiktok",label:"TikTok Creator Fund",currency:"USD",amount:240.5,lastPayoutAt:new Date().toISOString()},{platform:"instagram",label:"Instagram bonuses",currency:"USD",amount:125.75,lastPayoutAt:new Date(Date.now()-5760*60*1e3).toISOString()},{platform:"youtube",label:"YouTube rev share",currency:"USD",amount:410.2,lastPayoutAt:new Date(Date.now()-12960*60*1e3).toISOString()}],o=n.reduce((l,m)=>l+(m.amount||0),0),a=[],s=0;for(let l=r-1;l>=0;l--){let m=new Date;m.setDate(m.getDate()-l);let w=o/r,b=Math.sin(l/r*Math.PI*2)*(o*.03),y=Math.max(0,w+b);s+=y,a.push({date:m.toISOString().slice(0,10),totalRevenue:Number(s.toFixed(2))})}return{currency:"USD",totalRevenue:Number(o.toFixed(2)),platforms:n,timeseries:a}}var oe=async e=>{let t=e.info?.fieldName,r=e.identity?.sub||e.identity?.claims?.sub||"anonymous",n=e.arguments||{};switch(t){case"creatorCabinets":return ae(r);case"creatorCabinet":return k(r,n.id);case"createCreatorCabinet":return ie(r,n.input);case"updateCreatorCabinet":return de(r,n.input);case"deleteCreatorCabinet":return ue(r,n.id);case"creatorCabinetFolders":return F(r,n.cabinetId);case"creatorFolders":return F(r,n.cabinetId);case"createCreatorFolder":return le(r,n.input);case"renameCreatorFolder":return ce(r,n.input);case"deleteCreatorFolder":return pe(r,n.id,n.cabinetId);case"creatorCabinetAssets":return me(r,n);case"createCreatorAssetUpload":return Ae(r,n.input);case"updateCreatorAsset":return we(r,n.input);case"deleteCreatorAsset":return ye(r,n.id,n.cabinetId);case"moveCreatorAsset":return fe(r,n.input);case"importClosetItemToCabinet":return he(r,n.input);case"adminListCreatorAssetsByUser":return Ee(n);case"adminGetCreatorAsset":return be(n);case"adminModerateCreatorAsset":return H(r,n.input);case"adminSoftDeleteCreatorAsset":return Ce(r,n.input);case"adminRestoreCreatorAsset":return Se(r,n.input);case"adminRejectCreatorAsset":return ge(r,n.input);case"creatorRevenueByPlatform":return ne(e);case"creatorGoalCompass":return Ie(r);case"updateCreatorGoalCompass":return xe(r,n.input);case"creatorAiSuggest":return ke(e);default:throw new Error(`Unknown field ${t}`)}};function _(e){return e?{id:e.id,ownerSub:e.ownerSub,name:e.name,description:e.description??null,defaultCategory:e.defaultCategory??null,tags:e.tags??[],createdAt:e.createdAt,updatedAt:e.updatedAt,assetCount:e.assetCount??0}:null}function L(e){return e?{id:e.id,cabinetId:e.cabinetId,name:e.name,specialKind:e.specialKind??null,createdAt:e.createdAt,updatedAt:e.updatedAt}:null}function C(e){return e?{id:e.id,cabinetId:e.cabinetId,folderId:e.folderId??null,ownerSub:e.ownerSub,kind:e.kind??"OTHER",category:e.category??null,title:e.title??null,notes:e.notes??null,tags:e.tags??[],s3Key:e.s3Key,contentType:e.contentType??null,createdAt:e.createdAt,updatedAt:e.updatedAt,moderationStatus:e.moderationStatus??"ACTIVE",moderationReason:e.moderationReason??null,moderatedBy:e.moderatedBy??null,moderatedAt:e.moderatedAt??null}:null}async function ae(e){let r=(await c.send(new i.QueryCommand({TableName:p,IndexName:j,KeyConditionExpression:"#gpk = :gpk AND begins_with(#gsk, :prefix)",ExpressionAttributeNames:{"#gpk":"gsi1pk","#gsk":"gsi1sk"},ExpressionAttributeValues:{":gpk":`CREATOR#${e}`,":prefix":"CAB#"}}))).Items??[];return r.length===0&&(r=[await se(e)]),r.map(_)}async function k(e,t){if(!t)throw new Error("id is required");let r=await c.send(new i.GetCommand({TableName:p,Key:{[d]:`CAB#${t}`,[u]:"META"}}));return!r.Item||r.Item.ownerSub!==e?null:_(r.Item)}async function se(e){let t=g(),r=I(),n={[d]:`CAB#${r}`,[u]:"META",type:"CABINET",id:r,ownerSub:e,name:"From my closet",description:"Imported looks and outfit references from your Bestie closet",defaultCategory:"OUTFIT_REFS",tags:["closet-import"],assetCount:0,createdAt:t,updatedAt:t,gsi1pk:`CREATOR#${e}`,gsi1sk:`CAB#${t}#${r}`};return await c.send(new i.PutCommand({TableName:p,Item:n,ConditionExpression:"attribute_not_exists(#pk)",ExpressionAttributeNames:{"#pk":d}})),n}async function ie(e,t){if(!t?.name)throw new Error("name is required");let r=I(),n=g(),o={[d]:`CAB#${r}`,[u]:"META",type:"CABINET",id:r,ownerSub:e,name:t.name,description:t.description??null,defaultCategory:t.defaultCategory??null,tags:t.tags??[],assetCount:0,createdAt:n,updatedAt:n,gsi1pk:`CREATOR#${e}`,gsi1sk:`CAB#${n}#${r}`};return await c.send(new i.PutCommand({TableName:p,Item:o,ConditionExpression:"attribute_not_exists(#pk)",ExpressionAttributeNames:{"#pk":d}})),_(o)}async function de(e,t){let r=t?.id;if(!r)throw new Error("id is required");if(!t)throw new Error("input is required");let n=g(),o={"#updatedAt":"updatedAt","#ownerSub":"ownerSub"},a={":updatedAt":n,":ownerSub":e},s=["#updatedAt = :updatedAt"];Object.prototype.hasOwnProperty.call(t,"name")&&(o["#name"]="name",a[":name"]=t.name,s.push("#name = :name")),Object.prototype.hasOwnProperty.call(t,"description")&&(o["#description"]="description",a[":description"]=t.description??null,s.push("#description = :description")),Object.prototype.hasOwnProperty.call(t,"defaultCategory")&&(o["#defaultCategory"]="defaultCategory",a[":defaultCategory"]=t.defaultCategory??null,s.push("#defaultCategory = :defaultCategory")),Object.prototype.hasOwnProperty.call(t,"tags")&&(o["#tags"]="tags",a[":tags"]=t.tags??[],s.push("#tags = :tags"));let l=await c.send(new i.UpdateCommand({TableName:p,Key:{[d]:`CAB#${r}`,[u]:"META"},UpdateExpression:"SET "+s.join(", "),ConditionExpression:"#ownerSub = :ownerSub",ExpressionAttributeNames:o,ExpressionAttributeValues:a,ReturnValues:"ALL_NEW"}));return _(l.Attributes)}async function ue(e,t){if(!t)throw new Error("id is required");let r=`CAB#${t}`,o=(await c.send(new i.QueryCommand({TableName:p,KeyConditionExpression:"#pk = :pk",ExpressionAttributeNames:{"#pk":d},ExpressionAttributeValues:{":pk":r}}))).Items??[],a=o.find(s=>s.type==="CABINET");return!a||a.ownerSub!==e?!1:(await Promise.all(o.map(s=>c.send(new i.DeleteCommand({TableName:p,Key:{[d]:s[d],[u]:s[u]}})))),!0)}async function F(e,t){if(!t)throw new Error("cabinetId is required");return await k(e,t)?((await c.send(new i.QueryCommand({TableName:p,KeyConditionExpression:"#pk = :pk AND begins_with(#sk, :prefix)",ExpressionAttributeNames:{"#pk":d,"#sk":u},ExpressionAttributeValues:{":pk":`CAB#${t}`,":prefix":"FOLDER#"}}))).Items??[]).map(L):[]}async function le(e,t){let{cabinetId:r,name:n}=t||{};if(!r)throw new Error("cabinetId is required");if(!n)throw new Error("name is required");if(!await k(e,r))throw new Error("Cabinet not found");let a=I(),s=g(),l={[d]:`CAB#${r}`,[u]:`FOLDER#${a}`,type:"FOLDER",id:a,cabinetId:r,ownerSub:e,name:n,specialKind:null,createdAt:s,updatedAt:s};return await c.send(new i.PutCommand({TableName:p,Item:l,ConditionExpression:"attribute_not_exists(#pk) AND attribute_not_exists(#sk)",ExpressionAttributeNames:{"#pk":d,"#sk":u}})),L(l)}async function ce(e,t){let{id:r,cabinetId:n,name:o}=t||{};if(!r)throw new Error("id is required");if(!n)throw new Error("cabinetId is required");if(!o)throw new Error("name is required");let a=g(),s=await c.send(new i.UpdateCommand({TableName:p,Key:{[d]:`CAB#${n}`,[u]:`FOLDER#${r}`},UpdateExpression:"SET #name = :name, #updatedAt = :updatedAt",ConditionExpression:"#ownerSub = :ownerSub",ExpressionAttributeNames:{"#name":"name","#updatedAt":"updatedAt","#ownerSub":"ownerSub"},ExpressionAttributeValues:{":name":o,":updatedAt":a,":ownerSub":e},ReturnValues:"ALL_NEW"}));return L(s.Attributes)}async function pe(e,t,r){if(!t)throw new Error("id is required");if(!r)throw new Error("cabinetId is required");await c.send(new i.DeleteCommand({TableName:p,Key:{[d]:`CAB#${r}`,[u]:`FOLDER#${t}`},ConditionExpression:"#ownerSub = :ownerSub",ExpressionAttributeNames:{"#ownerSub":"ownerSub"},ExpressionAttributeValues:{":ownerSub":e}}));let o=(await c.send(new i.QueryCommand({TableName:p,KeyConditionExpression:"#pk = :pk AND begins_with(#sk, :prefix)",ExpressionAttributeNames:{"#pk":d,"#sk":u,"#folderId":"folderId"},ExpressionAttributeValues:{":pk":`CAB#${r}`,":prefix":"ASSET#",":folderId":t},FilterExpression:"#folderId = :folderId"}))).Items??[];return await Promise.all(o.map(a=>c.send(new i.UpdateCommand({TableName:p,Key:{[d]:a[d],[u]:a[u]},UpdateExpression:"SET #folderId = :null",ExpressionAttributeNames:{"#folderId":"folderId"},ExpressionAttributeValues:{":null":null}})))),!0}async function me(e,t){let{cabinetId:r,folderId:n,category:o,tag:a,search:s,limit:l=50,nextToken:m}=t||{};if(!r)throw new Error("cabinetId is required");if(!await k(e,r))return{items:[],nextToken:null};let b={TableName:p,KeyConditionExpression:"#pk = :pk AND begins_with(#sk, :prefix)",ExpressionAttributeNames:{"#pk":d,"#sk":u},ExpressionAttributeValues:{":pk":`CAB#${r}`,":prefix":"ASSET#"},Limit:l};m&&(b.ExclusiveStartKey={[d]:`CAB#${r}`,[u]:m});let y=await c.send(new i.QueryCommand(b)),f=(y.Items??[]).filter(A=>A.type==="ASSET");if(f=f.filter(A=>String(A.moderationStatus??"ACTIVE").toUpperCase()==="ACTIVE"),n!=null&&(f=f.filter(A=>A.folderId===n)),o&&(f=f.filter(A=>A.category===o)),a&&(f=f.filter(A=>Array.isArray(A.tags)&&A.tags.includes(a))),s){let A=String(s).toLowerCase();f=f.filter(T=>{let R=(T.title??"").toLowerCase(),x=(T.notes??"").toLowerCase();return R.includes(A)||x.includes(A)})}let S=y.LastEvaluatedKey?y.LastEvaluatedKey[u]:null;return{items:f.map(C),nextToken:S}}async function Ae(e,t){let{cabinetId:r,folderId:n,category:o,title:a,notes:s,tags:l=[],fileName:m,filename:w,contentType:b,kind:y}=t||{},f=m??w;if(!r)throw new Error("cabinetId is required");if(!f)throw new Error("fileName is required");if(!b)throw new Error("contentType is required");if(!await k(e,r))throw new Error("Cabinet not found");let A=I(),T=n||"unsorted",R=String(f).replace(/[^a-zA-Z0-9._-]/g,"_"),x=["creator-media",e,r,T,`${A}-${R}`].join("/"),h=g(),N=y??"OTHER",q={[d]:`CAB#${r}`,[u]:`ASSET#${A}`,type:"ASSET",id:A,cabinetId:r,folderId:n??null,ownerSub:e,kind:N,category:o??null,title:a??null,notes:s??null,tags:l,s3Key:x,contentType:b,createdAt:h,updatedAt:h,moderationStatus:"ACTIVE",moderationReason:null,moderatedBy:null,moderatedAt:null,gsi1pk:`CREATOR#${e}`,gsi1sk:`CAB_ASSET#${r}#${h}#${A}`};await c.send(new i.PutCommand({TableName:p,Item:q})),await c.send(new i.UpdateCommand({TableName:p,Key:{[d]:`CAB#${r}`,[u]:"META"},UpdateExpression:"SET #assetCount = if_not_exists(#assetCount, :zero) + :one, #updatedAt = :updatedAt",ExpressionAttributeNames:{"#assetCount":"assetCount","#updatedAt":"updatedAt"},ExpressionAttributeValues:{":zero":0,":one":1,":updatedAt":h}}));let z=new $.PutObjectCommand({Bucket:re,Key:x,ContentType:b});return{uploadUrl:await(0,G.getSignedUrl)(te,z,{expiresIn:900}),asset:C(q)}}async function we(e,t){let{id:r,cabinetId:n}=t||{};if(!r)throw new Error("id is required");if(!n)throw new Error("cabinetId is required");let o=g(),a={"#updatedAt":"updatedAt","#ownerSub":"ownerSub"},s={":updatedAt":o,":ownerSub":e},l=["#updatedAt = :updatedAt"];Object.prototype.hasOwnProperty.call(t,"folderId")&&(a["#folderId"]="folderId",s[":folderId"]=t.folderId??null,l.push("#folderId = :folderId")),Object.prototype.hasOwnProperty.call(t,"category")&&(a["#category"]="category",s[":category"]=t.category??null,l.push("#category = :category")),Object.prototype.hasOwnProperty.call(t,"title")&&(a["#title"]="title",s[":title"]=t.title??null,l.push("#title = :title")),Object.prototype.hasOwnProperty.call(t,"notes")&&(a["#notes"]="notes",s[":notes"]=t.notes??null,l.push("#notes = :notes")),Object.prototype.hasOwnProperty.call(t,"tags")&&(a["#tags"]="tags",s[":tags"]=t.tags??[],l.push("#tags = :tags")),Object.prototype.hasOwnProperty.call(t,"kind")&&(a["#kind"]="kind",s[":kind"]=t.kind??"OTHER",l.push("#kind = :kind")),Object.prototype.hasOwnProperty.call(t,"contentType")&&(a["#contentType"]="contentType",s[":contentType"]=t.contentType??null,l.push("#contentType = :contentType"));let m=await c.send(new i.UpdateCommand({TableName:p,Key:{[d]:`CAB#${n}`,[u]:`ASSET#${r}`},UpdateExpression:"SET "+l.join(", "),ConditionExpression:"#ownerSub = :ownerSub",ExpressionAttributeNames:a,ExpressionAttributeValues:s,ReturnValues:"ALL_NEW"}));return C(m.Attributes)}async function ye(e,t,r){if(!t)throw new Error("id is required");if(!r)throw new Error("cabinetId is required");let n=g();return await c.send(new i.DeleteCommand({TableName:p,Key:{[d]:`CAB#${r}`,[u]:`ASSET#${t}`},ConditionExpression:"#ownerSub = :ownerSub",ExpressionAttributeNames:{"#ownerSub":"ownerSub"},ExpressionAttributeValues:{":ownerSub":e}})),await c.send(new i.UpdateCommand({TableName:p,Key:{[d]:`CAB#${r}`,[u]:"META"},UpdateExpression:"SET #assetCount = if_not_exists(#assetCount, :zero) - :one, #updatedAt = :updatedAt",ExpressionAttributeNames:{"#assetCount":"assetCount","#updatedAt":"updatedAt"},ExpressionAttributeValues:{":zero":0,":one":1,":updatedAt":n}})),!0}async function fe(e,t){let{id:r,cabinetId:n,destinationFolderId:o}=t||{};if(!r)throw new Error("id is required");if(!n)throw new Error("cabinetId is required");let a=g(),s=await c.send(new i.UpdateCommand({TableName:p,Key:{[d]:`CAB#${n}`,[u]:`ASSET#${r}`},UpdateExpression:"SET #folderId = :folderId, #updatedAt = :updatedAt",ConditionExpression:"#ownerSub = :ownerSub",ExpressionAttributeNames:{"#folderId":"folderId","#updatedAt":"updatedAt","#ownerSub":"ownerSub"},ExpressionAttributeValues:{":folderId":o??null,":updatedAt":a,":ownerSub":e},ReturnValues:"ALL_NEW"}));return C(s.Attributes)}async function Ee(e){let{ownerSub:t,cabinetId:r,folderId:n,moderationStatus:o,includeSoftDeleted:a=!0,limit:s=50}=e||{};if(!t)throw new Error("ownerSub is required");let m=((await c.send(new i.QueryCommand({TableName:p,IndexName:j,KeyConditionExpression:"#gpk = :gpk AND begins_with(#gsk, :prefix)",ExpressionAttributeNames:{"#gpk":"gsi1pk","#gsk":"gsi1sk"},ExpressionAttributeValues:{":gpk":`CREATOR#${t}`,":prefix":"CAB_ASSET#"},Limit:s}))).Items??[]).filter(w=>w.type==="ASSET");if(r&&(m=m.filter(w=>w.cabinetId===r)),n!=null&&(m=m.filter(w=>w.folderId===n)),o){let w=String(o).toUpperCase();m=m.filter(b=>String(b.moderationStatus??"ACTIVE").toUpperCase()===w)}return a||(m=m.filter(w=>String(w.moderationStatus??"ACTIVE").toUpperCase()!=="SOFT_DELETED")),{items:m.map(C),nextToken:null}}async function be(e){let{cabinetId:t,id:r}=e||{};if(!t)throw new Error("cabinetId is required");if(!r)throw new Error("id is required");let n=await c.send(new i.GetCommand({TableName:p,Key:{[d]:`CAB#${t}`,[u]:`ASSET#${r}`}}));return!n.Item||n.Item.type!=="ASSET"?null:C(n.Item)}async function H(e,t){let{cabinetId:r,id:n,moderationStatus:o,moderationReason:a,tags:s}=t||{};if(!r)throw new Error("cabinetId is required");if(!n)throw new Error("id is required");if(!o)throw new Error("moderationStatus is required");let l=g(),m={"#moderationStatus":"moderationStatus","#updatedAt":"updatedAt","#moderatedAt":"moderatedAt","#moderatedBy":"moderatedBy"},w={":moderationStatus":o,":updatedAt":l,":moderatedAt":l,":moderatedBy":e},b=["#moderationStatus = :moderationStatus","#updatedAt = :updatedAt","#moderatedAt = :moderatedAt","#moderatedBy = :moderatedBy"];Object.prototype.hasOwnProperty.call(t,"moderationReason")&&(m["#moderationReason"]="moderationReason",w[":moderationReason"]=a??null,b.push("#moderationReason = :moderationReason")),Array.isArray(s)&&(m["#tags"]="tags",w[":tags"]=s,b.push("#tags = :tags"));let y=await c.send(new i.UpdateCommand({TableName:p,Key:{[d]:`CAB#${r}`,[u]:`ASSET#${n}`},UpdateExpression:"SET "+b.join(", "),ReturnValues:"ALL_NEW"}));return C(y.Attributes)}async function ge(e,t){if(!t)throw new Error("input is required");let{cabinetId:r,id:n,moderationReason:o,tags:a}=t;return H(e,{cabinetId:r,id:n,moderationStatus:"REJECTED",moderationReason:o,tags:a})}async function Ce(e,t){let{cabinetId:r,id:n,reason:o}=t||{};if(!r)throw new Error("cabinetId is required");if(!n)throw new Error("id is required");let a=g(),s=await c.send(new i.UpdateCommand({TableName:p,Key:{[d]:`CAB#${r}`,[u]:`ASSET#${n}`},UpdateExpression:"SET #moderationStatus = :status, #moderationReason = :reason, #moderatedBy = :moderatedBy, #moderatedAt = :moderatedAt, #updatedAt = :updatedAt",ExpressionAttributeNames:{"#moderationStatus":"moderationStatus","#moderationReason":"moderationReason","#moderatedBy":"moderatedBy","#moderatedAt":"moderatedAt","#updatedAt":"updatedAt"},ExpressionAttributeValues:{":status":"SOFT_DELETED",":reason":o??null,":moderatedBy":e,":moderatedAt":a,":updatedAt":a},ReturnValues:"ALL_NEW"}));return C(s.Attributes)}async function Se(e,t){let{cabinetId:r,id:n}=t||{};if(!r)throw new Error("cabinetId is required");if(!n)throw new Error("id is required");let o=g(),a=await c.send(new i.UpdateCommand({TableName:p,Key:{[d]:`CAB#${r}`,[u]:`ASSET#${n}`},UpdateExpression:"SET #moderationStatus = :status, #moderationReason = :reason, #moderatedBy = :moderatedBy, #moderatedAt = :moderatedAt, #updatedAt = :updatedAt",ExpressionAttributeNames:{"#moderationStatus":"moderationStatus","#moderationReason":"moderationReason","#moderatedBy":"moderatedBy","#moderatedAt":"moderatedAt","#updatedAt":"updatedAt"},ExpressionAttributeValues:{":status":"ACTIVE",":reason":null,":moderatedBy":e,":moderatedAt":o,":updatedAt":o},ReturnValues:"ALL_NEW"}));return C(a.Attributes)}function Te(){return{primaryGoal:"GROWTH",timeHorizon:"90_DAYS",weeklyCapacity:5,focusAreas:["PERSONALITY","NURTURE"],riskTolerance:"MEDIUM",notes:null,updatedAt:null}}async function Ie(e){let t=await c.send(new i.GetCommand({TableName:p,Key:{[d]:`CREATOR#${e}`,[u]:"GOAL_COMPASS"}}));if(!t.Item)return Te();let r=t.Item;return{primaryGoal:r.primaryGoal??"GROWTH",timeHorizon:r.timeHorizon??"90_DAYS",weeklyCapacity:typeof r.weeklyCapacity=="number"?r.weeklyCapacity:5,focusAreas:Array.isArray(r.focusAreas)&&r.focusAreas.length?r.focusAreas:["PERSONALITY","NURTURE"],riskTolerance:r.riskTolerance??"MEDIUM",notes:r.notes??null,updatedAt:r.updatedAt??null}}async function xe(e,t){if(!t)throw new Error("input is required");let r=g(),n={[d]:`CREATOR#${e}`,[u]:"GOAL_COMPASS",type:"CREATOR_GOAL_COMPASS",primaryGoal:t.primaryGoal??"GROWTH",timeHorizon:t.timeHorizon??"90_DAYS",weeklyCapacity:typeof t.weeklyCapacity=="number"?t.weeklyCapacity:5,focusAreas:Array.isArray(t.focusAreas)&&t.focusAreas.length?t.focusAreas:["PERSONALITY","NURTURE"],riskTolerance:t.riskTolerance??"MEDIUM",notes:t.notes??null,updatedAt:r};return await c.send(new i.PutCommand({TableName:p,Item:n})),{primaryGoal:n.primaryGoal,timeHorizon:n.timeHorizon,weeklyCapacity:n.weeklyCapacity,focusAreas:n.focusAreas,riskTolerance:n.riskTolerance,notes:n.notes,updatedAt:n.updatedAt}}async function he(e,t){let{closetItemId:r,cabinetId:n,folderId:o,kind:a,title:s,notes:l,tags:m=[]}=t||{};if(!r)throw new Error("closetItemId is required");if(!n)throw new Error("cabinetId is required");if(!await k(e,n))throw new Error("Cabinet not found");let y=(await c.send(new i.GetCommand({TableName:p,Key:{[d]:`CLOSET#${e}`,[u]:`ITEM#${r}`}}))).Item;if(!y||y.ownerSub!==e)throw new Error("Closet item not found");let f=I(),S=g(),A=y.mediaKey||y.rawMediaKey||(()=>{throw new Error("Closet item has no media key")})(),T=a??"PHOTO",R=s??y.title??null,x=l??y.notes??null,h=m.length?m:y.colorTags??[],N={[d]:`CAB#${n}`,[u]:`ASSET#${f}`,type:"ASSET",id:f,cabinetId:n,folderId:o??null,ownerSub:e,kind:T,category:"OUTFIT_REFS",title:R,notes:x,tags:h,s3Key:A,contentType:y.contentType??"image/jpeg",createdAt:S,updatedAt:S,sourceClosetItemId:r,moderationStatus:"ACTIVE",moderationReason:null,moderatedBy:null,moderatedAt:null,gsi1pk:`CREATOR#${e}`,gsi1sk:`CAB_ASSET#${n}#${S}#${f}`};return await c.send(new i.PutCommand({TableName:p,Item:N})),await c.send(new i.UpdateCommand({TableName:p,Key:{[d]:`CAB#${n}`,[u]:"META"},UpdateExpression:"SET #assetCount = if_not_exists(#assetCount, :zero) + :one, #updatedAt = :updatedAt",ExpressionAttributeNames:{"#assetCount":"assetCount","#updatedAt":"updatedAt"},ExpressionAttributeValues:{":zero":0,":one":1,":updatedAt":S}})),C(N)}async function ke(e){let t=e.arguments?.text??"",r=e.arguments?.kind??"OTHER",n=t||"your content",o=[];return r==="CAPTION"?o.push(`Behind the scenes of ${n} \u2728`,`Styling ${n} so you don't have to \u{1F485}`):r==="HASHTAGS"?o.push("#stylingadventures #creatorlife #behindthescenes","#outfitinspo #contentcreator #filmingday"):o.push(`Planning ideas for ${n}`),{suggestions:o}}0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
