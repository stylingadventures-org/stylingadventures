{
  "version": 3,
  "sources": ["../../lambda/thumb-head/index.ts"],
  "sourcesContent": ["// lambda/thumb-head/index.ts\r\nimport { S3Client, HeadObjectCommand } from \"@aws-sdk/client-s3\";\r\n\r\nconst s3 = new S3Client({ region: process.env.AWS_REGION || 'us-east-1' });\r\nconst BUCKET = process.env.BUCKET!;\r\nconst ORIGIN = process.env.WEB_ORIGIN || 'https://stylingadventures.com';\r\n\r\nconst baseHeaders = {\r\n  \"Content-Type\": \"application/json\",\r\n  \"Access-Control-Allow-Origin\": ORIGIN,\r\n  \"Access-Control-Allow-Credentials\": \"true\",\r\n  \"Vary\": \"Origin\",\r\n};\r\n\r\n/**\r\n * INPUT:  GET /thumb-head?key=<users/.../filename.ext>\r\n * OUTPUT: { ready: boolean }\r\n */\r\nexport const handler = async (event: any) => {\r\n  const raw = event?.queryStringParameters?.key;\r\n  if (!raw) {\r\n    return {\r\n      statusCode: 400,\r\n      headers: baseHeaders,\r\n      body: JSON.stringify({ message: \"Missing key\" }),\r\n    };\r\n  }\r\n\r\n  // Expect the *source* key; translate to the JPEG thumb key\r\n  const srcKey = decodeURIComponent(raw);\r\n  const thumbKey = `thumbs/${srcKey.replace(/\\.[^.]+$/, \".jpg\")}`;\r\n\r\n  try {\r\n    await s3.send(new HeadObjectCommand({ Bucket: BUCKET, Key: thumbKey }));\r\n    return {\r\n      statusCode: 200,\r\n      headers: baseHeaders,\r\n      body: JSON.stringify({ ready: true }),\r\n    };\r\n  } catch {\r\n    return {\r\n      statusCode: 200,\r\n      headers: baseHeaders,\r\n      body: JSON.stringify({ ready: false }),\r\n    };\r\n  }\r\n};\r\n\r\n"],
  "mappings": "yaAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,aAAAE,IAAA,eAAAC,EAAAH,GACA,IAAAI,EAA4C,8BAEtCC,EAAK,IAAI,WAAS,CAAE,OAAQ,QAAQ,IAAI,YAAc,WAAY,CAAC,EACnEC,EAAS,QAAQ,IAAI,OACrBC,EAAS,QAAQ,IAAI,YAAc,gCAEnCC,EAAc,CAClB,eAAgB,mBAChB,8BAA+BD,EAC/B,mCAAoC,OACpC,KAAQ,QACV,EAMaL,EAAU,MAAOO,GAAe,CAC3C,IAAMC,EAAMD,GAAO,uBAAuB,IAC1C,GAAI,CAACC,EACH,MAAO,CACL,WAAY,IACZ,QAASF,EACT,KAAM,KAAK,UAAU,CAAE,QAAS,aAAc,CAAC,CACjD,EAKF,IAAMG,EAAW,UADF,mBAAmBD,CAAG,EACH,QAAQ,WAAY,MAAM,CAAC,GAE7D,GAAI,CACF,aAAML,EAAG,KAAK,IAAI,oBAAkB,CAAE,OAAQC,EAAQ,IAAKK,CAAS,CAAC,CAAC,EAC/D,CACL,WAAY,IACZ,QAASH,EACT,KAAM,KAAK,UAAU,CAAE,MAAO,EAAK,CAAC,CACtC,CACF,MAAQ,CACN,MAAO,CACL,WAAY,IACZ,QAASA,EACT,KAAM,KAAK,UAAU,CAAE,MAAO,EAAM,CAAC,CACvC,CACF,CACF",
  "names": ["thumb_head_exports", "__export", "handler", "__toCommonJS", "import_client_s3", "s3", "BUCKET", "ORIGIN", "baseHeaders", "event", "raw", "thumbKey"]
}
