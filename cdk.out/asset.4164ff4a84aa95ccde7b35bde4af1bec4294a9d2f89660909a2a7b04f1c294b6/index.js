"use strict";var D=Object.defineProperty;var Y=Object.getOwnPropertyDescriptor;var W=Object.getOwnPropertyNames;var J=Object.prototype.hasOwnProperty;var Q=(e,t)=>{for(var r in t)D(e,r,{get:t[r],enumerable:!0})},X=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of W(t))!J.call(e,o)&&o!==r&&D(e,o,{get:()=>t[o],enumerable:!(n=Y(t,o))||n.enumerable});return e};var Z=e=>X(D({},"__esModule",{value:!0}),e);var Oe={};Q(Oe,{handler:()=>se});module.exports=Z(Oe);var j=require("@aws-sdk/client-dynamodb"),i=require("@aws-sdk/lib-dynamodb");var b=[];for(let e=0;e<256;++e)b.push((e+256).toString(16).slice(1));function v(e,t=0){return(b[e[t+0]]+b[e[t+1]]+b[e[t+2]]+b[e[t+3]]+"-"+b[e[t+4]]+b[e[t+5]]+"-"+b[e[t+6]]+b[e[t+7]]+"-"+b[e[t+8]]+b[e[t+9]]+"-"+b[e[t+10]]+b[e[t+11]]+b[e[t+12]]+b[e[t+13]]+b[e[t+14]]+b[e[t+15]]).toLowerCase()}var q=require("crypto"),_=new Uint8Array(256),O=_.length;function U(){return O>_.length-16&&((0,q.randomFillSync)(_),O=0),_.slice(O,O+=16)}var V=require("crypto"),P={randomUUID:V.randomUUID};function ee(e,t,r){if(P.randomUUID&&!t&&!e)return P.randomUUID();e=e||{};let n=e.random??e.rng?.()??U();if(n.length<16)throw new Error("Random bytes length must be >= 16");if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,t){if(r=r||0,r<0||r+16>t.length)throw new RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let o=0;o<16;++o)t[r+o]=n[o];return t}return v(n)}var I=ee;var $=require("@aws-sdk/client-s3"),F=require("@aws-sdk/s3-request-presigner"),c=i.DynamoDBDocumentClient.from(new j.DynamoDBClient({})),te=new $.S3Client({}),l=process.env.TABLE_NAME,re=process.env.CREATOR_MEDIA_BUCKET,d=process.env.PK_NAME||"pk",u=process.env.SK_NAME||"sk",G=process.env.STATUS_GSI||"gsi1";function g(){return new Date().toISOString()}async function ne(e){let t=e.arguments?.window||"LAST_30_DAYS",r=t==="LAST_7_DAYS"?7:t==="LAST_90_DAYS"?90:30,n="USD",o=[{platform:"tiktok",label:"TikTok / Reels",currency:n,amount:420.5,lastPayoutAt:new Date().toISOString()},{platform:"youtube",label:"YouTube",currency:n,amount:310.2,lastPayoutAt:new Date(Date.now()-3*864e5).toISOString()},{platform:"instagram",label:"Instagram",currency:n,amount:165,lastPayoutAt:null}],a=o.reduce((A,w)=>A+w.amount,0),s=new Date,p=Array.from({length:r}).map((A,w)=>{let E=new Date(s);E.setDate(s.getDate()-(r-1-w));let y=a/r,C=w/(r-1||1)*.4+.8;return{date:E.toISOString().slice(0,10),totalRevenue:Math.round(y*C*100)/100}}),m=p.reduce((A,w)=>A+w.totalRevenue,0);return{currency:n,totalRevenue:m,platforms:o,timeseries:p}}async function oe(e,t){if(!e)throw new Error("Not authenticated");if(!t)throw new Error("id is required");let r=`CREATOR#${e}`,n=`DIRECTOR_SHOOT#${t}`,o=await c.send(new i.GetCommand({TableName:l,Key:{[d]:r,[u]:n}}));if(!o.Item)return null;let a=o.Item;return{id:a.id,creatorId:e,shootName:a.shootName,primaryPlatform:a.primaryPlatform,objective:a.objective,scenes:a.scenes||[],createdAt:a.createdAt,updatedAt:a.updatedAt}}async function ae(e,t){if(!e)throw new Error("Not authenticated");if(!t)throw new Error("input is required");let r=t.id||"default",n=g(),o=`CREATOR#${e}`,a=`DIRECTOR_SHOOT#${r}`,s={[d]:o,[u]:a,id:r,creatorId:e,shootName:t.shootName,primaryPlatform:t.primaryPlatform,objective:t.objective,scenes:t.scenes||[],createdAt:n,updatedAt:n,type:"DIRECTOR_SHOOT_PLAN"};return await c.send(new i.PutCommand({TableName:l,Item:s})),{id:r,creatorId:e,shootName:s.shootName,primaryPlatform:s.primaryPlatform,objective:s.objective,scenes:s.scenes,createdAt:s.createdAt,updatedAt:s.updatedAt}}var se=async e=>{let t=e.info?.fieldName,r=e.identity?.sub||e.identity?.claims?.sub||"anonymous",n=e.arguments||{};switch(t){case"creatorCabinets":return ie(r);case"creatorCabinet":return k(r,n.id);case"createCreatorCabinet":return ue(r,n.input);case"updateCreatorCabinet":return ce(r,n.input);case"deleteCreatorCabinet":return le(r,n.id);case"creatorCabinetFolders":return M(r,n.cabinetId);case"creatorFolders":return M(r,n.cabinetId);case"createCreatorFolder":return pe(r,n.input);case"renameCreatorFolder":return me(r,n.input);case"deleteCreatorFolder":return Ae(r,n.id,n.cabinetId);case"creatorCabinetAssets":return we(r,n);case"createCreatorAssetUpload":return ye(r,n.input);case"updateCreatorAsset":return fe(r,n.input);case"deleteCreatorAsset":return Ee(r,n.id,n.cabinetId);case"moveCreatorAsset":return be(r,n.input);case"importClosetItemToCabinet":return Re(r,n.input);case"adminListCreatorAssetsByUser":return ge(n);case"adminGetCreatorAsset":return Se(n);case"adminModerateCreatorAsset":return H(r,n.input);case"adminSoftDeleteCreatorAsset":return Te(r,n.input);case"adminRestoreCreatorAsset":return Ie(r,n.input);case"adminRejectCreatorAsset":return Ce(r,n.input);case"creatorRevenueByPlatform":return ne(e);case"creatorGoalCompass":return xe(r);case"updateCreatorGoalCompass":return ke(r,n.input);case"getDirectorShootPlan":return oe(r,n.id);case"saveDirectorShootPlan":return ae(r,n.input);case"creatorAiSuggest":return Ne(e);default:throw new Error(`Unknown field ${t}`)}};function B(e){return e?{id:e.id,ownerSub:e.ownerSub,name:e.name,description:e.description??null,defaultCategory:e.defaultCategory??null,tags:e.tags??[],createdAt:e.createdAt,updatedAt:e.updatedAt,assetCount:e.assetCount??0}:null}function L(e){return e?{id:e.id,cabinetId:e.cabinetId,name:e.name,specialKind:e.specialKind??null,createdAt:e.createdAt,updatedAt:e.updatedAt}:null}function S(e){return e?{id:e.id,cabinetId:e.cabinetId,folderId:e.folderId??null,ownerSub:e.ownerSub,kind:e.kind??"OTHER",category:e.category??null,title:e.title??null,notes:e.notes??null,tags:e.tags??[],s3Key:e.s3Key,contentType:e.contentType??null,createdAt:e.createdAt,updatedAt:e.updatedAt,moderationStatus:e.moderationStatus??"ACTIVE",moderationReason:e.moderationReason??null,moderatedBy:e.moderatedBy??null,moderatedAt:e.moderatedAt??null}:null}async function ie(e){let r=(await c.send(new i.QueryCommand({TableName:l,IndexName:G,KeyConditionExpression:"#gpk = :gpk AND begins_with(#gsk, :prefix)",ExpressionAttributeNames:{"#gpk":"gsi1pk","#gsk":"gsi1sk"},ExpressionAttributeValues:{":gpk":`CREATOR#${e}`,":prefix":"CAB#"}}))).Items??[];return r.length===0&&(r=[await de(e)]),r.map(B)}async function k(e,t){if(!t)throw new Error("id is required");let r=await c.send(new i.GetCommand({TableName:l,Key:{[d]:`CAB#${t}`,[u]:"META"}}));return!r.Item||r.Item.ownerSub!==e?null:B(r.Item)}async function de(e){let t=g(),r=I(),n={[d]:`CAB#${r}`,[u]:"META",type:"CABINET",id:r,ownerSub:e,name:"From my closet",description:"Imported looks and outfit references from your Bestie closet",defaultCategory:"OUTFIT_REFS",tags:["closet-import"],assetCount:0,createdAt:t,updatedAt:t,gsi1pk:`CREATOR#${e}`,gsi1sk:`CAB#${t}#${r}`};return await c.send(new i.PutCommand({TableName:l,Item:n,ConditionExpression:"attribute_not_exists(#pk)",ExpressionAttributeNames:{"#pk":d}})),n}async function ue(e,t){if(!t?.name)throw new Error("name is required");let r=I(),n=g(),o={[d]:`CAB#${r}`,[u]:"META",type:"CABINET",id:r,ownerSub:e,name:t.name,description:t.description??null,defaultCategory:t.defaultCategory??null,tags:t.tags??[],assetCount:0,createdAt:n,updatedAt:n,gsi1pk:`CREATOR#${e}`,gsi1sk:`CAB#${n}#${r}`};return await c.send(new i.PutCommand({TableName:l,Item:o,ConditionExpression:"attribute_not_exists(#pk)",ExpressionAttributeNames:{"#pk":d}})),B(o)}async function ce(e,t){let r=t?.id;if(!r)throw new Error("id is required");if(!t)throw new Error("input is required");let n=g(),o={"#updatedAt":"updatedAt","#ownerSub":"ownerSub"},a={":updatedAt":n,":ownerSub":e},s=["#updatedAt = :updatedAt"];Object.prototype.hasOwnProperty.call(t,"name")&&(o["#name"]="name",a[":name"]=t.name,s.push("#name = :name")),Object.prototype.hasOwnProperty.call(t,"description")&&(o["#description"]="description",a[":description"]=t.description??null,s.push("#description = :description")),Object.prototype.hasOwnProperty.call(t,"defaultCategory")&&(o["#defaultCategory"]="defaultCategory",a[":defaultCategory"]=t.defaultCategory??null,s.push("#defaultCategory = :defaultCategory")),Object.prototype.hasOwnProperty.call(t,"tags")&&(o["#tags"]="tags",a[":tags"]=t.tags??[],s.push("#tags = :tags"));let p=await c.send(new i.UpdateCommand({TableName:l,Key:{[d]:`CAB#${r}`,[u]:"META"},UpdateExpression:"SET "+s.join(", "),ConditionExpression:"#ownerSub = :ownerSub",ExpressionAttributeNames:o,ExpressionAttributeValues:a,ReturnValues:"ALL_NEW"}));return B(p.Attributes)}async function le(e,t){if(!t)throw new Error("id is required");let r=`CAB#${t}`,o=(await c.send(new i.QueryCommand({TableName:l,KeyConditionExpression:"#pk = :pk",ExpressionAttributeNames:{"#pk":d},ExpressionAttributeValues:{":pk":r}}))).Items??[],a=o.find(s=>s.type==="CABINET");return!a||a.ownerSub!==e?!1:(await Promise.all(o.map(s=>c.send(new i.DeleteCommand({TableName:l,Key:{[d]:s[d],[u]:s[u]}})))),!0)}async function M(e,t){if(!t)throw new Error("cabinetId is required");return await k(e,t)?((await c.send(new i.QueryCommand({TableName:l,KeyConditionExpression:"#pk = :pk AND begins_with(#sk, :prefix)",ExpressionAttributeNames:{"#pk":d,"#sk":u},ExpressionAttributeValues:{":pk":`CAB#${t}`,":prefix":"FOLDER#"}}))).Items??[]).map(L):[]}async function pe(e,t){let{cabinetId:r,name:n}=t||{};if(!r)throw new Error("cabinetId is required");if(!n)throw new Error("name is required");if(!await k(e,r))throw new Error("Cabinet not found");let a=I(),s=g(),p={[d]:`CAB#${r}`,[u]:`FOLDER#${a}`,type:"FOLDER",id:a,cabinetId:r,ownerSub:e,name:n,specialKind:null,createdAt:s,updatedAt:s};return await c.send(new i.PutCommand({TableName:l,Item:p,ConditionExpression:"attribute_not_exists(#pk) AND attribute_not_exists(#sk)",ExpressionAttributeNames:{"#pk":d,"#sk":u}})),L(p)}async function me(e,t){let{id:r,cabinetId:n,name:o}=t||{};if(!r)throw new Error("id is required");if(!n)throw new Error("cabinetId is required");if(!o)throw new Error("name is required");let a=g(),s=await c.send(new i.UpdateCommand({TableName:l,Key:{[d]:`CAB#${n}`,[u]:`FOLDER#${r}`},UpdateExpression:"SET #name = :name, #updatedAt = :updatedAt",ConditionExpression:"#ownerSub = :ownerSub",ExpressionAttributeNames:{"#name":"name","#updatedAt":"updatedAt","#ownerSub":"ownerSub"},ExpressionAttributeValues:{":name":o,":updatedAt":a,":ownerSub":e},ReturnValues:"ALL_NEW"}));return L(s.Attributes)}async function Ae(e,t,r){if(!t)throw new Error("id is required");if(!r)throw new Error("cabinetId is required");await c.send(new i.DeleteCommand({TableName:l,Key:{[d]:`CAB#${r}`,[u]:`FOLDER#${t}`},ConditionExpression:"#ownerSub = :ownerSub",ExpressionAttributeNames:{"#ownerSub":"ownerSub"},ExpressionAttributeValues:{":ownerSub":e}}));let o=(await c.send(new i.QueryCommand({TableName:l,KeyConditionExpression:"#pk = :pk AND begins_with(#sk, :prefix)",ExpressionAttributeNames:{"#pk":d,"#sk":u,"#folderId":"folderId"},ExpressionAttributeValues:{":pk":`CAB#${r}`,":prefix":"ASSET#",":folderId":t},FilterExpression:"#folderId = :folderId"}))).Items??[];return await Promise.all(o.map(a=>c.send(new i.UpdateCommand({TableName:l,Key:{[d]:a[d],[u]:a[u]},UpdateExpression:"SET #folderId = :null",ExpressionAttributeNames:{"#folderId":"folderId"},ExpressionAttributeValues:{":null":null}})))),!0}async function we(e,t){let{cabinetId:r,folderId:n,category:o,tag:a,search:s,limit:p=50,nextToken:m}=t||{};if(!r)throw new Error("cabinetId is required");if(!await k(e,r))return{items:[],nextToken:null};let w={TableName:l,KeyConditionExpression:"#pk = :pk AND begins_with(#sk, :prefix)",ExpressionAttributeNames:{"#pk":d,"#sk":u},ExpressionAttributeValues:{":pk":`CAB#${r}`,":prefix":"ASSET#"},Limit:p};m&&(w.ExclusiveStartKey={[d]:`CAB#${r}`,[u]:m});let E=await c.send(new i.QueryCommand(w)),y=(E.Items??[]).filter(f=>f.type==="ASSET");if(y=y.filter(f=>String(f.moderationStatus??"ACTIVE").toUpperCase()==="ACTIVE"),n!=null&&(y=y.filter(f=>f.folderId===n)),o&&(y=y.filter(f=>f.category===o)),a&&(y=y.filter(f=>Array.isArray(f.tags)&&f.tags.includes(a))),s){let f=String(s).toLowerCase();y=y.filter(T=>{let R=(T.title??"").toLowerCase(),h=(T.notes??"").toLowerCase();return R.includes(f)||h.includes(f)})}let C=E.LastEvaluatedKey?E.LastEvaluatedKey[u]:null;return{items:y.map(S),nextToken:C}}async function ye(e,t){let{cabinetId:r,folderId:n,category:o,title:a,notes:s,tags:p=[],fileName:m,filename:A,contentType:w,kind:E}=t||{},y=m??A;if(!r)throw new Error("cabinetId is required");if(!y)throw new Error("fileName is required");if(!w)throw new Error("contentType is required");if(!await k(e,r))throw new Error("Cabinet not found");let f=I(),T=n||"unsorted",R=String(y).replace(/[^a-zA-Z0-9._-]/g,"_"),h=["creator-media",e,r,T,`${f}-${R}`].join("/"),x=g(),N=E??"OTHER",K={[d]:`CAB#${r}`,[u]:`ASSET#${f}`,type:"ASSET",id:f,cabinetId:r,folderId:n??null,ownerSub:e,kind:N,category:o??null,title:a??null,notes:s??null,tags:p,s3Key:h,contentType:w,createdAt:x,updatedAt:x,moderationStatus:"ACTIVE",moderationReason:null,moderatedBy:null,moderatedAt:null,gsi1pk:`CREATOR#${e}`,gsi1sk:`CAB_ASSET#${r}#${x}#${f}`};await c.send(new i.PutCommand({TableName:l,Item:K})),await c.send(new i.UpdateCommand({TableName:l,Key:{[d]:`CAB#${r}`,[u]:"META"},UpdateExpression:"SET #assetCount = if_not_exists(#assetCount, :zero) + :one, #updatedAt = :updatedAt",ExpressionAttributeNames:{"#assetCount":"assetCount","#updatedAt":"updatedAt"},ExpressionAttributeValues:{":zero":0,":one":1,":updatedAt":x}}));let z=new $.PutObjectCommand({Bucket:re,Key:h,ContentType:w});return{uploadUrl:await(0,F.getSignedUrl)(te,z,{expiresIn:900}),asset:S(K)}}async function fe(e,t){let{id:r,cabinetId:n}=t||{};if(!r)throw new Error("id is required");if(!n)throw new Error("cabinetId is required");let o=g(),a={"#updatedAt":"updatedAt","#ownerSub":"ownerSub"},s={":updatedAt":o,":ownerSub":e},p=["#updatedAt = :updatedAt"];Object.prototype.hasOwnProperty.call(t,"folderId")&&(a["#folderId"]="folderId",s[":folderId"]=t.folderId??null,p.push("#folderId = :folderId")),Object.prototype.hasOwnProperty.call(t,"category")&&(a["#category"]="category",s[":category"]=t.category??null,p.push("#category = :category")),Object.prototype.hasOwnProperty.call(t,"title")&&(a["#title"]="title",s[":title"]=t.title??null,p.push("#title = :title")),Object.prototype.hasOwnProperty.call(t,"notes")&&(a["#notes"]="notes",s[":notes"]=t.notes??null,p.push("#notes = :notes")),Object.prototype.hasOwnProperty.call(t,"tags")&&(a["#tags"]="tags",s[":tags"]=t.tags??[],p.push("#tags = :tags")),Object.prototype.hasOwnProperty.call(t,"kind")&&(a["#kind"]="kind",s[":kind"]=t.kind??"OTHER",p.push("#kind = :kind")),Object.prototype.hasOwnProperty.call(t,"contentType")&&(a["#contentType"]="contentType",s[":contentType"]=t.contentType??null,p.push("#contentType = :contentType"));let m=await c.send(new i.UpdateCommand({TableName:l,Key:{[d]:`CAB#${n}`,[u]:`ASSET#${r}`},UpdateExpression:"SET "+p.join(", "),ConditionExpression:"#ownerSub = :ownerSub",ExpressionAttributeNames:a,ExpressionAttributeValues:s,ReturnValues:"ALL_NEW"}));return S(m.Attributes)}async function Ee(e,t,r){if(!t)throw new Error("id is required");if(!r)throw new Error("cabinetId is required");let n=g();return await c.send(new i.DeleteCommand({TableName:l,Key:{[d]:`CAB#${r}`,[u]:`ASSET#${t}`},ConditionExpression:"#ownerSub = :ownerSub",ExpressionAttributeNames:{"#ownerSub":"ownerSub"},ExpressionAttributeValues:{":ownerSub":e}})),await c.send(new i.UpdateCommand({TableName:l,Key:{[d]:`CAB#${r}`,[u]:"META"},UpdateExpression:"SET #assetCount = if_not_exists(#assetCount, :zero) - :one, #updatedAt = :updatedAt",ExpressionAttributeNames:{"#assetCount":"assetCount","#updatedAt":"updatedAt"},ExpressionAttributeValues:{":zero":0,":one":1,":updatedAt":n}})),!0}async function be(e,t){let{id:r,cabinetId:n,destinationFolderId:o}=t||{};if(!r)throw new Error("id is required");if(!n)throw new Error("cabinetId is required");let a=g(),s=await c.send(new i.UpdateCommand({TableName:l,Key:{[d]:`CAB#${n}`,[u]:`ASSET#${r}`},UpdateExpression:"SET #folderId = :folderId, #updatedAt = :updatedAt",ConditionExpression:"#ownerSub = :ownerSub",ExpressionAttributeNames:{"#folderId":"folderId","#updatedAt":"updatedAt","#ownerSub":"ownerSub"},ExpressionAttributeValues:{":folderId":o??null,":updatedAt":a,":ownerSub":e},ReturnValues:"ALL_NEW"}));return S(s.Attributes)}async function ge(e){let{ownerSub:t,cabinetId:r,folderId:n,moderationStatus:o,includeSoftDeleted:a=!0,limit:s=50}=e||{};if(!t)throw new Error("ownerSub is required");let m=((await c.send(new i.QueryCommand({TableName:l,IndexName:G,KeyConditionExpression:"#gpk = :gpk AND begins_with(#gsk, :prefix)",ExpressionAttributeNames:{"#gpk":"gsi1pk","#gsk":"gsi1sk"},ExpressionAttributeValues:{":gpk":`CREATOR#${t}`,":prefix":"CAB_ASSET#"},Limit:s}))).Items??[]).filter(A=>A.type==="ASSET");if(r&&(m=m.filter(A=>A.cabinetId===r)),n!=null&&(m=m.filter(A=>A.folderId===n)),o){let A=String(o).toUpperCase();m=m.filter(w=>String(w.moderationStatus??"ACTIVE").toUpperCase()===A)}return a||(m=m.filter(A=>String(A.moderationStatus??"ACTIVE").toUpperCase()!=="SOFT_DELETED")),{items:m.map(S),nextToken:null}}async function Se(e){let{cabinetId:t,id:r}=e||{};if(!t)throw new Error("cabinetId is required");if(!r)throw new Error("id is required");let n=await c.send(new i.GetCommand({TableName:l,Key:{[d]:`CAB#${t}`,[u]:`ASSET#${r}`}}));return!n.Item||n.Item.type!=="ASSET"?null:S(n.Item)}async function H(e,t){let{cabinetId:r,id:n,moderationStatus:o,moderationReason:a,tags:s}=t||{};if(!r)throw new Error("cabinetId is required");if(!n)throw new Error("id is required");if(!o)throw new Error("moderationStatus is required");let p=g(),m={"#moderationStatus":"moderationStatus","#updatedAt":"updatedAt","#moderatedAt":"moderatedAt","#moderatedBy":"moderatedBy"},A={":moderationStatus":o,":updatedAt":p,":moderatedAt":p,":moderatedBy":e},w=["#moderationStatus = :moderationStatus","#updatedAt = :updatedAt","#moderatedAt = :moderatedAt","#moderatedBy = :moderatedBy"];Object.prototype.hasOwnProperty.call(t,"moderationReason")&&(m["#moderationReason"]="moderationReason",A[":moderationReason"]=a??null,w.push("#moderationReason = :moderationReason")),Array.isArray(s)&&(m["#tags"]="tags",A[":tags"]=s,w.push("#tags = :tags"));let E=await c.send(new i.UpdateCommand({TableName:l,Key:{[d]:`CAB#${r}`,[u]:`ASSET#${n}`},UpdateExpression:"SET "+w.join(", "),ReturnValues:"ALL_NEW"}));return S(E.Attributes)}async function Ce(e,t){if(!t)throw new Error("input is required");let{cabinetId:r,id:n,moderationReason:o,tags:a}=t;return H(e,{cabinetId:r,id:n,moderationStatus:"REJECTED",moderationReason:o,tags:a})}async function Te(e,t){let{cabinetId:r,id:n,reason:o}=t||{};if(!r)throw new Error("cabinetId is required");if(!n)throw new Error("id is required");let a=g(),s=await c.send(new i.UpdateCommand({TableName:l,Key:{[d]:`CAB#${r}`,[u]:`ASSET#${n}`},UpdateExpression:"SET #moderationStatus = :status, #moderationReason = :reason, #moderatedBy = :moderatedBy, #moderatedAt = :moderatedAt, #updatedAt = :updatedAt",ExpressionAttributeNames:{"#moderationStatus":"moderationStatus","#moderationReason":"moderationReason","#moderatedBy":"moderatedBy","#moderatedAt":"moderatedAt","#updatedAt":"updatedAt"},ExpressionAttributeValues:{":status":"SOFT_DELETED",":reason":o??null,":moderatedBy":e,":moderatedAt":a,":updatedAt":a},ReturnValues:"ALL_NEW"}));return S(s.Attributes)}async function Ie(e,t){let{cabinetId:r,id:n}=t||{};if(!r)throw new Error("cabinetId is required");if(!n)throw new Error("id is required");let o=g(),a=await c.send(new i.UpdateCommand({TableName:l,Key:{[d]:`CAB#${r}`,[u]:`ASSET#${n}`},UpdateExpression:"SET #moderationStatus = :status, #moderationReason = :reason, #moderatedBy = :moderatedBy, #moderatedAt = :moderatedAt, #updatedAt = :updatedAt",ExpressionAttributeNames:{"#moderationStatus":"moderationStatus","#moderationReason":"moderationReason","#moderatedBy":"moderatedBy","#moderatedAt":"moderatedAt","#updatedAt":"updatedAt"},ExpressionAttributeValues:{":status":"ACTIVE",":reason":null,":moderatedBy":e,":moderatedAt":o,":updatedAt":o},ReturnValues:"ALL_NEW"}));return S(a.Attributes)}function he(){return{primaryGoal:"GROWTH",timeHorizon:"90_DAYS",weeklyCapacity:5,focusAreas:["PERSONALITY","NURTURE"],riskTolerance:"MEDIUM",notes:null,updatedAt:null}}async function xe(e){let t=await c.send(new i.GetCommand({TableName:l,Key:{[d]:`CREATOR#${e}`,[u]:"GOAL_COMPASS"}}));if(!t.Item)return he();let r=t.Item;return{primaryGoal:r.primaryGoal??"GROWTH",timeHorizon:r.timeHorizon??"90_DAYS",weeklyCapacity:typeof r.weeklyCapacity=="number"?r.weeklyCapacity:5,focusAreas:Array.isArray(r.focusAreas)&&r.focusAreas.length?r.focusAreas:["PERSONALITY","NURTURE"],riskTolerance:r.riskTolerance??"MEDIUM",notes:r.notes??null,updatedAt:r.updatedAt??null}}async function ke(e,t){if(!t)throw new Error("input is required");let r=g(),n={[d]:`CREATOR#${e}`,[u]:"GOAL_COMPASS",type:"CREATOR_GOAL_COMPASS",primaryGoal:t.primaryGoal??"GROWTH",timeHorizon:t.timeHorizon??"90_DAYS",weeklyCapacity:typeof t.weeklyCapacity=="number"?t.weeklyCapacity:5,focusAreas:Array.isArray(t.focusAreas)&&t.focusAreas.length?t.focusAreas:["PERSONALITY","NURTURE"],riskTolerance:t.riskTolerance??"MEDIUM",notes:t.notes??null,updatedAt:r};return await c.send(new i.PutCommand({TableName:l,Item:n})),{primaryGoal:n.primaryGoal,timeHorizon:n.timeHorizon,weeklyCapacity:n.weeklyCapacity,focusAreas:n.focusAreas,riskTolerance:n.riskTolerance,notes:n.notes,updatedAt:n.updatedAt}}async function Re(e,t){let{closetItemId:r,cabinetId:n,folderId:o,kind:a,title:s,notes:p,tags:m=[]}=t||{};if(!r)throw new Error("closetItemId is required");if(!n)throw new Error("cabinetId is required");if(!await k(e,n))throw new Error("Cabinet not found");let E=(await c.send(new i.GetCommand({TableName:l,Key:{[d]:`CLOSET#${e}`,[u]:`ITEM#${r}`}}))).Item;if(!E||E.ownerSub!==e)throw new Error("Closet item not found");let y=I(),C=g(),f=E.mediaKey||E.rawMediaKey||(()=>{throw new Error("Closet item has no media key")})(),T=a??"PHOTO",R=s??E.title??null,h=p??E.notes??null,x=m.length?m:E.colorTags??[],N={[d]:`CAB#${n}`,[u]:`ASSET#${y}`,type:"ASSET",id:y,cabinetId:n,folderId:o??null,ownerSub:e,kind:T,category:"OUTFIT_REFS",title:R,notes:h,tags:x,s3Key:f,contentType:E.contentType??"image/jpeg",createdAt:C,updatedAt:C,sourceClosetItemId:r,moderationStatus:"ACTIVE",moderationReason:null,moderatedBy:null,moderatedAt:null,gsi1pk:`CREATOR#${e}`,gsi1sk:`CAB_ASSET#${n}#${C}#${y}`};return await c.send(new i.PutCommand({TableName:l,Item:N})),await c.send(new i.UpdateCommand({TableName:l,Key:{[d]:`CAB#${n}`,[u]:"META"},UpdateExpression:"SET #assetCount = if_not_exists(#assetCount, :zero) + :one, #updatedAt = :updatedAt",ExpressionAttributeNames:{"#assetCount":"assetCount","#updatedAt":"updatedAt"},ExpressionAttributeValues:{":zero":0,":one":1,":updatedAt":C}})),S(N)}async function Ne(e){let t=e.arguments?.text??"",r=e.arguments?.kind??"OTHER",n=t||"your content",o=[];return r==="CAPTION"?o.push(`Behind the scenes of ${n} \u2728`,`Styling ${n} so you don't have to \u{1F485}`):r==="HASHTAGS"?o.push("#stylingadventures #creatorlife #behindthescenes","#outfitinspo #contentcreator #filmingday"):o.push(`Planning ideas for ${n}`),{suggestions:o}}0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
