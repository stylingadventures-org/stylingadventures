{
  "version": 3,
  "sources": ["../../lambda/creator-tools/index.ts", "../../../../../node_modules/uuid/dist/esm/stringify.js", "../../../../../node_modules/uuid/dist/esm/rng.js", "../../../../../node_modules/uuid/dist/esm/native.js", "../../../../../node_modules/uuid/dist/esm/v4.js"],
  "sourcesContent": ["import { DynamoDBClient } from \"@aws-sdk/client-dynamodb\";\r\nimport {\r\n  DynamoDBDocumentClient,\r\n  QueryCommand,\r\n  PutCommand,\r\n  UpdateCommand,\r\n  DeleteCommand,\r\n  GetCommand,\r\n} from \"@aws-sdk/lib-dynamodb\";\r\nimport { v4 as uuid } from \"uuid\";\r\nimport { S3Client, PutObjectCommand } from \"@aws-sdk/client-s3\";\r\nimport { getSignedUrl } from \"@aws-sdk/s3-request-presigner\";\r\n\r\nconst ddb = DynamoDBDocumentClient.from(new DynamoDBClient({}));\r\nconst s3 = new S3Client({});\r\n\r\nconst TABLE_NAME = process.env.TABLE_NAME!;\r\nconst CREATOR_MEDIA_BUCKET = process.env.CREATOR_MEDIA_BUCKET!;\r\nconst PK = process.env.PK_NAME || \"pk\";\r\nconst SK = process.env.SK_NAME || \"sk\";\r\nconst STATUS_GSI = process.env.STATUS_GSI || \"gsi1\";\r\n\r\nfunction now() {\r\n  return new Date().toISOString();\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// Monetization HQ \u2013 earnings by platform (mocked, windowed)\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\ntype CreatorRevenueWindow = \"LAST_7_DAYS\" | \"LAST_30_DAYS\" | \"LAST_90_DAYS\";\r\n\r\nasync function creatorRevenueByPlatformResolver(event: any) {\r\n  const window: CreatorRevenueWindow =\r\n    event.arguments?.window || \"LAST_30_DAYS\";\r\n\r\n  const days =\r\n    window === \"LAST_7_DAYS\"\r\n      ? 7\r\n      : window === \"LAST_90_DAYS\"\r\n      ? 90\r\n      : 30;\r\n\r\n  // Simple sample fake data; you can swap this for real pipelines later.\r\n  const currency = \"USD\";\r\n\r\n  const platforms = [\r\n    {\r\n      platform: \"tiktok\",\r\n      label: \"TikTok / Reels\",\r\n      currency,\r\n      amount: 420.5,\r\n      lastPayoutAt: new Date().toISOString(),\r\n    },\r\n    {\r\n      platform: \"youtube\",\r\n      label: \"YouTube\",\r\n      currency,\r\n      amount: 310.2,\r\n      lastPayoutAt: new Date(\r\n        Date.now() - 3 * 86400000,\r\n      ).toISOString(),\r\n    },\r\n    {\r\n      platform: \"instagram\",\r\n      label: \"Instagram\",\r\n      currency,\r\n      amount: 165.0,\r\n      lastPayoutAt: null,\r\n    },\r\n  ];\r\n\r\n  const platformTotal = platforms.reduce(\r\n    (sum, p) => sum + p.amount,\r\n    0,\r\n  );\r\n\r\n  // Generate a simple upward trend timeseries\r\n  const today = new Date();\r\n  const timeseries = Array.from({ length: days }).map((_, i) => {\r\n    const d = new Date(today);\r\n    d.setDate(today.getDate() - (days - 1 - i));\r\n\r\n    const base = platformTotal / days;\r\n    const variance =\r\n      (i / (days - 1 || 1)) * 0.4 + 0.8; // ~0.8x to 1.2x\r\n\r\n    return {\r\n      date: d.toISOString().slice(0, 10), // YYYY-MM-DD\r\n      totalRevenue: Math.round(base * variance * 100) / 100,\r\n    };\r\n  });\r\n\r\n  const totalRevenue = timeseries.reduce(\r\n    (sum, p) => sum + p.totalRevenue,\r\n    0,\r\n  );\r\n\r\n  return {\r\n    currency,\r\n    totalRevenue,\r\n    platforms,\r\n    timeseries,\r\n  };\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// Director Suite \u2013 shoot plans (Dynamo persistence)\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function getDirectorShootPlan(sub: string, id: string) {\r\n  if (!sub) throw new Error(\"Not authenticated\");\r\n  if (!id) throw new Error(\"id is required\");\r\n\r\n  const pk = `CREATOR#${sub}`;\r\n  const sk = `DIRECTOR_SHOOT#${id}`;\r\n\r\n  const res = await ddb.send(\r\n    new GetCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: { [PK]: pk, [SK]: sk },\r\n    }),\r\n  );\r\n\r\n  if (!res.Item) return null;\r\n\r\n  const item = res.Item as any;\r\n\r\n  return {\r\n    id: item.id,\r\n    creatorId: sub,\r\n    shootName: item.shootName,\r\n    primaryPlatform: item.primaryPlatform,\r\n    objective: item.objective,\r\n    scenes: item.scenes || [],\r\n    createdAt: item.createdAt,\r\n    updatedAt: item.updatedAt,\r\n  };\r\n}\r\n\r\ninterface DirectorSceneInput {\r\n  id: string;\r\n  title: string;\r\n  shotType?: string | null;\r\n  location?: string | null;\r\n  mood?: string | null;\r\n  beats?: string | null;\r\n}\r\n\r\ninterface SaveDirectorShootPlanInput {\r\n  id?: string | null;\r\n  shootName: string;\r\n  primaryPlatform: string;\r\n  objective: string;\r\n  scenes: DirectorSceneInput[];\r\n}\r\n\r\nasync function saveDirectorShootPlan(\r\n  sub: string,\r\n  input: SaveDirectorShootPlanInput,\r\n) {\r\n  if (!sub) throw new Error(\"Not authenticated\");\r\n  if (!input) throw new Error(\"input is required\");\r\n\r\n  const id = input.id || \"default\";\r\n  const nowIso = now();\r\n\r\n  const pk = `CREATOR#${sub}`;\r\n  const sk = `DIRECTOR_SHOOT#${id}`;\r\n\r\n  const item = {\r\n    [PK]: pk,\r\n    [SK]: sk,\r\n    id,\r\n    creatorId: sub,\r\n    shootName: input.shootName,\r\n    primaryPlatform: input.primaryPlatform,\r\n    objective: input.objective,\r\n    scenes: input.scenes || [],\r\n    createdAt: nowIso,\r\n    updatedAt: nowIso,\r\n    type: \"DIRECTOR_SHOOT_PLAN\",\r\n  };\r\n\r\n  await ddb.send(\r\n    new PutCommand({\r\n      TableName: TABLE_NAME,\r\n      Item: item,\r\n    }),\r\n  );\r\n\r\n  return {\r\n    id,\r\n    creatorId: sub,\r\n    shootName: item.shootName,\r\n    primaryPlatform: item.primaryPlatform,\r\n    objective: item.objective,\r\n    scenes: item.scenes,\r\n    createdAt: item.createdAt,\r\n    updatedAt: item.updatedAt,\r\n  };\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// GraphQL handler \u2013 router\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\nexport const handler = async (event: any) => {\r\n  const field = event.info?.fieldName;\r\n  const sub =\r\n    event.identity?.sub ||\r\n    event.identity?.claims?.sub ||\r\n    \"anonymous\";\r\n  const args = event.arguments || {};\r\n\r\n  switch (field) {\r\n    // CABINETS\r\n    case \"creatorCabinets\":\r\n      return listCabinets(sub);\r\n    case \"creatorCabinet\":\r\n      return getCabinet(sub, args.id);\r\n    case \"createCreatorCabinet\":\r\n      return createCabinet(sub, args.input);\r\n    case \"updateCreatorCabinet\":\r\n      return updateCabinet(sub, args.input);\r\n    case \"deleteCreatorCabinet\":\r\n      return deleteCabinet(sub, args.id);\r\n\r\n    // FOLDERS\r\n    case \"creatorCabinetFolders\":\r\n      return listFolders(sub, args.cabinetId);\r\n\r\n    // Back-compat alias\r\n    case \"creatorFolders\":\r\n      return listFolders(sub, args.cabinetId);\r\n\r\n    case \"createCreatorFolder\":\r\n      return createFolder(sub, args.input);\r\n    case \"renameCreatorFolder\":\r\n      return renameFolder(sub, args.input);\r\n    case \"deleteCreatorFolder\":\r\n      return deleteFolder(\r\n        sub,\r\n        args.id,\r\n        args.cabinetId,\r\n      );\r\n\r\n    // ASSETS \u2013 creator-facing\r\n    case \"creatorCabinetAssets\":\r\n      return listAssets(sub, args);\r\n    case \"createCreatorAssetUpload\":\r\n      return createAssetUpload(sub, args.input);\r\n    case \"updateCreatorAsset\":\r\n      return updateAsset(sub, args.input);\r\n    case \"deleteCreatorAsset\":\r\n      return deleteAsset(sub, args.id, args.cabinetId);\r\n    case \"moveCreatorAsset\":\r\n      return moveAsset(sub, args.input);\r\n    case \"importClosetItemToCabinet\":\r\n      return importClosetItemToCabinet(sub, args.input);\r\n\r\n    // ADMIN moderation / listing\r\n    case \"adminListCreatorAssetsByUser\":\r\n      return adminListCreatorAssetsByUser(args);\r\n    case \"adminGetCreatorAsset\":\r\n      return adminGetCreatorAsset(args);\r\n    case \"adminModerateCreatorAsset\":\r\n      return adminModerateCreatorAsset(sub, args.input);\r\n    case \"adminSoftDeleteCreatorAsset\":\r\n      return adminSoftDeleteCreatorAsset(sub, args.input);\r\n    case \"adminRestoreCreatorAsset\":\r\n      return adminRestoreCreatorAsset(sub, args.input);\r\n    case \"adminRejectCreatorAsset\":\r\n      return adminRejectCreatorAsset(sub, args.input);\r\n\r\n    // Monetization HQ \u2013 earnings by platform (mocked)\r\n    case \"creatorRevenueByPlatform\":\r\n      return creatorRevenueByPlatformResolver(event);\r\n\r\n    // Goal compass (creator alignment)\r\n    case \"creatorGoalCompass\":\r\n      return getCreatorGoalCompass(sub);\r\n    case \"updateCreatorGoalCompass\":\r\n      return updateCreatorGoalCompass(sub, args.input);\r\n\r\n    // Director Suite \u2013 shoot plans\r\n    case \"getDirectorShootPlan\":\r\n      return getDirectorShootPlan(sub, args.id);\r\n    case \"saveDirectorShootPlan\":\r\n      return saveDirectorShootPlan(sub, args.input);\r\n\r\n    // AI\r\n    case \"creatorAiSuggest\":\r\n      return runCreatorAi(event);\r\n\r\n    default:\r\n      throw new Error(`Unknown field ${field}`);\r\n  }\r\n};\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// Mapping helpers\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nfunction mapCabinet(item: any) {\r\n  if (!item) return null;\r\n  return {\r\n    id: item.id,\r\n    ownerSub: item.ownerSub,\r\n    name: item.name,\r\n    description: item.description ?? null,\r\n    defaultCategory: item.defaultCategory ?? null,\r\n    tags: item.tags ?? [],\r\n    createdAt: item.createdAt,\r\n    updatedAt: item.updatedAt,\r\n    assetCount: item.assetCount ?? 0,\r\n  };\r\n}\r\n\r\nfunction mapFolder(item: any) {\r\n  if (!item) return null;\r\n  return {\r\n    id: item.id,\r\n    cabinetId: item.cabinetId,\r\n    name: item.name,\r\n    specialKind: item.specialKind ?? null,\r\n    createdAt: item.createdAt,\r\n    updatedAt: item.updatedAt,\r\n  };\r\n}\r\n\r\nfunction mapAsset(item: any) {\r\n  if (!item) return null;\r\n  return {\r\n    id: item.id,\r\n    cabinetId: item.cabinetId,\r\n    folderId: item.folderId ?? null,\r\n    ownerSub: item.ownerSub,\r\n    // ensure non-null for GraphQL\r\n    kind: item.kind ?? \"OTHER\",\r\n    category: item.category ?? null,\r\n    title: item.title ?? null,\r\n    notes: item.notes ?? null,\r\n    tags: item.tags ?? [],\r\n    s3Key: item.s3Key,\r\n    contentType: item.contentType ?? null,\r\n    createdAt: item.createdAt,\r\n    updatedAt: item.updatedAt,\r\n\r\n    // moderation defaults\r\n    moderationStatus: item.moderationStatus ?? \"ACTIVE\",\r\n    moderationReason: item.moderationReason ?? null,\r\n    moderatedBy: item.moderatedBy ?? null,\r\n    moderatedAt: item.moderatedAt ?? null,\r\n  };\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// CABINETS\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function listCabinets(sub: string) {\r\n  const res = await ddb.send(\r\n    new QueryCommand({\r\n      TableName: TABLE_NAME,\r\n      IndexName: STATUS_GSI,\r\n      KeyConditionExpression: \"#gpk = :gpk AND begins_with(#gsk, :prefix)\",\r\n      ExpressionAttributeNames: {\r\n        \"#gpk\": \"gsi1pk\",\r\n        \"#gsk\": \"gsi1sk\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":gpk\": `CREATOR#${sub}`,\r\n        \":prefix\": \"CAB#\",\r\n      },\r\n    }),\r\n  );\r\n\r\n  let items = res.Items ?? [];\r\n\r\n  // If this creator has no cabinets yet, auto-create a starter one.\r\n  if (items.length === 0) {\r\n    const starter = await createDefaultCabinetForCreator(sub);\r\n    items = [starter];\r\n  }\r\n\r\n  return items.map(mapCabinet);\r\n}\r\n\r\nasync function getCabinet(sub: string, id: string) {\r\n  if (!id) throw new Error(\"id is required\");\r\n\r\n  const res = await ddb.send(\r\n    new GetCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${id}`,\r\n        [SK]: \"META\",\r\n      },\r\n    }),\r\n  );\r\n\r\n  if (!res.Item || res.Item.ownerSub !== sub) {\r\n    // hide existence of other peoples\u2019 cabinets\r\n    return null;\r\n  }\r\n\r\n  return mapCabinet(res.Item);\r\n}\r\n\r\nasync function createDefaultCabinetForCreator(sub: string) {\r\n  const nowIso = now();\r\n  const id = uuid();\r\n\r\n  const item = {\r\n    [PK]: `CAB#${id}`,\r\n    [SK]: \"META\",\r\n    type: \"CABINET\",\r\n    id,\r\n    ownerSub: sub,\r\n    name: \"From my closet\",\r\n    description:\r\n      \"Imported looks and outfit references from your Bestie closet\",\r\n    defaultCategory: \"OUTFIT_REFS\",\r\n    tags: [\"closet-import\"],\r\n    assetCount: 0,\r\n    createdAt: nowIso,\r\n    updatedAt: nowIso,\r\n    gsi1pk: `CREATOR#${sub}`,\r\n    gsi1sk: `CAB#${nowIso}#${id}`,\r\n  };\r\n\r\n  await ddb.send(\r\n    new PutCommand({\r\n      TableName: TABLE_NAME,\r\n      Item: item,\r\n      ConditionExpression: \"attribute_not_exists(#pk)\",\r\n      ExpressionAttributeNames: {\r\n        \"#pk\": PK,\r\n      },\r\n    }),\r\n  );\r\n\r\n  return item;\r\n}\r\n\r\nasync function createCabinet(sub: string, input: any) {\r\n  if (!input?.name) {\r\n    throw new Error(\"name is required\");\r\n  }\r\n\r\n  const id = uuid();\r\n  const nowIso = now();\r\n\r\n  const item = {\r\n    [PK]: `CAB#${id}`,\r\n    [SK]: \"META\",\r\n    type: \"CABINET\",\r\n    id,\r\n    ownerSub: sub,\r\n    name: input.name,\r\n    description: input.description ?? null,\r\n    defaultCategory: input.defaultCategory ?? null,\r\n    tags: input.tags ?? [],\r\n    assetCount: 0,\r\n    createdAt: nowIso,\r\n    updatedAt: nowIso,\r\n    // GSI to list cabinets per creator\r\n    gsi1pk: `CREATOR#${sub}`,\r\n    gsi1sk: `CAB#${nowIso}#${id}`,\r\n  };\r\n\r\n  await ddb.send(\r\n    new PutCommand({\r\n      TableName: TABLE_NAME,\r\n      Item: item,\r\n      ConditionExpression: \"attribute_not_exists(#pk)\",\r\n      ExpressionAttributeNames: {\r\n        \"#pk\": PK,\r\n      },\r\n    }),\r\n  );\r\n\r\n  return mapCabinet(item);\r\n}\r\n\r\nasync function updateCabinet(sub: string, input: any) {\r\n  const id = input?.id;\r\n  if (!id) throw new Error(\"id is required\");\r\n  if (!input) throw new Error(\"input is required\");\r\n\r\n  const nowIso = now();\r\n\r\n  const names: Record<string, string> = {\r\n    \"#updatedAt\": \"updatedAt\",\r\n    \"#ownerSub\": \"ownerSub\",\r\n  };\r\n  const values: Record<string, any> = {\r\n    \":updatedAt\": nowIso,\r\n    \":ownerSub\": sub,\r\n  };\r\n  const sets: string[] = [\"#updatedAt = :updatedAt\"];\r\n\r\n  if (Object.prototype.hasOwnProperty.call(input, \"name\")) {\r\n    names[\"#name\"] = \"name\";\r\n    values[\":name\"] = input.name;\r\n    sets.push(\"#name = :name\");\r\n  }\r\n  if (Object.prototype.hasOwnProperty.call(input, \"description\")) {\r\n    names[\"#description\"] = \"description\";\r\n    values[\":description\"] = input.description ?? null;\r\n    sets.push(\"#description = :description\");\r\n  }\r\n  if (Object.prototype.hasOwnProperty.call(input, \"defaultCategory\")) {\r\n    names[\"#defaultCategory\"] = \"defaultCategory\";\r\n    values[\":defaultCategory\"] = input.defaultCategory ?? null;\r\n    sets.push(\"#defaultCategory = :defaultCategory\");\r\n  }\r\n  if (Object.prototype.hasOwnProperty.call(input, \"tags\")) {\r\n    names[\"#tags\"] = \"tags\";\r\n    values[\":tags\"] = input.tags ?? [];\r\n    sets.push(\"#tags = :tags\");\r\n  }\r\n\r\n  const res = await ddb.send(\r\n    new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${id}`,\r\n        [SK]: \"META\",\r\n      },\r\n      UpdateExpression: \"SET \" + sets.join(\", \"),\r\n      ConditionExpression: \"#ownerSub = :ownerSub\",\r\n      ExpressionAttributeNames: names,\r\n      ExpressionAttributeValues: values,\r\n      ReturnValues: \"ALL_NEW\",\r\n    }),\r\n  );\r\n\r\n  return mapCabinet(res.Attributes);\r\n}\r\n\r\nasync function deleteCabinet(sub: string, id: string) {\r\n  if (!id) throw new Error(\"id is required\");\r\n\r\n  const pkValue = `CAB#${id}`;\r\n\r\n  // First fetch all rows for this cabinet to confirm ownership & cascade delete.\r\n  const res = await ddb.send(\r\n    new QueryCommand({\r\n      TableName: TABLE_NAME,\r\n      KeyConditionExpression: \"#pk = :pk\",\r\n      ExpressionAttributeNames: {\r\n        \"#pk\": PK,\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":pk\": pkValue,\r\n      },\r\n    }),\r\n  );\r\n\r\n  const items = res.Items ?? [];\r\n  const meta = items.find((it) => it.type === \"CABINET\");\r\n\r\n  if (!meta || meta.ownerSub !== sub) {\r\n    // Not your cabinet \u2192 pretend it doesn't exist\r\n    return false;\r\n  }\r\n\r\n  // Best-effort cascade delete\r\n  await Promise.all(\r\n    items.map((item) =>\r\n      ddb.send(\r\n        new DeleteCommand({\r\n          TableName: TABLE_NAME,\r\n          Key: {\r\n            [PK]: item[PK],\r\n            [SK]: item[SK],\r\n          },\r\n        }),\r\n      ),\r\n    ),\r\n  );\r\n\r\n  return true;\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// FOLDERS\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function listFolders(sub: string, cabinetId: string) {\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n\r\n  // optional: check cabinet ownership\r\n  const cabinet = await getCabinet(sub, cabinetId);\r\n  if (!cabinet) {\r\n    // hide if not owner\r\n    return [];\r\n  }\r\n\r\n  const res = await ddb.send(\r\n    new QueryCommand({\r\n      TableName: TABLE_NAME,\r\n      KeyConditionExpression:\r\n        \"#pk = :pk AND begins_with(#sk, :prefix)\",\r\n      ExpressionAttributeNames: {\r\n        \"#pk\": PK,\r\n        \"#sk\": SK,\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":pk\": `CAB#${cabinetId}`,\r\n        \":prefix\": \"FOLDER#\",\r\n      },\r\n    }),\r\n  );\r\n\r\n  const items = res.Items ?? [];\r\n  return items.map(mapFolder);\r\n}\r\n\r\nasync function createFolder(sub: string, input: any) {\r\n  const { cabinetId, name } = input || {};\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n  if (!name) throw new Error(\"name is required\");\r\n\r\n  const cabinet = await getCabinet(sub, cabinetId);\r\n  if (!cabinet) {\r\n    throw new Error(\"Cabinet not found\");\r\n  }\r\n\r\n  const id = uuid();\r\n  const nowIso = now();\r\n\r\n  const item = {\r\n    [PK]: `CAB#${cabinetId}`,\r\n    [SK]: `FOLDER#${id}`,\r\n    type: \"FOLDER\",\r\n    id,\r\n    cabinetId,\r\n    ownerSub: sub,\r\n    name,\r\n    specialKind: null,\r\n    createdAt: nowIso,\r\n    updatedAt: nowIso,\r\n  };\r\n\r\n  await ddb.send(\r\n    new PutCommand({\r\n      TableName: TABLE_NAME,\r\n      Item: item,\r\n      ConditionExpression:\r\n        \"attribute_not_exists(#pk) AND attribute_not_exists(#sk)\",\r\n      ExpressionAttributeNames: {\r\n        \"#pk\": PK,\r\n        \"#sk\": SK,\r\n      },\r\n    }),\r\n  );\r\n\r\n  return mapFolder(item);\r\n}\r\n\r\nasync function renameFolder(sub: string, input: any) {\r\n  const { id, cabinetId, name } = input || {};\r\n  if (!id) throw new Error(\"id is required\");\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n  if (!name) throw new Error(\"name is required\");\r\n\r\n  const nowIso = now();\r\n\r\n  const res = await ddb.send(\r\n    new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: `FOLDER#${id}`,\r\n      },\r\n      UpdateExpression: \"SET #name = :name, #updatedAt = :updatedAt\",\r\n      ConditionExpression: \"#ownerSub = :ownerSub\",\r\n      ExpressionAttributeNames: {\r\n        \"#name\": \"name\",\r\n        \"#updatedAt\": \"updatedAt\",\r\n        \"#ownerSub\": \"ownerSub\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":name\": name,\r\n        \":updatedAt\": nowIso,\r\n        \":ownerSub\": sub,\r\n      },\r\n      ReturnValues: \"ALL_NEW\",\r\n    }),\r\n  );\r\n\r\n  return mapFolder(res.Attributes);\r\n}\r\n\r\nasync function deleteFolder(sub: string, id: string, cabinetId: string) {\r\n  if (!id) throw new Error(\"id is required\");\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n\r\n  // Delete the folder row (with ownership check)\r\n  await ddb.send(\r\n    new DeleteCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: `FOLDER#${id}`,\r\n      },\r\n      ConditionExpression: \"#ownerSub = :ownerSub\",\r\n      ExpressionAttributeNames: {\r\n        \"#ownerSub\": \"ownerSub\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":ownerSub\": sub,\r\n      },\r\n    }),\r\n  );\r\n\r\n  // Best-effort cleanup: move any assets in this folder to \"unsorted\" (null folderId)\r\n  const res = await ddb.send(\r\n    new QueryCommand({\r\n      TableName: TABLE_NAME,\r\n      KeyConditionExpression:\r\n        \"#pk = :pk AND begins_with(#sk, :prefix)\",\r\n      ExpressionAttributeNames: {\r\n        \"#pk\": PK,\r\n        \"#sk\": SK,\r\n        \"#folderId\": \"folderId\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":pk\": `CAB#${cabinetId}`,\r\n        \":prefix\": \"ASSET#\",\r\n        \":folderId\": id,\r\n      },\r\n      FilterExpression: \"#folderId = :folderId\",\r\n    }),\r\n  );\r\n\r\n  const assets = res.Items ?? [];\r\n  await Promise.all(\r\n    assets.map((asset) =>\r\n      ddb.send(\r\n        new UpdateCommand({\r\n          TableName: TABLE_NAME,\r\n          Key: {\r\n            [PK]: asset[PK],\r\n            [SK]: asset[SK],\r\n          },\r\n          UpdateExpression: \"SET #folderId = :null\",\r\n          ExpressionAttributeNames: {\r\n            \"#folderId\": \"folderId\",\r\n          },\r\n          ExpressionAttributeValues: {\r\n            \":null\": null,\r\n          },\r\n        }),\r\n      ),\r\n    ),\r\n  );\r\n\r\n  return true;\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// ASSETS \u2013 creator-facing\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function listAssets(sub: string, args: any) {\r\n  const {\r\n    cabinetId,\r\n    folderId,\r\n    category,\r\n    tag,\r\n    search,\r\n    limit = 50,\r\n    nextToken,\r\n  } = args || {};\r\n\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n\r\n  const cabinet = await getCabinet(sub, cabinetId);\r\n  if (!cabinet) {\r\n    // Hide if not owner\r\n    return {\r\n      items: [],\r\n      nextToken: null,\r\n    };\r\n  }\r\n\r\n  const queryInput: any = {\r\n    TableName: TABLE_NAME,\r\n    KeyConditionExpression:\r\n      \"#pk = :pk AND begins_with(#sk, :prefix)\",\r\n    ExpressionAttributeNames: {\r\n      \"#pk\": PK,\r\n      \"#sk\": SK,\r\n    },\r\n    ExpressionAttributeValues: {\r\n      \":pk\": `CAB#${cabinetId}`,\r\n      \":prefix\": \"ASSET#\",\r\n    },\r\n    Limit: limit,\r\n  };\r\n\r\n  if (nextToken) {\r\n    queryInput.ExclusiveStartKey = {\r\n      [PK]: `CAB#${cabinetId}`,\r\n      [SK]: nextToken,\r\n    };\r\n  }\r\n\r\n  const res = await ddb.send(new QueryCommand(queryInput));\r\n  let items = (res.Items ?? []).filter((it) => it.type === \"ASSET\");\r\n\r\n  // Hide moderated assets for the creator UI:\r\n  items = items.filter((it) => {\r\n    const status = String(it.moderationStatus ?? \"ACTIVE\").toUpperCase();\r\n    return status === \"ACTIVE\";\r\n  });\r\n\r\n  // In-memory filters\r\n  if (folderId !== undefined && folderId !== null) {\r\n    items = items.filter((it) => it.folderId === folderId);\r\n  }\r\n  if (category) {\r\n    items = items.filter((it) => it.category === category);\r\n  }\r\n  if (tag) {\r\n    items = items.filter(\r\n      (it) => Array.isArray(it.tags) && it.tags.includes(tag),\r\n    );\r\n  }\r\n  if (search) {\r\n    const q = String(search).toLowerCase();\r\n    items = items.filter((it) => {\r\n      const title = (it.title ?? \"\").toLowerCase();\r\n      const notes = (it.notes ?? \"\").toLowerCase();\r\n      return title.includes(q) || notes.includes(q);\r\n    });\r\n  }\r\n\r\n  const connectionNextToken =\r\n    res.LastEvaluatedKey ? res.LastEvaluatedKey[SK] : null;\r\n\r\n  return {\r\n    items: items.map(mapAsset),\r\n    nextToken: connectionNextToken,\r\n  };\r\n}\r\n\r\n// Upload flow\r\nasync function createAssetUpload(sub: string, input: any) {\r\n  const {\r\n    cabinetId,\r\n    folderId,\r\n    category,\r\n    title,\r\n    notes,\r\n    tags = [],\r\n    fileName,\r\n    filename, // tolerate old name\r\n    contentType,\r\n    kind,\r\n  } = input || {};\r\n\r\n  const finalFileName = fileName ?? filename;\r\n\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n  if (!finalFileName) throw new Error(\"fileName is required\");\r\n  if (!contentType) throw new Error(\"contentType is required\");\r\n\r\n  // Ensure cabinet exists + belongs to user\r\n  const cabinet = await getCabinet(sub, cabinetId);\r\n  if (!cabinet) {\r\n    throw new Error(\"Cabinet not found\");\r\n  }\r\n\r\n  const assetId = uuid();\r\n  const folderPart = folderId || \"unsorted\";\r\n  const safeName = String(finalFileName).replace(/[^a-zA-Z0-9._-]/g, \"_\");\r\n\r\n  const s3Key = [\r\n    \"creator-media\",\r\n    sub,\r\n    cabinetId,\r\n    folderPart,\r\n    `${assetId}-${safeName}`,\r\n  ].join(\"/\");\r\n\r\n  const nowIso = now();\r\n  const assetKind = kind ?? \"OTHER\";\r\n\r\n  const item = {\r\n    [PK]: `CAB#${cabinetId}`,\r\n    [SK]: `ASSET#${assetId}`,\r\n    type: \"ASSET\",\r\n    id: assetId,\r\n    cabinetId,\r\n    folderId: folderId ?? null,\r\n    ownerSub: sub,\r\n    kind: assetKind,\r\n    category: category ?? null,\r\n    title: title ?? null,\r\n    notes: notes ?? null,\r\n    tags,\r\n    s3Key,\r\n    contentType,\r\n    createdAt: nowIso,\r\n    updatedAt: nowIso,\r\n\r\n    // moderation defaults\r\n    moderationStatus: \"ACTIVE\" as const,\r\n    moderationReason: null,\r\n    moderatedBy: null,\r\n    moderatedAt: null,\r\n\r\n    // GSI for admin listing by user\r\n    gsi1pk: `CREATOR#${sub}`,\r\n    gsi1sk: `CAB_ASSET#${cabinetId}#${nowIso}#${assetId}`,\r\n  };\r\n\r\n  // 1) create ASSET row in Dynamo (pending upload)\r\n  await ddb.send(\r\n    new PutCommand({\r\n      TableName: TABLE_NAME,\r\n      Item: item,\r\n    }),\r\n  );\r\n\r\n  // Best-effort: bump cabinet.assetCount\r\n  await ddb.send(\r\n    new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: \"META\",\r\n      },\r\n      UpdateExpression:\r\n        \"SET #assetCount = if_not_exists(#assetCount, :zero) + :one, #updatedAt = :updatedAt\",\r\n      ExpressionAttributeNames: {\r\n        \"#assetCount\": \"assetCount\",\r\n        \"#updatedAt\": \"updatedAt\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":zero\": 0,\r\n        \":one\": 1,\r\n        \":updatedAt\": nowIso,\r\n      },\r\n    }),\r\n  );\r\n\r\n  // 2) make a presigned URL so the browser can PUT the file\r\n  const putCmd = new PutObjectCommand({\r\n    Bucket: CREATOR_MEDIA_BUCKET,\r\n    Key: s3Key,\r\n    ContentType: contentType,\r\n  });\r\n\r\n  const uploadUrl = await getSignedUrl(s3, putCmd, { expiresIn: 900 });\r\n\r\n  return {\r\n    uploadUrl,\r\n    asset: mapAsset(item),\r\n  };\r\n}\r\n\r\nasync function updateAsset(sub: string, input: any) {\r\n  const { id, cabinetId } = input || {};\r\n  if (!id) throw new Error(\"id is required\");\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n\r\n  const nowIso = now();\r\n\r\n  const names: Record<string, string> = {\r\n    \"#updatedAt\": \"updatedAt\",\r\n    \"#ownerSub\": \"ownerSub\",\r\n  };\r\n  const values: Record<string, any> = {\r\n    \":updatedAt\": nowIso,\r\n    \":ownerSub\": sub,\r\n  };\r\n  const sets: string[] = [\"#updatedAt = :updatedAt\"];\r\n\r\n  if (Object.prototype.hasOwnProperty.call(input, \"folderId\")) {\r\n    names[\"#folderId\"] = \"folderId\";\r\n    values[\":folderId\"] = input.folderId ?? null;\r\n    sets.push(\"#folderId = :folderId\");\r\n  }\r\n  if (Object.prototype.hasOwnProperty.call(input, \"category\")) {\r\n    names[\"#category\"] = \"category\";\r\n    values[\":category\"] = input.category ?? null;\r\n    sets.push(\"#category = :category\");\r\n  }\r\n  if (Object.prototype.hasOwnProperty.call(input, \"title\")) {\r\n    names[\"#title\"] = \"title\";\r\n    values[\":title\"] = input.title ?? null;\r\n    sets.push(\"#title = :title\");\r\n  }\r\n  if (Object.prototype.hasOwnProperty.call(input, \"notes\")) {\r\n    names[\"#notes\"] = \"notes\";\r\n    values[\":notes\"] = input.notes ?? null;\r\n    sets.push(\"#notes = :notes\");\r\n  }\r\n  if (Object.prototype.hasOwnProperty.call(input, \"tags\")) {\r\n    names[\"#tags\"] = \"tags\";\r\n    values[\":tags\"] = input.tags ?? [];\r\n    sets.push(\"#tags = :tags\");\r\n  }\r\n  if (Object.prototype.hasOwnProperty.call(input, \"kind\")) {\r\n    names[\"#kind\"] = \"kind\";\r\n    values[\":kind\"] = input.kind ?? \"OTHER\";\r\n    sets.push(\"#kind = :kind\");\r\n  }\r\n  if (Object.prototype.hasOwnProperty.call(input, \"contentType\")) {\r\n    names[\"#contentType\"] = \"contentType\";\r\n    values[\":contentType\"] = input.contentType ?? null;\r\n    sets.push(\"#contentType = :contentType\");\r\n  }\r\n\r\n  const res = await ddb.send(\r\n    new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: `ASSET#${id}`,\r\n      },\r\n      UpdateExpression: \"SET \" + sets.join(\", \"),\r\n      ConditionExpression: \"#ownerSub = :ownerSub\",\r\n      ExpressionAttributeNames: names,\r\n      ExpressionAttributeValues: values,\r\n      ReturnValues: \"ALL_NEW\",\r\n    }),\r\n  );\r\n\r\n  return mapAsset(res.Attributes);\r\n}\r\n\r\nasync function deleteAsset(sub: string, id: string, cabinetId: string) {\r\n  if (!id) throw new Error(\"id is required\");\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n\r\n  const nowIso = now();\r\n\r\n  // 1) Delete the asset row with ownership check\r\n  await ddb.send(\r\n    new DeleteCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: `ASSET#${id}`,\r\n      },\r\n      ConditionExpression: \"#ownerSub = :ownerSub\",\r\n      ExpressionAttributeNames: {\r\n        \"#ownerSub\": \"ownerSub\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":ownerSub\": sub,\r\n      },\r\n    }),\r\n  );\r\n\r\n  // 2) Best-effort: decrement assetCount\r\n  await ddb.send(\r\n    new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: \"META\",\r\n      },\r\n      UpdateExpression:\r\n        \"SET #assetCount = if_not_exists(#assetCount, :zero) - :one, #updatedAt = :updatedAt\",\r\n      ExpressionAttributeNames: {\r\n        \"#assetCount\": \"assetCount\",\r\n        \"#updatedAt\": \"updatedAt\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":zero\": 0,\r\n        \":one\": 1,\r\n        \":updatedAt\": nowIso,\r\n      },\r\n    }),\r\n  );\r\n\r\n  return true;\r\n}\r\n\r\nasync function moveAsset(sub: string, input: any) {\r\n  const { id, cabinetId, destinationFolderId } = input || {};\r\n  if (!id) throw new Error(\"id is required\");\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n\r\n  const nowIso = now();\r\n\r\n  const res = await ddb.send(\r\n    new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: `ASSET#${id}`,\r\n      },\r\n      UpdateExpression:\r\n        \"SET #folderId = :folderId, #updatedAt = :updatedAt\",\r\n      ConditionExpression: \"#ownerSub = :ownerSub\",\r\n      ExpressionAttributeNames: {\r\n        \"#folderId\": \"folderId\",\r\n        \"#updatedAt\": \"updatedAt\",\r\n        \"#ownerSub\": \"ownerSub\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":folderId\": destinationFolderId ?? null,\r\n        \":updatedAt\": nowIso,\r\n        \":ownerSub\": sub,\r\n      },\r\n      ReturnValues: \"ALL_NEW\",\r\n    }),\r\n  );\r\n\r\n  return mapAsset(res.Attributes);\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// ASSETS \u2013 admin listing / moderation\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function adminListCreatorAssetsByUser(args: any) {\r\n  const {\r\n    ownerSub,\r\n    cabinetId,\r\n    folderId,\r\n    moderationStatus,\r\n    includeSoftDeleted = true,\r\n    limit = 50,\r\n    // nextToken planned later\r\n  } = args || {};\r\n\r\n  if (!ownerSub) throw new Error(\"ownerSub is required\");\r\n\r\n  const res = await ddb.send(\r\n    new QueryCommand({\r\n      TableName: TABLE_NAME,\r\n      IndexName: STATUS_GSI,\r\n      KeyConditionExpression:\r\n        \"#gpk = :gpk AND begins_with(#gsk, :prefix)\",\r\n      ExpressionAttributeNames: {\r\n        \"#gpk\": \"gsi1pk\",\r\n        \"#gsk\": \"gsi1sk\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":gpk\": `CREATOR#${ownerSub}`,\r\n        \":prefix\": \"CAB_ASSET#\",\r\n      },\r\n      Limit: limit,\r\n    }),\r\n  );\r\n\r\n  let items = (res.Items ?? []).filter((it) => it.type === \"ASSET\");\r\n\r\n  if (cabinetId) {\r\n    items = items.filter((it) => it.cabinetId === cabinetId);\r\n  }\r\n  if (folderId !== undefined && folderId !== null) {\r\n    items = items.filter((it) => it.folderId === folderId);\r\n  }\r\n\r\n  if (moderationStatus) {\r\n    const wanted = String(moderationStatus).toUpperCase();\r\n    items = items.filter(\r\n      (it) =>\r\n        String(it.moderationStatus ?? \"ACTIVE\").toUpperCase() === wanted,\r\n    );\r\n  }\r\n\r\n  if (!includeSoftDeleted) {\r\n    items = items.filter(\r\n      (it) =>\r\n        String(it.moderationStatus ?? \"ACTIVE\").toUpperCase() !==\r\n        \"SOFT_DELETED\",\r\n    );\r\n  }\r\n\r\n  return {\r\n    items: items.map(mapAsset),\r\n    nextToken: null, // simple for now; can add JSON-encoded LastEvaluatedKey later\r\n  };\r\n}\r\n\r\nasync function adminGetCreatorAsset(args: any) {\r\n  const { cabinetId, id } = args || {};\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n  if (!id) throw new Error(\"id is required\");\r\n\r\n  const res = await ddb.send(\r\n    new GetCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: `ASSET#${id}`,\r\n      },\r\n    }),\r\n  );\r\n\r\n  if (!res.Item || res.Item.type !== \"ASSET\") {\r\n    return null;\r\n  }\r\n\r\n  return mapAsset(res.Item);\r\n}\r\n\r\nasync function adminModerateCreatorAsset(adminSub: string, input: any) {\r\n  const { cabinetId, id, moderationStatus, moderationReason, tags } =\r\n    input || {};\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n  if (!id) throw new Error(\"id is required\");\r\n  if (!moderationStatus) throw new Error(\"moderationStatus is required\");\r\n\r\n  const nowIso = now();\r\n\r\n  const names: Record<string, string> = {\r\n    \"#moderationStatus\": \"moderationStatus\",\r\n    \"#updatedAt\": \"updatedAt\",\r\n    \"#moderatedAt\": \"moderatedAt\",\r\n    \"#moderatedBy\": \"moderatedBy\",\r\n  };\r\n  const values: Record<string, any> = {\r\n    \":moderationStatus\": moderationStatus,\r\n    \":updatedAt\": nowIso,\r\n    \":moderatedAt\": nowIso,\r\n    \":moderatedBy\": adminSub,\r\n  };\r\n  const sets: string[] = [\r\n    \"#moderationStatus = :moderationStatus\",\r\n    \"#updatedAt = :updatedAt\",\r\n    \"#moderatedAt = :moderatedAt\",\r\n    \"#moderatedBy = :moderatedBy\",\r\n  ];\r\n\r\n  if (Object.prototype.hasOwnProperty.call(input, \"moderationReason\")) {\r\n    names[\"#moderationReason\"] = \"moderationReason\";\r\n    values[\":moderationReason\"] = moderationReason ?? null;\r\n    sets.push(\"#moderationReason = :moderationReason\");\r\n  }\r\n\r\n  if (Array.isArray(tags)) {\r\n    names[\"#tags\"] = \"tags\";\r\n    values[\":tags\"] = tags;\r\n    sets.push(\"#tags = :tags\");\r\n  }\r\n\r\n  const res = await ddb.send(\r\n    new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: `ASSET#${id}`,\r\n      },\r\n      UpdateExpression: \"SET \" + sets.join(\", \"),\r\n      ReturnValues: \"ALL_NEW\",\r\n    }),\r\n  );\r\n\r\n  return mapAsset(res.Attributes);\r\n}\r\n\r\nasync function adminRejectCreatorAsset(adminSub: string, input: any) {\r\n  if (!input) throw new Error(\"input is required\");\r\n  const { cabinetId, id, moderationReason, tags } = input;\r\n\r\n  return adminModerateCreatorAsset(adminSub, {\r\n    cabinetId,\r\n    id,\r\n    moderationStatus: \"REJECTED\",\r\n    moderationReason,\r\n    tags,\r\n  });\r\n}\r\n\r\nasync function adminSoftDeleteCreatorAsset(adminSub: string, input: any) {\r\n  const { cabinetId, id, reason } = input || {};\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n  if (!id) throw new Error(\"id is required\");\r\n\r\n  const nowIso = now();\r\n\r\n  const res = await ddb.send(\r\n    new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: `ASSET#${id}`,\r\n      },\r\n      UpdateExpression:\r\n        \"SET #moderationStatus = :status, #moderationReason = :reason, #moderatedBy = :moderatedBy, #moderatedAt = :moderatedAt, #updatedAt = :updatedAt\",\r\n      ExpressionAttributeNames: {\r\n        \"#moderationStatus\": \"moderationStatus\",\r\n        \"#moderationReason\": \"moderationReason\",\r\n        \"#moderatedBy\": \"moderatedBy\",\r\n        \"#moderatedAt\": \"moderatedAt\",\r\n        \"#updatedAt\": \"updatedAt\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":status\": \"SOFT_DELETED\",\r\n        \":reason\": reason ?? null,\r\n        \":moderatedBy\": adminSub,\r\n        \":moderatedAt\": nowIso,\r\n        \":updatedAt\": nowIso,\r\n      },\r\n      ReturnValues: \"ALL_NEW\",\r\n    }),\r\n  );\r\n\r\n  return mapAsset(res.Attributes);\r\n}\r\n\r\nasync function adminRestoreCreatorAsset(adminSub: string, input: any) {\r\n  const { cabinetId, id } = input || {};\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n  if (!id) throw new Error(\"id is required\");\r\n\r\n  const nowIso = now();\r\n\r\n  const res = await ddb.send(\r\n    new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: `ASSET#${id}`,\r\n      },\r\n      UpdateExpression:\r\n        \"SET #moderationStatus = :status, #moderationReason = :reason, #moderatedBy = :moderatedBy, #moderatedAt = :moderatedAt, #updatedAt = :updatedAt\",\r\n      ExpressionAttributeNames: {\r\n        \"#moderationStatus\": \"moderationStatus\",\r\n        \"#moderationReason\": \"moderationReason\",\r\n        \"#moderatedBy\": \"moderatedBy\",\r\n        \"#moderatedAt\": \"moderatedAt\",\r\n        \"#updatedAt\": \"updatedAt\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":status\": \"ACTIVE\",\r\n        \":reason\": null,\r\n        \":moderatedBy\": adminSub,\r\n        \":moderatedAt\": nowIso,\r\n        \":updatedAt\": nowIso,\r\n      },\r\n      ReturnValues: \"ALL_NEW\",\r\n    }),\r\n  );\r\n\r\n  return mapAsset(res.Attributes);\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// CREATOR GOAL COMPASS\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nfunction defaultGoalCompass() {\r\n  return {\r\n    primaryGoal: \"GROWTH\",\r\n    timeHorizon: \"90_DAYS\",\r\n    weeklyCapacity: 5,\r\n    focusAreas: [\"PERSONALITY\", \"NURTURE\"],\r\n    riskTolerance: \"MEDIUM\",\r\n    notes: null,\r\n    updatedAt: null,\r\n  };\r\n}\r\n\r\nasync function getCreatorGoalCompass(sub: string) {\r\n  const res = await ddb.send(\r\n    new GetCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CREATOR#${sub}`,\r\n        [SK]: \"GOAL_COMPASS\",\r\n      },\r\n    }),\r\n  );\r\n\r\n  if (!res.Item) {\r\n    // no record yet -> return defaults (client can still save)\r\n    return defaultGoalCompass();\r\n  }\r\n\r\n  const it = res.Item;\r\n\r\n  return {\r\n    primaryGoal: it.primaryGoal ?? \"GROWTH\",\r\n    timeHorizon: it.timeHorizon ?? \"90_DAYS\",\r\n    weeklyCapacity:\r\n      typeof it.weeklyCapacity === \"number\" ? it.weeklyCapacity : 5,\r\n    focusAreas:\r\n      Array.isArray(it.focusAreas) && it.focusAreas.length\r\n        ? it.focusAreas\r\n        : [\"PERSONALITY\", \"NURTURE\"],\r\n    riskTolerance: it.riskTolerance ?? \"MEDIUM\",\r\n    notes: it.notes ?? null,\r\n    updatedAt: it.updatedAt ?? null,\r\n  };\r\n}\r\n\r\nasync function updateCreatorGoalCompass(sub: string, input: any) {\r\n  if (!input) throw new Error(\"input is required\");\r\n\r\n  const nowIso = now();\r\n\r\n  // We treat this as an upsert that overwrites the current compass.\r\n  const item = {\r\n    [PK]: `CREATOR#${sub}`,\r\n    [SK]: \"GOAL_COMPASS\",\r\n    type: \"CREATOR_GOAL_COMPASS\",\r\n\r\n    primaryGoal: input.primaryGoal ?? \"GROWTH\",\r\n    timeHorizon: input.timeHorizon ?? \"90_DAYS\",\r\n    weeklyCapacity:\r\n      typeof input.weeklyCapacity === \"number\"\r\n        ? input.weeklyCapacity\r\n        : 5,\r\n    focusAreas:\r\n      Array.isArray(input.focusAreas) && input.focusAreas.length\r\n        ? input.focusAreas\r\n        : [\"PERSONALITY\", \"NURTURE\"],\r\n    riskTolerance: input.riskTolerance ?? \"MEDIUM\",\r\n    notes: input.notes ?? null,\r\n    updatedAt: nowIso,\r\n  };\r\n\r\n  await ddb.send(\r\n    new PutCommand({\r\n      TableName: TABLE_NAME,\r\n      Item: item,\r\n    }),\r\n  );\r\n\r\n  return {\r\n    primaryGoal: item.primaryGoal,\r\n    timeHorizon: item.timeHorizon,\r\n    weeklyCapacity: item.weeklyCapacity,\r\n    focusAreas: item.focusAreas,\r\n    riskTolerance: item.riskTolerance,\r\n    notes: item.notes,\r\n    updatedAt: item.updatedAt,\r\n  };\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// IMPORT FROM CLOSET \u2192 CABINET\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function importClosetItemToCabinet(sub: string, input: any) {\r\n  const {\r\n    closetItemId,\r\n    cabinetId,\r\n    folderId,\r\n    kind,\r\n    title,\r\n    notes,\r\n    tags = [],\r\n  } = input || {};\r\n\r\n  if (!closetItemId) throw new Error(\"closetItemId is required\");\r\n  if (!cabinetId) throw new Error(\"cabinetId is required\");\r\n\r\n  // 1) Ensure target cabinet belongs to this user\r\n  const cabinet = await getCabinet(sub, cabinetId);\r\n  if (!cabinet) {\r\n    throw new Error(\"Cabinet not found\");\r\n  }\r\n\r\n  // 2) Look up the closet item.\r\n  //\r\n  // NOTE: This assumes closet items are keyed by:\r\n  //   pk = `CLOSET#${sub}`\r\n  //   sk = `ITEM#${closetItemId}`\r\n  //\r\n  // If your actual pattern is different, adjust PK/SK accordingly.\r\n  const closetRes = await ddb.send(\r\n    new GetCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CLOSET#${sub}`,\r\n        [SK]: `ITEM#${closetItemId}`,\r\n      },\r\n    }),\r\n  );\r\n\r\n  const closetItem = closetRes.Item;\r\n  if (!closetItem || closetItem.ownerSub !== sub) {\r\n    throw new Error(\"Closet item not found\");\r\n  }\r\n\r\n  const assetId = uuid();\r\n  const nowIso = now();\r\n\r\n  // Reuse the existing closet media key if possible.\r\n  const s3Key =\r\n    (closetItem as any).mediaKey ||\r\n    (closetItem as any).rawMediaKey ||\r\n    (() => {\r\n      throw new Error(\"Closet item has no media key\");\r\n    })();\r\n\r\n  const assetKind = kind ?? \"PHOTO\";\r\n  const finalTitle = title ?? (closetItem as any).title ?? null;\r\n  const finalNotes = notes ?? (closetItem as any).notes ?? null;\r\n  const finalTags =\r\n    tags.length ? tags : (closetItem as any).colorTags ?? [];\r\n\r\n  const item = {\r\n    [PK]: `CAB#${cabinetId}`,\r\n    [SK]: `ASSET#${assetId}`,\r\n    type: \"ASSET\",\r\n    id: assetId,\r\n    cabinetId,\r\n    folderId: folderId ?? null,\r\n    ownerSub: sub,\r\n    kind: assetKind,\r\n    category: \"OUTFIT_REFS\",\r\n    title: finalTitle,\r\n    notes: finalNotes,\r\n    tags: finalTags,\r\n    s3Key,\r\n    contentType: (closetItem as any).contentType ?? \"image/jpeg\",\r\n    createdAt: nowIso,\r\n    updatedAt: nowIso,\r\n    sourceClosetItemId: closetItemId,\r\n\r\n    // moderation defaults\r\n    moderationStatus: \"ACTIVE\" as const,\r\n    moderationReason: null,\r\n    moderatedBy: null,\r\n    moderatedAt: null,\r\n\r\n    // GSI for admin listing by user\r\n    gsi1pk: `CREATOR#${sub}`,\r\n    gsi1sk: `CAB_ASSET#${cabinetId}#${nowIso}#${assetId}`,\r\n  };\r\n\r\n  await ddb.send(\r\n    new PutCommand({\r\n      TableName: TABLE_NAME,\r\n      Item: item,\r\n    }),\r\n  );\r\n\r\n  // Best-effort bump cabinet assetCount\r\n  await ddb.send(\r\n    new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: {\r\n        [PK]: `CAB#${cabinetId}`,\r\n        [SK]: \"META\",\r\n      },\r\n      UpdateExpression:\r\n        \"SET #assetCount = if_not_exists(#assetCount, :zero) + :one, #updatedAt = :updatedAt\",\r\n      ExpressionAttributeNames: {\r\n        \"#assetCount\": \"assetCount\",\r\n        \"#updatedAt\": \"updatedAt\",\r\n      },\r\n      ExpressionAttributeValues: {\r\n        \":zero\": 0,\r\n        \":one\": 1,\r\n        \":updatedAt\": nowIso,\r\n      },\r\n    }),\r\n  );\r\n\r\n  return mapAsset(item);\r\n}\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// AI \u2013 stubbed (safe, no Bedrock needed)\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function runCreatorAi(event: any) {\r\n  const text: string = event.arguments?.text ?? \"\";\r\n  const kind: string = event.arguments?.kind ?? \"OTHER\";\r\n\r\n  const base = text || \"your content\";\r\n  const suggestions: string[] = [];\r\n\r\n  if (kind === \"CAPTION\") {\r\n    suggestions.push(\r\n      `Behind the scenes of ${base} \u2728`,\r\n      `Styling ${base} so you don't have to \uD83D\uDC85`,\r\n    );\r\n  } else if (kind === \"HASHTAGS\") {\r\n    suggestions.push(\r\n      \"#stylingadventures #creatorlife #behindthescenes\",\r\n      \"#outfitinspo #contentcreator #filmingday\",\r\n    );\r\n  } else {\r\n    suggestions.push(`Planning ideas for ${base}`);\r\n  }\r\n\r\n  return { suggestions };\r\n}\r\n", "import validate from './validate.js';\nconst byteToHex = [];\nfor (let i = 0; i < 256; ++i) {\n    byteToHex.push((i + 0x100).toString(16).slice(1));\n}\nexport function unsafeStringify(arr, offset = 0) {\n    return (byteToHex[arr[offset + 0]] +\n        byteToHex[arr[offset + 1]] +\n        byteToHex[arr[offset + 2]] +\n        byteToHex[arr[offset + 3]] +\n        '-' +\n        byteToHex[arr[offset + 4]] +\n        byteToHex[arr[offset + 5]] +\n        '-' +\n        byteToHex[arr[offset + 6]] +\n        byteToHex[arr[offset + 7]] +\n        '-' +\n        byteToHex[arr[offset + 8]] +\n        byteToHex[arr[offset + 9]] +\n        '-' +\n        byteToHex[arr[offset + 10]] +\n        byteToHex[arr[offset + 11]] +\n        byteToHex[arr[offset + 12]] +\n        byteToHex[arr[offset + 13]] +\n        byteToHex[arr[offset + 14]] +\n        byteToHex[arr[offset + 15]]).toLowerCase();\n}\nfunction stringify(arr, offset = 0) {\n    const uuid = unsafeStringify(arr, offset);\n    if (!validate(uuid)) {\n        throw TypeError('Stringified UUID is invalid');\n    }\n    return uuid;\n}\nexport default stringify;\n", "import { randomFillSync } from 'crypto';\nconst rnds8Pool = new Uint8Array(256);\nlet poolPtr = rnds8Pool.length;\nexport default function rng() {\n    if (poolPtr > rnds8Pool.length - 16) {\n        randomFillSync(rnds8Pool);\n        poolPtr = 0;\n    }\n    return rnds8Pool.slice(poolPtr, (poolPtr += 16));\n}\n", "import { randomUUID } from 'crypto';\nexport default { randomUUID };\n", "import native from './native.js';\nimport rng from './rng.js';\nimport { unsafeStringify } from './stringify.js';\nfunction v4(options, buf, offset) {\n    if (native.randomUUID && !buf && !options) {\n        return native.randomUUID();\n    }\n    options = options || {};\n    const rnds = options.random ?? options.rng?.() ?? rng();\n    if (rnds.length < 16) {\n        throw new Error('Random bytes length must be >= 16');\n    }\n    rnds[6] = (rnds[6] & 0x0f) | 0x40;\n    rnds[8] = (rnds[8] & 0x3f) | 0x80;\n    if (buf) {\n        offset = offset || 0;\n        if (offset < 0 || offset + 16 > buf.length) {\n            throw new RangeError(`UUID byte range ${offset}:${offset + 15} is out of buffer bounds`);\n        }\n        for (let i = 0; i < 16; ++i) {\n            buf[offset + i] = rnds[i];\n        }\n        return buf;\n    }\n    return unsafeStringify(rnds);\n}\nexport default v4;\n"],
  "mappings": "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",
  "names": ["index_exports", "__export", "handler", "__toCommonJS", "import_client_dynamodb", "import_lib_dynamodb", "byteToHex", "i", "unsafeStringify", "arr", "offset", "import_crypto", "rnds8Pool", "poolPtr", "rng", "import_crypto", "native_default", "v4", "options", "buf", "offset", "native_default", "rnds", "rng", "i", "unsafeStringify", "v4_default", "import_client_s3", "import_s3_request_presigner", "ddb", "s3", "TABLE_NAME", "CREATOR_MEDIA_BUCKET", "PK", "SK", "STATUS_GSI", "now", "creatorRevenueByPlatformResolver", "event", "window", "days", "currency", "platforms", "platformTotal", "sum", "p", "today", "timeseries", "_", "i", "d", "base", "variance", "totalRevenue", "getDirectorShootPlan", "sub", "id", "pk", "sk", "res", "item", "saveDirectorShootPlan", "input", "nowIso", "handler", "field", "args", "listCabinets", "getCabinet", "createCabinet", "updateCabinet", "deleteCabinet", "listFolders", "createFolder", "renameFolder", "deleteFolder", "listAssets", "createAssetUpload", "updateAsset", "deleteAsset", "moveAsset", "importClosetItemToCabinet", "adminListCreatorAssetsByUser", "adminGetCreatorAsset", "adminModerateCreatorAsset", "adminSoftDeleteCreatorAsset", "adminRestoreCreatorAsset", "adminRejectCreatorAsset", "getCreatorGoalCompass", "updateCreatorGoalCompass", "runCreatorAi", "mapCabinet", "mapFolder", "mapAsset", "items", "createDefaultCabinetForCreator", "v4_default", "names", "values", "sets", "pkValue", "meta", "it", "cabinetId", "name", "assets", "asset", "folderId", "category", "tag", "search", "limit", "nextToken", "queryInput", "q", "title", "notes", "connectionNextToken", "tags", "fileName", "filename", "contentType", "kind", "finalFileName", "assetId", "folderPart", "safeName", "s3Key", "assetKind", "putCmd", "destinationFolderId", "ownerSub", "moderationStatus", "includeSoftDeleted", "wanted", "adminSub", "moderationReason", "reason", "defaultGoalCompass", "closetItemId", "closetItem", "finalTitle", "finalNotes", "finalTags", "text", "suggestions"]
}
