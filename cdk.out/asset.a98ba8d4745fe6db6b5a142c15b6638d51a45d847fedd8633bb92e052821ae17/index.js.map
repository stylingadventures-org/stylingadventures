{
  "version": 3,
  "sources": ["../../lambda/bestie/index.ts"],
  "sourcesContent": ["// lambda/bestie/index.ts\r\nimport {\r\n  CognitoIdentityProviderClient,\r\n  ListUsersCommand,\r\n} from \"@aws-sdk/client-cognito-identity-provider\";\r\nimport { DynamoDBClient } from \"@aws-sdk/client-dynamodb\";\r\nimport {\r\n  DynamoDBDocumentClient,\r\n  GetCommand,\r\n  UpdateCommand,\r\n} from \"@aws-sdk/lib-dynamodb\";\r\nimport type { AppSyncIdentityCognito } from \"aws-lambda\";\r\nimport Stripe from \"stripe\";\r\n\r\nconst { USER_POOL_ID = \"\", TABLE_NAME = \"\" } = process.env;\r\nif (!TABLE_NAME) throw new Error(\"Missing env TABLE_NAME\");\r\nif (!USER_POOL_ID) throw new Error(\"Missing env USER_POOL_ID\");\r\n\r\n// Stripe (checked lazily per-request so non-Stripe paths still work)\r\nconst STRIPE_SECRET_KEY = process.env.STRIPE_SECRET_KEY || \"\";\r\nconst STRIPE_PRICE_ID = process.env.STRIPE_PRICE_ID || \"\";\r\nconst BASE_SUCCESS_URL = (process.env.BASE_SUCCESS_URL || \"http://localhost:5173\").replace(/\\/$/, \"\");\r\n\r\nconst cognito = new CognitoIdentityProviderClient({});\r\nconst ddb = DynamoDBDocumentClient.from(new DynamoDBClient({}), {\r\n  marshallOptions: { removeUndefinedValues: true },\r\n});\r\n\r\ntype SAId =\r\n  | (AppSyncIdentityCognito & {\r\n      groups?: string[] | null;\r\n    })\r\n  | null\r\n  | undefined;\r\n\r\nconst PK = (sub: string) => `USER#${sub}`;\r\nconst SK_BESTIE = \"BESTIE\";\r\n\r\n/** Load current Bestie status from DDB. */\r\nasync function loadBestie(sub: string) {\r\n  const r = await ddb.send(\r\n    new GetCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: { pk: PK(sub), sk: SK_BESTIE },\r\n    })\r\n  );\r\n  const i = (r.Item as any) ?? {};\r\n  return {\r\n    active: !!i.active,\r\n    since: (i.since as string) ?? null,\r\n    until: (i.until as string) ?? null,\r\n    source: (i.source as string) ?? null,\r\n  };\r\n}\r\n\r\n/** Upsert Bestie status. */\r\nasync function saveBestie(\r\n  sub: string,\r\n  patch: { active: boolean; since?: string | null; until?: string | null; source?: string | null }\r\n) {\r\n  const now = new Date().toISOString();\r\n\r\n  // ensure document exists (optional bootstrap)\r\n  await ddb.send(\r\n    new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: { pk: PK(sub), sk: SK_BESTIE },\r\n      UpdateExpression: \"SET #doc = if_not_exists(#doc, :empty), updatedAt = :now\",\r\n      ExpressionAttributeNames: { \"#doc\": \"doc\" },\r\n      ExpressionAttributeValues: { \":empty\": {}, \":now\": now },\r\n    })\r\n  );\r\n\r\n  // apply the patch\r\n  await ddb.send(\r\n    new UpdateCommand({\r\n      TableName: TABLE_NAME,\r\n      Key: { pk: PK(sub), sk: SK_BESTIE },\r\n      UpdateExpression:\r\n        \"SET active = :a, since = if_not_exists(since, :since), until = :u, source = :s, updatedAt = :now\",\r\n      ExpressionAttributeValues: {\r\n        \":a\": patch.active,\r\n        \":since\": patch.since ?? now,\r\n        \":u\": patch.until ?? null,\r\n        \":s\": patch.source ?? null,\r\n        \":now\": now,\r\n      },\r\n    })\r\n  );\r\n\r\n  return loadBestie(sub);\r\n}\r\n\r\n/** Helper: find sub by email when admin sets bestie by email. */\r\nasync function lookupSubByEmail(email: string) {\r\n  const res = await cognito.send(\r\n    new ListUsersCommand({\r\n      UserPoolId: USER_POOL_ID,\r\n      Filter: `email = \"${email}\"`,\r\n      Limit: 1,\r\n    })\r\n  );\r\n  const user = res.Users?.[0];\r\n  if (!user?.Attributes) return null;\r\n  const subAttr = user.Attributes.find((a) => a.Name === \"sub\");\r\n  return subAttr?.Value ?? null;\r\n}\r\n\r\nfunction isAdmin(id: SAId) {\r\n  const g = (id as any)?.groups;\r\n  return Array.isArray(g) && g.includes(\"ADMIN\");\r\n}\r\n\r\nexport const handler = async (event: any) => {\r\n  const id = event.identity as SAId;\r\n  const fn = event.info?.fieldName as string;\r\n\r\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n  // Bestie checkout (Stripe)\r\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n  if (fn === \"startBestieCheckout\") {\r\n    const identity = event.identity as AppSyncIdentityCognito | undefined;\r\n    if (!identity?.sub) throw new Error(\"Unauthorized\");\r\n\r\n    if (!STRIPE_SECRET_KEY || !STRIPE_PRICE_ID) {\r\n      throw new Error(\"Stripe not configured\");\r\n    }\r\n\r\n    // Use the SDK\u2019s current version literal to satisfy TS\r\n    const stripe = new Stripe(STRIPE_SECRET_KEY);\r\n    \r\n\r\n    const successPath: string = event.arguments?.successPath ?? \"/bestie/thanks\";\r\n    const successUrl = `${BASE_SUCCESS_URL}${successPath}`;\r\n    const cancelUrl = `${BASE_SUCCESS_URL}/bestie?cancelled=1`;\r\n\r\n    const session = await stripe.checkout.sessions.create({\r\n      mode: \"subscription\",\r\n      line_items: [{ price: STRIPE_PRICE_ID, quantity: 1 }],\r\n      success_url: `${successUrl}?session_id={CHECKOUT_SESSION_ID}`,\r\n      cancel_url: cancelUrl,\r\n      client_reference_id: identity.sub,\r\n      customer_email: (identity as any)?.claims?.email,\r\n      metadata: { sub: identity.sub, email: (identity as any)?.claims?.email ?? \"\" },\r\n      allow_promotion_codes: true,\r\n    });\r\n\r\n    if (!session.url) throw new Error(\"No checkout URL from Stripe\");\r\n    return { url: session.url };\r\n  }\r\n\r\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n  // Query: meBestieStatus\r\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n  if (fn === \"meBestieStatus\") {\r\n    if (!id?.sub) throw new Error(\"Unauthorized\");\r\n    return loadBestie(id.sub);\r\n  }\r\n\r\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n  // Query: isEpisodeEarlyAccess(id)\r\n  // Rule: Bestie is active && until > now\r\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n  if (fn === \"isEpisodeEarlyAccess\") {\r\n    const now = Date.now();\r\n    const sub = id?.sub;\r\n    if (!sub) return { allowed: false, reason: \"not_signed_in\" };\r\n    const b = await loadBestie(sub);\r\n    const untilMs = b.until ? Date.parse(b.until) : 0;\r\n    const allowed = b.active && untilMs > now;\r\n    return { allowed, reason: allowed ? null : \"not_bestie\" };\r\n  }\r\n\r\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n  // Mutation: claimBestieTrial (7 days)\r\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n  if (fn === \"claimBestieTrial\") {\r\n    if (!id?.sub) throw new Error(\"Unauthorized\");\r\n    const current = await loadBestie(id.sub);\r\n\r\n    // If already active with a future-until, just return\r\n    if (current.active && current.until && Date.parse(current.until) > Date.now()) {\r\n      return current;\r\n    }\r\n    // If they already had a trial, do not re-grant\r\n    if (current.source === \"TRIAL\") {\r\n      return current;\r\n    }\r\n\r\n    const sevenDays = 7 * 24 * 60 * 60 * 1000;\r\n    const until = new Date(Date.now() + sevenDays).toISOString();\r\n    return saveBestie(id.sub, { active: true, until, source: \"TRIAL\" });\r\n  }\r\n\r\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n  // Admin helpers (require ADMIN group)\r\n  // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n  if (fn === \"adminSetBestie\") {\r\n    if (!isAdmin(id)) throw new Error(\"Forbidden\");\r\n    const { userSub, active } = event.arguments as { userSub: string; active: boolean };\r\n    const until = active ? new Date(Date.now() + 365 * 24 * 60 * 60 * 1000).toISOString() : null;\r\n    return saveBestie(userSub, { active: !!active, until, source: \"ADMIN\" });\r\n  }\r\n\r\n  if (fn === \"adminRevokeBestie\") {\r\n    if (!isAdmin(id)) throw new Error(\"Forbidden\");\r\n    const { userSub } = event.arguments as { userSub: string };\r\n    return saveBestie(userSub, { active: false, until: null, source: \"ADMIN\" });\r\n  }\r\n\r\n  if (fn === \"adminSetBestieByEmail\") {\r\n    if (!isAdmin(id)) throw new Error(\"Forbidden\");\r\n    const { email, active } = event.arguments as { email: string; active: boolean };\r\n    const sub = await lookupSubByEmail(email);\r\n    if (!sub) throw new Error(\"User not found\");\r\n    const until = active ? new Date(Date.now() + 365 * 24 * 60 * 60 * 1000).toISOString() : null;\r\n    return saveBestie(sub, { active: !!active, until, source: \"ADMIN_EMAIL\" });\r\n  }\r\n\r\n  if (fn === \"adminRevokeBestieByEmail\") {\r\n    if (!isAdmin(id)) throw new Error(\"Forbidden\");\r\n    const { email } = event.arguments as { email: string };\r\n    const sub = await lookupSubByEmail(email);\r\n    if (!sub) throw new Error(\"User not found\");\r\n    return saveBestie(sub, { active: false, until: null, source: \"ADMIN_EMAIL\" });\r\n  }\r\n\r\n  throw new Error(`Unknown field ${fn}`);\r\n};\r\n\r\n"],
  "mappings": "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",
  "names": ["index_exports", "__export", "handler", "__toCommonJS", "import_client_cognito_identity_provider", "import_client_dynamodb", "import_lib_dynamodb", "import_stripe", "USER_POOL_ID", "TABLE_NAME", "STRIPE_SECRET_KEY", "STRIPE_PRICE_ID", "BASE_SUCCESS_URL", "cognito", "ddb", "PK", "sub", "SK_BESTIE", "loadBestie", "i", "saveBestie", "patch", "now", "lookupSubByEmail", "email", "user", "a", "isAdmin", "id", "g", "event", "fn", "identity", "stripe", "Stripe", "successPath", "successUrl", "cancelUrl", "session", "b", "untilMs", "allowed", "current", "sevenDays", "until", "userSub", "active"]
}
