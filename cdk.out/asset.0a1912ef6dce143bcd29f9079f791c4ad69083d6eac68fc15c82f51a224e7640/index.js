"use strict";var u=Object.defineProperty;var g=Object.getOwnPropertyDescriptor;var f=Object.getOwnPropertyNames;var y=Object.prototype.hasOwnProperty;var A=(e,n)=>{for(var t in n)u(e,t,{get:n[t],enumerable:!0})},p=(e,n,t,r)=>{if(n&&typeof n=="object"||typeof n=="function")for(let s of f(n))!y.call(e,s)&&s!==t&&u(e,s,{get:()=>n[s],enumerable:!(r=g(n,s))||r.enumerable});return e};var C=e=>p(u({},"__esModule",{value:!0}),e);var I={};A(I,{handler:()=>P});module.exports=C(I);var d=require("@aws-sdk/client-s3"),h=new d.S3Client({region:process.env.AWS_REGION||process.env.AWS_DEFAULT_REGION||"us-east-1"}),c=process.env.BUCKET,m=String(process.env.ALLOWED_ORIGINS||"").split(",").map(e=>e.trim()).filter(Boolean);function w(e){return e.requestContext?.http?.method||e.httpMethod||"GET"}function O(e){let n=e.headers?.origin||e.headers?.Origin||"";return m.includes(n||"")?n:void 0}function a(e){let n={"Access-Control-Allow-Headers":"authorization,Authorization,Content-Type,X-Amz-Date,X-Api-Key,X-Amz-Security-Token","Access-Control-Allow-Methods":"GET,OPTIONS","Access-Control-Allow-Credentials":"true","Content-Type":"application/json",Vary:"Origin"};return e&&(n["Access-Control-Allow-Origin"]=e),n}function T(e){let n=String(e||"").trim();return n.includes("..")&&(n=""),n=n.replace(/^\/+/,"").replace(/[^A-Za-z0-9_\-\/.]/g,""),n}var P=async e=>{let n=O(e);if(w(e)==="OPTIONS")return(e.headers?.origin||e.headers?.Origin)&&!n?{statusCode:403,headers:a(void 0),body:""}:{statusCode:204,headers:a(n),body:""};try{if(!c)throw new Error("Missing BUCKET env var");let t=e.queryStringParameters??{},r=T(t.prefix),s=t.token||t.continuationToken||t.nextToken||void 0,i=await h.send(new d.ListObjectsV2Command({Bucket:c,Prefix:r||void 0,ContinuationToken:s||void 0,MaxKeys:1e3})),l=(i.Contents||[]).map(o=>({key:o.Key??"",size:o.Size??0,lastModified:o.LastModified?new Date(o.LastModified).toISOString():null}))??[];return{statusCode:200,headers:a(n),body:JSON.stringify({prefix:r,items:l,isTruncated:!!i.IsTruncated,nextToken:i.IsTruncated?i.NextContinuationToken??null:null})}}catch(t){let r=t?.message??String(t??"Error");return console.error(t),{statusCode:500,headers:a(n),body:JSON.stringify({error:r})}}};0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
