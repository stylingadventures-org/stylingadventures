{
  "version": 3,
  "sources": ["../../lambda/graphql/index.ts"],
  "sourcesContent": ["// lambda/graphql/index.ts\r\nimport { randomUUID } from \"crypto\";\r\nimport { DynamoDBClient } from \"@aws-sdk/client-dynamodb\";\r\nimport {\r\n  DynamoDBDocumentClient,\r\n  GetCommand,\r\n  PutCommand,\r\n  UpdateCommand,\r\n  DeleteCommand,\r\n  QueryCommand,\r\n} from \"@aws-sdk/lib-dynamodb\";\r\nimport type { AppSyncResolverEvent, AppSyncIdentityCognito } from \"aws-lambda\";\r\nimport { SFNClient, StartExecutionCommand } from \"@aws-sdk/client-sfn\";\r\n\r\nconst TABLE = process.env.TABLE_NAME!;\r\nconst APPROVAL_SM_ARN = process.env.APPROVAL_SM_ARN || \"\";\r\n\r\nconst ddb = DynamoDBDocumentClient.from(new DynamoDBClient({}));\r\nconst sfn = new SFNClient({});\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// Helpers\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\ntype ClosetStatus = \"DRAFT\" | \"PENDING\" | \"APPROVED\" | \"REJECTED\" | \"PUBLISHED\";\r\n\r\ninterface ClosetItem {\r\n  id: string;\r\n  ownerSub: string;\r\n  title?: string | null;\r\n  status: ClosetStatus;\r\n  mediaKey?: string | null;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n  // single-table attributes:\r\n  pk?: string;\r\n  sk?: string;\r\n  gsi1pk?: string;\r\n  gsi1sk?: string;\r\n  gsi2pk?: string;\r\n  gsi2sk?: string;\r\n  approvalToken?: string;\r\n  reason?: string | null;\r\n}\r\n\r\nconst nowIso = () => new Date().toISOString();\r\nconst assertAuth = (sub?: string) => {\r\n  if (!sub) throw new Error(\"Unauthenticated\");\r\n};\r\nconst isAdmin = (ident?: AppSyncIdentityCognito) => {\r\n  const groups = (ident as any)?.claims?.[\"cognito:groups\"];\r\n  return Array.isArray(groups)\r\n    ? groups.includes(\"ADMIN\")\r\n    : `${groups || \"\"}`.includes(\"ADMIN\");\r\n};\r\nconst keysForId = (id: string) => ({ pk: `ITEM#${id}`, sk: \"META\" });\r\n\r\nconst toPublic = (raw: any): ClosetItem => ({\r\n  id: raw.id,\r\n  ownerSub: raw.ownerSub,\r\n  title: raw.title ?? null,\r\n  status: raw.status,\r\n  mediaKey: raw.mediaKey ?? null,\r\n  createdAt: raw.createdAt,\r\n  updatedAt: raw.updatedAt,\r\n});\r\n\r\n// Episodes gate: public ids allowed without checks\r\nconst PUBLIC_EPISODES = new Set<string>([\"ep-001\"]);\r\n\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n// Router\r\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500-\r\nexport const handler = async (event: AppSyncResolverEvent<any>) => {\r\n  const field = event.info.fieldName;\r\n  const ident = event.identity as AppSyncIdentityCognito | undefined;\r\n  const sub = ident?.sub;\r\n\r\n  switch (field) {\r\n    // ------------------ Episodes early-access ------------------\r\n    case \"isEpisodeEarlyAccess\": {\r\n      const epId = String(event.arguments?.id || \"\").trim();\r\n\r\n      // Public episode? always allowed.\r\n      if (PUBLIC_EPISODES.has(epId)) {\r\n        return { allowed: true, reason: null };\r\n      }\r\n\r\n      // Must be signed in to check early drops.\r\n      if (!sub) return { allowed: false, reason: \"Sign in to check early access.\" };\r\n\r\n      // Look at profile flags that indicate Bestie.\r\n      const got = await ddb.send(\r\n        new GetCommand({ TableName: TABLE, Key: { pk: `USER#${sub}`, sk: \"PROFILE\" } })\r\n      );\r\n      const p = got.Item || {};\r\n      const bestieActive =\r\n        p.bestie?.BOOL === true ||\r\n        p.bestieActive?.BOOL === true ||\r\n        p.tier?.S === \"BESTIE\" ||\r\n        p.tier === \"BESTIE\"; // document client may already unmarshal\r\n\r\n      if (bestieActive) return { allowed: true, reason: null };\r\n\r\n      // Optional: dedicated BESTIE row\r\n      try {\r\n        const bestie = await ddb.send(\r\n          new GetCommand({ TableName: TABLE, Key: { pk: `USER#${sub}`, sk: \"BESTIE\" } })\r\n        );\r\n        if (bestie.Item?.active === true || bestie.Item?.active?.BOOL === true) {\r\n          return { allowed: true, reason: null };\r\n        }\r\n      } catch {\r\n        /* ignore */\r\n      }\r\n\r\n      return { allowed: false, reason: \"This is an early drop for Bestie members.\" };\r\n    }\r\n\r\n    // ------------------ Query.myCloset ------------------\r\n    case \"myCloset\": {\r\n      assertAuth(sub);\r\n\r\n      // Most-recent first by created/updated time\r\n      const out = await ddb.send(\r\n        new QueryCommand({\r\n          TableName: TABLE,\r\n          IndexName: \"gsi1\",\r\n          KeyConditionExpression: \"gsi1pk = :p\",\r\n          ExpressionAttributeValues: { \":p\": `OWNER#${sub}` },\r\n          ScanIndexForward: false,\r\n          Limit: 50,\r\n        })\r\n      );\r\n      return (out.Items || []).filter((x) => x.sk === \"META\").map(toPublic);\r\n    }\r\n\r\n    // ------------------ Mutation.createClosetItem ------------------\r\n    case \"createClosetItem\": {\r\n      assertAuth(sub);\r\n      const { title, mediaKey } = (event.arguments || {}) as {\r\n        title?: string | null;\r\n        mediaKey?: string | null;\r\n      };\r\n\r\n      const id = randomUUID();\r\n      const ts = nowIso();\r\n      const item: ClosetItem = {\r\n        id,\r\n        ownerSub: sub!,\r\n        title: (title ?? \"\").trim() || null,\r\n        mediaKey: (mediaKey ?? \"\").trim() || null,\r\n        status: \"DRAFT\",\r\n        createdAt: ts,\r\n        updatedAt: ts,\r\n      };\r\n\r\n      await ddb.send(\r\n        new PutCommand({\r\n          TableName: TABLE,\r\n          Item: {\r\n            ...item,\r\n            ...keysForId(id),\r\n            gsi1pk: `OWNER#${sub}`,\r\n            gsi1sk: ts,\r\n            gsi2pk: `STATUS#DRAFT`,\r\n            gsi2sk: ts,\r\n          },\r\n          ConditionExpression: \"attribute_not_exists(pk)\",\r\n        })\r\n      );\r\n\r\n      return item;\r\n    }\r\n\r\n    // ------------------ Mutation.updateClosetMediaKey ------------------\r\n    case \"updateClosetMediaKey\": {\r\n      assertAuth(sub);\r\n      const { id, mediaKey } = event.arguments as { id: string; mediaKey: string };\r\n\r\n      const got = await ddb.send(new GetCommand({ TableName: TABLE, Key: keysForId(id) }));\r\n      if (!got.Item) throw new Error(\"Not found\");\r\n      if (got.Item.ownerSub !== sub) throw new Error(\"Forbidden\");\r\n\r\n      const ts = nowIso();\r\n      const updated = await ddb.send(\r\n        new UpdateCommand({\r\n          TableName: TABLE,\r\n          Key: keysForId(id),\r\n          UpdateExpression: \"SET mediaKey = :k, updatedAt = :u\",\r\n          ExpressionAttributeValues: { \":k\": mediaKey, \":u\": ts },\r\n          ReturnValues: \"ALL_NEW\",\r\n        })\r\n      );\r\n      return toPublic(updated.Attributes);\r\n    }\r\n\r\n    // ------------------ Mutation.requestClosetApproval ------------------\r\n    case \"requestClosetApproval\": {\r\n      assertAuth(sub);\r\n      const { id } = event.arguments as { id: string };\r\n\r\n      const got = await ddb.send(new GetCommand({ TableName: TABLE, Key: keysForId(id) }));\r\n      if (!got.Item) throw new Error(\"Not found\");\r\n      if (got.Item.ownerSub !== sub) throw new Error(\"Forbidden\");\r\n\r\n      const ts = nowIso();\r\n      await ddb.send(\r\n        new UpdateCommand({\r\n          TableName: TABLE,\r\n          Key: keysForId(id),\r\n          UpdateExpression:\r\n            \"SET #s = :p, gsi2pk = :g, gsi2sk = :ts, updatedAt = :ts\",\r\n          ExpressionAttributeNames: { \"#s\": \"status\" },\r\n          ExpressionAttributeValues: {\r\n            \":p\": \"PENDING\",\r\n            \":g\": \"STATUS#PENDING\",\r\n            \":ts\": ts,\r\n          },\r\n        })\r\n      );\r\n\r\n      if (APPROVAL_SM_ARN) {\r\n        await sfn.send(\r\n          new StartExecutionCommand({\r\n            stateMachineArn: APPROVAL_SM_ARN,\r\n            input: JSON.stringify({ itemId: id, ownerSub: sub }),\r\n          })\r\n        );\r\n      }\r\n      return true;\r\n    }\r\n\r\n    // ------------------ Query.adminListPending ------------------\r\n    case \"adminListPending\": {\r\n      if (!isAdmin(ident)) throw new Error(\"Not authorized\");\r\n\r\n      const out = await ddb.send(\r\n        new QueryCommand({\r\n          TableName: TABLE,\r\n          IndexName: \"gsi2\",\r\n          KeyConditionExpression: \"gsi2pk = :p\",\r\n          ExpressionAttributeValues: { \":p\": \"STATUS#PENDING\" },\r\n          ScanIndexForward: false,\r\n          Limit: 100,\r\n        })\r\n      );\r\n\r\n      return (out.Items || []).map(toPublic);\r\n    }\r\n\r\n    // ------------------ Mutation.adminApproveItem ------------------\r\n    case \"adminApproveItem\": {\r\n      if (!isAdmin(ident)) throw new Error(\"Not authorized\");\r\n      const { id } = event.arguments as { id: string };\r\n\r\n      const ts = nowIso();\r\n      await ddb.send(\r\n        new UpdateCommand({\r\n          TableName: TABLE,\r\n          Key: keysForId(id),\r\n          UpdateExpression:\r\n            \"SET #s = :a, gsi2pk = :g, gsi2sk = :ts, updatedAt = :ts REMOVE approvalToken\",\r\n          ExpressionAttributeNames: { \"#s\": \"status\" },\r\n          ExpressionAttributeValues: {\r\n            \":a\": \"APPROVED\",\r\n            \":g\": \"STATUS#APPROVED\",\r\n            \":ts\": ts,\r\n          },\r\n        })\r\n      );\r\n      return true;\r\n    }\r\n\r\n    // ------------------ Mutation.adminRejectItem ------------------\r\n    case \"adminRejectItem\": {\r\n      if (!isAdmin(ident)) throw new Error(\"Not authorized\");\r\n      const { id, reason } = event.arguments as { id: string; reason?: string };\r\n\r\n      const ts = nowIso();\r\n      await ddb.send(\r\n        new UpdateCommand({\r\n          TableName: TABLE,\r\n          Key: keysForId(id),\r\n          UpdateExpression:\r\n            \"SET #s = :r, gsi2pk = :g, gsi2sk = :ts, updatedAt = :ts, reason = :why REMOVE approvalToken\",\r\n          ExpressionAttributeNames: { \"#s\": \"status\" },\r\n          ExpressionAttributeValues: {\r\n            \":r\": \"REJECTED\",\r\n            \":g\": \"STATUS#REJECTED\",\r\n            \":ts\": ts,\r\n            \":why\": reason ?? \"Rejected by admin\",\r\n          },\r\n        })\r\n      );\r\n      return true;\r\n    }\r\n\r\n    // ------------------ (Optional) Mutation.deleteClosetItem ------------------\r\n    case \"deleteClosetItem\": {\r\n      assertAuth(sub);\r\n      const { id } = event.arguments as { id: string };\r\n\r\n      const got = await ddb.send(new GetCommand({ TableName: TABLE, Key: keysForId(id) }));\r\n      if (!got.Item) throw new Error(\"Not found\");\r\n      if (got.Item.ownerSub !== sub && !isAdmin(ident)) throw new Error(\"Forbidden\");\r\n\r\n      await ddb.send(new DeleteCommand({ TableName: TABLE, Key: keysForId(id) }));\r\n      return true;\r\n    }\r\n\r\n    // ----------------------------------------------------------------\r\n    default:\r\n      throw new Error(`Unhandled field: ${field}`);\r\n  }\r\n};\r\n\r\n"],
  "mappings": "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",
  "names": ["index_exports", "__export", "handler", "__toCommonJS", "import_crypto", "import_client_dynamodb", "import_lib_dynamodb", "import_client_sfn", "TABLE", "APPROVAL_SM_ARN", "ddb", "sfn", "nowIso", "assertAuth", "sub", "isAdmin", "ident", "groups", "keysForId", "id", "toPublic", "raw", "PUBLIC_EPISODES", "event", "field", "epId", "p", "bestie", "x", "title", "mediaKey", "ts", "item", "got", "updated", "reason"]
}
