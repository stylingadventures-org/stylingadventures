{
 "Description": "AppSync GraphQL API - dev",
 "Resources": {
  "HelloFnServiceRoleDA97FE56": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ],
    "Tags": [
     {
      "Key": "App",
      "Value": "stylingadventures"
     },
     {
      "Key": "Env",
      "Value": "dev"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "ApiStack/HelloFn/ServiceRole/Resource"
   }
  },
  "HelloFn7942DF23": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": "cdk-hnb659fds-assets-637423256673-us-east-1",
     "S3Key": "dba505f53767a9e6657cdeba0a1fe85822984a28978face5a785b36aa3fb4af7.zip"
    },
    "Environment": {
     "Variables": {
      "NODE_OPTIONS": "--enable-source-maps"
     }
    },
    "Handler": "index.handler",
    "Role": {
     "Fn::GetAtt": [
      "HelloFnServiceRoleDA97FE56",
      "Arn"
     ]
    },
    "Runtime": "nodejs20.x",
    "Tags": [
     {
      "Key": "App",
      "Value": "stylingadventures"
     },
     {
      "Key": "Env",
      "Value": "dev"
     }
    ]
   },
   "DependsOn": [
    "HelloFnServiceRoleDA97FE56"
   ],
   "Metadata": {
    "aws:cdk:path": "ApiStack/HelloFn/Resource",
    "aws:asset:path": "asset.dba505f53767a9e6657cdeba0a1fe85822984a28978face5a785b36aa3fb4af7",
    "aws:asset:is-bundled": false,
    "aws:asset:property": "Code"
   }
  },
  "StylingApiC401F041": {
   "Type": "AWS::AppSync::GraphQLApi",
   "Properties": {
    "AuthenticationType": "AMAZON_COGNITO_USER_POOLS",
    "Name": "stylingadventures-api",
    "Tags": [
     {
      "Key": "App",
      "Value": "stylingadventures"
     },
     {
      "Key": "Env",
      "Value": "dev"
     }
    ],
    "UserPoolConfig": {
     "AwsRegion": "us-east-1",
     "DefaultAction": "ALLOW",
     "UserPoolId": {
      "Fn::ImportValue": "IdentityStack:ExportsOutputRefUserPool6BA7E5F296FD7236"
     }
    },
    "XrayEnabled": true
   },
   "Metadata": {
    "aws:cdk:path": "ApiStack/StylingApi/Resource"
   }
  },
  "StylingApiSchemaD8A6FBCC": {
   "Type": "AWS::AppSync::GraphQLSchema",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "StylingApiC401F041",
      "ApiId"
     ]
    },
    "Definition": "\"\"\"Auth directive used in this API (mapped to Cognito user pools in AppSync)\"\"\"\r\ndirective @aws_auth(cognito_groups: [String]) on FIELD_DEFINITION | OBJECT\r\n\r\n\"\"\" -------- App base enums & types -------- \"\"\"\r\nenum ClosetStatus {\r\n  DRAFT\r\n  PENDING\r\n  APPROVED\r\n  REJECTED\r\n  PUBLISHED\r\n}\r\n\r\ntype ClosetItem {\r\n  id: ID!\r\n  ownerSub: String!\r\n  status: ClosetStatus!\r\n  createdAt: AWSDateTime!\r\n  updatedAt: AWSDateTime!\r\n  mediaKey: String\r\n  title: String\r\n  reason: String          # optional: why REJECTED\r\n}\r\n\r\n\"\"\"RBAC: roles & tiers (existing enum-backed user model)\"\"\"\r\nenum Role { FAN BESTIE CREATOR COLLAB ADMIN }\r\nenum Tier { FREE PRIME }\r\n\r\ntype User {\r\n  id: ID!\r\n  email: AWSEmail\r\n  role: Role!\r\n  tier: Tier\r\n  createdAt: AWSDateTime!\r\n  updatedAt: AWSDateTime!\r\n}\r\n\r\ninput SetUserRoleInput {\r\n  userId: ID!\r\n  email: AWSEmail\r\n  role: Role!\r\n  tier: Tier\r\n}\r\n\r\n\"\"\"Phase-1 lightweight profile returned by Query.me (string-based)\"\"\"\r\ntype UserProfile {\r\n  id: ID!\r\n  email: String\r\n  role: String!\r\n  tier: String!\r\n  createdAt: AWSDateTime\r\n  updatedAt: AWSDateTime\r\n}\r\n\r\n\"\"\"Paged list of users for admin UI\"\"\"\r\ntype AdminUsersPage {\r\n  items: [User!]!\r\n  nextToken: String\r\n}\r\n\r\n\"\"\" -------- Queries -------- \"\"\"\r\ntype Query {\r\n  hello: String!\r\n\r\n  \"\"\"\r\n  Returns the signed-in creatorâ€™s items. Never null; empty list if none.\r\n  Implemented by lambda/graphql/closet.ts -> myCloset\r\n  \"\"\"\r\n  myCloset: [ClosetItem!]!\r\n\r\n  \"\"\"\r\n  Items awaiting moderation. Requires elevated groups.\r\n  Implemented by lambda/graphql/closet.ts -> adminListPending\r\n  \"\"\"\r\n  adminListPending: [ClosetItem!]!\r\n    @aws_auth(cognito_groups: [\"ADMIN\", \"COLLAB\", \"PRIME\"])\r\n\r\n  # Roles / user directory\r\n  # NOTE: now returns UserProfile (string role/tier) to match the NONE DS resolver.\r\n  me: UserProfile!\r\n\r\n  # Existing admin users listing remains enum-backed\r\n  adminListUsers(search: String, limit: Int, nextToken: String): AdminUsersPage\r\n    @aws_auth(cognito_groups: [\"ADMIN\"])\r\n}\r\n\r\n\"\"\" -------- Mutations -------- \"\"\"\r\ntype Mutation {\r\n  \"\"\"\r\n  Creates a new item in DRAFT.\r\n  Implemented by lambda/graphql/closet.ts -> createClosetItem\r\n  \"\"\"\r\n  createClosetItem(title: String, mediaKey: String): ClosetItem! @aws_auth\r\n\r\n  \"\"\"\r\n  Marks item PENDING and starts the approval Step Function.\r\n  Returns a string (execution request marker).\r\n  Implemented by lambda/graphql/closet.ts -> requestClosetApproval\r\n  \"\"\"\r\n  requestClosetApproval(id: ID!): String!\r\n\r\n  # Roles\r\n  # Return shape is now UserProfile to align with front-end expectations.\r\n  setUserRole(input: SetUserRoleInput!): UserProfile!\r\n\r\n  # Moderation actions\r\n  adminApproveItem(id: ID!): ClosetItem!\r\n    @aws_auth(cognito_groups: [\"ADMIN\", \"COLLAB\"])\r\n  adminRejectItem(id: ID!, reason: String): ClosetItem!\r\n    @aws_auth(cognito_groups: [\"ADMIN\", \"COLLAB\"])\r\n\r\n  \"\"\"\r\n  Admin/creator fix-up: update the media key on an item.\r\n  Implemented by lambda/graphql/closet.ts -> updateClosetMediaKey\r\n  \"\"\"\r\n  updateClosetMediaKey(id: ID!, mediaKey: String!): ClosetItem!\r\n}\r\n\r\nschema {\r\n  query: Query\r\n  mutation: Mutation\r\n}\r\n\r\n"
   },
   "Metadata": {
    "aws:cdk:path": "ApiStack/StylingApi/Schema"
   }
  },
  "StylingApiRolesDsServiceRole42160415": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "appsync.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "Tags": [
     {
      "Key": "App",
      "Value": "stylingadventures"
     },
     {
      "Key": "Env",
      "Value": "dev"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "ApiStack/StylingApi/RolesDs/ServiceRole/Resource"
   }
  },
  "StylingApiRolesDsServiceRoleDefaultPolicy3799FB1B": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": "lambda:InvokeFunction",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "RolesFn27BF2B8D",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "RolesFn27BF2B8D",
             "Arn"
            ]
           },
           ":*"
          ]
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "StylingApiRolesDsServiceRoleDefaultPolicy3799FB1B",
    "Roles": [
     {
      "Ref": "StylingApiRolesDsServiceRole42160415"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "ApiStack/StylingApi/RolesDs/ServiceRole/DefaultPolicy/Resource"
   }
  },
  "StylingApiRolesDs00C42927": {
   "Type": "AWS::AppSync::DataSource",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "StylingApiC401F041",
      "ApiId"
     ]
    },
    "LambdaConfig": {
     "LambdaFunctionArn": {
      "Fn::GetAtt": [
       "RolesFn27BF2B8D",
       "Arn"
      ]
     }
    },
    "Name": "RolesDs",
    "ServiceRoleArn": {
     "Fn::GetAtt": [
      "StylingApiRolesDsServiceRole42160415",
      "Arn"
     ]
    },
    "Type": "AWS_LAMBDA"
   },
   "Metadata": {
    "aws:cdk:path": "ApiStack/StylingApi/RolesDs/Resource"
   }
  },
  "StylingApiSetUserRole87913D00": {
   "Type": "AWS::AppSync::Resolver",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "StylingApiC401F041",
      "ApiId"
     ]
    },
    "DataSourceName": "RolesDs",
    "FieldName": "setUserRole",
    "Kind": "UNIT",
    "RequestMappingTemplate": "{\"version\": \"2017-02-28\", \"operation\": \"Invoke\", \"payload\": $util.toJson($ctx)}",
    "ResponseMappingTemplate": "$util.toJson($ctx.result)",
    "TypeName": "Mutation"
   },
   "DependsOn": [
    "StylingApiRolesDs00C42927",
    "StylingApiSchemaD8A6FBCC"
   ],
   "Metadata": {
    "aws:cdk:path": "ApiStack/StylingApi/SetUserRole/Resource"
   }
  },
  "StylingApiHelloDsServiceRole44626254": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "appsync.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "Tags": [
     {
      "Key": "App",
      "Value": "stylingadventures"
     },
     {
      "Key": "Env",
      "Value": "dev"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "ApiStack/StylingApi/HelloDs/ServiceRole/Resource"
   }
  },
  "StylingApiHelloDsServiceRoleDefaultPolicy8C35E727": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": "lambda:InvokeFunction",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "HelloFn7942DF23",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "HelloFn7942DF23",
             "Arn"
            ]
           },
           ":*"
          ]
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "StylingApiHelloDsServiceRoleDefaultPolicy8C35E727",
    "Roles": [
     {
      "Ref": "StylingApiHelloDsServiceRole44626254"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "ApiStack/StylingApi/HelloDs/ServiceRole/DefaultPolicy/Resource"
   }
  },
  "StylingApiHelloDs58F1D645": {
   "Type": "AWS::AppSync::DataSource",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "StylingApiC401F041",
      "ApiId"
     ]
    },
    "LambdaConfig": {
     "LambdaFunctionArn": {
      "Fn::GetAtt": [
       "HelloFn7942DF23",
       "Arn"
      ]
     }
    },
    "Name": "HelloDs",
    "ServiceRoleArn": {
     "Fn::GetAtt": [
      "StylingApiHelloDsServiceRole44626254",
      "Arn"
     ]
    },
    "Type": "AWS_LAMBDA"
   },
   "Metadata": {
    "aws:cdk:path": "ApiStack/StylingApi/HelloDs/Resource"
   }
  },
  "StylingApiHello5D556CAF": {
   "Type": "AWS::AppSync::Resolver",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "StylingApiC401F041",
      "ApiId"
     ]
    },
    "DataSourceName": "HelloDs",
    "FieldName": "hello",
    "Kind": "UNIT",
    "RequestMappingTemplate": "{\"version\": \"2017-02-28\", \"operation\": \"Invoke\", \"payload\": $util.toJson($ctx)}",
    "ResponseMappingTemplate": "$util.toJson($ctx.result)",
    "TypeName": "Query"
   },
   "DependsOn": [
    "StylingApiHelloDs58F1D645",
    "StylingApiSchemaD8A6FBCC"
   ],
   "Metadata": {
    "aws:cdk:path": "ApiStack/StylingApi/Hello/Resource"
   }
  },
  "StylingApiNoneDsForMe1A76D286": {
   "Type": "AWS::AppSync::DataSource",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "StylingApiC401F041",
      "ApiId"
     ]
    },
    "Name": "NoneDsForMe",
    "Type": "NONE"
   },
   "Metadata": {
    "aws:cdk:path": "ApiStack/StylingApi/NoneDsForMe/Resource"
   }
  },
  "StylingApiMe3282F680": {
   "Type": "AWS::AppSync::Resolver",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "StylingApiC401F041",
      "ApiId"
     ]
    },
    "DataSourceName": "NoneDsForMe",
    "FieldName": "me",
    "Kind": "UNIT",
    "RequestMappingTemplate": "{\n  \"version\": \"2018-05-29\",\n  \"payload\": {}\n}",
    "ResponseMappingTemplate": "$util.toJson({\n  \"id\": $ctx.identity.sub,\n  \"email\": $ctx.identity.claims.get(\"email\"),\n  \"role\": \"FAN\",\n  \"tier\": \"FREE\",\n  \"createdAt\": $util.time.nowISO8601(),\n  \"updatedAt\": $util.time.nowISO8601()\n})",
    "TypeName": "Query"
   },
   "DependsOn": [
    "StylingApiNoneDsForMe1A76D286",
    "StylingApiSchemaD8A6FBCC"
   ],
   "Metadata": {
    "aws:cdk:path": "ApiStack/StylingApi/Me/Resource"
   }
  },
  "StylingApiClosetDsServiceRole61F98ADC": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "appsync.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "Tags": [
     {
      "Key": "App",
      "Value": "stylingadventures"
     },
     {
      "Key": "Env",
      "Value": "dev"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "ApiStack/StylingApi/ClosetDs/ServiceRole/Resource"
   }
  },
  "StylingApiClosetDsServiceRoleDefaultPolicyE595E568": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": "lambda:InvokeFunction",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "ClosetResolverFnDB09D91C",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "ClosetResolverFnDB09D91C",
             "Arn"
            ]
           },
           ":*"
          ]
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "StylingApiClosetDsServiceRoleDefaultPolicyE595E568",
    "Roles": [
     {
      "Ref": "StylingApiClosetDsServiceRole61F98ADC"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "ApiStack/StylingApi/ClosetDs/ServiceRole/DefaultPolicy/Resource"
   }
  },
  "StylingApiClosetDs3024963C": {
   "Type": "AWS::AppSync::DataSource",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "StylingApiC401F041",
      "ApiId"
     ]
    },
    "LambdaConfig": {
     "LambdaFunctionArn": {
      "Fn::GetAtt": [
       "ClosetResolverFnDB09D91C",
       "Arn"
      ]
     }
    },
    "Name": "ClosetDs",
    "ServiceRoleArn": {
     "Fn::GetAtt": [
      "StylingApiClosetDsServiceRole61F98ADC",
      "Arn"
     ]
    },
    "Type": "AWS_LAMBDA"
   },
   "Metadata": {
    "aws:cdk:path": "ApiStack/StylingApi/ClosetDs/Resource"
   }
  },
  "StylingApiMyClosetC8373A07": {
   "Type": "AWS::AppSync::Resolver",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "StylingApiC401F041",
      "ApiId"
     ]
    },
    "DataSourceName": "ClosetDs",
    "FieldName": "myCloset",
    "Kind": "UNIT",
    "RequestMappingTemplate": "{\"version\": \"2017-02-28\", \"operation\": \"Invoke\", \"payload\": $util.toJson($ctx)}",
    "ResponseMappingTemplate": "$util.toJson($ctx.result)",
    "TypeName": "Query"
   },
   "DependsOn": [
    "StylingApiClosetDs3024963C",
    "StylingApiSchemaD8A6FBCC"
   ],
   "Metadata": {
    "aws:cdk:path": "ApiStack/StylingApi/MyCloset/Resource"
   }
  },
  "StylingApiAdminListPendingResolver16923FC0": {
   "Type": "AWS::AppSync::Resolver",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "StylingApiC401F041",
      "ApiId"
     ]
    },
    "DataSourceName": "ClosetDs",
    "FieldName": "adminListPending",
    "Kind": "UNIT",
    "RequestMappingTemplate": "{\"version\": \"2017-02-28\", \"operation\": \"Invoke\", \"payload\": $util.toJson($ctx)}",
    "ResponseMappingTemplate": "$util.toJson($ctx.result)",
    "TypeName": "Query"
   },
   "DependsOn": [
    "StylingApiClosetDs3024963C",
    "StylingApiSchemaD8A6FBCC"
   ],
   "Metadata": {
    "aws:cdk:path": "ApiStack/StylingApi/AdminListPendingResolver/Resource"
   }
  },
  "StylingApiCreateClosetItemF16DABD7": {
   "Type": "AWS::AppSync::Resolver",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "StylingApiC401F041",
      "ApiId"
     ]
    },
    "DataSourceName": "ClosetDs",
    "FieldName": "createClosetItem",
    "Kind": "UNIT",
    "RequestMappingTemplate": "{\"version\": \"2017-02-28\", \"operation\": \"Invoke\", \"payload\": $util.toJson($ctx)}",
    "ResponseMappingTemplate": "$util.toJson($ctx.result)",
    "TypeName": "Mutation"
   },
   "DependsOn": [
    "StylingApiClosetDs3024963C",
    "StylingApiSchemaD8A6FBCC"
   ],
   "Metadata": {
    "aws:cdk:path": "ApiStack/StylingApi/CreateClosetItem/Resource"
   }
  },
  "StylingApiRequestClosetApproval8385052A": {
   "Type": "AWS::AppSync::Resolver",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "StylingApiC401F041",
      "ApiId"
     ]
    },
    "DataSourceName": "ClosetDs",
    "FieldName": "requestClosetApproval",
    "Kind": "UNIT",
    "RequestMappingTemplate": "{\"version\": \"2017-02-28\", \"operation\": \"Invoke\", \"payload\": $util.toJson($ctx)}",
    "ResponseMappingTemplate": "$util.toJson($ctx.result)",
    "TypeName": "Mutation"
   },
   "DependsOn": [
    "StylingApiClosetDs3024963C",
    "StylingApiSchemaD8A6FBCC"
   ],
   "Metadata": {
    "aws:cdk:path": "ApiStack/StylingApi/RequestClosetApproval/Resource"
   }
  },
  "StylingApiAdminApproveItem0F267B42": {
   "Type": "AWS::AppSync::Resolver",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "StylingApiC401F041",
      "ApiId"
     ]
    },
    "DataSourceName": "ClosetDs",
    "FieldName": "adminApproveItem",
    "Kind": "UNIT",
    "RequestMappingTemplate": "{\"version\": \"2017-02-28\", \"operation\": \"Invoke\", \"payload\": $util.toJson($ctx)}",
    "ResponseMappingTemplate": "$util.toJson($ctx.result)",
    "TypeName": "Mutation"
   },
   "DependsOn": [
    "StylingApiClosetDs3024963C",
    "StylingApiSchemaD8A6FBCC"
   ],
   "Metadata": {
    "aws:cdk:path": "ApiStack/StylingApi/AdminApproveItem/Resource"
   }
  },
  "StylingApiAdminRejectItemCC71EBDE": {
   "Type": "AWS::AppSync::Resolver",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "StylingApiC401F041",
      "ApiId"
     ]
    },
    "DataSourceName": "ClosetDs",
    "FieldName": "adminRejectItem",
    "Kind": "UNIT",
    "RequestMappingTemplate": "{\"version\": \"2017-02-28\", \"operation\": \"Invoke\", \"payload\": $util.toJson($ctx)}",
    "ResponseMappingTemplate": "$util.toJson($ctx.result)",
    "TypeName": "Mutation"
   },
   "DependsOn": [
    "StylingApiClosetDs3024963C",
    "StylingApiSchemaD8A6FBCC"
   ],
   "Metadata": {
    "aws:cdk:path": "ApiStack/StylingApi/AdminRejectItem/Resource"
   }
  },
  "StylingApiUpdateClosetMediaKeyD01273A7": {
   "Type": "AWS::AppSync::Resolver",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "StylingApiC401F041",
      "ApiId"
     ]
    },
    "DataSourceName": "ClosetDs",
    "FieldName": "updateClosetMediaKey",
    "Kind": "UNIT",
    "RequestMappingTemplate": "{\"version\": \"2017-02-28\", \"operation\": \"Invoke\", \"payload\": $util.toJson($ctx)}",
    "ResponseMappingTemplate": "$util.toJson($ctx.result)",
    "TypeName": "Mutation"
   },
   "DependsOn": [
    "StylingApiClosetDs3024963C",
    "StylingApiSchemaD8A6FBCC"
   ],
   "Metadata": {
    "aws:cdk:path": "ApiStack/StylingApi/UpdateClosetMediaKey/Resource"
   }
  },
  "RolesFnServiceRole774A669F": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ],
    "Tags": [
     {
      "Key": "App",
      "Value": "stylingadventures"
     },
     {
      "Key": "Env",
      "Value": "dev"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "ApiStack/RolesFn/ServiceRole/Resource"
   }
  },
  "RolesFn27BF2B8D": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": "cdk-hnb659fds-assets-637423256673-us-east-1",
     "S3Key": "f83b809923daf3d79da12a0bd5ac93524cd1866ce8bf9ab7697d597390f6375d.zip"
    },
    "Description": "Resolves Mutation.setUserRole",
    "Environment": {
     "Variables": {
      "NODE_OPTIONS": "--enable-source-maps"
     }
    },
    "Handler": "index.handler",
    "Role": {
     "Fn::GetAtt": [
      "RolesFnServiceRole774A669F",
      "Arn"
     ]
    },
    "Runtime": "nodejs20.x",
    "Tags": [
     {
      "Key": "App",
      "Value": "stylingadventures"
     },
     {
      "Key": "Env",
      "Value": "dev"
     }
    ]
   },
   "DependsOn": [
    "RolesFnServiceRole774A669F"
   ],
   "Metadata": {
    "aws:cdk:path": "ApiStack/RolesFn/Resource",
    "aws:asset:path": "asset.f83b809923daf3d79da12a0bd5ac93524cd1866ce8bf9ab7697d597390f6375d",
    "aws:asset:is-bundled": true,
    "aws:asset:property": "Code"
   }
  },
  "ClosetResolverFnServiceRole21435BA2": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ],
    "Tags": [
     {
      "Key": "App",
      "Value": "stylingadventures"
     },
     {
      "Key": "Env",
      "Value": "dev"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "ApiStack/ClosetResolverFn/ServiceRole/Resource"
   }
  },
  "ClosetResolverFnServiceRoleDefaultPolicy2117A20A": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "dynamodb:BatchGetItem",
        "dynamodb:GetRecords",
        "dynamodb:GetShardIterator",
        "dynamodb:Query",
        "dynamodb:GetItem",
        "dynamodb:Scan",
        "dynamodb:ConditionCheckItem",
        "dynamodb:BatchWriteItem",
        "dynamodb:PutItem",
        "dynamodb:UpdateItem",
        "dynamodb:DeleteItem",
        "dynamodb:DescribeTable"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::ImportValue": "DataStack:ExportsOutputFnGetAttAppTable815C50BCArnF3D9E3C3"
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::ImportValue": "DataStack:ExportsOutputFnGetAttAppTable815C50BCArnF3D9E3C3"
           },
           "/index/*"
          ]
         ]
        }
       ]
      },
      {
       "Action": [
        "dynamodb:Query",
        "dynamodb:Scan",
        "dynamodb:GetItem",
        "dynamodb:BatchGetItem",
        "dynamodb:UpdateItem",
        "dynamodb:PutItem"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::ImportValue": "DataStack:ExportsOutputFnGetAttAppTable815C50BCArnF3D9E3C3"
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::ImportValue": "DataStack:ExportsOutputFnGetAttAppTable815C50BCArnF3D9E3C3"
           },
           "/index/*"
          ]
         ]
        }
       ]
      },
      {
       "Action": "states:StartExecution",
       "Effect": "Allow",
       "Resource": {
        "Fn::ImportValue": "WorkflowsStack:ExportsOutputRefClosetUploadApprovalDA1D2210CE637AAA"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "ClosetResolverFnServiceRoleDefaultPolicy2117A20A",
    "Roles": [
     {
      "Ref": "ClosetResolverFnServiceRole21435BA2"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "ApiStack/ClosetResolverFn/ServiceRole/DefaultPolicy/Resource"
   }
  },
  "ClosetResolverFnDB09D91C": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": "cdk-hnb659fds-assets-637423256673-us-east-1",
     "S3Key": "950f5ec91eeceaa8eb8b053ca4251bb2da6c96c85d11e4b6ed2adbfbb66572d4.zip"
    },
    "Description": "GraphQL field resolver for closet queries/mutations",
    "Environment": {
     "Variables": {
      "TABLE_NAME": {
       "Fn::ImportValue": "DataStack:ExportsOutputRefAppTable815C50BC1988FCFB"
      },
      "APPROVAL_SM_ARN": {
       "Fn::ImportValue": "WorkflowsStack:ExportsOutputRefClosetUploadApprovalDA1D2210CE637AAA"
      },
      "NODE_OPTIONS": "--enable-source-maps"
     }
    },
    "Handler": "index.handler",
    "Role": {
     "Fn::GetAtt": [
      "ClosetResolverFnServiceRole21435BA2",
      "Arn"
     ]
    },
    "Runtime": "nodejs20.x",
    "Tags": [
     {
      "Key": "App",
      "Value": "stylingadventures"
     },
     {
      "Key": "Env",
      "Value": "dev"
     }
    ]
   },
   "DependsOn": [
    "ClosetResolverFnServiceRoleDefaultPolicy2117A20A",
    "ClosetResolverFnServiceRole21435BA2"
   ],
   "Metadata": {
    "aws:cdk:path": "ApiStack/ClosetResolverFn/Resource",
    "aws:asset:path": "asset.950f5ec91eeceaa8eb8b053ca4251bb2da6c96c85d11e4b6ed2adbfbb66572d4",
    "aws:asset:is-bundled": true,
    "aws:asset:property": "Code"
   }
  },
  "CDKMetadata": {
   "Type": "AWS::CDK::Metadata",
   "Properties": {
    "Analytics": "v2:deflate64:H4sIAAAAAAAA/1VPQW7CMBB8C3dnC6EXjtCqvSDaJg+IFmcLThzbzdogZOXvlR0h2tPMrHZ2Z0ooVxtYLvDKhWz7QqsjxNqj7AVeuYkah2OLEN+CkV5ZI16+zZ1PQuEAsbKa0jjjp9VK3pKc2SR43SAzeYZtAsFr2AXZk98hk0Dn+GYkxPcR3flHb51K5qy+9v9VLc80oNjnSK/osbZhlPn3H1URW32hMUe684M19NiZxFyrMbaljuGQ4VEr2fKtnLj2eFLmlO59BO+Cn0TyQcdPl3IJqw08LzpWqhiD8WogqGb8BZyYRY5bAQAA"
   },
   "Metadata": {
    "aws:cdk:path": "ApiStack/CDKMetadata/Default"
   }
  }
 },
 "Outputs": {
  "GraphQlApiUrl": {
   "Value": {
    "Fn::GetAtt": [
     "StylingApiC401F041",
     "GraphQLUrl"
    ]
   }
  },
  "GraphQlApiId": {
   "Value": {
    "Fn::GetAtt": [
     "StylingApiC401F041",
     "ApiId"
    ]
   }
  }
 },
 "Parameters": {
  "BootstrapVersion": {
   "Type": "AWS::SSM::Parameter::Value<String>",
   "Default": "/cdk-bootstrap/hnb659fds/version",
   "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]"
  }
 },
 "Rules": {
  "CheckBootstrapVersion": {
   "Assertions": [
    {
     "Assert": {
      "Fn::Not": [
       {
        "Fn::Contains": [
         [
          "1",
          "2",
          "3",
          "4",
          "5"
         ],
         {
          "Ref": "BootstrapVersion"
         }
        ]
       }
      ]
     },
     "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI."
    }
   ]
  }
 }
}