{
  "version": 3,
  "sources": ["../../lambda/game/leaderboard.ts"],
  "sourcesContent": ["// lambda/game/leaderboard.ts\r\nimport { DynamoDBClient } from \"@aws-sdk/client-dynamodb\";\r\nimport { DynamoDBDocumentClient, QueryCommand } from \"@aws-sdk/lib-dynamodb\";\r\n\r\nconst TABLE = process.env.TABLE_NAME!;\r\nconst ddb = DynamoDBDocumentClient.from(new DynamoDBClient({}), {\r\n  marshallOptions: { removeUndefinedValues: true },\r\n});\r\n\r\nexport const handler = async (event: any) => {\r\n  const { fieldName } = event.info;\r\n  const { limit = 10, season = \"GLOBAL\" } = event.arguments || {};\r\n\r\n  if (fieldName === \"topXP\" || fieldName === \"topCoins\") {\r\n    // Partition key used by your GSI1\r\n    const gsiPk = `LEADERBOARD#${season}`;\r\n\r\n    const resp = await ddb.send(\r\n      new QueryCommand({\r\n        TableName: TABLE,\r\n        IndexName: \"gsi1\", // \u2705 correct lowercase index name\r\n        KeyConditionExpression: \"#pk = :p\",\r\n        ExpressionAttributeNames: { \"#pk\": \"gsi1pk\" },\r\n        ExpressionAttributeValues: { \":p\": gsiPk },\r\n        // Sort descending by your precomputed score/XP sort key\r\n        ScanIndexForward: false,\r\n        Limit: Math.min(100, limit),\r\n      })\r\n    );\r\n\r\n    // Items are plain JS objects with native numbers/strings\r\n    const items = resp.Items ?? [];\r\n\r\n    // If you store sort key like \"XP#000001234\", you already sorted above.\r\n    // Compute rank client-side.\r\n    return items.map((i, idx) => ({\r\n      userId: String(i.pk || \"\").replace(\"USER#\", \"\"),\r\n      displayName: i.displayName ?? null,\r\n      xp: typeof i.xp === \"number\" ? i.xp : null,\r\n      coins: typeof i.coins === \"number\" ? i.coins : null,\r\n      rank: idx + 1,\r\n    }));\r\n  }\r\n\r\n  throw new Error(`Unknown field ${fieldName}`);\r\n};\r\n"],
  "mappings": "yaAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,aAAAE,IAAA,eAAAC,EAAAH,GACA,IAAAI,EAA+B,oCAC/BC,EAAqD,iCAE/CC,EAAQ,QAAQ,IAAI,WACpBC,EAAM,yBAAuB,KAAK,IAAI,iBAAe,CAAC,CAAC,EAAG,CAC9D,gBAAiB,CAAE,sBAAuB,EAAK,CACjD,CAAC,EAEYL,EAAU,MAAOM,GAAe,CAC3C,GAAM,CAAE,UAAAC,CAAU,EAAID,EAAM,KACtB,CAAE,MAAAE,EAAQ,GAAI,OAAAC,EAAS,QAAS,EAAIH,EAAM,WAAa,CAAC,EAE9D,GAAIC,IAAc,SAAWA,IAAc,WAAY,CAErD,IAAMG,EAAQ,eAAeD,CAAM,GAoBnC,QAlBa,MAAMJ,EAAI,KACrB,IAAI,eAAa,CACf,UAAWD,EACX,UAAW,OACX,uBAAwB,WACxB,yBAA0B,CAAE,MAAO,QAAS,EAC5C,0BAA2B,CAAE,KAAMM,CAAM,EAEzC,iBAAkB,GAClB,MAAO,KAAK,IAAI,IAAKF,CAAK,CAC5B,CAAC,CACH,GAGmB,OAAS,CAAC,GAIhB,IAAI,CAACG,EAAGC,KAAS,CAC5B,OAAQ,OAAOD,EAAE,IAAM,EAAE,EAAE,QAAQ,QAAS,EAAE,EAC9C,YAAaA,EAAE,aAAe,KAC9B,GAAI,OAAOA,EAAE,IAAO,SAAWA,EAAE,GAAK,KACtC,MAAO,OAAOA,EAAE,OAAU,SAAWA,EAAE,MAAQ,KAC/C,KAAMC,EAAM,CACd,EAAE,CACJ,CAEA,MAAM,IAAI,MAAM,iBAAiBL,CAAS,EAAE,CAC9C",
  "names": ["leaderboard_exports", "__export", "handler", "__toCommonJS", "import_client_dynamodb", "import_lib_dynamodb", "TABLE", "ddb", "event", "fieldName", "limit", "season", "gsiPk", "i", "idx"]
}
