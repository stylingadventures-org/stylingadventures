"use strict";var u=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var A=Object.getOwnPropertyNames;var l=Object.prototype.hasOwnProperty;var f=(e,r)=>{for(var t in r)u(e,t,{get:r[t],enumerable:!0})},m=(e,r,t,i)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of A(r))!l.call(e,n)&&n!==t&&u(e,n,{get:()=>r[n],enumerable:!(i=d(r,n))||i.enumerable});return e};var R=e=>m(u({},"__esModule",{value:!0}),e);var O={};f(O,{handler:()=>B});module.exports=R(O);var s=require("@aws-sdk/client-dynamodb"),c=require("@aws-sdk/util-dynamodb"),C=new s.DynamoDBClient({}),w=process.env.APP_TABLE_NAME,I=process.env.ORDERS_TABLE_NAME;function T(e){let r=e?.claims||{},t=r["custom:tier"]||r.tier,i=r["cognito:groups"],n=Array.isArray(i)?i:String(i||"").split(",").map(o=>o.trim()).filter(Boolean);return n.includes("ADMIN")?"ADMIN":n.includes("COLLAB")?"COLLAB":n.includes("PRIME")?"PRIME":n.includes("CREATOR")?"CREATOR":n.includes("BESTIE")?"BESTIE":t&&["FREE","BESTIE","CREATOR","COLLAB","ADMIN","PRIME"].includes(t)?t:"FREE"}function L(e){let r=T(e);if(!["CREATOR","COLLAB","ADMIN","PRIME"].includes(r))throw new Error("Creator tier required");return r}function p(e){if(!e?.sub)throw new Error("Not authenticated");return String(e.sub)}var B=async e=>{console.log("CommerceFn event",JSON.stringify(e));let r=e.info?.fieldName,t=e.identity,i=L(t),n=p(t);switch(r){case"creatorRevenueSummary":return{creatorId:n,tier:i,last30dRevenue:0,totalRevenue:0,affiliateClicks:0};case"recordAffiliateClick":{let{itemId:o,source:E}=e.arguments||{},a=new Date().toISOString();return await C.send(new s.PutItemCommand({TableName:I,Item:(0,c.marshall)({pk:`CREATOR#${n}`,sk:`CLICK#${a}`,type:"AFFILIATE_CLICK",itemId:o,source:E||"unknown",createdAt:a},{removeUndefinedValues:!0})})),{ok:!0}}default:throw new Error(`Unsupported field in CommerceFn: ${r}`)}};0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
