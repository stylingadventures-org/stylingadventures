"use strict";var a=Object.defineProperty;var u=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var g=Object.prototype.hasOwnProperty;var h=(t,e)=>{for(var r in e)a(t,r,{get:e[r],enumerable:!0})},l=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of y(e))!g.call(t,s)&&s!==r&&a(t,s,{get:()=>e[s],enumerable:!(o=u(e,s))||o.enumerable});return t};var A=t=>l(a({},"__esModule",{value:!0}),t);var I={};h(I,{handler:()=>O});module.exports=A(I);var i=require("@aws-sdk/client-s3"),f=new i.S3Client({region:process.env.AWS_REGION||"us-east-1"}),d=process.env.BUCKET||"",c=String(process.env.ALLOWED_ORIGINS||"").split(",").map(t=>t.trim()).filter(Boolean),C=(process.env.WEB_ORIGIN||"").trim();function m(t){let e=t.headers?.origin||t.headers?.Origin||"";return c.length>0?c.includes(e)?e:void 0:C||void 0}function n(t){let e={"Content-Type":"application/json","Access-Control-Allow-Headers":"authorization,Authorization,Content-Type,X-Amz-Date,X-Api-Key,X-Amz-Security-Token","Access-Control-Allow-Methods":"GET,HEAD,OPTIONS","Access-Control-Allow-Credentials":"true","Cache-Control":"private, max-age=2",Vary:"Origin"};return t&&(e["Access-Control-Allow-Origin"]=t),e}function p(t){let r=decodeURIComponent(String(t)).replace(/^[/\\]+/,"").replace(/\.\./g,"");return r.startsWith("thumbs/")?r:`thumbs/${r.replace(/\.[^.]+$/,".jpg")}`}var O=async t=>{let e=m(t),r=t.requestContext?.http?.method||t.httpMethod||"GET";if(r==="OPTIONS")return!!(t.headers?.origin||t.headers?.Origin)&&!e?{statusCode:403,headers:n(void 0),body:""}:{statusCode:204,headers:n(e),body:""};if(!d)return{statusCode:500,headers:n(e),body:JSON.stringify({message:"Missing BUCKET env var"})};let o=t.queryStringParameters?.key||"";if(!o)return{statusCode:400,headers:n(e),body:JSON.stringify({message:"Missing key"})};let s=p(o);try{return await f.send(new i.HeadObjectCommand({Bucket:d,Key:s})),r==="HEAD"?{statusCode:204,headers:n(e),body:""}:{statusCode:200,headers:n(e),body:JSON.stringify({ready:!0,key:s})}}catch{return r==="HEAD"?{statusCode:404,headers:n(e),body:""}:{statusCode:200,headers:n(e),body:JSON.stringify({ready:!1,key:s})}}};0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
