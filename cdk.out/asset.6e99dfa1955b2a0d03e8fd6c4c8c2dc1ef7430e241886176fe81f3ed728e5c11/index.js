"use strict";var a=Object.defineProperty;var c=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var y=Object.prototype.hasOwnProperty;var h=(t,e)=>{for(var r in e)a(t,r,{get:e[r],enumerable:!0})},g=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of u(e))!y.call(t,s)&&s!==r&&a(t,s,{get:()=>e[s],enumerable:!(o=c(e,s))||o.enumerable});return t};var l=t=>g(a({},"__esModule",{value:!0}),t);var O={};h(O,{handler:()=>p});module.exports=l(O);var i=require("@aws-sdk/client-s3"),C=new i.S3Client({region:process.env.AWS_REGION||"us-east-1"}),d=process.env.BUCKET,f=String(process.env.ALLOWED_ORIGINS||"").split(",").map(t=>t.trim()).filter(Boolean);function A(t){let e=t.headers?.origin||t.headers?.Origin||"";return f.includes(e??"")?e:void 0}function n(t){let e={"Content-Type":"application/json","Access-Control-Allow-Headers":"authorization,Authorization,Content-Type,X-Amz-Date,X-Api-Key,X-Amz-Security-Token","Access-Control-Allow-Methods":"GET,HEAD,POST,DELETE,OPTIONS","Access-Control-Allow-Credentials":"true","Cache-Control":"private, max-age=2",Vary:"Origin"};return t&&(e["Access-Control-Allow-Origin"]=t),e}function m(t){let e=decodeURIComponent(t);return e.startsWith("thumbs/")?e:`thumbs/${e.replace(/\.[^.]+$/,".jpg")}`}var p=async t=>{let e=A(t),r=t.requestContext?.http?.method||t.httpMethod;if(r==="OPTIONS")return(t.headers?.origin||t.headers?.Origin)&&!e?{statusCode:403,headers:n(void 0),body:""}:{statusCode:204,headers:n(e),body:""};try{if(!d)throw new Error("BUCKET env var is not set");let o=t.queryStringParameters?.key;if(!o)return{statusCode:400,headers:n(e),body:JSON.stringify({message:"Missing key"})};let s=m(o);return await C.send(new i.HeadObjectCommand({Bucket:d,Key:s})),r==="HEAD"?{statusCode:204,headers:n(e),body:""}:{statusCode:200,headers:n(e),body:JSON.stringify({ready:!0})}}catch{return r==="HEAD"?{statusCode:404,headers:n(e),body:""}:{statusCode:200,headers:n(e),body:JSON.stringify({ready:!1})}}};0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
