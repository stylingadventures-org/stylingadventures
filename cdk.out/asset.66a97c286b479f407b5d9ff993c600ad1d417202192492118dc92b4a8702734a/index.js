"use strict";var c=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames;var p=Object.prototype.hasOwnProperty;var m=(t,e)=>{for(var s in e)c(t,s,{get:e[s],enumerable:!0})},f=(t,e,s,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of C(e))!p.call(t,r)&&r!==s&&c(t,r,{get:()=>e[r],enumerable:!(n=y(e,r))||n.enumerable});return t};var h=t=>f(c({},"__esModule",{value:!0}),t);var A={};m(A,{handler:()=>g});module.exports=h(A);var o=require("@aws-sdk/client-s3"),x=new o.S3Client({region:process.env.AWS_REGION||"us-east-1",forcePathStyle:!0}),O=process.env.BUCKET,S=process.env.WEB_ORIGIN||"https://stylingadventures.com",u={"Access-Control-Allow-Origin":S,"Access-Control-Allow-Credentials":"true","Access-Control-Allow-Headers":"Authorization,Content-Type,X-Amz-Date,X-Amz-Security-Token","Access-Control-Allow-Methods":"GET,OPTIONS","Content-Type":"application/json",Vary:"Origin"},g=async t=>{if((t?.httpMethod||t?.requestContext?.http?.method)==="OPTIONS")return{statusCode:204,headers:u,body:""};try{let s=(t?.requestContext?.authorizer?.claims??t?.requestContext?.authorizer?.jwt?.claims??{})?.sub,n=(t?.queryStringParameters?.prefix??"").replace(/\.\./g,"").replace(/^[/\\]+/,""),l=`${s?`users/${s}/`:""}${n}`,i=await x.send(new o.ListObjectsV2Command({Bucket:O,Prefix:l||void 0,MaxKeys:1e3})),d=(i.Contents??[]).map(a=>({key:a.Key,size:a.Size,lastModified:a.LastModified?.toISOString?.()??null}));return{statusCode:200,headers:u,body:JSON.stringify({prefix:l,items:d,isTruncated:!!i.IsTruncated,nextToken:i.NextContinuationToken??null})}}catch(e){return console.error(e),{statusCode:500,headers:u,body:JSON.stringify({error:e?.message??String(e)})}}};0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
