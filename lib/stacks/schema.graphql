# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# SCALARS
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
scalar AWSDateTime
scalar AWSJSON

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ROOT TYPES
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

type Query {
  # Simple test
  hello: String!

  # Basic identity derived from Cognito JWT
  me: Me!

  # Closet (fan/bestie)
  myCloset: [ClosetItem!]!
  myWishlist: [ClosetItem!]!

  # NEW Bestie closet UI â€“ paginated connection
  bestieClosetItems(
    limit: Int
    nextToken: String
  ): BestieClosetItemsConnection!

  closetItemComments(closetItemId: ID!): [ClosetComment!]!

  # Admin closet views
  adminClosetItemLikes(closetItemId: ID!): [ClosetLike!]!
  adminClosetItemComments(closetItemId: ID!): [ClosetComment!]!
  adminListPending: [ClosetItem!]!

  # Paginated admin list used by Closet Library UI
  adminListClosetItems(
    status: ClosetStatus
    limit: Int
    nextToken: String
  ): ClosetItemConnection!

  # Bestie closet library (uses same shape, different resolver/filter)
  adminListBestieClosetItems(
    limit: Int
    nextToken: String
    search: String
    ownerSub: ID
  ): BestieClosetItemConnection!

  # Fan-facing closet feed
  closetFeed(
    sort: ClosetFeedSort
    status: ClosetStatus
    ownerSub: String
  ): [ClosetItem!]!

  # Bestie / tiers
  meBestieStatus: BestieStatus!

  # Episodes early-access gate
  isEpisodeEarlyAccess(episodeId: ID!): Boolean!

  # Game: leaderboard & polls & profile
  topXP(limit: Int): [LeaderboardEntry!]!
  topCoins(limit: Int): [LeaderboardEntry!]!
  getPoll(id: ID!): Poll
  getMyProfile: GameProfile!
}

type Mutation {
  # Roles
  setUserRole(userId: ID!, role: UserRole!): UserRoleAssignment!

  # Closet (fan/bestie)
  createClosetItem(input: CreateClosetItemInput!): ClosetItem!
  requestClosetApproval(closetItemId: ID!): ClosetItem!
  updateClosetMediaKey(closetItemId: ID!, mediaKey: String!): ClosetItem!

  # Legacy story metadata
  updateClosetItemStory(input: UpdateClosetItemStoryInput!): ClosetItem!

  likeClosetItem(closetItemId: ID!): ClosetItem!
  commentOnClosetItem(closetItemId: ID!, text: String!): ClosetComment!
  pinHighlight(closetItemId: ID!, pinned: Boolean!): ClosetItem!
  toggleWishlistItem(closetItemId: ID!): ClosetItem!

  # â­ NEW â€“ Bestie closet CRUD used by BestieCloset.jsx
  bestieCreateClosetItem(input: BestieCreateClosetItemInput!): ClosetItem!
  bestieUpdateClosetItem(
    id: ID!
    input: BestieUpdateClosetItemInput!
  ): ClosetItem!
  bestieDeleteClosetItem(id: ID!): ClosetItem!

  # Closet admin
  adminCreateClosetItem(input: AdminCreateClosetItemInput!): ClosetItem!
  adminApproveItem(closetItemId: ID!): ClosetItem!
  adminRejectItem(closetItemId: ID!, reason: String): ClosetItem!
  adminSetClosetAudience(
    closetItemId: ID!
    audience: ClosetAudience!
  ): ClosetItem!
  adminUpdateClosetItem(
    closetItemId: ID!
    input: AdminUpdateClosetItemInput!
  ): ClosetItem!

  # Hearts for fan closet feed
  toggleFavoriteClosetItem(id: ID!, favoriteOn: Boolean): ClosetItem

  # Bestie / tiers
  startBestieCheckout: BestieCheckoutSession!
  claimBestieTrial: BestieStatus!

  adminSetBestie(userId: ID!): BestieStatus!
  adminRevokeBestie(userId: ID!): BestieStatus!
  adminSetBestieByEmail(email: String!): BestieStatus!
  adminRevokeBestieByEmail(email: String!): BestieStatus!

  # Game
  logGameEvent(input: LogGameEventInput!): GameEventResult!
  awardCoins(userId: ID!, amount: Int!): GameProfile!

  createPoll(input: CreatePollInput!): Poll!
  votePoll(pollId: ID!, optionId: ID!): Poll!

  grantBadge(userId: ID!, badgeId: ID!): GameProfile!
  setDisplayName(name: String!): GameProfile!
  updateProfile(input: UpdateProfileInput!): GameProfile!

  # BESTIES â€“ CLOSET & BACKGROUNDS
  requestClosetBackgroundChange(
    input: RequestBackgroundChangeInput!
  ): ClosetItem!

  attachAffiliateLink(input: AttachAffiliateLinkInput!): ClosetItem!
  approveAffiliateLink(closetItemId: ID!): ClosetItem!
  rejectAffiliateLink(closetItemId: ID!, reason: String): ClosetItem!

  # BESTIES â€“ STORIES
  createStory(input: CreateStoryInput!): Story!
  publishStory(storyId: ID!): Story!

  # COMMUNITY / PINTEREST FEED
  addClosetItemToCommunityFeed(closetItemId: ID!): ClosetItem!
  removeClosetItemFromCommunityFeed(closetItemId: ID!): ClosetItem!
  shareClosetItemToPinterest(closetItemId: ID!): Boolean!
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# IDENTITY / USER
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

type Me {
  id: ID!
  email: String
  role: String
  tier: String
}

enum UserRole {
  FAN
  BESTIE
  ADMIN
}

type UserRoleAssignment {
  userId: ID!
  role: UserRole!
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# CLOSET DOMAIN
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

enum ClosetAudience {
  PRIVATE
  FOLLOWERS
  PUBLIC
  BESTIE
  EXCLUSIVE
  ADMIN_ONLY
  HIDDEN
}

enum ClosetStatus {
  DRAFT
  PENDING
  APPROVED
  REJECTED
  PUBLISHED
  ARCHIVED
}

enum ClosetFeedSort {
  NEWEST
  MOST_LOVED
}

# Connection wrapper for adminListClosetItems
type ClosetItemConnection {
  items: [ClosetItem!]!
  nextToken: String
}

# Bestie-specific connection wrapper (same item shape, different resolver/filter)
type BestieClosetItemConnection {
  items: [ClosetItem!]!
  nextToken: String
}

# Connection wrapper used by the Bestie closet UI
type BestieClosetItemsConnection {
  items: [ClosetItem!]!
  nextToken: String
}

type ClosetItem {
  id: ID!
  ownerSub: ID
  userId: ID
  title: String
  description: String
  story: String
  status: ClosetStatus
  audience: ClosetAudience
  mediaKey: String
  rawMediaKey: String

  # Categorization
  category: String
  subcategory: String

  # Story-style metadata (Bestie / fan-facing)
  storyTitle: String
  storySeason: String
  storyVibes: [String!]

  # Extra admin-upload metadata
  season: String
  vibes: String

  # Bestie closet metadata
  colorTags: [String!]
  notes: String
  visibility: ClosetAudience

  # Admin metadata (e.g. rejection reason)
  reason: String

  # Lala's pick flag
  pinned: Boolean

  # Computed flags/metrics
  isInWishlist: Boolean!
  isPinnedHighlight: Boolean!
  likesCount: Int!
  commentsCount: Int!

  # Fan â€œheartâ€ data
  favoriteCount: Int
  viewerHasFaved: Boolean

  createdAt: AWSDateTime
  updatedAt: AWSDateTime
}

input CreateClosetItemInput {
  title: String
  description: String
  story: String
  audience: ClosetAudience
  mediaKey: String
  rawMediaKey: String
  category: String
  subcategory: String
}

input AdminCreateClosetItemInput {
  ownerId: ID
  title: String
  description: String
  story: String
  mediaKey: String
  rawMediaKey: String
  audience: ClosetAudience
  season: String
  vibes: String
  category: String
  subcategory: String
}

input AdminUpdateClosetItemInput {
  title: String
  category: String
  subcategory: String
  audience: ClosetAudience
  pinned: Boolean
}

# ğŸ‘‡ used by updateClosetItemStory mutation
input UpdateClosetItemStoryInput {
  id: ID!
  storyTitle: String
  storySeason: String
  storyVibes: [String!]
}

# For Bestie closet uploads (BestieCloset.jsx)
input BestieCreateClosetItemInput {
  title: String
  rawMediaKey: String!          # S3 key from signedUpload â€“ required
  category: String!             # required
  subcategory: String!          # required
  colorTags: [String!]
  season: String
  notes: String
  visibility: ClosetAudience
}

input BestieUpdateClosetItemInput {
  title: String
  category: String
  subcategory: String
  colorTags: [String!]
  season: String
  notes: String
  visibility: ClosetAudience
}

type ClosetComment {
  id: ID!
  closetItemId: ID!
  authorId: ID!
  text: String!
  createdAt: AWSDateTime!
}

type ClosetLike {
  closetItemId: ID!
  userId: ID!
  createdAt: AWSDateTime!
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# BESTIE / TIERS
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

enum BestieTier {
  FREE
  PAID
}

type BestieStatus {
  userId: ID!
  isBestie: Boolean!
  tier: BestieTier!
  expiresAt: AWSDateTime
  activeSubscription: Boolean!
}

type BestieCheckoutSession {
  url: String!
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# BESTIES â€“ STORIES, BACKGROUNDS, AFFILIATE, FEED
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

enum StoryVisibility {
  PRIVATE
  BESTIES
  PUBLIC
}

type Story {
  id: ID!
  ownerSub: ID!
  title: String!
  body: String
  closetItemIds: [ID!]!
  stickers: AWSJSON
  polls: AWSJSON
  status: ClosetStatus!
  visibility: StoryVisibility!
  scheduledAt: AWSDateTime
  publishedAt: AWSDateTime
  shareToCommunityFeed: Boolean!
  shareToPinterest: Boolean!
}

input CreateStoryInput {
  title: String!
  body: String
  closetItemIds: [ID!]!
  stickers: AWSJSON
  polls: AWSJSON
  visibility: StoryVisibility = BESTIES
  scheduledAt: AWSDateTime
  shareToCommunityFeed: Boolean = false
  shareToPinterest: Boolean = false
}

input RequestBackgroundChangeInput {
  closetItemId: ID!
  requestedBackgroundStyle: String!
  notes: String
}

input AttachAffiliateLinkInput {
  closetItemId: ID!
  url: String!
  provider: String
  campaignTag: String
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# EPISODES / EARLY ACCESS
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

type EpisodeAccess {
  episodeId: ID!
  isEarlyAccess: Boolean!
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# GAME / PROFILE / LEADERBOARD / POLLS
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

type LeaderboardEntry {
  userId: ID!
  displayName: String
  xp: Int!
  coins: Int!
  rank: Int!
}

type GameProfile {
  userId: ID!
  displayName: String
  xp: Int!
  coins: Int!
  badges: [Badge!]!
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime
  pinnedClosetItems: [ClosetItem!]!
}

type Badge {
  id: ID!
  name: String!
  description: String
  earnedAt: AWSDateTime!
}

input UpdateProfileInput {
  displayName: String
}

input LogGameEventInput {
  type: String!
  episodeId: ID
  metadata: AWSJSON
}

type GameEventResult {
  success: Boolean!
  newXP: Int
  newCoins: Int
  xp: Int
  coins: Int
  lastEventAt: AWSDateTime
}

type Poll {
  id: ID!
  question: String!
  options: [PollOption!]!
  createdAt: AWSDateTime!
  closesAt: AWSDateTime
  totalVotes: Int!
}

type PollOption {
  id: ID!
  text: String!
  votes: Int!
}

input CreatePollInput {
  question: String!
  options: [String!]!
  closesAt: AWSDateTime
}
