<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, viewport-fit=cover"
  />
  <title>Styling Adventures</title>
  <link rel="icon" href="data:,">
  <style>
    :root {
      --bg: #0b1020;
      --card: #101a32;
      --text: #e6ecff;
      --muted: #9db0d8;
      --accent: #7aa2ff;
      --accent-2: #34d399;
      --ring: rgba(122,162,255,.35);
    }
    * { box-sizing: border-box }
    html,body { height: 100% }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: radial-gradient(1000px 600px at 20% -10%, #142147 0%, transparent 60%),
                  radial-gradient(900px 700px at 120% 20%, #1c2b59 0%, transparent 50%),
                  var(--bg);
      color: var(--text);
      display: grid;
      place-items: center;
      padding: clamp(16px, 3vw, 32px);
    }
    .card {
      width: min(920px, 94vw);
      background: color-mix(in oklab, var(--card) 92%, black 8%);
      border: 1px solid rgba(255,255,255,.06);
      border-radius: 18px;
      box-shadow: 0 10px 40px rgba(8,12,30,.45), inset 0 1px 0 rgba(255,255,255,.03);
      padding: clamp(20px, 4vw, 32px);
      backdrop-filter: blur(6px);
    }
    h1 {
      margin: 0 0 8px 0;
      font-size: clamp(28px, 3.4vw, 42px);
      letter-spacing: .2px;
    }
    p { margin: 8px 0; color: var(--muted); line-height: 1.55 }
    code { background: rgba(255,255,255,.08); padding: .1rem .35rem; border-radius: 6px }
    .row {
      display: flex; gap: 12px; flex-wrap: wrap;
      margin-top: 18px;
    }
    .btn {
      appearance: none;
      border: 1px solid rgba(255,255,255,.12);
      color: var(--text);
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      padding: 11px 16px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      letter-spacing: .2px;
      transition: transform .06s ease, box-shadow .06s ease, border-color .2s ease;
      box-shadow: 0 6px 18px rgba(0,0,0,.35);
    }
    .btn:hover { border-color: var(--ring) }
    .btn:active { transform: translateY(1px) }
    .btn.primary {
      background: linear-gradient(180deg, color-mix(in oklab, var(--accent) 85%, white 12%), color-mix(in oklab, var(--accent) 75%, black 10%));
      color: #0c1535;
      border-color: color-mix(in oklab, var(--accent) 60%, black 20%);
      box-shadow: 0 8px 28px color-mix(in oklab, var(--accent) 35%, black 65%);
    }
    .btn.secondary {
      background: linear-gradient(180deg, color-mix(in oklab, var(--accent-2) 85%, white 10%), color-mix(in oklab, var(--accent-2) 75%, black 10%));
      color: #062a1d;
      border-color: color-mix(in oklab, var(--accent-2) 60%, black 20%);
      box-shadow: 0 8px 28px color-mix(in oklab, var(--accent-2) 35%, black 65%);
    }
    .hint {
      margin-top: 14px;
      padding: 10px 12px;
      border: 1px dashed rgba(255,255,255,.12);
      border-radius: 12px;
      color: var(--muted);
      font-size: .95rem;
    }
    .kvs { display: grid; gap: 4px; margin-top: 10px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: .9rem; }
    .kvs span { color: #c6d4ff }
  </style>
</head>
<body>
  <main class="card">
    <h1>Styling Adventures – Fan Tier</h1>
    <p>This static page is served from S3 via CloudFront. Use the buttons below to try the Cognito Hosted UI round-trip.</p>

    <div class="row">
      <button class="btn primary" id="loginBtn">Sign in with Cognito</button>
      <button class="btn secondary" id="logoutBtn">Sign out</button>
    </div>

    <div class="hint">
      If you’re testing locally, after signing in you’ll land on
      <code>/callback/index.html</code>. Copy the <code>?code=…</code> value from the URL
      into your PowerShell when prompted.
    </div>

    <div class="kvs" id="debug"></div>
  </main>

  <script>
    // === Environment (filled from your deployment) ===
    const REGION   = "us-east-1";
    const DOMAIN   = "stylingadventures-256673";            // Cognito Hosted UI subdomain (without the .auth.)
    const CLIENTID = "7bkph1q2q1dgpk0497gk41t7tc";          // User Pool client ID
    const ORIGIN   = location.origin;
    const REDIRECT = `${ORIGIN}/callback/index.html`;
    const LOGOUT   = `${ORIGIN}/logout/index.html`;

    // Minimal PKCE (challenge only; Cognito will handle the rest server-side for Hosted UI redirect)
    async function sha256(input) {
      const data = new TextEncoder().encode(input);
      const digest = await crypto.subtle.digest('SHA-256', data);
      return btoa(String.fromCharCode(...new Uint8Array(digest)))
        .replace(/=/g, '').replace(/\+/g, '-').replace(/\//g, '_');
    }
    function randomStr(len=32) {
      const bytes = crypto.getRandomValues(new Uint8Array(len));
      return btoa(String.fromCharCode(...bytes))
        .replace(/=/g,'').replace(/\+/g,'-').replace(/\//g,'_');
    }

    // Build & go to Hosted UI
    document.getElementById('loginBtn').addEventListener('click', async () => {
      const verifier  = randomStr(32);
      sessionStorage.setItem('pkce_verifier', verifier); // for optional debugging
      const challenge = await sha256(verifier);
      const url = new URL(`https://${DOMAIN}.auth.${REGION}.amazoncognito.com/login`);
      url.searchParams.set('client_id', CLIENTID);
      url.searchParams.set('response_type', 'code');
      url.searchParams.set('scope', 'openid email profile');
      url.searchParams.set('redirect_uri', REDIRECT);
      url.searchParams.set('code_challenge_method', 'S256');
      url.searchParams.set('code_challenge', challenge);
      location.href = url.toString();
    });

    // Hosted UI logout
    document.getElementById('logoutBtn').addEventListener('click', () => {
      const url = new URL(`https://${DOMAIN}.auth.${REGION}.amazoncognito.com/logout`);
      url.searchParams.set('client_id', CLIENTID);
      url.searchParams.set('logout_uri', LOGOUT);
      location.href = url.toString();
    });

    // Debug panel (nice to see what the page thinks your env is)
    document.getElementById('debug').innerHTML = `
      <div><span>Origin:</span> ${ORIGIN}</div>
      <div><span>Redirect URI:</span> ${REDIRECT}</div>
      <div><span>Logout URI:</span> ${LOGOUT}</div>
      <div><span>Hosted UI:</span> https://${DOMAIN}.auth.${REGION}.amazoncognito.com</div>
    `;
  </script>
</body>
</html>
