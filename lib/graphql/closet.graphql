scalar AWSDateTime

# ---------------------------------------------------------------------------
# Enums
# ---------------------------------------------------------------------------
enum ClosetStatus {
  DRAFT
  PENDING
  APPROVED
  REJECTED
  PUBLISHED
}

enum ClosetAudience {
  PUBLIC
  BESTIE
  EXCLUSIVE
}

# Sort options for the public / fan-facing feed
enum ClosetFeedSort {
  NEWEST
  MOST_LOVED
}

# ---------------------------------------------------------------------------
# Types
# ---------------------------------------------------------------------------
type ClosetItem {
  id: ID!
  userId: ID!
  ownerSub: String!
  status: ClosetStatus!
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!

  # Media keys
  mediaKey: String        # cleaned/bg-removed asset
  rawMediaKey: String     # original upload key used by bg worker

  # Basic metadata
  title: String
  reason: String          # rejection reason, if any
  audience: ClosetAudience

  # Story metadata for Lala’s Closet + Bestie tools
  storyTitle: String
  storySeason: String
  storyVibes: [String!]

  # Aggregate favorites (nullable for back-compat)
  favoriteCount: Int

  # Per-viewer flag (nullable; will be treated as false in UI if missing)
  viewerHasFaved: Boolean
}

# ---------------------------------------------------------------------------
# Inputs
# ---------------------------------------------------------------------------
input UpdateClosetItemStoryInput {
  id: ID!
  storyTitle: String
  storySeason: String
  storyVibes: [String!]
}

# Admin create for background-removal pipeline
input AdminCreateClosetItemInput {
  title: String!

  """
  Exact S3 object key of the original upload (including prefix), e.g.
  "closet/<uuid>.jpg" or "users/<sub>/<uuid>.jpg".
  """
  rawMediaKey: String!

  season: String
  vibes: String
}

# ---------------------------------------------------------------------------
# Queries
# ---------------------------------------------------------------------------
type Query {
  # Signed-in creator’s items
  myCloset: [ClosetItem!]!

  # Items awaiting moderation
  adminListPending: [ClosetItem!]!

  """
  Fan-facing closet feed.

  Implementation note: resolver enforces status = PUBLISHED using the
  status GSI (default index name "gsi2") and filters by audience visibility.
  It currently returns a simple list, but accepts limit/nextToken for
  future pagination.
  """
  closetFeed(
    limit: Int
    nextToken: String
    sort: ClosetFeedSort = NEWEST
  ): [ClosetItem!]!

  # Small snippet for dashboards (Bestie + Fan home)
  topClosetLooks(limit: Int): [ClosetItem!]!
}

# ---------------------------------------------------------------------------
# Mutations
# ---------------------------------------------------------------------------
type Mutation {
  # Legacy/basic creator flows
  createClosetItem(title: String, mediaKey: String): ClosetItem!
  requestClosetApproval(id: ID!): String!
  updateClosetMediaKey(id: ID!, mediaKey: String!): ClosetItem!

  # Admin create wired to bg-removal pipeline
  adminCreateClosetItem(input: AdminCreateClosetItemInput!): ClosetItem!

  # Moderation actions
  adminApproveItem(id: ID!): ClosetItem!
  adminRejectItem(id: ID!, reason: String): ClosetItem!

  # Visibility controls (Lala’s Closet audiences)
  adminSetClosetAudience(id: ID!, audience: ClosetAudience!): ClosetItem!

  # Bestie-side story metadata for closet items
  updateClosetItemStory(input: UpdateClosetItemStoryInput!): ClosetItem!

  """
  Fan / favorite interaction.

  If "favoriteOn" is null, the resolver may toggle based on current state.
  Returns the updated ClosetItem with favoriteCount + viewerHasFaved
  hydrated for the caller (or null while backend is still stubbed).
  """
  toggleFavoriteClosetItem(id: ID!, favoriteOn: Boolean): ClosetItem
}
