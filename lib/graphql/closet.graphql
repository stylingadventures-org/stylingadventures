# lib/graphql/closet.graphql
scalar AWSDateTime

enum ClosetStatus {
  DRAFT
  PENDING
  APPROVED
  REJECTED
  PUBLISHED
}

enum ClosetAudience {
  PUBLIC
  BESTIE
  EXCLUSIVE
}

# Sort options for the public fan feed
enum ClosetFeedSort {
  NEWEST
  MOST_LOVED
}

type ClosetItem {
  id: ID!
  userId: ID!
  ownerSub: String!
  status: ClosetStatus!
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
  mediaKey: String
  title: String
  reason: String
  audience: ClosetAudience

  # Story metadata for Lala’s Closet + Bestie tools
  storyTitle: String
  storySeason: String
  storyVibes: [String!]

  # Aggregate favorites (backend) – nullable so old items are still valid
  favoriteCount: Int
}

type ClosetFeedPage {
  items: [ClosetItem!]
  nextToken: String
}

input UpdateClosetItemStoryInput {
  id: ID!
  storyTitle: String
  storySeason: String
  storyVibes: [String!]
}

type Query {
  myCloset: [ClosetItem!]!
  adminListPending: [ClosetItem!]!
  closetFeed(limit: Int, nextToken: String, sort: ClosetFeedSort): ClosetFeedPage

  # Small snippet for dashboards (Bestie + Fan home)
  topClosetLooks(limit: Int): [ClosetItem!]!
}

type Mutation {
  createClosetItem(title: String, mediaKey: String): ClosetItem!
  requestClosetApproval(id: ID!): String!
  updateClosetMediaKey(id: ID!, mediaKey: String!): ClosetItem!

  adminApproveItem(id: ID!): ClosetItem!
  adminRejectItem(id: ID!, reason: String): ClosetItem!

  adminSetClosetAudience(id: ID!, audience: ClosetAudience!): ClosetItem!

  updateClosetItemStory(input: UpdateClosetItemStoryInput!): ClosetItem!
}
