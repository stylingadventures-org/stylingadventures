<!doctype html>
<meta charset="utf-8">
<title>Styling Adventures · Admin</title>
<link rel="stylesheet" href="/styles.css" />
<script type="module">
  async function cfg(){ const r=await fetch('/config.v2.json?ts='+Date.now(),{cache:'no-store'}); return r.json(); }
  const c = await cfg();
  const clientId = c.clientId || c.clientID;
  const domain = c.hostedUiDomain
    ? `https://${c.hostedUiDomain}.auth.${c.region}.amazoncognito.com`
    : c.domain.replace(/\/+$/,'');
  const redirect = (location.origin.startsWith('http://localhost:'))
    ? 'http://localhost:5173/callback/'
    : 'https://d1so4qr6zsby5r.cloudfront.net/callback/';
  const state = crypto.getRandomValues(new Uint32Array(1))[0].toString(36);
  const ver = btoa(String.fromCharCode(...crypto.getRandomValues(new Uint8Array(32))))
               .replace(/\+/g,'-').replace(/\//g,'_').replace(/=+$/,'');
  sessionStorage.setItem('oauth_state', state);
  sessionStorage.setItem('pkce_verifier', ver);
  const challenge = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(ver))
    .then(b => btoa(String.fromCharCode(...new Uint8Array(b))).replace(/\+/g,'-').replace(/\//g,'_').replace(/=+$/,''));
  const p = new URLSearchParams({response_type:'code',client_id:clientId,redirect_uri:redirect,scope:'email openid profile',state,code_challenge:challenge,code_challenge_method:'S256'});
  document.getElementById('signin').href = `${domain}/oauth2/authorize?${p.toString()}`;
</script>
<body class="sa-body">
  <h1 class="sa-h1">Admin</h1>
  <p><a id="signin" class="sa-btn">Sign in</a></p>
  <p><a href="/fan/">← Back to Fan</a></p>
</body>
